ここページは、 WWA Wing を開発でトラブルを起こさないようにするためのガイドラインです。
コントリビューションの場合は、 [行動規範](./CODE_OF_CONDUCT_ja.md) を熟読の上、 以下の手順と注意事項をご確認願います。

# WWA Wing Team 以外のみなさんへ
まず、気になったことがありましたら [Issue](https://github.com/WWAWing/WWAWing/issues) に作成しましょう。 Issue では主に下記の内容について議論を行う場です。

- バグ
- 新機能追加
- 既存のソースコードの改修
- ロードマップに関する提案
- WWA Wing リポジトリの Wiki の編集要望

WWA Wing では、下記のことに念頭して活動していただくことを期待しています。

- [すべてのサポートブラウザ](https://github.com/WWAWing/WWAWing/blob/develop/README.md#%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6) で正しく動作できるようにする
- 見ていてわかりやすいソースコードにする (例: JSDoc の追加)
- より少ないマシンリソースで動作できるようにする

## ソースコードの変更をしたい
新機能追加やリファクタリングを行いたい場合は、通常以下の方法で実施します。

1. WWA Wing リポジトリをフォークします → [フォークを使って作業する - GitHub ヘルプ](https://help.github.com/ja/github/collaborating-with-issues-and-pull-requests/working-with-forks)
2. `develop` ブランチからブランチを作成します
3. 変更を加えます
4. `develop` ブランチへマージするプルリクエストを作成します
5. [WWA Wing Team のメンバー](https://github.com/orgs/WWAWing/people) からレビューを受けます (しばらく時間がかかる場合があります)
6. レビューで問題なければ、プルリクエストをマージします
7. プルリクエストのブランチを削除します

マージ後、 develop ブランチで変更した内容はマイナーバージョンアップ後に取り入れます。
- 💡 マイナーバージョンアップを行うと、バージョン番号の **マイナー** (`3.2.1` の `2` に該当) が1つ上がります。レビュー後、 WWA Wing Team のメンバーが手動で作業を行います。


## バージョニングポリシー
### 安定版 (しばしば、正式版と表記されることもあります)
安定版のバージョンは `X.Y.Z` という表記をしています。 `X`, `Y`, `Z` ともに 0 以上の整数値です。

- `Z` の部分は **パッチ** (patch) と呼び、軽微な機能の修正の場合に上がります。
- `Y` の部分は **マイナー** (minor) と呼び、機能の追加時に上がります。
- `X` の部分は **メジャー** (major) と呼びます。現状は 3 以外に使用していませんが、ユーザ体験が変わったり、既存のマクロ文に大幅な破壊的変更が入ったりした時に上げる想定です。

### 不安定版 (旧: alpha版, beta版相当)
不安定版のバージョンは、 `X.Y.Z-hogehoge.based-on.A.B.C` または  `X.Y.Z-hogehoge.based-on.A.B.C.p.n` という表記をしています。

- `X.Y.Z` の部分は、正式リリース予定のバージョンです。 `X`, `Y`, `Z` ともに 0 以上の整数値です。
- `hogehoge` の部分は、 提供される機能の名前です。半角英数とハイフンが使用されます。 (例: `gamepad`, `new-message-system`, `if-macro`)
- `A.B.C` の部分は、ベースにしている正式リリースのバージョンです。 `X.Y.Z` より過去のバージョンとなります。 `A`, `B`, `C` ともに 0 以上の整数値です。
- `p.n` の部分は、ベースにしている正式リリースのバージョンが同じものが複数ある場合に、後から出たものに `n` の部分に大きい番号が与えられます。 `n` は 1 以上の整数値です。
  - ベースにしている正式リリースのバージョンが 1 つのみの場合はこの部分はありません。

例えば、 `super-jumpgate` 機能が開発中で、ベースバージョンが `5.5.0` 、リリース予定のバージョンが `5.6.0` の場合は次のようにバージョンが進んでいきます。

1. `5.6.0-super-jumpgate.based-on.5.5.0`
2. `5.6.0-super-jumpgate.based-on.5.5.0.p.1`: `super-jumpgate` 機能に不具合があって修正
3. `5.6.0-super-jumpgate.based-on.5.5.0.p.2`: `super-jumpgate` 機能にまた不具合があって修正
4. `5.6.0-super-jumpgate.based-on.5.5.1`: バージョン `5.5.1` がリリースされたので、その内容に追従した
5. `5.6.0-super-jumpgate.based-on.5.5.1.p.1`: `super-jumpgate` 機能にまたまた不具合があって修正
6. `5.6.0-super-jumpgate.based-on.5.5.2`: バージョン `5.5.2` がリリースされたので、その内容に追従した

※ 正式リリース予定のバージョンは、リリース計画の変更によって途中で変更される可能性があります。

## レビューについて
ソースコードの品質を保つため、作成したプルリクエストをマージする場合は、事前に WWA Wing Team によるレビューが必要になります。

レビューについては、そもそも変更を加えたソースコードで動作するか、わかりにくい箇所がないか確認します。

問題がなければ、 WWA Wing Team のメンバーの1人が承認 (Approve) します。逆に修正が必要であればフィードバック (Comment あるいは Request changes) を加えます。

# WWA Wing Team のメンバーが行う作業
ここからは、 WWA Wing Team のメンバーができることについて記載しています。

## リリースしたい (develop→master）
要約: npm パッケージの publish は、 `develop` ブランチから`master` ブランチへのマージの **直前** に GitHub Actions の手動実行により実施します。
マージされると、GitHub Actions により自動で配布物のアップロードが実行されます。

1. `develop` ブランチから `master` ブランチにマージするプルリクエストを作成します
2. 他の WWA Wing Team のメンバーからレビューを受けます。
3. レビュー完了後、[マニュアル](https://www.notion.so/wwawing/7-26f484f68c974893b286f0aae17bc149)に今回のバージョンでの変更差分を書いてください。
4. **マージする前に** パッケージのpublishを行います。下記の手順に従ってください。
5. [WWA Wing Publish](https://github.com/WWAWing/WWAWing/actions/workflows/publish.yml) のページを開き、画面右側にある `Run workflow` を押してください。
6. 「バージョンを入力」欄に次の文字列を入力し、「Run workflow」を押してください (ブランチ名は `develop` のままに、publishに使うタグ名は、そのまま `latest` としてください)。
  - バージョン番号の一番下の値(**パッチ**) ( `3.2.1 ` なら `1`) を上げたい場合は  `patch` を (主に軽微な修正時に選択)、
  - バージョン番号の真ん中の値(**マイナー**) ( `3.2.1 ` なら `2`) を上げたい場合は  `minor` を (主に機能の追加時に選択)、
  - バージョン番号の最も上の値(**メジャー**) (`3.2.1` なら `3`) を上げたい場合は `major` を (ユーザ体験が大きく変わるなど、大規模なアップデート時に選択)、それぞれ記入してください。
7. 成功したら、プルリクエストにバージョン上げのコミットが含まれていることを確認してから、プルリクエストをマージします。
8. https://github.com/WWAWing/WWAWing/releases で新しいリリースを作成してください。タグ名は、新しいバージョン名としてください。
9. リリースが作成されると、自動で配布物のアップロードと、WWA Wing の サイト更新の Pull Request 作成が実行されます。
10.  https://github.com/WWAWing/sites にできたサイト更新のPRをレビューしてマージしてください。

## 急遽変更が必要になった (hotfix)
セキュリティやバグの関係ですぐに修正が必要になった場合でかつ、`develop` ブランチをすぐにリリースできない場合は、以下の方法で実施します。
ただし、 **バグ修正や小規模の機能追加に限ります** 。

1. `master` ブランチからブランチを作成します
2. 変更を加えます
3. **`master` ブランチへマージする** プルリクエストを作成します
4. リリースフローに従ってリリースを行います (**先述「リリースしたい」の3.～9.に従ってください。**)
5. master ブランチから develop ブランチに変更を反映します (**後述**)

## master → develop の変更を反映したい
1. develop ブランチを pull して develop ブランチの内容を最新の内容に更新します
2. develop ブランチからブランチを作成します
3. master ブランチから `2.` のブランチにマージします
4. **develop ブランチへマージする** プルリクエストを作成します
5. WWA Wing Team のメンバーからレビューを受けます (見るだけですので、大抵の場合は承認されるはず)
6. レビューで問題なければ、プルリクエストをマージします
7. プルリクエストのブランチを削除します

## 不安定版 npm パッケージの publish について
※実施する前に @matsuyuki-a までご相談ください。

正式版でない npm パッケージを publish する場合は、 [WWA Wing Publish](https://github.com/WWAWing/WWAWing/actions/workflows/publish.yml) のページを開き、

- publish したいブランチを選択する
- バージョン名を `3.2.0-hogehoge.based-on.3.1.9.p.1` のように、フルで記入 (vなし)
- タグ名を、上記バージョン名の `hogehoge` の部分の文字列とする (将来的にはここは省略できるようにしたい...)

の3点を守り、`Run workflow` を押してください。
