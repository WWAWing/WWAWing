/*
 WWA Wing
 http://wwawing.com/
 Copyright (c) 1996-2015 NAO
 Copyright (c) 2015 WWA Wing Team
 LICENSE: https://raw.githubusercontent.com/WWAWing/WWAWing/master/LICENSE

 CryptoJS v3.1.2
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
*/
var wwa_input;
(function(f){(function(b){b[b.NONE=0]="NONE";b[b.KEYDOWN=1]="KEYDOWN";b[b.KEYPRESS=2]="KEYPRESS";b[b.KEYUP=3]="KEYUP";b[b.KEYPRESS_MESSAGECHANGE=4]="KEYPRESS_MESSAGECHANGE"})(f.KeyState||(f.KeyState={}));var d=f.KeyState;(function(b){b[b.KEY_ENTER=13]="KEY_ENTER";b[b.KEY_SHIFT=16]="KEY_SHIFT";b[b.KEY_ESC=27]="KEY_ESC";b[b.KEY_SPACE=32]="KEY_SPACE";b[b.KEY_LEFT=37]="KEY_LEFT";b[b.KEY_UP=38]="KEY_UP";b[b.KEY_RIGHT=39]="KEY_RIGHT";b[b.KEY_DOWN=40]="KEY_DOWN";b[b.KEY_1=49]="KEY_1";b[b.KEY_2=50]="KEY_2";
b[b.KEY_3=51]="KEY_3";b[b.KEY_A=65]="KEY_A";b[b.KEY_C=67]="KEY_C";b[b.KEY_D=68]="KEY_D";b[b.KEY_E=69]="KEY_E";b[b.KEY_I=73]="KEY_I";b[b.KEY_M=77]="KEY_M";b[b.KEY_N=78]="KEY_N";b[b.KEY_P=80]="KEY_P";b[b.KEY_Q=81]="KEY_Q";b[b.KEY_S=83]="KEY_S";b[b.KEY_W=87]="KEY_W";b[b.KEY_X=88]="KEY_X";b[b.KEY_Y=89]="KEY_Y";b[b.KEY_Z=90]="KEY_Z";b[b.KEY_F1=112]="KEY_F1";b[b.KEY_F3=114]="KEY_F3";b[b.KEY_F4=115]="KEY_F4";b[b.KEY_F5=116]="KEY_F5";b[b.KEY_F6=117]="KEY_F6";b[b.KEY_F7=118]="KEY_F7";b[b.KEY_F8=119]="KEY_F8";
b[b.KEY_F12=123]="KEY_F12"})(f.KeyCode||(f.KeyCode={}));var k=function(){function b(){var h;this._nextKeyState=Array(b.KEY_BUFFER_MAX);this._keyState=Array(b.KEY_BUFFER_MAX);this._prevKeyState=Array(b.KEY_BUFFER_MAX);this._prevKeyStateOnControllable=Array(b.KEY_BUFFER_MAX);this._keyInputContinueFrameNum=Array(b.KEY_BUFFER_MAX);for(h=0;h<b.KEY_BUFFER_MAX;h++)this._nextKeyState[h]=!1,this._keyState[h]=!1,this._prevKeyState[h]=!1,this._prevKeyStateOnControllable[h]=!1,this._keyInputContinueFrameNum[h]=
0}b.prototype.checkHitKey=function(b){b=this.getKeyState(b);return b===d.KEYDOWN||b===d.KEYPRESS};b.prototype.getKeyState=function(b){return this._prevKeyState[b]?this._keyState[b]?d.KEYPRESS:d.KEYUP:this._keyState[b]?d.KEYDOWN:d.NONE};b.prototype.getKeyStateForControllPlayer=function(b){return this._prevKeyStateOnControllable[b]?this._keyState[b]?d.KEYPRESS:d.KEYUP:this._keyState[b]?d.KEYDOWN:d.NONE};b.prototype.getKeyStateForMessageCheck=function(b){return this._prevKeyState[b]?this._keyState[b]?
this._keyInputContinueFrameNum[b]>=wwa_data.WWAConsts.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM?d.KEYPRESS_MESSAGECHANGE:d.KEYPRESS:d.KEYUP:this._keyState[b]?d.KEYDOWN:d.NONE};b.prototype.setPressInfo=function(b){this._nextKeyState[b]=!0;this._keyInputContinueFrameNum[b]=-1};b.prototype.setReleaseInfo=function(b){this._nextKeyState[b]=!1;this._keyInputContinueFrameNum[b]=-1};b.prototype.update=function(){var h;this._prevKeyState=this._keyState.slice();this._keyState=this._nextKeyState.slice();for(h=0;h<b.KEY_BUFFER_MAX;h++)this._keyState[h]&&
this._keyInputContinueFrameNum[h]++};b.prototype.memorizeKeyStateOnControllableFrame=function(){this._prevKeyStateOnControllable=this._keyState.slice()};b.prototype.allClear=function(){var h;this._nextKeyState=Array(b.KEY_BUFFER_MAX);for(h=0;h<b.KEY_BUFFER_MAX;h++)this._nextKeyState[h]=!1};b.KEY_BUFFER_MAX=256;return b}();f.KeyStore=k;(function(b){b[b.NONE=0]="NONE";b[b.MOUSEDOWN=1]="MOUSEDOWN";b[b.MOUSEPRESS=2]="MOUSEPRESS";b[b.MOUSEUP=3]="MOUSEUP"})(f.MouseState||(f.MouseState={}));var b=f.MouseState,
k=function(){function d(){this._nextMouseState=this._mouseState=this._prevMouseState=!1}d.prototype.checkClickMouse=function(d){d=void 0!==d?this.getMouseState(d):this.getMouseState();return d===b.MOUSEDOWN||d===b.MOUSEPRESS};d.prototype.getMouseState=function(d){return void 0!==d&&this._inputDir!==d?b.NONE:this._prevMouseState?this._mouseState?b.MOUSEPRESS:b.MOUSEUP:this._mouseState?b.MOUSEDOWN:b.NONE};d.prototype.getMouseStateForControllPlayer=function(d){return void 0!==d&&this._inputDir!==d?b.NONE:
this._prevMouseStateOnControllable?this._mouseState?b.MOUSEPRESS:b.MOUSEUP:this._mouseState?b.MOUSEDOWN:b.NONE};d.prototype.setPressInfo=function(b,a){this._nextMouseState=!0;this._inputDir=b;this._touchID=a};d.prototype.setReleaseInfo=function(){this._touchID=void 0;this._nextMouseState=!1};d.prototype.memorizeMouseStateOnControllableFrame=function(){this._prevMouseStateOnControllable=this._mouseState};d.prototype.update=function(){this._prevMouseState=this._mouseState;this._mouseState=this._nextMouseState};
d.prototype.clear=function(){this._nextMouseState=!1};d.prototype.getTouchID=function(){return this._touchID};return d}();f.MouseStore=k})(wwa_input||(wwa_input={}));var __extends=this&&this.__extends||function(f,d){function k(){this.constructor=f}for(var b in d)d.hasOwnProperty(b)&&(f[b]=d[b]);f.prototype=null===d?Object.create(d):(k.prototype=d.prototype,new k)},wwa_data;
(function(f){var d=function(){function a(a,b){this.strength=a;this.defence=b}a.prototype.add=function(a){this.strength+=a.strength;this.defence+=a.defence;return this};a.prototype.plus=function(b){return new a(this.strength+b.strength,this.defence+b.defence)};a.prototype.minus=function(b){return new a(this.strength-b.strength,this.defence-b.defence)};a.prototype.equals=function(a){return this.strength===a.strength&&this.defence===a.defence};return a}();f.EquipmentStatus=d;d=function(a){function b(b,
c,w,d){a.call(this,c,w);this.energy=b;this.gold=d}__extends(b,a);b.prototype.add=function(a){a instanceof b&&(this.energy+=a.energy,this.gold+=a.gold);this.strength+=a.strength;this.defence+=a.defence;return this};b.prototype.plus=function(a){return a instanceof b?new b(this.energy+a.energy,this.strength+a.strength,this.defence+a.defence,this.gold+a.gold):new b(this.energy,this.strength+a.strength,this.defence+a.defence,this.gold)};b.prototype.minus=function(a){return a instanceof b?new b(this.energy-
a.energy,this.strength-a.strength,this.defence-a.defence,this.gold-a.gold):new b(this.energy,this.strength-a.strength,this.defence-a.defence,this.gold)};b.prototype.equals=function(a){return this.energy===a.energy&&this.strength===a.strength&&this.defence===a.defence&&this.gold===a.gold};return b}(d);f.Status=d;var k=function(){function a(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.x=a;this.y=b}a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y};a.prototype.substract=function(b){return new a(this.x-
b.x,this.y-b.y)};a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.convertIntoPosition=function(a){return new b(a,this.x,this.y,0,0)};a.prototype.getDirectionTo=function(a){return this.x<a.x?this.y>a.y?r.RIGHT_UP:this.y===a.y?r.RIGHT:r.RIGHT_DOWN:this.x===a.x?this.y>a.y?r.UP:this.y===a.y?r.NO_DIRECTION:r.DOWN:this.y>a.y?r.LEFT_UP:this.y===a.y?r.LEFT:r.LEFT_DOWN};a.prototype.toString=function(){return"("+this.x+", "+this.y+")"};return a}();f.Coord=k;var b=function(){function a(a,
b,c,d,h){void 0===d&&(d=0);void 0===h&&(h=0);this._wwa=a;if(void 0===this._wwa)throw Error("WWA\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3057\u307e\u305b\u3093. ");a=this._wwa.getMapWidth();if(0>b||b>=a||b>=a-1&&0<d||0>c||c>=a||c>=a-1&&0<h)throw Error("\u7bc4\u56f2\u5916\u306e\u5ea7\u6a19\u3067\u3059!! parts:("+b+", "+c+"), offset:("+d+", "+h+"), mapWidth = "+a);this._partsCoord=new k(b,c);this._offsetCoord=new k(d,h)}a.prototype.getPartsCoord=function(){return this._partsCoord};
a.prototype.getOffsetCoord=function(){return this._offsetCoord};a.prototype.getScreenTopPosition=function(){return new a(this._wwa,Math.floor(this._partsCoord.x/(h.H_PARTS_NUM_IN_WINDOW-1))*(h.H_PARTS_NUM_IN_WINDOW-1),Math.floor(this._partsCoord.y/(h.V_PARTS_NUM_IN_WINDOW-1))*(h.V_PARTS_NUM_IN_WINDOW-1),0,0)};a.prototype.getDefaultCameraPosition=function(){var a=this.getScreenTopPosition(),b=a.getPartsCoord(),c=this._wwa.getMapWidth(),a=a.getPartsCoord().clone();b.x===c-1&&a.x--;b.y===c-1&&a.y--;
return a.convertIntoPosition(this._wwa).getScreenTopPosition()};a.prototype.getNextJustPosition=function(b){if(void 0!==b){var n=this._partsCoord;return new a(this._wwa,n.x+f.vx[b],n.y+f.vy[b],0,0)}b=this._partsCoord.x;n=this._partsCoord.y;0>this._offsetCoord.x?b--:0<this._offsetCoord.x&&b++;0>this._offsetCoord.y?n--:0<this._offsetCoord.y&&n++;return new a(this._wwa,b,n,0,0)};a.prototype.getNextFramePosition=function(b,n,c){var w=this._partsCoord.x,d=this._partsCoord.y;n=this._offsetCoord.x+f.vx[b]*
n;b=this._offsetCoord.y+f.vy[b]*c;0>n&&(c=Math.floor(Math.abs(n)/h.CHIP_SIZE),w-=c,n=(n+c*h.CHIP_SIZE)%h.CHIP_SIZE);0>b&&(c=Math.floor(Math.abs(b)/h.CHIP_SIZE),d-=c,b=(b+c*h.CHIP_SIZE)%h.CHIP_SIZE);n>=h.CHIP_SIZE&&(w+=Math.floor(n/h.CHIP_SIZE),n=(n+h.CHIP_SIZE)%h.CHIP_SIZE);b>=h.CHIP_SIZE&&(d+=Math.floor(b/h.CHIP_SIZE),b=(b+h.CHIP_SIZE)%h.CHIP_SIZE);return new a(this._wwa,w,d,n,b)};a.prototype.isJustPosition=function(){return 0==this._offsetCoord.x&&0==this._offsetCoord.y};a.prototype.isScreenTopPosition=
function(){var a=this.getScreenTopPosition();return this.equals(a)};a.prototype.equals=function(a){return this._partsCoord.equals(a.getPartsCoord())&&this._offsetCoord.equals(a.getOffsetCoord())};a.prototype.isInCameraRange=function(a,b){void 0===b&&(b=!1);var c=a.getPosition()._partsCoord,n=this._partsCoord.x,w=this._partsCoord.y,d=b?1:0;return c.x<=n&&n<c.x+h.H_PARTS_NUM_IN_WINDOW-d&&c.y<=w&&w<c.y+h.V_PARTS_NUM_IN_WINDOW-d};a.prototype.hasLocalGate=function(){return this._wwa.getMapTypeByPosition(this)===
h.MAP_LOCALGATE||this._wwa.getObjectTypeByPosition(this)===h.OBJECT_LOCALGATE};a.prototype.clone=function(){return new a(this._wwa,this._partsCoord.x,this._partsCoord.y,this._offsetCoord.x,this._offsetCoord.y)};return a}();f.Position=b;d=function(){return function(a,b,n){this.destPos=a.clone();this.srcPos=b.clone();this.srcSize=n.clone()}}();f.Face=d;(function(a){a[a.LEFT=0]="LEFT";a[a.RIGHT=1]="RIGHT";a[a.DOWN=2]="DOWN";a[a.UP=3]="UP";a[a.LEFT_DOWN=4]="LEFT_DOWN";a[a.LEFT_UP=5]="LEFT_UP";a[a.RIGHT_DOWN=
6]="RIGHT_DOWN";a[a.RIGHT_UP=7]="RIGHT_UP";a[a.NO_DIRECTION=8]="NO_DIRECTION"})(f.Direction||(f.Direction={}));var r=f.Direction;f.vx=[-1,1,0,0,-1,-1,1,1,0];f.vy=[0,0,1,-1,1,-1,1,-1,0];f.dirToPos=[4,6,2,0];f.dirToKey=[wwa_input.KeyCode.KEY_LEFT,wwa_input.KeyCode.KEY_RIGHT,wwa_input.KeyCode.KEY_DOWN,wwa_input.KeyCode.KEY_UP];(function(a){a[a.YES=0]="YES";a[a.NO=1]="NO";a[a.UNSELECTED=2]="UNSELECTED"})(f.YesNoState||(f.YesNoState={}));(function(a){a[a.MAP=0]="MAP";a[a.OBJECT=1]="OBJECT";a[a.CHOICE_YES=
2]="CHOICE_YES";a[a.CHOICE_NO=3]="CHOICE_NO"})(f.AppearanceTriggerType||(f.AppearanceTriggerType={}));(function(a){a[a.NORMAL=0]="NORMAL";a[a.CAN_USE=1]="CAN_USE";a[a.NOT_DISAPPEAR=2]="NOT_DISAPPEAR"})(f.ItemMode||(f.ItemMode={}));(function(a){a[a.MAP=1]="MAP";a[a.OBJECT=0]="OBJECT"})(f.PartsType||(f.PartsType={}));(function(a){a[a.NONE=0]="NONE";a[a.CALL_BY_MAP_PARTS=1]="CALL_BY_MAP_PARTS";a[a.CALL_BY_OBJECT_PARTS=2]="CALL_BY_OBJECT_PARTS";a[a.CALL_BY_ITEM_USE=3]="CALL_BY_ITEM_USE";a[a.CALL_BY_QUICK_SAVE=
4]="CALL_BY_QUICK_SAVE";a[a.CALL_BY_QUICK_LOAD=5]="CALL_BY_QUICK_LOAD";a[a.CALL_BY_RESTART_GAME=6]="CALL_BY_RESTART_GAME";a[a.CALL_BY_GOTO_WWA=7]="CALL_BY_GOTO_WWA";a[a.CALL_BY_PASSWORD_SAVE=8]="CALL_BY_PASSWORD_SAVE";a[a.CALL_BY_PASSWORD_LOAD=9]="CALL_BY_PASSWORD_LOAD"})(f.ChoiceCallInfo||(f.ChoiceCallInfo={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.QUICK_SAVE=1]="QUICK_SAVE";a[a.RESTART_GAME=2]="RESTART_GAME";a[a.GOTO_WWA=3]="GOTO_WWA"})(f.SidebarButton||(f.SidebarButton={}));(function(a){a[a.UP=
0]="UP";a[a.DOWN=1]="DOWN"})(f.SpeedChange||(f.SpeedChange={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.RESTART_GAME=1]="RESTART_GAME";a[a.PASSWORD=2]="PASSWORD"})(f.LoadType||(f.LoadType={}));(function(a){a[a.STATIC=0]="STATIC";a[a.CHASE_PLAYER=1]="CHASE_PLAYER";a[a.RUN_OUT=2]="RUN_OUT";a[a.HANG_AROUND=3]="HANG_AROUND"})(f.MoveType||(f.MoveType={}));(function(a){a[a.MODE_X=0]="MODE_X";a[a.MODE_Y=1]="MODE_Y";a[a.UNDECIDED=2]="UNDECIDED"})(f.SecondCandidateMoveType||(f.SecondCandidateMoveType=
{}));f.sidebarButtonCellElementID=["cell-load","cell-save","cell-restart","cell-gotowwa"];(function(a){a[a.ASK_LINK=5]="ASK_LINK";a[a.NO_MONEY=6]="NO_MONEY";a[a.NO_ITEM=7]="NO_ITEM";a[a.USE_ITEM=8]="USE_ITEM"})(f.SystemMessage1||(f.SystemMessage1={}));(function(a){a[a.CLICKABLE_ITEM=0]="CLICKABLE_ITEM";a[a.FULL_ITEM=1]="FULL_ITEM";a[a.LOAD_SE=2]="LOAD_SE"})(f.SystemMessage2||(f.SystemMessage2={}));(function(a){a[a.UNDEFINED=0]="UNDEFINED";a[a.IMGPLAYER=1]="IMGPLAYER";a[a.IMGYESNO=2]="IMGYESNO";a[a.HPMAX=
3]="HPMAX";a[a.SAVE=4]="SAVE";a[a.ITEM=5]="ITEM";a[a.DEFAULT=6]="DEFAULT";a[a.OLDMAP=7]="OLDMAP";a[a.PARTS=8]="PARTS";a[a.MOVE=9]="MOVE";a[a.MAP=10]="MAP";a[a.DIRMAP=11]="DIRMAP";a[a.IMGFRAME=12]="IMGFRAME";a[a.IMGBOM=13]="IMGBOM";a[a.DELPLAYER=14]="DELPLAYER";a[a.FACE=15]="FACE";a[a.EFFECT=16]="EFFECT";a[a.GAMEOVER=17]="GAMEOVER";a[a.IMGCLICK=18]="IMGCLICK";a[a.STATUS=19]="STATUS";a[a.EFFITEM=20]="EFFITEM";a[a.COLOR=21]="COLOR";a[a.WAIT=22]="WAIT";a[a.SOUND=23]="SOUND"})(f.MacroType||(f.MacroType=
{}));f.macrotable={"":0,$imgplayer:1,$imgyesno:2,$hpmax:3,$save:4,$item:5,$default:6,$oldmap:7,$parts:8,$move:9,$map:10,$dirmap:11,$imgframe:12,$imgbom:13,$delplayer:14,$face:15,$effect:16,$gameover:17,$imgclick:18,$status:19,$effitem:20,$color:21,$wait:22,$sound:23};(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.MOVES=4]="MOVES"})(f.MacroStatusIndex||(f.MacroStatusIndex={}));(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";
a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.WIDE_CELL_ROW=4]="WIDE_CELL_ROW";a[a.ITEM_BG=5]="ITEM_BG";a[a.MAIN_FRAME=6]="MAIN_FRAME"})(f.MacroImgFrameIndex||(f.MacroImgFrameIndex={}));(function(a){a[a.DECISION=1]="DECISION";a[a.ATTACK=3]="ATTACK";a[a.BGM_LB=70]="BGM_LB";a[a.NO_SOUND=99]="NO_SOUND"})(f.SystemSound||(f.SystemSound={}));f.speedList=[2,5,8,10];f.speedNameList=["\u4f4e\u901f","\u6e96\u4f4e\u901f","\u4e2d\u901f","\u9ad8\u901f"];var h=function(){function a(){}a.VERSION_WWAJS="W3.15b++";
a.WWA_HOME="http://wwajp.com";a.ITEMBOX_SIZE=12;a.MAP_ATR_MAX=60;a.OBJ_ATR_MAX=60;a.OLD_MAP_ATR_MAX=40;a.OLD_OBJ_ATR_MAX=40;a.ATR_TYPE=3;a.ATR_MODE=4;a.ATR_STRING=5;a.ATR_X=6;a.ATR_Y=7;a.ATR_X2=8;a.ATR_Y2=9;a.ATR_ENERGY=10;a.ATR_STRENGTH=11;a.ATR_DEFENCE=12;a.ATR_GOLD=13;a.ATR_ITEM=14;a.ATR_NUMBER=15;a.ATR_JUMP_X=16;a.ATR_MOVE=16;a.ATR_JUMP_Y=17;a.ATR_SOUND=19;a.ATR_APPERANCE_BASE=20;a.REL_ATR_APPERANCE_ID=0;a.REL_ATR_APPERANCE_X=1;a.REL_ATR_APPERANCE_Y=2;a.REL_ATR_APPERANCE_TYPE=3;a.REL_ATR_APPERANCE_UNIT_LENGTH=
4;a.ATR_RANDOM_BASE=10;a.RANDOM_ATR_NUM=10;a.RANDOM_ITERATION_MAX=10;a.MAP_STREET=0;a.MAP_WALL=1;a.MAP_LOCALGATE=2;a.MAP_URLGATE=4;a.OBJECT_NORMAL=0;a.OBJECT_MESSAGE=1;a.OBJECT_URLGATE=2;a.OBJECT_STATUS=3;a.OBJECT_ITEM=4;a.OBJECT_DOOR=5;a.OBJECT_MONSTER=6;a.OBJECT_SCORE=11;a.OBJECT_SELL=14;a.OBJECT_BUY=15;a.OBJECT_RANDOM=16;a.OBJECT_SELECT=17;a.OBJECT_LOCALGATE=18;a.SYSTEM_MESSAGE_NUM=20;a.IMGPOS_DEFAULT_YESNO_X=3;a.IMGPOS_DEFAULT_YESNO_Y=1;a.IMGRELPOS_YESNO_YES_X=0;a.IMGRELPOS_YESNO_NO_X=1;a.IMGRELPOS_YESNO_YESP_X=
2;a.IMGRELPOS_YESNO_NOP_X=3;a.IMGPOS_DEFAULT_PLAYER_X=2;a.IMGPOS_DEFAULT_PLAYER_Y=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y=0;a.IMGPOS_DEFAULT_FRAME_X=0;a.IMGPOS_DEFAULT_FRAME_Y=1;a.IMGPOS_DEFAULT_BATTLE_EFFECT_X=3;a.IMGPOS_DEFAULT_BATTLE_EFFECT_Y=3;a.DEFAULT_DISABLE_SAVE=!1;a.DEFAULT_OLDMAP=!1;a.DEFAULT_OBJECT_NO_COLLAPSE=!1;a.SPLASH_SCREEN_DISP_MILLS=100;a.DEFAULT_FRAME_INTERVAL=20;a.GAMEOVER_FRAME_INTERVAL=50;a.YESNO_PRESS_DISP_FRAME_NUM=20;a.CHIP_SIZE=40;
a.MAP_WINDOW_WIDTH=440;a.MAP_WINDOW_HEIGHT=440;a.H_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_WIDTH/a.CHIP_SIZE;a.V_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_HEIGHT/a.CHIP_SIZE;a.DEFAULT_SPEED_INDEX=2;a.MIN_SPEED_INDEX=0;a.MAX_SPEED_INDEX=f.speedList.length-1;a.ANIMATION_REP_HALF_FRAME=22;a.PLAYER_LOOKING_AROUND_START_FRAME=4*a.ANIMATION_REP_HALF_FRAME;a.RELATIVE_COORD_BIAS=1E4;a.RELATIVE_COORD_LOWER=a.RELATIVE_COORD_BIAS-1E3;a.PLAYER_COORD=a.RELATIVE_COORD_BIAS-1E3;a.LOCALGATE_PLAYER_WAIT_FRAME=5;a.STATUS_CHANGED_EFFECT_FRAME_NUM=
20;a.PASSABLE_OBJECT=1;a.APPERANCE_PARTS_MIN_INDEX=0;a.APPERANCE_PARTS_MAX_INDEX=9;a.APPERANCE_PARTS_MIN_INDEX_NO=5;a.APPERANCE_PARTS_MAX_INDEX_YES=4;a.FADEOUT_SPEED=8;a.STATUS_MINUS_BORDER=3E4;a.ITEMBOX_IS_FULL=-1;a.BATTLE_INTERVAL_FRAME_NUM=10;a.BATTLE_SPEED_CHANGE_TURN_NUM=40;a.RANDOM_MOVE_ITERATION_NUM=50;a.BATTLE_ESTIMATE_MONSTER_TYPE_MAX=8;a.SOUND_MAX=100;a.ITEM_BORDER_IMG_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAArklEQVRYR+2Y0QqAIAxFt///aENJHwxxuJUSxzeh3S7HXaNpEkly4FIRzba0GEyHeVTN7jqDWvb7V4Y1NLibZIY0NbiL5G3MZLCe / 1fn3XJgJYjB7mgg6O1VCEKwXo79JeklY62nB62kRs9BEIKkeNIDhISQEBJC4k0BBCF4D7D4cV9shf99ixdB + MrM0y3fa3zV05D45GOqhwPMGPkYlccIOEY2VKUN0UNVXxC7ADj7mDi9aFZZAAAAAElFTkSuQmCC";
a.LOAD_STAGE_MAX_EXCEPT_AUDIO=7;a.WWA_STYLE_TAG_ID="wwa-additional-style";a.DEFAULT_FRAME_COLOR_R=255;a.DEFAULT_FRAME_COLOR_G=255;a.DEFAULT_FRAME_COLOR_B=255;a.DEFAULT_FRAMEOUT_COLOR_R=96;a.DEFAULT_FRAMEOUT_COLOR_G=96;a.DEFAULT_FRAMEOUT_COLOR_B=96;a.DEFAULT_STRBACK_COLOR_R=0;a.DEFAULT_STRBACK_COLOR_G=0;a.DEFAULT_STRBACK_COLOR_B=0;a.DEFAULT_STATUS_COLOR_R=0;a.DEFAULT_STATUS_COLOR_G=0;a.DEFAULT_STATUS_COLOR_B=0;a.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM=20;a.WWAP_SERVER_OLD="http://wwawing.com/wwap";a.WWAP_SERVER=
"https://wwaphoenix.github.io";a.WWAP_SERVER_AUDIO_DIR="audio";a.WWAP_SERVER_TITLE_IMG="cover_p.gif";a.WWAP_SERVER_LOADER_NO_WORKER="wwaload.noworker.js";return a}();f.WWAConsts=h;d=function(){return function(){}}();f.LoaderResponse=d;d=function(){return function(){}}();f.LoaderError=d;d=function(){return function(){}}();f.LoaderProgress=d;(function(a){a[a.INIT=0]="INIT";a[a.MAP_LOAD=1]="MAP_LOAD";a[a.OBJ_LOAD=2]="OBJ_LOAD";a[a.MAP_ATTR=3]="MAP_ATTR";a[a.OBJ_ATTR=4]="OBJ_ATTR";a[a.RAND_PARTS=5]="RAND_PARTS";
a[a.MESSAGE=6]="MESSAGE";a[a.GAME_INIT=7]="GAME_INIT";a[a.AUDIO=8]="AUDIO"})(f.LoadStage||(f.LoadStage={}));f.loadMessages="\u30ed\u30fc\u30c9\u306e\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u30e9\u30f3\u30c0\u30e0\u30d1\u30fc\u30c4\u3092\u7f6e\u63db\u3057\u3066\u3044\u307e\u3059\u3002;\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;Welcome to WWA Wing!".split(";");
(function(a){a[a.COLOR_FRAME=0]="COLOR_FRAME";a[a.COLOR_FRAMEOUT=1]="COLOR_FRAMEOUT";a[a.COLOR_STR=2]="COLOR_STR";a[a.COLOR_STATUS_STR=4]="COLOR_STATUS_STR"})(f.ChangeStyleType||(f.ChangeStyleType={}));(function(a){a[a.MESSAGE_WINDOW=0]="MESSAGE_WINDOW";a[a.SIDEBAR=1]="SIDEBAR"})(f.SelectorType||(f.SelectorType={}));d=function(){return function(){this.checkString=this.checkOriginalMapString=this.statusColorB=this.statusColorG=this.statusColorR=this.fontColorB=this.fontColorG=this.fontColorR=this.frameOutColorB=
this.frameOutColorG=this.frameOutColorR=this.frameColorB=this.frameColorG=this.frameColorR=this.imgClickY=this.imgClickX=this.bgm=this.delPlayerFlag=this.objectNoCollapseDefaultFlag=this.compatibleForOldMapFlag=this.disableSaveFlag=this.clickableItemSignImgPosY=this.clickableItemSignImgPosX=this.playerImgPosY=this.playerImgPosX=this.yesnoImgPosY=this.yesnoImgPosX=this.moves=this.systemMessage=this.mapCGName=this.charCGName=this.worldPassNumber=this.worldName=this.message=this.worldPassword=this.objectAttribute=
this.mapAttribute=this.mapObjectCompressed=this.mapCompressed=this.mapObject=this.map=this.messageNum=this.mapWidth=this.itemBox=this.statusGold=this.statusDefence=this.statusStrength=this.statusEnergy=this.statusEnergyMax=this.isOldMap=this.objPartsMax=this.mapPartsMax=this.playerY=this.playerX=this.gameoverY=this.gameoverX=this.version=void 0}}();f.WWAData=d})(wwa_data||(wwa_data={}));var wwa_parts_player;
(function(f){var d=wwa_data.Direction,k=wwa_data.WWAConsts,b=function(){function a(a){this._position=a}a.prototype.getPosition=function(){return this._position};return a}(),r=function(a){function b(b){a.call(this,b)}__extends(b,a);return b}(b);f.PartsObject=r;b=function(a){function b(b){a.call(this,b)}__extends(b,a);return b}(b);f.PartsMap=b;var h;(function(a){a[a.CONTROLLABLE=0]="CONTROLLABLE";a[a.MOVING=1]="MOVING";a[a.CAMERA_MOVING=2]="CAMERA_MOVING";a[a.MESSAGE_WAITING=3]="MESSAGE_WAITING";a[a.LOCALGATE_JUMPED=
4]="LOCALGATE_JUMPED";a[a.BATTLE=5]="BATTLE";a[a.ESTIMATE_WINDOW_WAITING=6]="ESTIMATE_WINDOW_WAITING";a[a.PASSWORD_WINDOW_WAITING=7]="PASSWORD_WINDOW_WAITING"})(h||(h={}));r=function(a){function b(b,c,w,f,r){a.call(this,c);this._status=f;this._equipStatus=new wwa_data.EquipmentStatus(0,0);this._itemBox=Array(k.ITEMBOX_SIZE);this._itemBoxElement=Array(k.ITEMBOX_SIZE);this._itemUsingEvent=Array(k.ITEMBOX_SIZE);for(c=0;c<this._itemBox.length;c++)this._itemBox[c]=0,this._itemBoxElement[c]=wwa_util.$qsh("#item"+
c+">.item-disp");this.updateItemBox();this._energyMax=r;this._dir=d.DOWN;this._wwa=b;this._state=h.CONTROLLABLE;this._camera=w;this._isPartsEventExecuted=!1;this._energyValueElement=wwa_util.$qsh("#disp-energy>.status-value-box");this._strengthValueElement=wwa_util.$qsh("#disp-strength>.status-value-box");this._defenceValueElement=wwa_util.$qsh("#disp-defence>.status-value-box");this._goldValueElement=wwa_util.$qsh("#disp-gold>.status-value-box");this._isClickableItemGot=this._isReadyToUseItem=!1;
this._moveObjectAutoExecTimer=this._moveMacroWaitingRemainMoves=this._moves=0;this.updateStatusValueBox();this._afterMoveMacroFlag=this._partsAppeared=!1;this._isPreparedForLookingAround=!0;this._lookingAroundTimer=k.PLAYER_LOOKING_AROUND_START_FRAME;this._speedIndex=k.DEFAULT_SPEED_INDEX}__extends(b,a);b.prototype.move=function(){if(this.isControllable())this.controll(this._dir);else if(this._state===h.CAMERA_MOVING){try{this._camera.move(this._dir)}catch(c){}this._isOnCameraStopPosition()&&(this._state=
h.CONTROLLABLE)}else if(this._state===h.MOVING){try{var a=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex])}catch(c){}a.isJustPosition()&&(this._state=h.CONTROLLABLE,this._moves++,this._isPartsEventExecuted=!1,this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0);this._position=a}};b.prototype.controll=function(a){var c,b;if(this.isControllable()){this._isPreparedForLookingAround=!1;this._dir=a;try{c=this._position.getNextFramePosition(this._dir,
wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex]),b=this._position.getNextJustPosition(a)}catch(A){return}if(this._isOnCameraMovingPosition()){if(0!==this._wwa.getMapIdByPosition(b)||this._wwa.isOldMap()||this._wwa.debug)try{this._camera.move(this._dir),this._state=h.CAMERA_MOVING}catch(A){this._state=h.CONTROLLABLE}}else this.canMoveTo(b)?(this._position=c,this._state=h.MOVING,this._wwa.getMapAttributeByPosition(this._position.getNextJustPosition(a),k.ATR_TYPE)!==k.MAP_LOCALGATE&&
this._wwa.moveObjects(!0)):(this._wwa.getMapTypeByPosition(b)===k.MAP_WALL&&this._wwa.checkMap(b.getPartsCoord()),this._wwa.checkObject(b.getPartsCoord()))}};b.prototype.canMoveTo=function(a){if(null===a)return!1;if(this._wwa.debug)return!0;this._wwa.getMapWidth();a.getPartsCoord();a.getOffsetCoord();return 0===this._wwa.getMapIdByPosition(a)&&!this._wwa.isOldMap()||this._wwa.getMapTypeByPosition(a)===k.MAP_WALL?!1:0===this._wwa.getObjectIdByPosition(a)||this._wwa.getObjectTypeByPosition(a)===k.OBJECT_NORMAL&&
this._wwa.getObjectAttributeByPosition(a,k.ATR_MODE)===k.PASSABLE_OBJECT?!0:this._wwa.getObjectTypeByPosition(a)===k.OBJECT_DOOR&&this._wwa.getObjectAttributeByPosition(a,k.ATR_NUMBER)===k.PASSABLE_OBJECT?this.hasItem(this._wwa.getObjectAttributeByPosition(a,k.ATR_ITEM))?!1:!0:!1};b.prototype.isMoving=function(){return this._state==h.MOVING||this._state==h.CAMERA_MOVING};b.prototype._isOnCameraMovingPosition=function(){var a=this._camera.getPosition().getPartsCoord(),c=this.getPosition().getPartsCoord();
return c.x-a.x===k.H_PARTS_NUM_IN_WINDOW-1&&this._dir===d.RIGHT||c.x===a.x&&this._dir===d.LEFT||c.y-a.y===k.V_PARTS_NUM_IN_WINDOW-1&&this._dir===d.DOWN||c.y===a.y&&this._dir===d.UP};b.prototype._isOnCameraStopPosition=function(){var a=this._camera.getPosition().getPartsCoord(),c=this.getPosition().getPartsCoord();return c.x-a.x===k.H_PARTS_NUM_IN_WINDOW-1&&this._dir===d.LEFT||c.x===a.x&&this._dir===d.RIGHT||c.y-a.y===k.V_PARTS_NUM_IN_WINDOW-1&&this._dir===d.UP||c.y===a.y&&this._dir===d.DOWN};b.prototype.isControllable=
function(){var a=this._afterMoveMacroFlag;this._afterMoveMacroFlag=!1;return this._state===h.CONTROLLABLE&&!this._partsAppeared&&(this._wwa.getMapTypeByPosition(this._position)!==k.MAP_LOCALGATE&&this._wwa.getMapTypeByPosition(this._position)!==k.MAP_URLGATE||!this._wwa.isPrevFrameEventExecuted())&&0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&!a&&this._wwa.canInput()};b.prototype.getCopyOfItemBox=function(){return this._itemBox.slice()};b.prototype.getDir=function(){return this._dir};
b.prototype.getEnergyMax=function(){return this._energyMax};b.prototype.isJumped=function(){return this._state===h.LOCALGATE_JUMPED};b.prototype.setMessageWaiting=function(){this._state=h.MESSAGE_WAITING};b.prototype.isWaitingMessage=function(){return this._state===h.MESSAGE_WAITING};b.prototype.clearMessageWaiting=function(){this._state===h.MESSAGE_WAITING&&(this._state=h.CONTROLLABLE,this._isPartsEventExecuted=!0,this._isPreparedForLookingAround&&(this._lookingAroundTimer=k.PLAYER_LOOKING_AROUND_START_FRAME))};
b.prototype.setEstimateWindowWating=function(){this._state=h.ESTIMATE_WINDOW_WAITING};b.prototype.isWatingEstimateWindow=function(){return this._state===h.ESTIMATE_WINDOW_WAITING};b.prototype.clearEstimateWindowWaiting=function(){this._state===h.ESTIMATE_WINDOW_WAITING&&(this._state=h.CONTROLLABLE)};b.prototype.setPasswordWindowWating=function(){this._state=h.PASSWORD_WINDOW_WAITING};b.prototype.isWaitingPasswordWindow=function(){return this._state===h.PASSWORD_WINDOW_WAITING};b.prototype.clearPasswordWindowWaiting=
function(){this._state===h.PASSWORD_WINDOW_WAITING&&(this._state=h.CONTROLLABLE)};b.prototype.isPartsEventExecuted=function(){return this._isPartsEventExecuted};b.prototype.resetEventExecutionInfo=function(){this._isPartsEventExecuted=!1};b.prototype.getLastExecPartsIDOnSamePosition=function(a){return a===wwa_data.PartsType.MAP?this._samePosLastExecutedMapID:this._samePosLastExecutedObjID};b.prototype.setLastExecInfoOnSamePosition=function(a,c){a===wwa_data.PartsType.MAP?this._samePosLastExecutedMapID=
c:this._samePosLastExecutedObjID=c};b.prototype.processAfterJump=function(){this._state===h.LOCALGATE_JUMPED&&0===--this._jumpWaitFramesRemain&&(this._state=h.CONTROLLABLE)};b.prototype.jumpTo=function(a){var c=this._camera.getPosition();this.getPosition();if(this._position.equals(a))return!1;this._position=a;a.isInCameraRange(this._camera,!0)||this._camera.reset(a);this._state=h.LOCALGATE_JUMPED;this._jumpWaitFramesRemain=k.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=
void 0;a.hasLocalGate()?this._dir=d.DOWN:a.getPartsCoord().y<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(d.DOWN).hasLocalGate()?this._dir=d.UP:1<=a.getPartsCoord().y&&a.getNextJustPosition(d.UP).hasLocalGate()?this._dir=d.DOWN:a.getPartsCoord().x<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(d.RIGHT).hasLocalGate()?this._dir=d.LEFT:1<=a.getPartsCoord().x&&a.getNextJustPosition(d.LEFT).hasLocalGate()?this._dir=d.RIGHT:this._dir=d.DOWN;this._camera.getPosition().equals(c)||(this._isPreparedForLookingAround=
!0,this._lookingAroundTimer=k.PLAYER_LOOKING_AROUND_START_FRAME);return!0};b.prototype.systemJumpTo=function(a){this._position=a;this._camera.reset(a);this._camera.resetPreviousPosition();this._state=h.LOCALGATE_JUMPED;this._jumpWaitFramesRemain=k.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;this._dir=d.DOWN;this._isPreparedForLookingAround=!0;this._lookingAroundTimer=k.PLAYER_LOOKING_AROUND_START_FRAME};b.prototype.addStatusAll=function(a){this._status.add(a);
this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return this._status};b.prototype.setEnergyMax=function(a){this._energyMax=a;0!==a&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return a};b.prototype.setEnergy=function(a){this._status.energy=a;this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,
this._energyMax));this.updateStatusValueBox();return a};b.prototype.damage=function(a){this._status.energy=Math.max(0,this._status.energy-a);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox()};b.prototype.setStrength=function(a){return this._status.strength=a};b.prototype.setDefence=function(a){this._status.defence=a;this.updateStatusValueBox();return a};b.prototype.setGold=function(a){this._status.gold=
a;this.updateStatusValueBox();return a};b.prototype.getStatus=function(){return this._status.plus(this._equipStatus)};b.prototype.getStatusWithoutEquipments=function(){return this._status.plus(new wwa_data.EquipmentStatus(0,0))};b.prototype.updateStatusValueBox=function(){var a=this._status.plus(this._equipStatus),c=a.strength,b=a.defence,d=a.gold;this._energyValueElement.textContent=a.energy+"";this._strengthValueElement.textContent=c+"";this._defenceValueElement.textContent=b+"";this._goldValueElement.textContent=
d+""};b.prototype.updateItemBox=function(){for(var a,c,b=0;b<this._itemBoxElement.length;b++)0===this._itemBox[b]?this._itemBoxElement[b].style.backgroundPosition="-40px 0px":(a=this._wwa.getObjectCropXById(this._itemBox[b]),c=this._wwa.getObjectCropYById(this._itemBox[b]),this._itemBoxElement[b].style.backgroundPosition="-"+a+"px -"+c+"px")};b.prototype.isDead=function(){return 0>=this._status.energy};b.prototype.addItem=function(a,c,b){void 0===c&&(c=0);void 0===b&&(b=!1);var n;n=this._wwa.getObjectAttributeById(a,
k.ATR_NUMBER);0===c&&0!==n&&(c=n);if(0===c){if(0===a)return;c=this._getBlankItemPos();if(c===k.ITEMBOX_IS_FULL)throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");this._forceSetItemBox(c,a)}else if(!1===b)if(n=this._itemBox[c-1],this._wwa.getObjectAttributeById(n,k.ATR_NUMBER)!==this._wwa.getObjectAttributeById(a,k.ATR_NUMBER))if(b=this._getBlankItemPos(),b!==k.ITEMBOX_IS_FULL)this._forceSetItemBox(b,n),this._forceSetItemBox(c,a);else throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");
else this._forceSetItemBox(c,a);else this._forceSetItemBox(c,a);this._updateEquipmentStatus();this.updateItemBox()};b.prototype._forceSetItemBox=function(a,c){var b=this,n=wwa_util.$qsh("#item"+(a-1)+">.item-click-border"),d=this._wwa.getObjectAttributeById(c,k.ATR_MODE);this.removeItemByItemPosition(a);this._itemBox[a-1]=c;0!==c&&d!==wwa_data.ItemMode.NORMAL&&(d=this._wwa.getSystemMessageById(wwa_data.SystemMessage2.CLICKABLE_ITEM),this._isClickableItemGot||("BLANK"!==d&&this._wwa.setMessageQueue(""===
d?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u306f\u53f3\u306e\u30dc\u30c3\u30af\u30b9\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\u4f7f\u7528\u3067\u304d\u308b\u30a2\u30a4\u30c6\u30e0\u306f\u8272\u67a0\u3067\u56f2\u307e\u308c\u307e\u3059\u3002":d,!1,!0),this._isClickableItemGot=!0),n.style.display="block",function(a){b._itemUsingEvent[a-1]=function(){if(b.isControllable())b._wwa.onselectitem(a)}}(a),n.addEventListener("click",this._itemUsingEvent[a-
1]))};b.prototype._getBlankItemPos=function(){var a;for(a=1;a<this._itemBox.length+1;a++)if(0===this._itemBox[a-1])return a;return k.ITEMBOX_IS_FULL};b.prototype._updateEquipmentStatus=function(){var a,b=new wwa_data.EquipmentStatus(0,0);for(a=0;a<k.ITEMBOX_SIZE;a++)0!==this._itemBox[a]&&(b.strength+=this._wwa.getObjectAttributeById(this._itemBox[a],k.ATR_STRENGTH),b.defence+=this._wwa.getObjectAttributeById(this._itemBox[a],k.ATR_DEFENCE));a=b.minus(this._equipStatus);this._wwa.setStatusChangedEffect(a);
this._equipStatus=b;this.updateStatusValueBox()};b.prototype.hasItem=function(a){for(var b=0;b<k.ITEMBOX_SIZE;b++)if(this._itemBox[b]===a)return!0;return!1};b.prototype.canUseItem=function(a){a=this._itemBox[a-1];return 0===a||this._wwa.getObjectAttributeById(a,k.ATR_MODE)===wwa_data.ItemMode.NORMAL?!1:!0};b.prototype.useItem=function(){var a;a=this._itemBox[this._readyToUseItemPos-1];this._wwa.getObjectAttributeById(a,k.ATR_MODE)!==wwa_data.ItemMode.NOT_DISAPPEAR&&this.removeItemByItemPosition(this._readyToUseItemPos);
var b=wwa_util.$id("item"+(this._readyToUseItemPos-1));setTimeout(function(){b.classList.contains("onpress")&&b.classList.remove("onpress")},k.DEFAULT_FRAME_INTERVAL);this._isReadyToUseItem=!1;this._readyToUseItemPos=void 0;return a};b.prototype.canHaveMoreItems=function(){return this._getBlankItemPos()!==k.ITEMBOX_IS_FULL};b.prototype.removeItemByItemPosition=function(a){var b;0!==this._itemBox[a-1]&&(this._wwa.getObjectAttributeById(this._itemBox[a-1],k.ATR_MODE)!==wwa_data.ItemMode.NORMAL&&(b=
wwa_util.$qsh("#item"+(a-1)+">.item-click-border"),b.removeEventListener("click",this._itemUsingEvent[a-1]),b.style.display="none"),this._itemBox[a-1]=0,this._updateEquipmentStatus(),this.updateItemBox())};b.prototype.removeItemByPartsID=function(a){if(!this.hasItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3063\u3066\u3044\u306a\u3044");for(var b=0;b<k.ITEMBOX_SIZE;b++)if(this._itemBox[b]===a){this._wwa.getObjectAttributeById(this._itemBox[b],k.ATR_MODE)!==wwa_data.ItemMode.NORMAL&&(a=
wwa_util.$qsh("#item"+b+">.item-click-border"),a.removeEventListener("click",this._itemUsingEvent[b]),a.style.display="none");this._itemBox[b]=0;this._updateEquipmentStatus();this.updateItemBox();break}};b.prototype.clearItemBox=function(){for(var a=1;a<=k.ITEMBOX_SIZE;a++)this.removeItemByItemPosition(a);this._updateEquipmentStatus();this.updateItemBox()};b.prototype.hasGold=function(a){return this._status.gold>=a};b.prototype.payGold=function(a){if(!this.hasGold(a))throw Error("\u304a\u91d1\u304c\u8db3\u308a\u306a\u3044");
this.setGold(this._status.gold-a)};b.prototype.earnGold=function(a){this.setGold(this._status.gold+a)};b.prototype.setPartsAppearedFlag=function(){this._partsAppeared=!0};b.prototype.clearPartsAppearedFlag=function(){this._partsAppeared=!1};b.prototype.isPartsAppearedTime=function(){return!0===this._partsAppeared};b.prototype.startBattleWith=function(a){this._isPlayerTurn=!0;this._battleFrameCounter=k.BATTLE_INTERVAL_FRAME_NUM;this._battleTurnNum=0;this._enemy=a;this._state=h.BATTLE};b.prototype.isFighting=
function(){return this._state===h.BATTLE};b.prototype.isTurn=function(){return this._isPlayerTurn};b.prototype.getTurnNum=function(){return this._battleTurnNum};b.prototype.isBattleStartFrame=function(){return this._battleFrameCounter===k.BATTLE_INTERVAL_FRAME_NUM&&0===this._battleTurnNum};b.prototype.fight=function(){if(!this.isFighting())throw Error("\u30d0\u30c8\u30eb\u304c\u958b\u59cb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");0===this._battleTurnNum&&this._battleFrameCounter===k.BATTLE_INTERVAL_FRAME_NUM&&
this._wwa.showMonsterWindow();if(!(0<--this._battleFrameCounter)){this._battleTurnNum++;this._speedIndex===k.MAX_SPEED_INDEX||this._battleTurnNum>k.BATTLE_SPEED_CHANGE_TURN_NUM?(1===this._battleTurnNum&&this._wwa.playSound(wwa_data.SystemSound.ATTACK),this._battleFrameCounter=1):(this._battleFrameCounter=k.BATTLE_INTERVAL_FRAME_NUM,this._wwa.playSound(wwa_data.SystemSound.ATTACK));var a=this.getStatus(),b=this._enemy.status;if(this._isPlayerTurn){if(a.strength>b.defence||a.defence<b.strength){b.energy>
a.strength-b.defence?a.strength>b.defence&&this._enemy.damage(a.strength-b.defence):(this._wwa.playSound(this._wwa.getObjectAttributeById(this._enemy.partsID,k.ATR_SOUND)),this.earnGold(b.gold),this._wwa.setStatusChangedEffect(new wwa_data.Status(0,0,0,b.gold)),0!==this._enemy.item?this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._enemy.item,this._enemy.position):this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,0,this._enemy.position),this._wwa.appearParts(this._enemy.position,wwa_data.AppearanceTriggerType.OBJECT,
this._enemy.partsID),this._state=h.CONTROLLABLE,this._wwa.setMessageQueue(this._enemy.message,!1,!1),this._enemy.battleEndProcess(),this._battleTurnNum=0,this._enemy=null);this._isPlayerTurn=!1;return}this._enemy.battleEndProcess();this._wwa.setMessageQueue("\u76f8\u624b\u306e\u9632\u5fa1\u80fd\u529b\u304c\u9ad8\u3059\u304e\u308b\uff01",!1,!0);this._battleTurnNum=0;this._enemy=null}else b.strength>a.defence&&(a.energy>b.strength-a.defence?this.damage(b.strength-a.defence):(this.setEnergy(0),this._enemy.battleEndProcess(),
this._state=h.CONTROLLABLE,this._battleTurnNum=0,this._enemy=null,this._wwa.gameover()));this._isPlayerTurn=!0}};b.prototype.readyToUseItem=function(a){var b;if(!this.canUseItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u304c\u306a\u3044\u304b\u3001\u30a2\u30a4\u30c6\u30e0\u304c\u4f7f\u3048\u307e\u305b\u3093\u3002");b=this._itemBox[a-1];this._wwa.getObjectAttributeById(b,k.ATR_STRING);this._wwa.appearParts(this._position.getPartsCoord(),wwa_data.AppearanceTriggerType.OBJECT,b);this._readyToUseItemPos=
a;this._isReadyToUseItem=!0};b.prototype.isReadyToUseItem=function(){return this._isReadyToUseItem};b.prototype.getDrawingCenterPosition=function(){var a=this._position.getPartsCoord(),b=this._position.getOffsetCoord(),d=this._camera.getPosition(),w=d.getPartsCoord(),d=d.getOffsetCoord();return new wwa_data.Coord((a.x-w.x)*k.CHIP_SIZE+b.x-d.x+k.CHIP_SIZE/2,(a.y-w.y)*k.CHIP_SIZE+b.y-d.y+k.CHIP_SIZE/2)};b.prototype.getMoveCount=function(){return this._moves};b.prototype.setMoveCount=function(a){return this._moves=
a};b.prototype.isMoveObjectAutoExecTime=function(){return 0===this._moveObjectAutoExecTimer};b.prototype.setMoveMacroWaiting=function(a){0>a||(this._moveMacroWaitingRemainMoves=a,this._moveObjectAutoExecTimer=0)};b.prototype.resetMoveObjectAutoExecTimer=function(){this._moveObjectAutoExecTimer=k.CHIP_SIZE/wwa_data.speedList[this._speedIndex];this._moveMacroWaitingRemainMoves--};b.prototype.decrementMoveObjectAutoExecTimer=function(){0<=this._moveMacroWaitingRemainMoves&&0<this._moveObjectAutoExecTimer&&
(this._moveObjectAutoExecTimer--,0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&(this._afterMoveMacroFlag=!0));return 0};b.prototype.isWaitingMoveMacro=function(){return 0!==this._moveMacroWaitingRemainMoves||0!==this._moveObjectAutoExecTimer};b.prototype.decrementLookingAroundTimer=function(){return this._isPreparedForLookingAround&&0<this._lookingAroundTimer?--this._lookingAroundTimer:0};b.prototype.isLookingAround=function(){return this._isPreparedForLookingAround&&0===
this._lookingAroundTimer};b.prototype.getSpeedIndex=function(){return this._speedIndex};b.prototype.speedUp=function(){return this._speedIndex=Math.min(k.MAX_SPEED_INDEX,this._speedIndex+1)};b.prototype.speedDown=function(){return this._speedIndex=Math.max(k.MIN_SPEED_INDEX,this._speedIndex-1)};return b}(r);f.Player=r})(wwa_parts_player||(wwa_parts_player={}));var wwa_camera;
(function(f){var d=wwa_data.WWAConsts,k=function(){function b(b){this._position=null;this.reset(b)}b.prototype.setPlayer=function(b){this._player=b};b.prototype.isResetting=function(){return this._isResetting};b.prototype.getPosition=function(){return this._position};b.prototype.getPreviousPosition=function(){return this._positionPrev};b.prototype.resetPreviousPosition=function(){this._positionPrev=null};b.prototype.move=function(b){var h=wwa_data.speedList[this._player.getSpeedIndex()];this._position=
this._position.getNextFramePosition(b,h*(d.H_PARTS_NUM_IN_WINDOW-1),h*(d.V_PARTS_NUM_IN_WINDOW-1))};b.prototype.getTransitionStepNum=function(){return this._transitionStep};b.prototype.advanceTransitionStepNum=function(){++this._transitionStep;this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW&&(this._isResetting=!1,this._transitionStep=0);return this._transitionStep};b.prototype.isFinalStep=function(){if(!1===this._isResetting)throw Error("\u30ea\u30bb\u30c3\u30c8\u4e2d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002");
return this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW-1};b.prototype.reset=function(b){this._positionPrev=this._position;this._position=b.getDefaultCameraPosition();this._transitionStep=0;this._isResetting=!0};return b}();f.Camera=k})(wwa_camera||(wwa_camera={}));var wwa_cgmanager;
(function(f){var d=wwa_data.WWAConsts,k=function(){function b(b,d,a,w){this._isLoaded=!1;this._ctx=b;this._ctxSub=d;this._fileName=a;this._loadCompleteCallBack=w;this._load()}b.prototype._load=function(){var b=this;this._isLoaded||(this._image=new Image,this._image.addEventListener("load",function(){b._loadCompleteCallBack()}),this._image.addEventListener("error",function(){throw Error("Image Load Failed!!\nfile name:"+b._fileName);}),this._image.src=this._fileName,this._isLoaded=!0)};b.prototype.drawCanvas=
function(b,h,a,w,n){void 0===n&&(n=!1);n=n?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");n.drawImage(this._image,d.CHIP_SIZE*b,d.CHIP_SIZE*h,d.CHIP_SIZE,d.CHIP_SIZE,a,w,d.CHIP_SIZE,d.CHIP_SIZE)};b.prototype.drawCanvasWithSize=function(b,h,a,w,n,c,f){void 0===f&&(f=!1);f=f?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");f.drawImage(this._image,d.CHIP_SIZE*b,d.CHIP_SIZE*h,d.CHIP_SIZE*a,d.CHIP_SIZE*w,n,c,d.CHIP_SIZE*a,d.CHIP_SIZE*w)};b.prototype.drawCanvasWithUpperYLimit=
function(b,h,a,w,n,c){void 0===c&&(c=!1);c=c?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");n=Math.max(0,w+d.CHIP_SIZE-n);n>=d.CHIP_SIZE||c.drawImage(this._image,d.CHIP_SIZE*b,d.CHIP_SIZE*h,d.CHIP_SIZE,d.CHIP_SIZE-n,a,w,d.CHIP_SIZE,d.CHIP_SIZE)};b.prototype.drawCanvasWithLowerYLimit=function(b,h,a,w,n,c){void 0===c&&(c=!1);c=c?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");n=Math.max(0,n-w);n>=d.CHIP_SIZE||c.drawImage(this._image,d.CHIP_SIZE*
b,d.CHIP_SIZE*h+n,d.CHIP_SIZE,d.CHIP_SIZE-n,a,w+n,d.CHIP_SIZE,d.CHIP_SIZE)};b.prototype.clearCanvas=function(b,d,a,w,n){void 0===n&&(n=!1);(n?this._ctxSub:this._ctx).clearRect(b,d,a,w)};b.prototype.drawBase=function(b,d,a,w,n){void 0===n&&(n=!1);n=n?this._ctxSub:this._ctx;n.fillStyle="#9E9E9E";n.fillRect(b,d,a,w)};return b}();f.CGManager=k})(wwa_cgmanager||(wwa_cgmanager={}));var wwa_util;
(function(f){f.$id=function(d){return document.getElementById(d)};f.$class=function(d){return document.getElementsByClassName(d)};f.$tag=function(d){return document.getElementsByTagName(d)};f.$qs=function(d){return document.querySelector(d)};f.$qsh=function(d){return document.querySelector(d)};f.$qsAll=function(d){return document.querySelectorAll(d)};f.$localPos=function(d,k){var b,r;b=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;r=window.pageYOffset||document.body.scrollTop||
document.documentElement.scrollTop;b=d-f.$id("wwa-wrapper").offsetLeft+b;r=k-f.$id("wwa-wrapper").offsetTop+r;return new wwa_data.Coord(b,r)};f.$escapedURI=function(d){return d.match(/^https?:\/\//)||d.match(/^\.\.\//)?d:location.href="./"+d};f.arr2str4save=function(d){var k="";if(d instanceof Array){for(var b=0;b<d.length;b++)k+=f.arr2str4save(d[b])+"/";return k}return d+""}})(wwa_util||(wwa_util={}));var wwa_message;
(function(f){var d=function(){return function(a,b,d,c){this.message=a;this.isSystemMessage=b;this.isEndOfPartsEvent=d;this.macro=c;void 0===this.macro&&(this.macro=[])}}();f.MessageInfo=d;f.strArrayToMessageInfoArray=function(a,b){var w=[];a.forEach(function(a){w.push(new d(a,b))});return w};var k=function(){function a(a,b,c,d,h,f){this._wwa=a;this._triggerPartsID=b;this._triggerPartsType=c;this._triggerPartsPosition=d;this.macroType=h;this.macroArgs=f}a.prototype.execute=function(){try{this.macroType===
wwa_data.MacroType.IMGPLAYER?this._executeImgPlayerMacro():this.macroType===wwa_data.MacroType.IMGYESNO?this._executeImgYesNoMacro():this.macroType===wwa_data.MacroType.HPMAX?this._executeHPMaxMacro():this.macroType===wwa_data.MacroType.SAVE?this._executeSaveMacro():this.macroType===wwa_data.MacroType.ITEM?this._executeItemMacro():this.macroType===wwa_data.MacroType.DEFAULT?this._executeDefaultMacro():this.macroType===wwa_data.MacroType.OLDMAP?this._executeOldMapMacro():this.macroType===wwa_data.MacroType.PARTS?
this._executePartsMacro():this.macroType===wwa_data.MacroType.MOVE?this._executeMoveMacro():this.macroType===wwa_data.MacroType.MAP?this._executeMapMacro():this.macroType===wwa_data.MacroType.DIRMAP?this._executeDirMapMacro():this.macroType===wwa_data.MacroType.IMGFRAME?this._executeImgFrameMacro():this.macroType===wwa_data.MacroType.IMGBOM?this._executeImgBomMacro():this.macroType===wwa_data.MacroType.DELPLAYER?this._executeDelPlayerMacro():this.macroType===wwa_data.MacroType.FACE?this._executeFaceMacro():
this.macroType===wwa_data.MacroType.EFFECT?this._executeEffectMacro():this.macroType===wwa_data.MacroType.GAMEOVER?this._executeGameOverMacro():this.macroType===wwa_data.MacroType.IMGCLICK?this._executeImgClickMacro():this.macroType===wwa_data.MacroType.STATUS?this._executeStatusMacro():this.macroType===wwa_data.MacroType.COLOR?this._executeColorMacro():this.macroType===wwa_data.MacroType.WAIT?this._executeWaitMacro():this.macroType===wwa_data.MacroType.SOUND&&this._executeSoundMacro()}catch(w){}};
a.prototype._concatEmptyArgs=function(a){if(this.macroArgs.length<a){a=Array(a-this.macroArgs.length);for(var b=0;b<a.length;b++)a[b]="";this.macroArgs=this.macroArgs.concat(a)}};a.prototype._parseInt=function(a,b){void 0===b&&(b=0);var c=parseInt(this.macroArgs[a]);return isNaN(c)?b:c};a.prototype._executeImgPlayerMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setPlayerImgCoord(new wwa_data.Coord(a,b))};a.prototype._executeImgYesNoMacro=function(){this._concatEmptyArgs(2);
var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setYesNoImgCoord(new wwa_data.Coord(a,b))};a.prototype._executeHPMaxMacro=function(){this._concatEmptyArgs(1);var a=Math.max(0,this._parseInt(0));this._wwa.setPlayerEnergyMax(a)};a.prototype._executeSaveMacro=function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.disableSave(a)};a.prototype._executeItemMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setPlayerGetItem(a,b)};a.prototype._executeDefaultMacro=
function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.setObjectNotCollapseOnPartsOnPlayer(a)};a.prototype._executeOldMapMacro=function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.setOldMap(a)};a.prototype._executePartsMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2,wwa_data.PartsType.OBJECT),d=this._parseInt(3);if(c!==wwa_data.PartsType.OBJECT&&c!==wwa_data.PartsType.MAP)throw Error("\u30d1\u30fc\u30c4\u7a2e\u5225\u304c\u4e0d\u660e\u3067\u3059");
0!==d&&1!==d&&(d=1);if(0>a||0>b)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(c===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum()||b>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(a>=this._wwa.getMapPartsNum()||b>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.replaceParts(a,b,c,!!d)};a.prototype._executeMoveMacro=function(){this._concatEmptyArgs(1);
var a=this._parseInt(0);this._wwa.setMoveMacroWaitingToPlayer(a)};a.prototype._executeMapMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this.macroArgs[1],c=this.macroArgs[2],d=this._parseInt(3,wwa_data.PartsType.OBJECT);if(0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(d===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
this._wwa.appearPartsEval(this._triggerPartsPosition,b,c,a,d)};a.prototype._executeDirMapMacro=function(){this._concatEmptyArgs(3);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2,wwa_data.PartsType.OBJECT);if(isNaN(a)||isNaN(b)||isNaN(c))throw Error("\u5f15\u6570\u304c\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(c===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
}else if(a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.appearPartsByDirection(b,a,c)};a.prototype._executeImgFrameMacro=function(){this._concatEmptyArgs(3);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2),d=b*wwa_data.WWAConsts.CHIP_SIZE,h=c*wwa_data.WWAConsts.CHIP_SIZE;if(0>b||0>c)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(a===wwa_data.MacroImgFrameIndex.ENERGY)wwa_util.$qsh("#disp-energy>.status-icon").style.backgroundPosition=
"-"+d+"px -"+h+"px";else if(a===wwa_data.MacroImgFrameIndex.STRENGTH)wwa_util.$qsh("#disp-strength>.status-icon").style.backgroundPosition="-"+d+"px -"+h+"px";else if(a===wwa_data.MacroImgFrameIndex.DEFENCE)wwa_util.$qsh("#disp-defence>.status-icon").style.backgroundPosition="-"+d+"px -"+h+"px";else if(a===wwa_data.MacroImgFrameIndex.GOLD)wwa_util.$qsh("#disp-gold>.status-icon").style.backgroundPosition="-"+d+"px -"+h+"px";else if(a===wwa_data.MacroImgFrameIndex.WIDE_CELL_ROW)Array.prototype.forEach.call(wwa_util.$qsAll("div.wide-cell-row"),
function(a){a.style.backgroundPosition="-"+d+"px -"+h+"px"});else if(a===wwa_data.MacroImgFrameIndex.ITEM_BG)Array.prototype.forEach.call(wwa_util.$qsAll("div.item-cell"),function(a){a.style.backgroundPosition="-"+d+"px -"+h+"px"});else if(a===wwa_data.MacroImgFrameIndex.MAIN_FRAME)this._wwa.setFrameCoord(new wwa_data.Coord(b,c));else throw Error("\u7a2e\u5225\u304c\u4e0d\u6b63\u3067\u3059\u3002");};a.prototype._executeImgBomMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);
if(0>a||0>b)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");this._wwa.setBattleEffectCoord(new wwa_data.Coord(a,b))};a.prototype._executeDelPlayerMacro=function(){this._concatEmptyArgs(1);var a=parseInt(this.macroArgs[0]);this._wwa.setDelPlayer(!!a)};a.prototype._executeFaceMacro=function(){this._concatEmptyArgs(6);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2),d=this._parseInt(3),h=this._parseInt(4),f=this._parseInt(5);if(0>
a||0>b||0>c||0>d||0>h||0>f)throw Error("\u5404\u5f15\u6570\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");a=new wwa_data.Face(new wwa_data.Coord(a,b),new wwa_data.Coord(c,d),new wwa_data.Coord(h,f));this._wwa.addFace(a)};a.prototype._executeEffectMacro=function(){this._concatEmptyArgs(1);var a=this._parseInt(0);if(0>a)throw Error("\u5f85\u3061\u6642\u9593\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");
0===a&&this._wwa.stopEffect();for(var b=[],c=1;c<this.macroArgs.length;c+=2){var d=this._parseInt(c),h;if(0>d)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(c+1===this.macroArgs.length)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u3067\u3001Y\u5ea7\u6a19\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");h=this._parseInt(c+
1);if(0>h)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");b.push(new wwa_data.Coord(d,h))}this._wwa.setEffect(a,b)};a.prototype._executeGameOverMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);if(0>a||a>=this._wwa.getMapWidth()||0>b||b>=this._wwa.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");
this._wwa.setGameOverPosition(new wwa_data.Coord(a,b))};a.prototype._executeImgClickMacro=function(){this._concatEmptyArgs(2);if(1>this.macroArgs.length)throw Error("\u5f15\u6570\u304c\u5c11\u306a\u3059\u304e\u307e\u3059");var a=this._parseInt(0),b=this._parseInt(1);if(0>a||0>b)throw Error("\u5f15\u6570\u304c0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");this._wwa.setImgClick(new wwa_data.Coord(a,b))};a.prototype._executeStatusMacro=function(){this._concatEmptyArgs(2);
var a=this._parseInt(0),b=this._parseInt(1);if(0>a||4<a)throw Error("\u30b9\u30c6\u30fc\u30bf\u30b9\u7a2e\u5225\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");this._wwa.setPlayerStatus(a,b)};a.prototype._executeColorMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this._parseInt(1),c=this._parseInt(2),d=this._parseInt(3);if(0>a||5<a)throw Error("\u7a2e\u5225\u306f0\u304b\u30895\u307e\u3067\u3067\u3059");if(0>b||255<b||0>c||255<c||0>d||255<d)throw Error("\u8272\u304c\u7bc4\u56f2\u5916\u3067\u3059");
this._wwa.changeStyleRule(a,b,c,d)};a.prototype._executeWaitMacro=function(){throw Error("Not implemented!");};a.prototype._executeSoundMacro=function(){this._concatEmptyArgs(1);var a=parseInt(this.macroArgs[0]);this._wwa.playSound(a)};return a}();f.Macro=k;f.parseMacro=function(a,b,d,c,h){h=h.match(/^\$([a-zA-Z_][a-zA-Z0-9_]*)\=(.*)$/);if(null===h||3!==h.length)throw Error("\u30de\u30af\u30ed\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var f=wwa_data.macrotable["$"+h[1].toLowerCase()];return void 0===
f?new k(a,b,d,c,wwa_data.MacroType.UNDEFINED,h[2].split(",")):new k(a,b,d,c,f,h[2].split(",").map(function(a){return a.trim()}))};var b=function(){function a(a,b,c,d,h,f,l){this._wwa=a;this._coord=b;this._width=c;this._height=d;this._isVisible=h;this._parentElement=f;this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.borderWidth="2px";this._element.style.borderStyle="solid";this._element.style.borderRadius="10px";this._element.classList.add("wwa-message-window");
this._element.style.zIndex=l+"";this._element.style.left=this._coord.x+"px";this._element.style.top=this._coord.y+"px";this._element.style.width=this._width+"px";this._element.style.height=this._height+"px";this._parentElement.appendChild(this._element)}a.prototype.update=function(a){};a.prototype.show=function(){this._isVisible=!0;this._element.style.display="block";this.update()};a.prototype.hide=function(){this._isVisible=!1;this._element.style.display="none";this.update()};a.prototype.isVisible=
function(){return this._isVisible};return a}(),r=function(a){function b(b,c,d,h,f,l,k){a.call(this,b,new wwa_data.Coord(c.x,c.y),d,h,f,l,201);this._cgFileName=k;this._monsterBox=document.createElement("div");this._monsterBox.style.width=wwa_data.WWAConsts.CHIP_SIZE+"px";this._monsterBox.style.height=wwa_data.WWAConsts.CHIP_SIZE+"px";this._monsterBox.style.position="absolute";this._monsterBox.style.left="10px";this._monsterBox.style.top="10px";this._monsterBox.style.backgroundImage="url("+this._cgFileName.replace("(",
"\\(").replace(")","\\)")+")";this._monsterBox.style.backgroundPosition="0 0";this._element.appendChild(this._monsterBox);this._energyBox=document.createElement("div");this._energyBox.style.position="absolute";this._energyBox.style.left="80px";this._energyBox.style.top="10px";this._energyBox.textContent="\u751f\u547d\u529b 0";this._element.appendChild(this._energyBox);this._strengthBox=document.createElement("div");this._strengthBox.style.position="absolute";this._strengthBox.style.left="80px";this._strengthBox.style.top=
"30px";this._strengthBox.textContent="\u653b\u6483\u529b 0";this._element.appendChild(this._strengthBox);this._defenceBox=document.createElement("div");this._defenceBox.style.position="absolute";this._defenceBox.style.left="180px";this._defenceBox.style.top="30px";this._defenceBox.textContent="\u9632\u5fa1\u529b 0";this._element.appendChild(this._defenceBox);this._element.style.display=this._isVisible?"block":"none"}__extends(b,a);b.prototype.update=function(a){void 0!==a&&(this._monsterBox.style.backgroundPosition=
"-"+a.imgCoord.x+"px -"+a.imgCoord.y+"px",this._energyBox.textContent="\u751f\u547d\u529b "+a.status.energy,this._strengthBox.textContent="\u653b\u6483\u529b "+a.status.strength,this._defenceBox.textContent="\u9632\u5fa1\u529b "+a.status.defence)};return b}(b);f.MosterWindow=r;b=function(a){function b(b,c,d,h){a.call(this,b,new wwa_data.Coord(c.x,c.y),340,30,d,h,202);this._element.style.textAlign="center";this._element.style.display=this._isVisible?"block":"none";this.update(0)}__extends(b,a);b.prototype.update=
function(a){void 0!==a&&(this._element.textContent="Score: "+a)};return b}(b);f.ScoreWindow=b;(function(a){a[a.TOP=0]="TOP";a[a.CENTER=1]="CENTER";a[a.BOTTOM=2]="BOTTOM";a[a.SCORE=3]="SCORE"})(f.Positioning||(f.Positioning={}));var h=f.Positioning,b=function(){function a(a,b,c,d,h,f,l,k,x,g){var e=this,m=l.replace("(","\\(").replace(")","\\)");this._wwa=a;this._cgFileName=l;this._x=b;this._y=c;this._width=d;this._height=h;this._message=f;this._isVisible=k;this._isYesno=x;this._element=document.createElement("div");
this._element.style.position="absolute";this._element.style.borderWidth="2px";this._element.style.borderStyle="solid";this._element.style.borderRadius="10px";this._element.classList.add("wwa-message-window");this._element.style.zIndex="400";this._msgWrapperElement=document.createElement("div");this._msgWrapperElement.style.padding="7px";this._msgWrapperElement.style.margin="0";this._msgWrapperElement.style.textAlign="left";this._msgWrapperElement.style.wordWrap="break-word";this._element.appendChild(this._msgWrapperElement);
this._dummyElement=document.createElement("div");this._dummyElement.style.display="none";this._dummyElement.style.padding="0";this._dummyElement.style.margin="0";this._dummyElement.style.height="55px";this._element.appendChild(this._dummyElement);this._ynWrapperElement=document.createElement("div");this._ynWrapperElement.style.padding="0";this._ynWrapperElement.style.margin="0";this._ynWrapperElement.style.position="absolute";this._ynWrapperElement.style.left="246px";this._ynWrapperElement.style.bottom=
"10px";this._ynWrapperElement.style.width="80px";this._ynWrapperElement.style.height="40px";this._ynWrapperElement.style.zIndex="10";this._element.appendChild(this._ynWrapperElement);this._parentElement=g;this._parentElement.appendChild(this._element);this._divYesElement=document.createElement("div");this._divYesElement.style.padding="0";this._divYesElement.style.margin="0";this._divYesElement.style.cssFloat="left";this._divYesElement.style.width="40px";this._divYesElement.style.height="40px";this._divYesElement.style.background=
"url("+m+")";this._divYesElement.onclick=function(){e._isInputDisable||(a.setYesNoInput(wwa_data.YesNoState.YES),e.update())};this._divYesElement.style.cursor="pointer";this._divNoElement=document.createElement("div");this._divNoElement.style.padding="0";this._divNoElement.style.margin="0";this._divNoElement.style.cssFloat="left";this._divNoElement.style.width="40px";this._divNoElement.style.height="40px";this._divNoElement.style.background="url("+m+")";this._divNoElement.onclick=function(){e._isInputDisable||
(a.setYesNoInput(wwa_data.YesNoState.NO),e.update())};this._divNoElement.style.cursor="pointer";this._ynWrapperElement.appendChild(this._divYesElement);this._ynWrapperElement.appendChild(this._divNoElement);e._isInputDisable=!1;this.update()}a.prototype.setPosition=function(a,b,c,d){this._x=a;this._y=b;this._width=c;this._height=d;this.update()};a.prototype.setPositionByPlayerPosition=function(a,b,c,d,h){d=d.getPartsCoord().substract(h.getPartsCoord()).y;this.setPositionEasy(a?f.Positioning.BOTTOM:
b?f.Positioning.SCORE:c?f.Positioning.CENTER:d>=Math.ceil(wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW/2)?f.Positioning.TOP:f.Positioning.BOTTOM)};a.prototype.setPositionEasy=function(a){var b=Math.floor(this._element.clientHeight/2);a===h.CENTER?(this._y=wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/2-b,this.update()):a===h.TOP?(this._y=Math.max(20,wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/4-b)+10,this.update()):a===h.BOTTOM?(this._y=Math.min(wwa_data.WWAConsts.MAP_WINDOW_HEIGHT-20-this._element.clientHeight,3*wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/
4-b),this.update()):a===h.SCORE&&(this._y=80,this.update())};a.prototype.setMessage=function(a){this._message=a;this.update()};a.prototype.setYesNoChoice=function(a){this._isInputDisable=!1;this._isYesno=a;this.update();return this._isYesno};a.prototype.isYesNoChoice=function(){return this._isYesno};a.prototype.setInputDisable=function(){this._isInputDisable=!0};a.prototype.isInputDisable=function(){return this._isInputDisable};a.prototype.show=function(){this._isVisible=!0;this.update()};a.prototype.hide=
function(){this._isVisible=!1;this.update()};a.prototype.isVisible=function(){return this._isVisible};a.prototype.update=function(){var a=this._wwa.getYesNoImgCoord();this._isYesno?(this._wwa.getYesNoState()===wwa_data.YesNoState.YES?(this._divYesElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YESP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+
"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):this._wwa.getYesNoState()===wwa_data.YesNoState.NO?(this._divYesElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NOP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):(this._divYesElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*
wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px"),this._ynWrapperElement.style.display="block"):this._ynWrapperElement.style.display="none";this._msgWrapperElement.textContent="";for(var a=this._message.split("\n"),b=0;b<a.length;b++){var c=document.createElement("span");c.textContent=a[b];this._msgWrapperElement.appendChild(c);
this._msgWrapperElement.appendChild(document.createElement("br"))}this._isVisible?(this._element.style.left=this._x+"px",this._element.style.top=this._y+"px"):(this._element.style.left="-999999px",this._element.style.top="-999999px");this._element.style.width=this._width+"px";this._element.style.minHeight=this._height+"px";this._dummyElement.style.display=this._isYesno?"block":"none"};return a}();f.MessageWindow=b})(wwa_message||(wwa_message={}));var wwa_monster;
(function(f){var d=function(){function d(b,d,h,a,f,k,c){this._partsID=b;this._position=d;this._imgCoord=h;this._status=a;this._message=f;this._item=k;this._battleEndCallback=c}Object.defineProperty(d.prototype,"partsID",{get:function(){return this._partsID},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"imgCoord",{get:function(){return this._imgCoord},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"item",{get:function(){return this._item},enumerable:!0,configurable:!0});d.prototype.damage=function(b){this._status.energy=Math.max(0,this._status.energy-b)};d.prototype.battleEndProcess=function(){this._battleEndCallback()};
return d}();f.Monster=d})(wwa_monster||(wwa_monster={}));var wwa_motion;
(function(f){var d=function(){function b(b,d,a,f,k){this._player=b;this._objectID=d;this._srcPos=a;this._destPos=f;this._dir=k;this._currentPos=this._srcPos.clone()}b.prototype.update=function(){var b=this._player.getSpeedIndex();return this._currentPos=this._currentPos.getNextFramePosition(this._dir,wwa_data.speedList[b],wwa_data.speedList[b])};Object.defineProperty(b.prototype,"isAchievedDestination",{get:function(){return this._currentPos.equals(this._destPos)},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"currentPosition",{get:function(){return this._currentPos},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"beforePosition",{get:function(){return this._srcPos},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"destination",{get:function(){return this._destPos},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objID",{get:function(){return this._objectID},enumerable:!0,configurable:!0});return b}();f.ObjectMovingData=
d;var k=function(){function b(b,d){this._wwa=b;this._player=d;this.clear()}b.prototype.add=function(b,h,a,f){this._queue.push(new d(this._player,b,h,a,f))};b.prototype.update=function(){for(var b=[],d=[],a=0;a<this._queue.length;a++)this._queue[a].update(),this._queue[a].isAchievedDestination?(b.push(this._queue[a]),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,0,this._queue[a].beforePosition.getPartsCoord()),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._queue[a].objID,this._queue[a].destination.getPartsCoord())):
d.push(this._queue[a]);this._queue=d;return b};b.prototype.clear=function(){this._queue=[]};Object.defineProperty(b.prototype,"objectMovingData",{get:function(){return this.objectMovingData},enumerable:!0,configurable:!0});b.prototype.getOffsetByBeforePartsCoord=function(b){var d=this._queue.filter(function(a){return a.beforePosition.getPartsCoord().equals(b)});return 0===d.length?null:d[0].currentPosition.getOffsetCoord()};return b}();f.ObjectMovingDataManager=k})(wwa_motion||(wwa_motion={}));var wwa_estimate_battle;
(function(f){var d=function(){function b(b,a,d){this.id=b;this.imgFileName=a;this.parent=d;this.elem=document.createElement("div");this.elem.classList.add("est");this.elem.setAttribute("id","wwa-est-"+b);this.imgElem=document.createElement("div");this.imgElem.classList.add("est-img-wrapper");this.imgElem.style.backgroundImage="url("+this.imgFileName.replace("(","\\(").replace(")","\\)")+")";this.statusElem=document.createElement("div");this.statusElem.classList.add("est-status-wrapper");this.energyElem=
document.createElement("div");this.energyElem.classList.add("est-energy");this.energyDispElem=document.createElement("span");this.energyDispElem.classList.add("est-energy-disp");this.energyElem.appendChild(this.energyDispElem);this.statusElem.appendChild(this.energyElem);this.strengthElem=document.createElement("div");this.strengthElem.classList.add("est-strength");this.strengthDispElem=document.createElement("span");this.strengthDispElem.classList.add("est-strength-disp");this.strengthElem.appendChild(this.strengthDispElem);
this.statusElem.appendChild(this.strengthElem);this.defenceElem=document.createElement("div");this.defenceElem.classList.add("est-defence");this.defenceDispElem=document.createElement("span");this.defenceDispElem.classList.add("est-defence-disp");this.defenceElem.appendChild(this.defenceDispElem);this.statusElem.appendChild(this.defenceElem);this.damageElem=document.createElement("div");this.damageElem.classList.add("est-damage");this.damageDispElem=document.createElement("span");this.damageDispElem.classList.add("est-damage-disp");
this.damageElem.appendChild(this.damageDispElem);this.statusElem.appendChild(this.damageElem);this.elem.appendChild(this.imgElem);this.elem.appendChild(this.statusElem)}b.prototype.hide=function(){this.elem.style.display="none"};b.prototype.show=function(){this.elem.style.display="block"};b.prototype.setResult=function(b,a,d){this.imgElem.style.backgroundPosition="-"+b.x+"px -"+b.y+"px";this.energyDispElem.textContent="\u751f\u547d\u529b "+a.energy;this.strengthDispElem.textContent="\u653b\u6483\u529b "+
a.strength;this.defenceDispElem.textContent="\u9632\u5fa1\u529b "+a.defence;this.damageDispElem.textContent=d.isNoEffect?"\u653b\u6483\u7121\u52b9":d.isOverMaxTurn?"\u9577\u671f\u6226\u304c\u4e88\u60f3\u3055\u308c\u307e\u3059":"\u4e88\u60f3\u30c0\u30e1\u30fc\u30b8 "+d.damage};return b}(),k=function(){function f(b,a,f){var h=this;this._wwa=b;this._imgFileName=a;this._parent=f;this._element=document.createElement("div");this._element.setAttribute("id","wwa-battle-estimate");this._element.style.display=
"none";this._edes=[];for(a=0;a<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;a++)b=new d(a,this._imgFileName,this._element),this._edes.push(b),this._element.appendChild(b.elem);this._element.addEventListener("click",function(){h._wwa.hideBattleEstimateWindow()});this._parent.appendChild(this._element)}f.prototype.update=function(d,a){for(var f=0;f<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;f++)if(f>=a.length)this._edes[f].hide();else{var h=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_X),
c=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_Y),h=new wwa_data.Coord(h,c),c=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_ENERGY),k=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_STRENGTH),r=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_DEFENCE),c=new wwa_data.Status(c,k,r,0);a:{var k=c.energy,r=d.strength-c.defence,C=Math.max(0,c.strength-d.defence),l=0,B=0;if(0<r)for(;;){l++;k-=r;if(0>=k){k=new b(!1,!1,B);break a}B+=C;if(1E4<l){k=new b(!1,
!0,0);break a}}else k=new b(!0,!1,0)}this._edes[f].setResult(h,c,k);this._edes[f].show()}};f.prototype.show=function(){this._element.style.display="block"};f.prototype.hide=function(){this._element.style.display="none"};return f}();f.BattleEstimateWindow=k;var b=function(){return function(b,d,a){this.isNoEffect=b;this.isOverMaxTurn=d;this.damage=a}}()})(wwa_estimate_battle||(wwa_estimate_battle={}));var wwa_inject_html;
(function(f){f.inject=function(d,f){var b=document.createElement("style");b.type="text/css";b.setAttribute("id",wwa_data.WWAConsts.WWA_STYLE_TAG_ID);wwa_util.$tag("head")[0].appendChild(b);d.innerHTML='            <canvas id="wwa-map" class="wwa-canvas" width="440" height="440">                \u3053\u306e\u30d6\u30e9\u30a6\u30b6\u306f\u3001Canvas\u8981\u7d20\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002            </canvas>            <canvas id="wwa-map-sub" class="wwa-canvas" width="440" height="440"></canvas>            <div id="wwa-sidebar">                <div class="wide-cell-row" id="disp-energy"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-strength"><div class="status-icon"></div><div class="status-value-box"> 0 </div></div>                <div class="wide-cell-row" id="disp-defence"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-gold"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="item-cell" id="item0"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item1"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item2"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item3"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item4"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item5"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item6"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item7"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item8"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item9"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item10"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item11"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="wide-cell-row" id="cell-load">Password</div><div class="wide-button" id="button-load"></div>                <div class="wide-cell-row" id="cell-save">Quick Save</div><div class="wide-button" id="button-save"></div>                <div class="wide-cell-row" id="cell-restart">Restart Game</div><div class="wide-button" id="button-restart"></div>                <div class="wide-cell-row" id="cell-gotowwa">Go to WWA</div><div class="wide-button" id="button-gotowwa"></div>            </div>            <div id="wwa-controller"></div>            <div id="wwa-fader"></div>            <div id="wwa-cover">                 <div id="version"></div>                 <div id="progress-message-container">\u958b\u59cb\u3057\u3066\u3044\u307e\u3059...</div>                 <div id="progress-bar-bg"></div>                 <div id="progress-bar" class="progress-bar"></div>                 <div id="progress-bar-audio" class="progress-bar"></div>                 <div id="progress-disp">---</div>            </div>            <div id="wwa-audio-wrapper"></div>    ';
b=document.createElement("img");b.src=f;wwa_util.$id("wwa-cover").appendChild(b)}})(wwa_inject_html||(wwa_inject_html={}));var wwa_psave;(function(f){var d;f.getPressData=function(){return d};f.createSavePassword=function(f){if(void 0===d||null===d)d=new Uint8Array(f.mapWidth*f.mapWidth*4);return""}})(wwa_psave||(wwa_psave={}));var wwa_password_window;
(function(f){(function(b){b[b.SAVE=0]="SAVE";b[b.LOAD=1]="LOAD"})(f.Mode||(f.Mode={}));var d=f.Mode,k=function(){function b(b,f){var a=this;this._wwa=b;this._parent=f;this._element=document.createElement("div");this._element.setAttribute("id","wwa-password-window");this._element.style.display="none";this._descriptionElement=document.createElement("div");this._descriptionElement.classList.add("wwa-password-description");this._passwordBoxElement=document.createElement("textarea");this._passwordBoxElement.setAttribute("cols",
"50");this._passwordBoxElement.setAttribute("rows","16");this._passwordBoxElement.addEventListener("focus",function(b){a._passwordBoxElement.select()});this._buttonWrapperElement=document.createElement("div");this._okButtonElement=document.createElement("button");this._okButtonElement.textContent="OK";this._okButtonElement.addEventListener("click",function(){a._wwa.hidePasswordWindow()});this._cancelButtonElement=document.createElement("button");this._cancelButtonElement.textContent="\u30ad\u30e3\u30f3\u30bb\u30eb";
this._cancelButtonElement.addEventListener("click",function(){a._wwa.hidePasswordWindow(!0)});this._buttonWrapperElement.appendChild(this._okButtonElement);this._buttonWrapperElement.appendChild(this._cancelButtonElement);this._mode=d.LOAD;this._element.appendChild(this._descriptionElement);this._element.appendChild(this._passwordBoxElement);this._element.appendChild(this._buttonWrapperElement);this._parent.appendChild(this._element);this.update()}Object.defineProperty(b.prototype,"mode",{get:function(){return this._mode},
set:function(b){this._mode=b;b===d.LOAD&&(this.password="")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"password",{get:function(){return this._passwordBoxElement.value},set:function(b){this._passwordBoxElement.value=b},enumerable:!0,configurable:!0});b.prototype.show=function(b){void 0!==b&&(this.mode=b);this._isVisible=!0;this.update()};b.prototype.hide=function(){this._isVisible=!1;this.update()};b.prototype.update=function(){var b;if(this._mode===d.LOAD){b="\u4e0b\u306e\u30dc\u30c3\u30af\u30b9\u306b\u524d\u56de\u306e\u30d7\u30ec\u30a4\u3067\u53d6\u5f97\u3057\u305f\n\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u30c6\u30ad\u30b9\u30c8\u306f\u3001Ctrl+C\u3067\u30b3\u30d4\u30fc\u3001Ctrl+V\u3067\u8cbc\u308a\u4ed8\u3051\u3067\u304d\u307e\u3059\u3002\n\u73fe\u5728\u3001Java\u7248WWA\u3067\u53d6\u5f97\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002\n\u4f5c\u6210\u8005\u304c\u30de\u30c3\u30d7\u306e\u5185\u5bb9\u3092\u5909\u66f4\u3057\u305f\u5834\u5408\u306f\n\u305d\u308c\u4ee5\u524d\u306b\u53d6\u5f97\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u4f7f\u3048\u306a\u304f\u306a\u308a\u307e\u3059\u3002";
try{this._passwordBoxElement.removeAttribute("readonly")}catch(w){}this._cancelButtonElement.style.display="inline"}else b="\u4e0b\u8a18\u30c6\u30ad\u30b9\u30c8\u304c\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30d4\u30fc\u3057\u3066\u30e1\u30e2\u5e33\u306a\u3069\u306e\u30c6\u30ad\u30b9\u30c8\u30a8\u30c7\u30a3\u30bf\u306b\u8cbc\u308a\u4ed8\u3051\u3066\n\u4fdd\u5b58\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30dc\u30c3\u30af\u30b9\u3092\u30af\u30ea\u30c3\u30af\u3067\u5168\u4f53\u3092\u9078\u629e\u3001\n\u300cCtrl+C\u300d\u3067\u30b3\u30d4\u30fc\u3001\u300cCtrl+V\u300d\u3067\u8cbc\u308a\u4ed8\u3051\u3067\u304d\u307e\u3059\u3002\n\u901a\u5e38\u6570\u4e07\u6587\u5b57\u7a0b\u5ea6\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002",
this._passwordBoxElement.setAttribute("readonly","readonly"),this._cancelButtonElement.style.display="none";b=b.split("\n");this._descriptionElement.textContent="";for(var f=0;f<b.length;f++){var a=document.createElement("span");a.textContent=b[f];this._descriptionElement.appendChild(a);this._descriptionElement.appendChild(document.createElement("br"))}this._element.style.display=this._isVisible?"block":"none"};return b}();f.PasswordWindow=k})(wwa_password_window||(wwa_password_window={}));
var postMessage_noWorker=function(f){},wwa_main;
(function(f){function d(a,b,c){var e=new wwa_data.LoaderProgress;e.current=a;e.total=b;e.stage=c;return e}function k(){void 0===window.wwap_mode&&(wwap_mode=!1);Array.prototype.forEach.call(l.$qsAll("a.wwa-copyright"),function(a){a.addEventListener("click",function(){x=!0})});window.addEventListener("beforeunload",function(a){if(x)return x=!1,a.returnValue="\u3053\u306e\u30da\u30fc\u30b8\u3092\u96e2\u308c\u307e\u3059\u304b\uff1f"});var a=wwap_mode?c.WWAP_SERVER+"/"+c.WWAP_SERVER_TITLE_IMG:l.$id("wwa-wrapper").getAttribute("data-wwa-title-img");
wwa_inject_html.inject(l.$id("wwa-wrapper"),null===a?"cover.gif":a);var a=l.$id("wwa-wrapper").getAttribute("data-wwa-mapdata"),b=l.$id("wwa-wrapper").getAttribute("data-wwa-loader"),m=l.$id("wwa-wrapper").getAttribute("data-wwa-audio-dir"),p=!0;l.$id("wwa-wrapper").getAttribute("data-wwa-urlgate-enable").match(/^false$/i)&&(p=!1);new B(a,b,p,m)}var b=wwa_input.KeyCode,r=wwa_input.KeyState,h=wwa_input.KeyStore,a=wwa_input.MouseState,w=wwa_input.MouseStore,n=wwa_cgmanager.CGManager,c=wwa_data.WWAConsts,
y=wwa_data.Coord,A=wwa_data.Position,C=wwa_camera.Camera,l=wwa_util;f.getProgress=d;var B=function(){function g(a,m,p,z){var e=this;void 0===p&&(p=!1);void 0===z&&(z="");try{l.$id("version").textContent="WWA Wing Ver."+c.VERSION_WWAJS}catch(E){}this._isURLGateEnable=p;this._animationCounter=this._mainCallCounter=0;this._statusPressCounter=new wwa_data.Status(0,0,0,0);z?"/"!==z[z.length-1]&&(z+="/"):z="./audio/";this._audioDirectory=z;var g=(new Date).getTime();location.href.match(/^file/)&&alert("\u3010\u8b66\u544a\u3011\u76f4\u63a5HTML\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u78ba\u8a8d\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u540c\u68b1\u306e\u300cWWA Debugger\u300d\u3092\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002");
if(void 0===window.audiojs)alert("Audio.js\u306e\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n\u30d5\u30a9\u30eb\u30c0"+this._audioDirectory+"\u306e\u4e2d\u306baudio.min.js\u306f\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3059\u304b\uff1f \n\u30d5\u30a9\u30eb\u30c0\u3092\u5909\u66f4\u3055\u308c\u308b\u5834\u5408\u306b\u306f data-wwa-audio-dir \u5c5e\u6027\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044");else if(this._loadHandler=function(a){if(null!==a.data.error&&void 0!==
a.data.error)alert("\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002: \n"+a.data.error.message);else if(null!==a.data.progress&&void 0!==a.data.progress)e._setProgressBar(a.data.progress);else{e._wwaData=a.data.wwaData;try{l.$id("version").textContent+=" (Map data Ver. "+Math.floor(e._wwaData.version/10)+"."+ +e._wwaData.version%10+")"}catch(q){}e.initCSSRule();e._setProgressBar(d(0,4,wwa_data.LoadStage.GAME_INIT));a=new Image;a.src=e._wwaData.mapCGName;a.addEventListener("error",
function(){alert("\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u300c"+e._wwaData.mapCGName+"\u300d\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u7ba1\u7406\u8005\u306e\u65b9\u3078: \u30c7\u30fc\u30bf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u304b\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002")});e._restartData=JSON.parse(JSON.stringify(e._wwaData));var m=e._wwaData.mapCGName.replace("(",
"\\(").replace(")","\\)");Array.prototype.forEach.call(l.$qsAll("div.item-cell"),function(a){a.style.backgroundPosition="-40px -80px";a.style.backgroundImage="url("+m+")"});Array.prototype.forEach.call(l.$qsAll("div.wide-cell-row"),function(a){a.style.backgroundPosition="-160px -120px";a.style.backgroundImage="url("+m+")"});Array.prototype.forEach.call(l.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage="url('"+c.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0";
a.style.display="none";a.style.cursor="pointer"});Array.prototype.forEach.call(l.$qsAll(".item-cell>.item-disp"),function(a){a.style.backgroundImage="url("+m+")"});a=l.$qsh("#disp-energy>.status-icon");a.style.backgroundPosition="-120px -80px";a.style.backgroundImage="url("+m+")";a=l.$qsh("#disp-strength>.status-icon");a.style.backgroundPosition="-160px -80px";a.style.backgroundImage="url("+m+")";a=l.$qsh("#disp-defence>.status-icon");a.style.backgroundPosition="-200px -80px";a.style.backgroundImage=
"url("+m+")";a=l.$qsh("#disp-gold>.status-icon");a.style.backgroundPosition="-240px -80px";a.style.backgroundImage="url("+m+")";e._setProgressBar(d(1,4,wwa_data.LoadStage.GAME_INIT));e._replaceAllRandomObjects();a=(new Date).getTime();console.log("Loading Complete!"+(a-g)+"ms");e._cvs=l.$id("wwa-map");e._cvsSub=l.$id("wwa-map-sub");a=e._cvs.getContext("2d");var p=e._cvsSub.getContext("2d");a.fillStyle="rgba( 255, 255, 255, 0.5)";a.fillRect(0,0,440,440);var z=new A(e,e._wwaData.playerX,e._wwaData.playerY);
e._camera=new C(z);var f=new wwa_data.Status(e._wwaData.statusEnergy,e._wwaData.statusStrength,e._wwaData.statusDefence,e._wwaData.statusGold);e._player=new wwa_parts_player.Player(e,z,e._camera,f,e._wwaData.statusEnergyMax);e._objectMovingDataManager=new wwa_motion.ObjectMovingDataManager(e,e._player);e._camera.setPlayer(e._player);e._keyStore=new h;e._mouseStore=new w;e._messageQueue=[];e._yesNoJudge=wwa_data.YesNoState.UNSELECTED;e._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;e._yesNoChoiceCallInfo=
wwa_data.ChoiceCallInfo.NONE;e._prevFrameEventExected=!1;e._lastMessage=new wwa_message.MessageInfo("",!1,!1,[]);e._execMacroListInNextFrame=[];e._passwordLoadExecInNextFrame=!1;e._setProgressBar(d(2,4,wwa_data.LoadStage.GAME_INIT));window.addEventListener("keydown",function(a){e._keyStore.setPressInfo(a.keyCode);a.keyCode===b.KEY_F5?a.preventDefault():e._player.isWaitingMessage()?a.keyCode!==b.KEY_DOWN&&a.keyCode!==b.KEY_LEFT&&a.keyCode!==b.KEY_RIGHT&&a.keyCode!==b.KEY_UP&&a.keyCode!==b.KEY_SHIFT&&
a.keyCode!==b.KEY_ENTER&&a.keyCode!==b.KEY_ESC&&a.keyCode!==b.KEY_SPACE||a.preventDefault():e._player.isWaitingPasswordWindow()||a.keyCode!==b.KEY_DOWN&&a.keyCode!==b.KEY_LEFT&&a.keyCode!==b.KEY_RIGHT&&a.keyCode!==b.KEY_UP&&a.keyCode!==b.KEY_SHIFT&&a.keyCode!==b.KEY_ENTER&&a.keyCode!==b.KEY_1&&a.keyCode!==b.KEY_2&&a.keyCode!==b.KEY_3&&a.keyCode!==b.KEY_A&&a.keyCode!==b.KEY_C&&a.keyCode!==b.KEY_D&&a.keyCode!==b.KEY_E&&a.keyCode!==b.KEY_M&&a.keyCode!==b.KEY_N&&a.keyCode!==b.KEY_Q&&a.keyCode!==b.KEY_S&&
a.keyCode!==b.KEY_W&&a.keyCode!==b.KEY_X&&a.keyCode!==b.KEY_Y&&a.keyCode!==b.KEY_Z&&a.keyCode!==b.KEY_ESC&&a.keyCode!==b.KEY_F1&&a.keyCode!==b.KEY_F3&&a.keyCode!==b.KEY_F4&&a.keyCode!==b.KEY_F6&&a.keyCode!==b.KEY_F7&&a.keyCode!==b.KEY_F8&&a.keyCode!==b.KEY_F12&&a.keyCode!==b.KEY_SPACE||a.preventDefault()});window.addEventListener("keyup",function(a){e._keyStore.setReleaseInfo(a.keyCode);if(a.keyCode===b.KEY_F5)a.preventDefault();else if(a.keyCode===b.KEY_DOWN||a.keyCode===b.KEY_LEFT||a.keyCode===
b.KEY_RIGHT||a.keyCode===b.KEY_UP||a.keyCode===b.KEY_SHIFT||a.keyCode===b.KEY_ENTER||a.keyCode===b.KEY_1||a.keyCode===b.KEY_2||a.keyCode===b.KEY_3||a.keyCode===b.KEY_A||a.keyCode===b.KEY_C||a.keyCode===b.KEY_D||a.keyCode===b.KEY_E||a.keyCode===b.KEY_M||a.keyCode===b.KEY_N||a.keyCode===b.KEY_Q||a.keyCode===b.KEY_S||a.keyCode===b.KEY_W||a.keyCode===b.KEY_X||a.keyCode===b.KEY_Y||a.keyCode===b.KEY_Z||a.keyCode===b.KEY_ESC||a.keyCode===b.KEY_F1||a.keyCode===b.KEY_F3||a.keyCode===b.KEY_F4||a.keyCode===
b.KEY_F6||a.keyCode===b.KEY_F7||a.keyCode===b.KEY_F8||a.keyCode===b.KEY_F12||a.keyCode===b.KEY_SPACE)e._player.isWaitingMessage()||e._player.isWaitingPasswordWindow()||a.preventDefault()});window.addEventListener("blur",function(a){e._keyStore.allClear();e._mouseStore.clear()});window.addEventListener("contextmenu",function(a){e._keyStore.allClear();e._mouseStore.clear()});window.addEventListener("help",function(a){a.preventDefault()});e._wwaWrapperElement=wwa_util.$id("wwa-wrapper");e._mouseControllerElement=
wwa_util.$id("wwa-controller");e._mouseControllerElement.addEventListener("mousedown",function(a){if(1===a.which){if(e._mouseStore.getMouseState()===wwa_input.MouseState.NONE){var b=wwa_util.$localPos(a.clientX,a.clientY),c=e._player.getDrawingCenterPosition(),b=b.substract(c),c=Math.abs(b.x),m=Math.abs(b.y),p;0<b.y&&m>c?p=wwa_data.Direction.DOWN:0>b.y&&m>c?p=wwa_data.Direction.UP:0<b.x&&m<c?p=wwa_data.Direction.RIGHT:0>b.x&&m<c&&(p=wwa_data.Direction.LEFT);e._mouseStore.setPressInfo(p)}a.preventDefault()}});
e._mouseControllerElement.addEventListener("mouseleave",function(a){e._mouseStore.clear()});e._mouseControllerElement.addEventListener("mouseup",function(a){1===a.which&&(e._mouseStore.setReleaseInfo(),a.preventDefault())});window.TouchEvent&&(e._mouseControllerElement.addEventListener("touchstart",function(a){if(e._mouseStore.getMouseState()!==wwa_input.MouseState.NONE)a.preventDefault();else{var b=wwa_util.$localPos(a.changedTouches[0].clientX,a.changedTouches[0].clientY),c=e._player.getDrawingCenterPosition(),
b=b.substract(c),c=Math.abs(b.x),m=Math.abs(b.y),p;0<b.y&&m>c?p=wwa_data.Direction.DOWN:0>b.y&&m>c?p=wwa_data.Direction.UP:0<b.x&&m<c?p=wwa_data.Direction.RIGHT:0>b.x&&m<c&&(p=wwa_data.Direction.LEFT);e._mouseStore.setPressInfo(p,a.changedTouches[0].identifier);a.cancelable&&a.preventDefault()}}),e._mouseControllerElement.addEventListener("touchend",function(a){for(var b=0;b<a.changedTouches.length;b++)if(e._mouseStore.getTouchID()===a.changedTouches[b].identifier){e._mouseStore.setReleaseInfo();
a.preventDefault();break}}),e._mouseControllerElement.addEventListener("touchcancel",function(a){for(var b=0;b<a.changedTouches.length;b++)if(e._mouseStore.getTouchID()===a.changedTouches[b].identifier){e._mouseStore.setReleaseInfo();a.preventDefault();break}}));l.$id("button-load").addEventListener("click",function(){if(e._player.isControllable())e.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD)});l.$id("button-save").addEventListener("click",function(){if(e._player.isControllable())e.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE)});
l.$id("button-restart").addEventListener("click",function(){if(e._player.isControllable())e.onselectbutton(wwa_data.SidebarButton.RESTART_GAME)});l.$id("button-gotowwa").addEventListener("click",function(){if(e._player.isControllable())e.onselectbutton(wwa_data.SidebarButton.GOTO_WWA)});Array.prototype.forEach.call(l.$qsAll(".wide-cell-row"),function(a){a.addEventListener("click",function(){e._displayHelp()})});e._frameCoord=new y(c.IMGPOS_DEFAULT_FRAME_X,c.IMGPOS_DEFAULT_YESNO_Y);e._battleEffectCoord=
new y(c.IMGPOS_DEFAULT_BATTLE_EFFECT_X,c.IMGPOS_DEFAULT_BATTLE_EFFECT_Y);e._battleEstimateWindow=new wwa_estimate_battle.BattleEstimateWindow(e,e._wwaData.mapCGName,wwa_util.$id("wwa-wrapper"));e._passwordWindow=new wwa_password_window.PasswordWindow(e,wwa_util.$id("wwa-wrapper"));e._messageWindow=new wwa_message.MessageWindow(e,50,180,340,0,"",e._wwaData.mapCGName,!1,!0,l.$id("wwa-wrapper"));e._monsterWindow=new wwa_message.MosterWindow(e,new y(50,180),340,60,!1,l.$id("wwa-wrapper"),e._wwaData.mapCGName);
e._scoreWindow=new wwa_message.ScoreWindow(e,new y(50,50),!1,l.$id("wwa-wrapper"));e._setProgressBar(d(3,4,wwa_data.LoadStage.GAME_INIT));e._isLoadedSound=!1;e._temporaryInputDisable=!1;e._paintSkipByDoorOpen=!1;e._clearFacesInNextFrame=!1;e._useConsole=!1;e.clearFaces();e._cgManager=new n(a,p,e._wwaData.mapCGName,function(){if("ON"===e._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])e._isLoadedSound=!0,e.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u203biOS, Android\u7aef\u672b\u3067\u306f\u3001\u97f3\u697d\u306f\u518d\u751f\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002",
!1,!0),e.loadSound(),setTimeout(e.soundCheckCaller,c.DEFAULT_FRAME_INTERVAL,e);else if("OFF"===e._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])e._isLoadedSound=!1,e.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002",!1,!0),e.openGameWindow();else{e._messageWindow.setMessage((""===e._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE]?"\u52b9\u679c\u97f3\u30fb\uff22\uff27\uff2d\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u304b\uff1f":
e._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])+"\n\u203biOS, Android\u7aef\u672b\u3067\u306f\u3001\u9078\u629e\u306b\u95a2\u308f\u3089\u305a\u97f3\u697d\u304c\u518d\u751f\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002");e._messageWindow.show();e._setProgressBar(d(4,4,wwa_data.LoadStage.GAME_INIT));var a=setInterval(function(){e._keyStore.update();if(e._yesNoJudgeInNextFrame===wwa_data.YesNoState.UNSELECTED)if(e._keyStore.getKeyState(b.KEY_ENTER)===r.KEYDOWN||e._keyStore.getKeyState(b.KEY_Y)===
r.KEYDOWN)e._yesNoJudgeInNextFrame=wwa_data.YesNoState.YES;else if(e._keyStore.getKeyState(b.KEY_N)===r.KEYDOWN||e._keyStore.getKeyState(b.KEY_ESC)===r.KEYDOWN)e._yesNoJudgeInNextFrame=wwa_data.YesNoState.NO;e._yesNoJudgeInNextFrame===wwa_data.YesNoState.YES?(clearInterval(a),e._messageWindow.update(),e._yesNoJudge=e._yesNoJudgeInNextFrame,e._messageWindow.setInputDisable(),setTimeout(function(){e._messageWindow.update();setTimeout(function(){e._messageWindow.hide();e._yesNoJudge=wwa_data.YesNoState.UNSELECTED;
e._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;e._isLoadedSound=!0;e.loadSound();setTimeout(e.soundCheckCaller,c.DEFAULT_FRAME_INTERVAL,e)},c.YESNO_PRESS_DISP_FRAME_NUM*c.DEFAULT_FRAME_INTERVAL)},c.DEFAULT_FRAME_INTERVAL)):e._yesNoJudgeInNextFrame===wwa_data.YesNoState.NO&&(clearInterval(a),e._messageWindow.update(),e._yesNoJudge=e._yesNoJudgeInNextFrame,e._messageWindow.setInputDisable(),setTimeout(function(){e._messageWindow.update();setTimeout(function(){e._messageWindow.hide();e._yesNoJudge=
wwa_data.YesNoState.UNSELECTED;e._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;e._isLoadedSound=!1;e.openGameWindow()},c.YESNO_PRESS_DISP_FRAME_NUM*c.DEFAULT_FRAME_INTERVAL)},c.DEFAULT_FRAME_INTERVAL))},c.DEFAULT_FRAME_INTERVAL)}})}},wwap_mode||void 0===Worker){if(external_script_inject_mode){if(m=document.getElementById("wwaloader-ex"),!(m.src.match(/^http:\/\/wwawing\.com/)||m.src.match(/^http:\/\/www\.wwawing\.com/)||m.src.match(/^https:\/\/wwaphoenix\.github\.io/)||m.src.match(/^https:\/\/www\.wwaphoenix\.github\.io/)))throw Error("SCRIPT ORIGIN ERROR");
}else m=document.createElement("script"),m.src=wwap_mode?c.WWAP_SERVER+"/"+c.WWAP_SERVER_LOADER_NO_WORKER:"wwaload.noworker.js",document.getElementsByTagName("head")[0].appendChild(m);var f=this;postMessage_noWorker=function(a){f._loadHandler(a)};try{loader_start({data:{fileName:a+"?date="+g}})}catch(E){m.onload=function(){loader_start({data:{fileName:a+"?date="+g}})}}}else try{var k=new Worker(m+"?date="+g);k.postMessage({fileName:a+"?date="+g});k.addEventListener("message",this._loadHandler)}catch(E){alert("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u30ed\u30fc\u30c9\u6642\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002:\nWebWorker\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"+
E.message)}}g.prototype._setProgressBar=function(a){a.stage<=c.LOAD_STAGE_MAX_EXCEPT_AUDIO?(wwa_util.$id("progress-message-container").textContent=a.stage===c.LOAD_STAGE_MAX_EXCEPT_AUDIO?"World Name: "+this._wwaData.worldName:wwa_data.loadMessages[a.stage],wwa_util.$id("progress-bar").style.width=(1*a.stage+a.current/a.total*1)/(c.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*c.MAP_WINDOW_WIDTH+"px",wwa_util.$id("progress-disp").textContent=((1*a.stage+a.current/a.total*1)/(c.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*100).toFixed(2)+
"%"):(wwa_util.$id("progress-message-container").textContent="\u52b9\u679c\u97f3/BGM\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002(\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u30b9\u30ad\u30c3\u30d7\uff09",wwa_util.$id("progress-bar-audio").style.width=a.current*c.MAP_WINDOW_WIDTH/a.total+"px",wwa_util.$id("progress-disp").textContent=(a.current/a.total*100).toFixed(2)+"%")};g.prototype.createAudioJSInstance=function(a,b){if(0!==a&&void 0===this._audioJSInstances[a]&&a!==wwa_data.SystemSound.NO_SOUND){var e=
wwap_mode?c.WWAP_SERVER+"/"+c.WWAP_SERVER_AUDIO_DIR+"/"+a+".mp3":this._audioDirectory+a+".mp3",m=new Audio(e);m.preload="auto";a>=wwa_data.SystemSound.BGM_LB&&(m.loop=!0);l.$id("wwa-audio-wrapper").appendChild(m);this._audioJSInstances[a]=audiojs.create(m);a<wwa_data.SystemSound.BGM_LB&&(e=new Audio(e),e.preload="auto",l.$id("wwa-audio-wrapper").appendChild(e),this._audioJSInstancesSub[a]=audiojs.create(e))}};g.prototype.loadSound=function(){this._audioJSInstances=Array(c.SOUND_MAX+1);this._audioJSInstancesSub=
Array(c.SOUND_MAX+1);this.createAudioJSInstance(wwa_data.SystemSound.DECISION);this.createAudioJSInstance(wwa_data.SystemSound.ATTACK);for(var a=1;a<this._wwaData.mapPartsMax;a++){var b=this._wwaData.mapAttribute[a][c.ATR_SOUND];this.createAudioJSInstance(b)}for(a=1;a<this._wwaData.objPartsMax;a++)this._wwaData.objectAttribute[a][c.ATR_TYPE]!==c.OBJECT_RANDOM&&(b=this._wwaData.objectAttribute[a][c.ATR_SOUND],this.createAudioJSInstance(b));this._wwaData.bgm=0;this._soundLoadSkipFlag=!1};g.prototype.checkAllSoundLoaded=
function(){var a=0,b=0;this._keyStore.update();this._keyStore.getKeyState(wwa_input.KeyCode.KEY_SPACE)===wwa_input.KeyState.KEYDOWN&&(this._soundLoadSkipFlag=!0);for(var p=1;p<=c.SOUND_MAX;p++)void 0===this._audioJSInstances[p]||this._audioJSInstances[p].wrapper.classList.contains("error")||(b++,this._audioJSInstances[p].wrapper.classList.contains("loading")||a++);a<b&&!this._soundLoadSkipFlag?(this._setProgressBar(d(a,b,wwa_data.LoadStage.AUDIO)),setTimeout(this.soundCheckCaller,c.DEFAULT_FRAME_INTERVAL,
this)):(this._setProgressBar(d(c.SOUND_MAX,c.SOUND_MAX,wwa_data.LoadStage.AUDIO)),this.openGameWindow())};g.prototype.playSound=function(a){var b=this;if(this._isLoadedSound){if(0>a||a>c.SOUND_MAX)throw Error("\u30b5\u30a6\u30f3\u30c9\u756a\u53f7\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");if(!(a>=wwa_data.SystemSound.BGM_LB&&this._wwaData.bgm===a)&&((a===wwa_data.SystemSound.NO_SOUND||a>=wwa_data.SystemSound.BGM_LB)&&0!==this._wwaData.bgm&&(this._audioJSInstances[this._wwaData.bgm].wrapper.classList.contains("loading")||
this._audioJSInstances[this._wwaData.bgm].pause(),this._wwaData.bgm=0),0!==a&&a!==wwa_data.SystemSound.NO_SOUND))if(this._audioJSInstances[a].wrapper.classList.contains("loading")){if(a>=wwa_data.SystemSound.BGM_LB){var e=function(a,c){var m=setInterval(function(){c._wwaData.bgm===a?c._audioJSInstances[a].wrapper.classList.contains("loading")||(b._audioJSInstances[a].skipTo(0),b._audioJSInstances[a].play(),b._wwaData.bgm=a,clearInterval(m)):(clearInterval(m),c._wwaData.bgm!==wwa_data.SystemSound.NO_SOUND&&
e(c._wwaData.bgm,c))},4)};e(a,this)}this._wwaData.bgm=a}else 0===a||this._audioJSInstances[a].wrapper.classList.contains("error")||(a>=wwa_data.SystemSound.BGM_LB?(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._wwaData.bgm=a):this._nextSoundIsSub?(this._audioJSInstancesSub[a].skipTo(0),this._audioJSInstancesSub[a].play(),this._nextSoundIsSub=!1):(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._nextSoundIsSub=!0))}};g.prototype.openGameWindow=
function(){var a=this,b=this._player.getPosition();l.$id("wwa-cover").style.opacity="0";0!==this.getObjectIdByPosition(b)&&this._player.setPartsAppearedFlag();setTimeout(function(){l.$id("wwa-wrapper").removeChild(l.$id("wwa-cover"));a._main()},c.SPLASH_SCREEN_DISP_MILLS)};g.prototype.mainCaller=function(a){a._main()};g.prototype.soundCheckCaller=function(a){a.checkAllSoundLoaded()};g.prototype.onselectitem=function(a){if(this._player.canUseItem(a))if(wwa_util.$id("item"+(a-1)).classList.add("onpress"),
this.playSound(wwa_data.SystemSound.DECISION),"BLANK"===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]){this._player.readyToUseItem(a);a=this._player.useItem();var b=this.getObjectAttributeById(a,c.ATR_STRING);this.setMessageQueue(this.getMessageById(b),!1,!1,a,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord())}else this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b?":
this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM],!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE,this._yesNoUseItemPos=a};g.prototype.onselectbutton=function(a,b){void 0===b&&(b=!1);var e=wwa_util.$id(wwa_data.sidebarButtonCellElementID[a]);this.playSound(wwa_data.SystemSound.DECISION);e.classList.add("onpress");if(a===wwa_data.SidebarButton.QUICK_LOAD)if(void 0===this._quickSaveData||b)this.onpasswordloadcalled();else this.setMessageQueue("\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u304b\uff1f\n\u2192\uff2e\uff4f\u3067\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\n\u3000\u5165\u529b\u9078\u629e\u304c\u3067\u304d\u307e\u3059\u3002",
!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD;else a===wwa_data.SidebarButton.QUICK_SAVE?this._wwaData.disableSaveFlag?this.setMessageQueue("\u3053\u3053\u3067\u306f\u30bb\u30fc\u30d6\u6a5f\u80fd\u306f\n\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002",!1,!0):(this.setMessageQueue("\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\u3092\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n\u2192\uff2e\uff4f\u3067\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\n\u3000\u8868\u793a\u9078\u629e\u304c\u3067\u304d\u307e\u3059\u3002",
!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE):a===wwa_data.SidebarButton.RESTART_GAME?(this.setMessageQueue("\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3057\u306a\u304a\u3057\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME):a===wwa_data.SidebarButton.GOTO_WWA&&(this.setMessageQueue("\uff37\uff37\uff21\u306e\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u958b\u304d\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=
wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA)};g.prototype.onpasswordloadcalled=function(){wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.add("onpress");this.setMessageQueue("\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u307e\u3059\u304b\uff1f",!0,!0);this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD};g.prototype.onpasswordsavecalled=function(){wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.add("onpress");
this._wwaData.disableSaveFlag?this.setMessageQueue("\u3053\u3053\u3067\u306f\u30bb\u30fc\u30d6\u6a5f\u80fd\u306f\n\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002",!1,!0):(this.setMessageQueue("\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8868\u793a\u3057\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE)};g.prototype.onchangespeed=function(a){a=a===wwa_data.SpeedChange.UP?this._player.speedUp():this._player.speedDown();
this.setMessageQueue("\u79fb\u52d5\u901f\u5ea6\u3092\u3010"+wwa_data.speedNameList[a]+"\u3011\u306b\u5207\u308a\u66ff\u3048\u307e\u3057\u305f\u3002\n"+(a===c.MAX_SPEED_INDEX?"\u6226\u95d8\u3082\u901f\u304f\u306a\u308a\u307e\u3059\u3002\n":"")+"("+(c.MAX_SPEED_INDEX+1)+"\u6bb5\u968e\u4e2d"+(a+1)+"\uff09 \u901f\u5ea6\u3092\u843d\u3068\u3059\u306b\u306fI\u30ad\u30fc, \u901f\u5ea6\u3092\u4e0a\u3052\u308b\u306b\u306fP\u30ad\u30fc\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002",!1,!0)};g.prototype._main=
function(){var e=this;this._temporaryInputDisable=!1;this._waitTimeInCurrentFrame=c.DEFAULT_FRAME_INTERVAL;this._stopUpdateByLoadFlag=!1;this._keyStore.update();this._mouseStore.update();void 0!==this._yesNoJudgeInNextFrame&&(this._yesNoJudge=this._yesNoJudgeInNextFrame,this._yesNoJudgeInNextFrame=void 0);this._clearFacesInNextFrame&&(this.clearFaces(),this._clearFacesInNextFrame=!1);for(var m=0;m<this._execMacroListInNextFrame.length;m++)this._execMacroListInNextFrame[m].execute();""===this._lastMessage.message&&
this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);this._execMacroListInNextFrame=[];this._player.getPosition();m=this._player.getDir();if(this._player.isControllable()){if(this._keyStore.getKeyStateForControllPlayer(b.KEY_LEFT)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.LEFT)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.LEFT),
this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(b.KEY_UP)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.UP)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(b.KEY_RIGHT)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.RIGHT)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.RIGHT),
this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(b.KEY_DOWN)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.DOWN)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(wwa_data.dirToKey[m]))this._player.controll(m),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT))this._player.controll(wwa_data.Direction.LEFT),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP))this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_RIGHT)||this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT))this._player.controll(wwa_data.Direction.RIGHT),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN))this._player.controll(wwa_data.Direction.DOWN),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT))this._player.controll(wwa_data.Direction.LEFT),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP))this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_RIGHT)||this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT))this._player.controll(wwa_data.Direction.RIGHT),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN))this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update();else if(this._keyStore.getKeyState(b.KEY_1)===wwa_input.KeyState.KEYDOWN)this.onselectitem(1);else if(this._keyStore.getKeyState(b.KEY_2)===wwa_input.KeyState.KEYDOWN)this.onselectitem(2);else if(this._keyStore.getKeyState(b.KEY_3)===wwa_input.KeyState.KEYDOWN)this.onselectitem(3);
else if(this._keyStore.getKeyState(b.KEY_Q)===wwa_input.KeyState.KEYDOWN)this.onselectitem(4);else if(this._keyStore.getKeyState(b.KEY_W)===wwa_input.KeyState.KEYDOWN)this.onselectitem(5);else if(this._keyStore.getKeyState(b.KEY_E)===wwa_input.KeyState.KEYDOWN)this.onselectitem(6);else if(this._keyStore.getKeyState(b.KEY_A)===wwa_input.KeyState.KEYDOWN)this.onselectitem(7);else if(this._keyStore.getKeyState(b.KEY_S)===wwa_input.KeyState.KEYDOWN)this.onselectitem(8);else if(this._keyStore.getKeyState(b.KEY_D)===
wwa_input.KeyState.KEYDOWN)this.onselectitem(9);else if(this._keyStore.getKeyState(b.KEY_Z)===wwa_input.KeyState.KEYDOWN)this.onselectitem(10);else if(this._keyStore.getKeyState(b.KEY_X)===wwa_input.KeyState.KEYDOWN)this.onselectitem(11);else if(this._keyStore.getKeyState(b.KEY_C)===wwa_input.KeyState.KEYDOWN)this.onselectitem(12);else if(this._keyStore.getKeyState(b.KEY_I))this.onchangespeed(wwa_data.SpeedChange.DOWN);else if(this._keyStore.checkHitKey(b.KEY_P))this.onchangespeed(wwa_data.SpeedChange.UP);
else if(this._keyStore.getKeyState(b.KEY_F1)===wwa_input.KeyState.KEYDOWN||this._keyStore.getKeyState(b.KEY_M)===wwa_input.KeyState.KEYDOWN)this.launchBattleEstimateWindow();else if(this._keyStore.checkHitKey(b.KEY_F3))this.playSound(wwa_data.SystemSound.DECISION),this.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD,!0);else if(this._keyStore.checkHitKey(b.KEY_F4))this.playSound(wwa_data.SystemSound.DECISION),this.onpasswordsavecalled();else if(this._keyStore.checkHitKey(b.KEY_F5))this.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD);
else if(this._keyStore.checkHitKey(b.KEY_F6))this.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE);else if(this._keyStore.checkHitKey(b.KEY_F7))this.onselectbutton(wwa_data.SidebarButton.RESTART_GAME);else if(this._keyStore.checkHitKey(b.KEY_F8))this.onselectbutton(wwa_data.SidebarButton.GOTO_WWA);else this._keyStore.checkHitKey(b.KEY_F12)&&this._displayHelp();this._keyStore.memorizeKeyStateOnControllableFrame();this._mouseStore.memorizeMouseStateOnControllableFrame()}else if(this._player.isJumped())this._camera.isResetting()||
this._player.processAfterJump();else if(this._player.isMoving())this._player.move(),this._objectMovingDataManager.update();else if(this._player.isWaitingMessage())if(this._messageWindow.isVisible()||this._messageWindow.show(),!this._messageWindow.isYesNoChoice()){var m=this._keyStore.getKeyStateForMessageCheck(b.KEY_ENTER),p=this._keyStore.getKeyStateForMessageCheck(b.KEY_SPACE),d=this._keyStore.getKeyStateForMessageCheck(b.KEY_ESC);if(m===r.KEYDOWN||m===r.KEYPRESS_MESSAGECHANGE||p===r.KEYDOWN||p===
r.KEYPRESS_MESSAGECHANGE||d===r.KEYDOWN||d===r.KEYPRESS_MESSAGECHANGE||this._mouseStore.getMouseState()===a.MOUSEDOWN){for(m=0;m<wwa_data.sidebarButtonCellElementID.length;m++)p=wwa_util.$id(wwa_data.sidebarButtonCellElementID[m]),p.classList.contains("onpress")&&p.classList.remove("onpress");this._setNextMessage()}}else{if(!this._messageWindow.isInputDisable()){if(this._yesNoJudge===wwa_data.YesNoState.UNSELECTED)if(this._keyStore.getKeyState(b.KEY_ENTER)===r.KEYDOWN||this._keyStore.getKeyState(b.KEY_Y)===
r.KEYDOWN)this._yesNoJudge=wwa_data.YesNoState.YES;else if(this._keyStore.getKeyState(b.KEY_N)===r.KEYDOWN||this._keyStore.getKeyState(b.KEY_ESC)===r.KEYDOWN)this._yesNoJudge=wwa_data.YesNoState.NO;this._yesNoJudge===wwa_data.YesNoState.YES?(this.playSound(wwa_data.SystemSound.DECISION),this._yesNoDispCounter=c.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update()):this._yesNoJudge===wwa_data.YesNoState.NO&&(this.playSound(wwa_data.SystemSound.DECISION),this._yesNoDispCounter=
c.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update())}}else this._player.isWatingEstimateWindow()?this._keyStore.getKeyState(b.KEY_ENTER)!==r.KEYDOWN&&this._keyStore.getKeyState(b.KEY_SPACE)!==r.KEYDOWN||this.hideBattleEstimateWindow():this._player.isFighting()?(this._player.fight(),this._monsterWindow.update(this._monster)):this._player.isWaitingMoveMacro()&&(this._player.isMoveObjectAutoExecTime()&&(this.moveObjects(!1),this._player.resetMoveObjectAutoExecTimer()),
this._objectMovingDataManager.update());this._prevFrameEventExected=!1;this._player.getPosition().isJustPosition()&&this._camera.getPosition().isScreenTopPosition()&&(this._player.isJumped()||this._player.isWaitingMessage()||this._player.isWaitingMoveMacro()||this._player.isFighting()||(this._player.isPartsAppearedTime()&&this._player.clearPartsAppearedFlag(),this._replaceRandomObjectsInScreen(),(m=this.checkMap())||this.checkObject(),this._prevFrameEventExected=m),this._player.isWaitingMessage()&&
this._messageWindow.isYesNoChoice()&&this._yesNoJudge!==wwa_data.YesNoState.UNSELECTED&&!this._player.isWaitingMoveMacro()&&!this._player.isFighting()&&this._execChoiceWindowRunningEvent());this._passwordLoadExecInNextFrame&&(this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.PASSWORD,this._player.clearPasswordWindowWaiting(),this._passwordLoadExecInNextFrame=!1);this._drawAll();this._mainCallCounter++;this._mainCallCounter%=1E9;this._animationCounter=(this._animationCounter+1)%(2*c.ANIMATION_REP_HALF_FRAME);
this._camera.isResetting()&&this._camera.advanceTransitionStepNum();this._player.isWaitingMessage()||(this._player.decrementLookingAroundTimer(),0<this._statusPressCounter.energy&&0===--this._statusPressCounter.energy&&wwa_util.$id("disp-energy").classList.remove("onpress"),0<this._statusPressCounter.strength&&0===--this._statusPressCounter.strength&&wwa_util.$id("disp-strength").classList.remove("onpress"),0<this._statusPressCounter.defence&&0===--this._statusPressCounter.defence&&wwa_util.$id("disp-defence").classList.remove("onpress"),
0<this._statusPressCounter.gold&&0===--this._statusPressCounter.gold&&wwa_util.$id("disp-gold").classList.remove("onpress"));this._player.isWaitingMoveMacro()&&this._player.decrementMoveObjectAutoExecTimer();this._stopUpdateByLoadFlag?this._fadeout(function(){e._loadType===wwa_data.LoadType.QUICK_LOAD?e._quickLoad():e._loadType===wwa_data.LoadType.RESTART_GAME?e._restartGame():e._loadType===wwa_data.LoadType.PASSWORD&&(e._applyQuickLoad(e._passwordSaveExtractData),e._passwordSaveExtractData=void 0);
setTimeout(e.mainCaller,e._waitTimeInCurrentFrame,e)}):setTimeout(this.mainCaller,this._waitTimeInCurrentFrame,this)};g.prototype._drawAll=function(){var a=this._camera.getPosition().getPartsCoord(),b=this._camera.getPosition().getOffsetCoord(),p=c.MAP_WINDOW_HEIGHT,d;d=this._player.getPosition().getPartsCoord();if(this._paintSkipByDoorOpen)this._paintSkipByDoorOpen=!1;else{this._cgManager.clearCanvas(0,0,c.MAP_WINDOW_WIDTH,c.MAP_WINDOW_HEIGHT);this._cgManager.drawBase(0,0,c.MAP_WINDOW_WIDTH,c.MAP_WINDOW_HEIGHT);
if(this._camera.isResetting()){if(null!==this._camera.getPreviousPosition())var g=this._camera.getPreviousPosition().getPartsCoord(),f=this._camera.getPreviousPosition().getOffsetCoord();p=this._camera.getTransitionStepNum()*c.CHIP_SIZE;this._drawMap(g,f,p,!0);this._drawPlayer(g,f,p,!0);this._drawObjects(g,f,p,!0);if(this._camera.isFinalStep())var l=255,h=setInterval(function(){var a=wwa_util.$id("wwa-fader");l-=3*c.FADEOUT_SPEED;0>=l?(clearInterval(h),a.style.backgroundColor="transparent",a.removeAttribute("style"),
a.style.display="none"):a.style.opacity=l/255+""},20)}this._drawMap(a,b,p);this._drawPlayer(a,b,p);this._drawObjects(a,b,p);this._player.isFighting()&&!this._player.isBattleStartFrame()&&(p=this._player.isTurn()?this._monster.position.x:d.x,d=this._player.isTurn()?this._monster.position.y:d.y,this._cgManager.drawCanvas(this._battleEffectCoord.x,this._battleEffectCoord.y,c.CHIP_SIZE*(p-a.x)-b.x,c.CHIP_SIZE*(d-a.y)-b.y,!1));this._drawEffect();this._drawFaces();this._drawFrame()}};g.prototype._drawMap=
function(a,b,p,d){void 0===d&&(d=!1);if(void 0!==a)for(var e=Math.min(this._wwaData.mapWidth-1,a.x+c.H_PARTS_NUM_IN_WINDOW),m=Math.max(0,a.y-1),z=Math.min(this._wwaData.mapWidth-1,a.y+c.V_PARTS_NUM_IN_WINDOW),g=Math.max(0,a.x-1);g<=e;g++)for(var f=m;f<=z;f++){var l=this._wwaData.map[f][g],h=this._wwaData.mapAttribute[l][c.ATR_X]/c.CHIP_SIZE,l=this._wwaData.mapAttribute[l][c.ATR_Y]/c.CHIP_SIZE,k=c.CHIP_SIZE*(g-a.x)-b.x,x=c.CHIP_SIZE*(f-a.y)-b.y;d?this._cgManager.drawCanvasWithLowerYLimit(h,l,k,x,p):
this._cgManager.drawCanvasWithUpperYLimit(h,l,k,x,p)}};g.prototype._drawPlayer=function(a,b,p,d){void 0===d&&(d=!1);if(void 0!==a&&!this._wwaData.delPlayerFlag){var e=this._player.getPosition().getPartsCoord(),m=this._player.getPosition().getOffsetCoord(),g=wwa_data.dirToPos[this._player.getDir()],z=(e.x-a.x)*c.CHIP_SIZE+m.x-b.x;a=(e.y-a.y)*c.CHIP_SIZE+m.y-b.y;b=this._player.getDir();e=[2,3,4,5,0,1,6,7];m=this._player.isLookingAround()&&!this._player.isWaitingMessage()?this._wwaData.playerImgPosX+
e[Math.floor(this._mainCallCounter%64/8)]:(b===wwa_data.Direction.LEFT||b===wwa_data.Direction.RIGHT)&&Math.abs(m.x)>Math.floor(c.CHIP_SIZE/2)||(b===wwa_data.Direction.UP||b===wwa_data.Direction.DOWN)&&Math.abs(m.y)>Math.floor(c.CHIP_SIZE/2)?this._wwaData.playerImgPosX+g+1:this._wwaData.playerImgPosX+g;d?this._cgManager.drawCanvasWithLowerYLimit(m,this._wwaData.playerImgPosY,z,a,p):this._cgManager.drawCanvasWithUpperYLimit(m,this._wwaData.playerImgPosY,z,a,p)}};g.prototype._drawObjects=function(a,
b,p,d){void 0===d&&(d=!1);if(void 0!==a)for(var e=Math.min(this._wwaData.mapWidth-1,a.x+c.H_PARTS_NUM_IN_WINDOW),m=Math.max(0,a.y-1),g=Math.min(this._wwaData.mapWidth-1,a.y+c.V_PARTS_NUM_IN_WINDOW),z,f=Math.max(0,a.x-1);f<=e;f++)for(var l=m;l<=g;l++)if(!(this._player.isFighting()&&this._player.isTurn()&&this._player.getPosition().getPartsCoord().equals(this._monster.position)&&(new wwa_data.Coord(f,l)).equals(this._monster.position))){var h=this._wwaData.mapObject[l][f];z=new y(0,0);if(this._wwaData.objectAttribute[h][c.ATR_MOVE]!==
wwa_data.MoveType.STATIC){var k=this._objectMovingDataManager.getOffsetByBeforePartsCoord(new y(f,l));null!==k&&(z=k)}var x=this._animationCounter>c.ANIMATION_REP_HALF_FRAME||0===this._wwaData.objectAttribute[h][c.ATR_X2]&&0===this._wwaData.objectAttribute[h][c.ATR_Y2],k=this._wwaData.objectAttribute[h][x?c.ATR_X:c.ATR_X2]/c.CHIP_SIZE,x=this._wwaData.objectAttribute[h][x?c.ATR_Y:c.ATR_Y2]/c.CHIP_SIZE,q=c.CHIP_SIZE*(f-a.x)+z.x-b.x;z=c.CHIP_SIZE*(l-a.y)+z.y-b.y;var B=this._wwaData.objectAttribute[h][c.ATR_TYPE],
n=this._wwaData.objectAttribute[h][c.ATR_NUMBER];0===h||this._checkNoDrawObject(new y(f,l),B,n)||(d?this._cgManager.drawCanvasWithLowerYLimit(k,x,q,z,p):this._cgManager.drawCanvasWithUpperYLimit(k,x,q,z,p))}};g.prototype._drawEffect=function(){if(0!==this._wwaData.effectCoords.length)for(var a=Math.floor(this._mainCallCounter%(this._wwaData.effectCoords.length*this._wwaData.effectWaits)/this._wwaData.effectWaits),b=0;b<c.V_PARTS_NUM_IN_WINDOW;b++)for(var p=0;p<c.H_PARTS_NUM_IN_WINDOW;p++)this._cgManager.drawCanvas(this._wwaData.effectCoords[a].x,
this._wwaData.effectCoords[a].y,p*c.CHIP_SIZE,b*c.CHIP_SIZE,!1)};g.prototype._drawFaces=function(){for(var a=0;a<this._faces.length;a++)this._cgManager.drawCanvasWithSize(this._faces[a].srcPos.x,this._faces[a].srcPos.y,this._faces[a].srcSize.x,this._faces[a].srcSize.y,this._faces[a].destPos.x,this._faces[a].destPos.y,!1)};g.prototype._drawFrame=function(){this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y,0,0,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y,c.MAP_WINDOW_WIDTH-
c.CHIP_SIZE,0,!1);this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+2,0,c.MAP_WINDOW_HEIGHT-c.CHIP_SIZE,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+2,c.MAP_WINDOW_WIDTH-c.CHIP_SIZE,c.MAP_WINDOW_HEIGHT-c.CHIP_SIZE,!1);for(var a=1;a<c.H_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y,c.CHIP_SIZE*a,0,!1),this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y+2,c.CHIP_SIZE*a,c.MAP_WINDOW_HEIGHT-c.CHIP_SIZE,
!1);for(a=1;a<c.V_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+1,0,c.CHIP_SIZE*a,!1),this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+1,c.MAP_WINDOW_WIDTH-c.CHIP_SIZE,c.CHIP_SIZE*a,!1)};g.prototype._checkNoDrawObject=function(a,b,p){var e=this._player.getPosition(),m=e.getPartsCoord();return!e.isJustPosition()||m.x!==a.x||m.y!==a.y||this._wwaData.objectNoCollapseDefaultFlag?!1:b===c.OBJECT_DOOR&&0===p?!0:b===c.OBJECT_STATUS||b===c.OBJECT_MESSAGE||
b===c.OBJECT_ITEM||b===c.OBJECT_SELL||b===c.OBJECT_BUY||b===c.OBJECT_SELL||b===c.OBJECT_LOCALGATE};g.prototype.getMapWidth=function(){if(void 0===this._wwaData)throw Error("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093");return this._wwaData.mapWidth};g.prototype.getMapIdByPosition=function(a){a=a.getPartsCoord();return this._wwaData.map[a.y][a.x]};g.prototype.getObjectIdByPosition=function(a){a=a.getPartsCoord();return this._wwaData.mapObject[a.y][a.x]};
g.prototype.getMapTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[a.y][a.x]][c.ATR_TYPE]};g.prototype.getObjectTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[a.y][a.x]][c.ATR_TYPE]};g.prototype.getMapAttributeByPosition=function(a,b){var e=a.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[e.y][e.x]][b]};g.prototype.isCurrentPosMapPartsIncludingMessage=function(a){return 0!==
this.getMapAttributeByPosition(a,c.ATR_STRING)};g.prototype.getObjectAttributeByPosition=function(a,b){var e=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[e.y][e.x]][b]};g.prototype.getMapAttributeById=function(a,b){return this._wwaData.mapAttribute[a][b]};g.prototype.getObjectAttributeById=function(a,b){return this._wwaData.objectAttribute[a][b]};g.prototype.getObjectCropXById=function(a){return this._wwaData.objectAttribute[a][c.ATR_X]};g.prototype.getObjectCropYById=
function(a){return this._wwaData.objectAttribute[a][c.ATR_Y]};g.prototype.getMessageById=function(a){return this._wwaData.message[a]};g.prototype.getSystemMessageById=function(a){return this._wwaData.systemMessage[a]};g.prototype.checkMap=function(a){var b=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==a?a:b;var e=this._wwaData.map[a.y][a.x],d=this._wwaData.mapAttribute[e][c.ATR_TYPE],b=a.x===b.x&&a.y===b.y,g=!1;if(b&&this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.MAP)===
e)return!1;d===c.MAP_STREET?g=this._execMapStreetEvent(a,e,d):d===c.MAP_WALL?g=this._execMapWallEvent(a,e,d):d===c.MAP_LOCALGATE?g=this._execMapLocalGateEvent(a,e,d):d===c.MAP_URLGATE&&(g=this._execMapUrlGateEvent(a,e,d));b&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.MAP,e);return g};g.prototype.checkObject=function(a){var b=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==a?a:b;var e=this._wwaData.mapObject[a.y][a.x],d=this._wwaData.objectAttribute[e][c.ATR_TYPE],
b=a.x===b.x&&a.y===b.y;b&&this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.OBJECT)===e||(d===c.OBJECT_NORMAL?this._execObjectNormalEvent(a,e,d):d===c.OBJECT_MESSAGE?this._execObjectMessageEvent(a,e,d):d===c.OBJECT_MONSTER?this._execObjectMonsterEvent(a,e,d):d===c.OBJECT_ITEM?this._execObjectItemEvent(a,e,d):d===c.OBJECT_DOOR?this._execObjectDoorEvent(a,e,d):d===c.OBJECT_STATUS?this._execObjectStatusEvent(a,e,d):d===c.OBJECT_BUY?this._execObjectBuyEvent(a,e,d):d===c.OBJECT_SELL?this._execObjectSellEvent(a,
e,d):d===c.OBJECT_URLGATE?this._execObjectUrlGateEvent(a,e,d):d===c.OBJECT_SCORE?this._execObjectScoreEvent(a,e,d):d===c.OBJECT_SELECT?this._execObjectYesNoChoiceEvent(a,e,d):d===c.OBJECT_LOCALGATE&&this._execObjectLocalGateEvent(a,e,d),b&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.OBJECT,e))};g.prototype._execMapStreetEvent=function(a,b,d){d=this._wwaData.mapAttribute[b][c.ATR_ITEM];if(0!==d&&!this._player.hasItem(d))return!1;this.appearParts(a,wwa_data.AppearanceTriggerType.MAP);
d=this._wwaData.mapAttribute[b][c.ATR_STRING];var e=this._wwaData.message[d];this._waitTimeInCurrentFrame+=100*this._wwaData.mapAttribute[b][c.ATR_NUMBER];this._temporaryInputDisable=!0;a=this.setMessageQueue(e,!1,!1,b,wwa_data.PartsType.MAP,a.clone());this.playSound(this._wwaData.mapAttribute[b][c.ATR_SOUND]);return 0!==d&&a};g.prototype._execMapWallEvent=function(a,b,d){d=this.getObjectIdByPosition(a.convertIntoPosition(this));var e=this.getObjectAttributeById(d,c.ATR_TYPE);0!==d&&e!==c.OBJECT_NORMAL&&
(e!==c.OBJECT_DOOR||this._player.hasItem(this.getObjectAttributeById(d,c.ATR_ITEM))&&this.getObjectAttributeById(e,c.ATR_MODE)!==c.PASSABLE_OBJECT)||(this.appearParts(a,wwa_data.AppearanceTriggerType.MAP),this.setMessageQueue(this._wwaData.message[this._wwaData.mapAttribute[b][c.ATR_STRING]],!1,!1,b,wwa_data.PartsType.MAP,a.clone()),this.playSound(this._wwaData.mapAttribute[b][c.ATR_SOUND]));return!1};g.prototype._execMapLocalGateEvent=function(a,b,d){d=this._player.getPosition().getPartsCoord();
var e=this._wwaData.mapAttribute[b][c.ATR_JUMP_X],m=this._wwaData.mapAttribute[b][c.ATR_JUMP_Y];e>c.RELATIVE_COORD_LOWER&&(e=a.x+e-c.RELATIVE_COORD_BIAS);m>c.RELATIVE_COORD_LOWER&&(m=a.y+m-c.RELATIVE_COORD_BIAS);this.appearParts(a,wwa_data.AppearanceTriggerType.MAP);return 0<=e&&0<=m&&e<this._wwaData.mapWidth&&m<this._wwaData.mapWidth&&(e!==d.x||m!==d.y)?(this._player.jumpTo(new A(this,e,m,0,0)),this.playSound(this._wwaData.mapAttribute[b][c.ATR_SOUND]),!0):!1};g.prototype._execMapUrlGateEvent=function(a,
b,d){d=this._wwaData.mapAttribute[b][c.ATR_STRING];if(!this._isURLGateEnable)return!0;if("BLANK"===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK])location.href=wwa_util.$escapedURI(this._wwaData.message[d].split(/\s/g)[0]);else return this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],
!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=b,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS,this._yesNoURL=this._wwaData.message[d].split(/\s/g)[0],!0};g.prototype._execObjectNormalEvent=function(a,b,c){};g.prototype._execObjectMessageEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];var e=this._player.getPosition().getPartsCoord(),m=this._wwaData.objectAttribute[b][c.ATR_SOUND];a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||
(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!1,!1,b,wwa_data.PartsType.OBJECT,a);this._waitTimeInCurrentFrame+=100*this._wwaData.objectAttribute[b][c.ATR_NUMBER];this._temporaryInputDisable=!0;this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b);this.playSound(m)};g.prototype._execObjectStatusEvent=function(a,b,d){d=new wwa_data.Status(this._wwaData.objectAttribute[b][c.ATR_ENERGY],this._wwaData.objectAttribute[b][c.ATR_STRENGTH],this._wwaData.objectAttribute[b][c.ATR_DEFENCE],
this._wwaData.objectAttribute[b][c.ATR_GOLD]);var e=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]],m=this._player.getStatusWithoutEquipments();d.strength>c.STATUS_MINUS_BORDER&&m.strength<d.strength-c.STATUS_MINUS_BORDER||d.defence>c.STATUS_MINUS_BORDER&&m.defence<d.defence-c.STATUS_MINUS_BORDER||d.gold>c.STATUS_MINUS_BORDER&&m.gold<d.gold-c.STATUS_MINUS_BORDER?(this._wwaData.mapObject[a.y][a.x]=0,this._keyStore.allClear(),this._mouseStore.clear()):(d.energy=d.energy>c.STATUS_MINUS_BORDER?
c.STATUS_MINUS_BORDER-d.energy:d.energy,d.strength=d.strength>c.STATUS_MINUS_BORDER?c.STATUS_MINUS_BORDER-d.strength:d.strength,d.defence=d.defence>c.STATUS_MINUS_BORDER?c.STATUS_MINUS_BORDER-d.defence:d.defence,d.gold=d.gold>c.STATUS_MINUS_BORDER?c.STATUS_MINUS_BORDER-d.gold:d.gold,this._player.addStatusAll(d),this.setStatusChangedEffect(d),this._player.isDead()&&0!==this._wwaData.objectAttribute[b][c.ATR_ENERGY]?this.gameover():(this.setMessageQueue(e,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),
this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b),this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])))};g.prototype._execObjectMonsterEvent=function(a,b,d){var e=this;d=new wwa_data.Coord(this._wwaData.objectAttribute[b][c.ATR_X],this._wwaData.objectAttribute[b][c.ATR_Y]);var m=new wwa_data.Status(this._wwaData.objectAttribute[b][c.ATR_ENERGY],this._wwaData.objectAttribute[b][c.ATR_STRENGTH],this._wwaData.objectAttribute[b][c.ATR_DEFENCE],this._wwaData.objectAttribute[b][c.ATR_GOLD]);
this._monster=new wwa_monster.Monster(b,a,d,m,this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]],this._wwaData.objectAttribute[b][c.ATR_ITEM],function(){e._monsterWindow.hide()});this._player.startBattleWith(this._monster)};g.prototype._execObjectBuyEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];var e=this._player.getPosition().getPartsCoord();a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=
0);this.setMessageQueue(d,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};g.prototype._execObjectSellEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];var e=this._player.getPosition().getPartsCoord();a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=
0);this.setMessageQueue(d,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};g.prototype._execObjectItemEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];try{this._player.addItem(b,this._wwaData.objectAttribute[b][c.ATR_NUMBER]),this._wwaData.mapObject[a.y][a.x]=0,0===this._wwaData.objectAttribute[b][c.ATR_MODE]&&
(this.setMessageQueue(d,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b))}catch(z){"BLANK"!==this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]&&this.setMessageQueue(""===this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]?"\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002":this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM],!1,!0)}this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};
g.prototype._execObjectDoorEvent=function(a,b,d){d=this._wwaData.objectAttribute[b][c.ATR_ITEM];var e=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];this._player.hasItem(d)&&(0===this._wwaData.objectAttribute[b][c.ATR_MODE]&&this._player.removeItemByPartsID(d),this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND]),this.setMessageQueue(e,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,
b),this._paintSkipByDoorOpen=!0)};g.prototype._execObjectYesNoChoiceEvent=function(a,b,d){d=this._wwaData.message[this._wwaData.objectAttribute[b][c.ATR_STRING]];var e=this._player.getPosition().getPartsCoord();a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;
this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};g.prototype._execObjectLocalGateEvent=function(a,b,d){d=this._player.getPosition().getPartsCoord();a.x!==d.x||a.y!==d.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);var e=this._wwaData.objectAttribute[b][c.ATR_JUMP_X],m=this._wwaData.objectAttribute[b][c.ATR_JUMP_Y];e>c.RELATIVE_COORD_LOWER&&(e=d.x+e-c.RELATIVE_COORD_BIAS);m>c.RELATIVE_COORD_LOWER&&(m=d.y+m-c.RELATIVE_COORD_BIAS);this.appearParts(a,
wwa_data.AppearanceTriggerType.OBJECT,b);0<=e&&0<=m&&e<this._wwaData.mapWidth&&m<this._wwaData.mapWidth&&(e!==d.x||m!==d.y)&&(this._player.jumpTo(new A(this,e,m,0,0)),this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND]))};g.prototype._execObjectUrlGateEvent=function(a,b,d){d=this._wwaData.objectAttribute[b][c.ATR_STRING];this._isURLGateEnable&&("BLANK"===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?location.href=wwa_util.$escapedURI(this._wwaData.message[d].split(/\s/g)[0]):(this.setMessageQueue(""===
this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=b,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS,this._yesNoURL=this._wwaData.message[d].split(/\s/g)[0]))};g.prototype._execObjectScoreEvent=function(a,b,d){a=this._wwaData.objectAttribute[b][c.ATR_STRING];
this._player.getPosition().getPartsCoord();d=this._player.getStatus();var e;e=0+this._wwaData.objectAttribute[b][c.ATR_ENERGY]*d.energy;e+=this._wwaData.objectAttribute[b][c.ATR_STRENGTH]*d.strength;e+=this._wwaData.objectAttribute[b][c.ATR_DEFENCE]*d.defence;e+=this._wwaData.objectAttribute[b][c.ATR_GOLD]*d.gold;this._scoreWindow.update(e);this._scoreWindow.show();this.setMessageQueue(0===a?"\u30b9\u30b3\u30a2\u3092\u8868\u793a\u3057\u307e\u3059\u3002":this._wwaData.message[a],!1,!1);this.playSound(this._wwaData.objectAttribute[b][c.ATR_SOUND])};
g.prototype._execChoiceWindowRunningEvent=function(){var a;if(0===--this._yesNoDispCounter)if(this._yesNoJudge===wwa_data.YesNoState.YES){if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS)a=this._wwaData.mapAttribute[this._yesNoChoicePartsID][c.ATR_TYPE],a===c.MAP_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS)if(a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_TYPE],
a===c.OBJECT_BUY)this._player.hasItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM])?(this._player.removeItemByPartsID(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM]),a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_GOLD],this._player.earnGold(a),this.setStatusChangedEffect(new wwa_data.Status(0,0,0,a)),this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,this._yesNoChoicePartsID)):"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]&&
this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]?"\u30a2\u30a4\u30c6\u30e0\u3092\u3082\u3063\u3066\u3044\u306a\u3044\u3002":this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM],!0));else if(a===c.OBJECT_SELL)if(this._player.hasGold(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_GOLD]))if(this._player.canHaveMoreItems()||0===this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM]){0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM]&&
this._player.addItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ITEM]);a=new wwa_data.Status(this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ENERGY],this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_STRENGTH],this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_DEFENCE],-this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_GOLD]);this._player.getStatusWithoutEquipments();a.energy=a.energy>c.STATUS_MINUS_BORDER?c.STATUS_MINUS_BORDER-a.energy:
a.energy;this.setStatusChangedEffect(a);this._player.addStatusAll(a);if(this._player.isDead()&&0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_ENERGY]){this.gameover();return}this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,this._yesNoChoicePartsID)}else"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]?"\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002":
this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM],!0));else"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]?"\u6240\u6301\u91d1\u304c\u8db3\u308a\u306a\u3044\u3002":this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY],!0));else a===c.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.CHOICE_YES,this._yesNoChoicePartsID):a===
c.OBJECT_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE?this._player.readyToUseItem(this._yesNoUseItemPos):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.QUICK_LOAD):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE?
(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"),this._quickSave()):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.RESTART_GAME):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA?(location.href=wwa_util.$escapedURI(c.WWA_HOME),
wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress")):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"),this._player.setPasswordWindowWating(),this._passwordWindow.show(wwa_password_window.Mode.LOAD)):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE&&(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"),
this._player.setPasswordWindowWating(),this._passwordWindow.password=this._quickSave(!0),this._passwordWindow.show(wwa_password_window.Mode.SAVE));this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this._setNextMessage();this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;this._messageWindow.setYesNoChoice(!1)}else if(this._yesNoJudge===wwa_data.YesNoState.NO){if(this._yesNoChoiceCallInfo!==wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS)if(this._yesNoChoiceCallInfo===
wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS)a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][c.ATR_TYPE],a!==c.OBJECT_BUY&&a!==c.OBJECT_SELL&&a===c.OBJECT_SELECT&&this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.CHOICE_NO,this._yesNoChoicePartsID);else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE)wwa_util.$id("item"+(this._yesNoUseItemPos-1)).classList.remove("onpress");else{if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD){this._yesNoJudge=
wwa_data.YesNoState.UNSELECTED;this.onpasswordloadcalled();return}if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE){this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this.onpasswordsavecalled();return}this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress"):
this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE&&wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress")}this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this._setNextMessage();this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=
void 0;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;this._messageWindow.setYesNoChoice(!1)}};g.prototype.setMessageQueue=function(a,b,c,d,g,f,l){void 0===d&&(d=0);void 0===g&&(g=wwa_data.PartsType.OBJECT);void 0===f&&(f=new y(0,0));void 0===l&&(l=!1);this._messageQueue=this._messageQueue.concat(this.getMessageQueueByRawMessage(a,d,g,f));this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=
void 0);if(0!==this._messageQueue.length){a=this._messageQueue.shift();for(d=0;d<a.macro.length;d++)this._execMacroListInNextFrame.push(a.macro[d]);this._lastMessage=a;if(""!==a.message)return this._messageWindow.setMessage(a.message),this._messageWindow.setYesNoChoice(b),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),c,this._player.getPosition(),this._camera.getPosition()),this._player.setMessageWaiting(),!0;0===this._messageQueue.length?this._hideMessageWindow(l):
this._setNextMessage()}return!1};g.prototype.getMessageQueueByRawMessage=function(a,b,c,d,g){void 0===g&&(g=!1);var e=a.split(/\n\<c\>/i)[0].split(/\<c\>/i)[0].replace(/\n\<p\>\n/ig,"<P>").replace(/\n\<p\>/ig,"<P>").replace(/\<p\>\n/ig,"<P>").replace(/\<p\>/ig,"<P>");a=[];if(""!==e)for(var e=e.split(/\<p\>/ig),m=0;m<e.length;m++){for(var p=e[m].split("\n"),f=[],l=[],h=0;h<p.length;h++){var z=p[h].match(/(\$(?:[a-zA-Z_][a-zA-Z0-9_]*)\=(?:.*))/);null!==z&&2<=z.length?(z=wwa_message.parseMacro(this,
b,c,d,z[1]),l.push(z)):p[h].match(/^\$/)||f.push(p[h])}a.push(new wwa_message.MessageInfo(f.join("\n"),g,m===e.length-1,l))}return a};g.prototype.appearParts=function(a,b,d){void 0===d&&(d=0);var e=b===wwa_data.AppearanceTriggerType.CHOICE_NO?c.APPERANCE_PARTS_MIN_INDEX_NO:c.APPERANCE_PARTS_MIN_INDEX,m=b===wwa_data.AppearanceTriggerType.CHOICE_YES?c.APPERANCE_PARTS_MAX_INDEX_YES:c.APPERANCE_PARTS_MAX_INDEX,g,f,p,l;b===wwa_data.AppearanceTriggerType.MAP?(d=0===d?this._wwaData.map[a.y][a.x]:d,b=wwa_data.PartsType.MAP):
(d=0===d?this._wwaData.mapObject[a.y][a.x]:d,b=wwa_data.PartsType.OBJECT);for(;e<=m;e++)if(f=c.ATR_APPERANCE_BASE+e*c.REL_ATR_APPERANCE_UNIT_LENGTH,g=f+c.REL_ATR_APPERANCE_ID,p=f+c.REL_ATR_APPERANCE_X,l=f+c.REL_ATR_APPERANCE_Y,f+=c.REL_ATR_APPERANCE_TYPE,g=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[d][g]:this._wwaData.objectAttribute[d][g],f=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[d][f]:this._wwaData.objectAttribute[d][f],p=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[d][p]:
this._wwaData.objectAttribute[d][p],l=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[d][l]:this._wwaData.objectAttribute[d][l],p===c.PLAYER_COORD?(p=this._player.getPosition().getPartsCoord().x,this._player.resetEventExecutionInfo()):p>c.RELATIVE_COORD_LOWER&&(p=a.x+p-c.RELATIVE_COORD_BIAS),l===c.PLAYER_COORD?(l=this._player.getPosition().getPartsCoord().y,this._player.resetEventExecutionInfo()):l>c.RELATIVE_COORD_LOWER&&(l=a.y+l-c.RELATIVE_COORD_BIAS),0!==p||0!==l)try{if(new wwa_data.Position(this,
p,l,0,0),f===wwa_data.PartsType.MAP){if(g>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[l][p]=g}else{if(g>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[l][p]=g;this._replaceRandomObject(new y(p,l));p===this._player.getPosition().getPartsCoord().x&&l===this._player.getPosition().getPartsCoord().y&&
this._player.setPartsAppearedFlag()}}catch(L){}};g.prototype.appearPartsByDirection=function(a,b,c){var e=this._player.getPosition().getPartsCoord(),d=this._player.getDir(),m=wwa_data.vx[d],d=wwa_data.vy[d];this.appearPartsEval(e,(0<=m?"+":"-")+Math.abs(m)*a,(0<=d?"+":"-")+Math.abs(d)*a,b,c)};g.prototype.appearPartsEval=function(a,b,c,d,g){var e=this._player.getPosition().getPartsCoord();if("P"===b||"p"===b)b=e.x;else if("+"===b[0])b=a.x+parseInt(b.substr(1));else if("-"===b[0])b=a.x-parseInt(b.substr(1));
else if(b=parseInt(b),isNaN(b))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");if("P"===c||"p"===c)a=e.y;else if("+"===c[0])a=a.y+parseInt(c.substr(1));else if("-"===c[0])a=a.y-parseInt(c.substr(1));else if(a=parseInt(c),isNaN(a))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");try{if(new wwa_data.Position(this,
b,a,0,0),g===wwa_data.PartsType.MAP){if(d>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[a][b]=d}else{if(d>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[a][b]=d;this._replaceRandomObject(new y(b,a));b===this._player.getPosition().getPartsCoord().x&&a===this._player.getPosition().getPartsCoord().y&&
this._player.setPartsAppearedFlag()}}catch(F){}};g.prototype._replaceRandomObject=function(a){var b=this._wwaData.mapObject[a.y][a.x],e;if(this._wwaData.objectAttribute[b][c.ATR_TYPE]===c.OBJECT_RANDOM){for(var d=0;d<c.RANDOM_ITERATION_MAX;d++){e=Math.floor(10*Math.random());e=this._wwaData.objectAttribute[b][c.ATR_RANDOM_BASE+e];if(e>=this._wwaData.objPartsMax){e=0;break}if(this._wwaData.objectAttribute[e][c.ATR_TYPE]!==c.OBJECT_RANDOM)break;b=e}this._wwaData.mapObject[a.y][a.x]=e}};g.prototype._replaceRandomObjectsInScreen=
function(){for(var a=this._camera.getPosition().getPartsCoord(),b=Math.min(this._wwaData.mapWidth-1,a.x+c.H_PARTS_NUM_IN_WINDOW),d=Math.max(0,a.y-1),g=Math.min(this._wwaData.mapWidth-1,a.y+c.V_PARTS_NUM_IN_WINDOW),a=Math.max(0,a.x-1);a<=b;a++)for(var f=d;f<=g;f++)this._replaceRandomObject(new y(a,f))};g.prototype._replaceAllRandomObjects=function(){for(var a=0;a<this._wwaData.mapWidth;a++)for(var b=0;b<this._wwaData.mapWidth;b++)this._replaceRandomObject(new y(a,b))};g.prototype.gameover=function(){var a=
this._wwaData.gameoverX,b=this._wwaData.gameoverY;this._messageWindow.isVisible()&&(this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,this._messageQueue=[],this._messageWindow.hide(),this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE,this._messageWindow.setYesNoChoice(!1));this._waitTimeInCurrentFrame=c.GAMEOVER_FRAME_INTERVAL;this._temporaryInputDisable=!0;this._player.jumpTo(new A(this,a,b,0,0))};g.prototype.setYesNoInput=
function(a){this._yesNoJudgeInNextFrame=a};g.prototype.getYesNoState=function(){return void 0!==this._yesNoJudgeInNextFrame?this._yesNoJudgeInNextFrame:this._yesNoJudge};g.prototype.setStatusChangedEffect=function(a){0!==a.strength&&(wwa_util.$id("disp-strength").classList.add("onpress"),this._statusPressCounter.strength=c.STATUS_CHANGED_EFFECT_FRAME_NUM);0!==a.defence&&(wwa_util.$id("disp-defence").classList.add("onpress"),this._statusPressCounter.defence=c.STATUS_CHANGED_EFFECT_FRAME_NUM);a instanceof
wwa_data.Status&&(0!==a.energy&&(wwa_util.$id("disp-energy").classList.add("onpress"),this._statusPressCounter.energy=c.STATUS_CHANGED_EFFECT_FRAME_NUM),0!==a.gold&&(wwa_util.$id("disp-gold").classList.add("onpress"),this._statusPressCounter.gold=c.STATUS_CHANGED_EFFECT_FRAME_NUM))};g.prototype.setPartsOnPosition=function(a,b,c){a===wwa_data.PartsType.MAP?(b>=this._wwaData.mapPartsMax&&(this._wwaData.map[c.y][c.x]=0),this._wwaData.map[c.y][c.x]=b):(b>=this._wwaData.objPartsMax&&(this._wwaData.mapObject[c.y][c.x]=
0),this._wwaData.mapObject[c.y][c.x]=b)};g.prototype._countSamePartsLength=function(a,b){var e;for(e=b+1;e<a.length&&a[e]===a[e-1];e++);return e-b};g.prototype._compressMap=function(a){for(var b=[],e=0;e<a.length;e++){b[e]=[];for(var c=0;c<a[e].length;){var d=this._countSamePartsLength(a[e],c);b[e].push([a[e][c],d]);c+=d}}return b};g.prototype._decompressMap=function(a){for(var b=[],e=0;e<a.length;e++){b[e]=[];for(var c=0;c<a[e].length;c++)for(var d=a[e][c][1],g=0;g<d;g++)b[e].push(a[e][c][0])}return b};
g.prototype._generateMapDataHash=function(a){var b="A",e,c,d;for(d=0;d<a.map.length;d++){for(c=0;c<a.map[d].length;)e=this._countSamePartsLength(a.map[d],c),b+=a.map[d][c]+"|"+e+"/",c+=e;for(c=0;c<a.mapObject[d].length;)e=this._countSamePartsLength(a.mapObject[d],c),b+=a.mapObject[d][c]+"|"+e+"/",c+=e}for(e=0;e<a.mapAttribute.length;e++)for(c=0;c<a.mapAttribute[e].length;c++)b+=a.mapAttribute[e][c]+"/";for(e=0;e<a.objectAttribute.length;e++)for(c=0;c<a.objectAttribute[e].length;c++)b+=a.objectAttribute[e][c]+
"/";return CryptoJS.MD5(b+"Z").toString()};g.prototype._generateSaveDataHash=function(a){var b=this._generateMapDataHash(a),e=[],c;for(c in a)"map"!==c&&"mapObject"!==c&&"mapCompressed"!==c&&"mapObjectCompressed"!==c&&"mapAttribute"!==c&&"objectAttribute"!==c&&"checkString"!==c&&e.push(c);e.sort();for(c=0;c<e.length;c++)b+=wwa_util.arr2str4save(a[e[c]]);return CryptoJS.MD5(b).toString()};g.prototype._quickSave=function(a){void 0===a&&(a=!1);var b=JSON.parse(JSON.stringify(this._wwaData)),c=this._player.getPosition().getPartsCoord(),
e=this._player.getStatusWithoutEquipments();b.itemBox=this._player.getCopyOfItemBox();b.playerX=c.x;b.playerY=c.y;b.statusEnergyMax=this._player.getEnergyMax();b.statusEnergy=e.energy;b.statusStrength=e.strength;b.statusDefence=e.defence;b.statusGold=e.gold;b.moves=this._player.getMoveCount();a&&(b.checkOriginalMapString=this._generateMapDataHash(this._restartData),b.mapCompressed=this._compressMap(b.map),b.mapObjectCompressed=this._compressMap(b.mapObject),b.checkString=this._generateSaveDataHash(b),
b.map=void 0,b.mapObject=void 0);b.message=void 0;b.mapAttribute=void 0;b.objectAttribute=void 0;if(a)return a=JSON.stringify(b),CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(a),"^ /"+(231*this._wwaData.worldPassNumber+8310+b.checkOriginalMapString)+"P+>A[]").toString();this._quickSaveData=b;l.$id("cell-load").textContent="Quick Load";return""};g.prototype._decodePassword=function(a){var b=this._generateMapDataHash(this._restartData);try{var c=CryptoJS.AES.decrypt(a,"^ /"+(231*this._wwaData.worldPassNumber+
8310+b)+"P+>A[]").toString(CryptoJS.enc.Utf8)}catch(D){throw Error("\u30c7\u30fc\u30bf\u304c\u7834\u640d\u3057\u3066\u3044\u307e\u3059\u3002\n"+D.message);}var e;try{e=JSON.parse(c)}catch(D){throw Error("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u4ee5\u5916\u306e\u3082\u306e\u304c\u6697\u53f7\u5316\u3055\u308c\u305f\u304b\u3001\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306b\u4f55\u304b\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\nJSON PARSE FAILED");}return e};g.prototype._quickLoad=
function(a,b,c){void 0===a&&(a=!1);void 0===b&&(b=null);void 0===c&&(c=!0);if(!a&&void 0===this._quickSaveData&&null===b)throw Error("\u30bb\u30fc\u30d6\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002");a=null!==b?this._decodePassword(b):JSON.parse(JSON.stringify(a?this._restartData:this._quickSaveData));a.message=JSON.parse(JSON.stringify(this._restartData.message));a.mapAttribute=JSON.parse(JSON.stringify(this._restartData.mapAttribute));a.objectAttribute=JSON.parse(JSON.stringify(this._restartData.objectAttribute));
void 0===a.map&&(a.map=this._decompressMap(a.mapCompressed),a.mapCompressed=void 0);void 0===a.mapObject&&(a.mapObject=this._decompressMap(a.mapObjectCompressed),a.mapObjectCompressed=void 0);if(null!==b){b=this._generateSaveDataHash(a);if(a.checkString!==b)throw Error("\u30c7\u30fc\u30bf\u304c\u58ca\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\nInvalid hash (ALL DATA)= "+a.checkString+" "+this._generateSaveDataHash(a));b=this._generateMapDataHash(this._restartData);if(a.checkOriginalMapString!==
b)throw Error("\u7ba1\u7406\u8005\u306b\u3088\u3063\u3066\u30de\u30c3\u30d7\u304c\u5909\u66f4\u3055\u308c\u305f\u3088\u3046\u3067\u3059\u3002\nInvalid hash (ORIGINAL MAP)= "+a.checkString+" "+this._generateSaveDataHash(a));console.log("Valid Password!")}c&&this._applyQuickLoad(a);return a};g.prototype._applyQuickLoad=function(a){this._player.setEnergyMax(a.statusEnergyMax);this._player.setEnergy(a.statusEnergy);this._player.setStrength(a.statusStrength);this._player.setDefence(a.statusDefence);this._player.setGold(a.statusGold);
this._player.setMoveCount(a.moves);this._player.clearItemBox();for(var b=0;b<a.itemBox.length;b++)this._player.addItem(a.itemBox[b],b+1,!0);this._player.systemJumpTo(new wwa_data.Position(this,a.playerX,a.playerY,0,0));0===a.bgm?this.playSound(wwa_data.SystemSound.NO_SOUND):this.playSound(a.bgm);this.setImgClick(new y(a.imgClickX,a.imgClickY));0!==this.getObjectIdByPosition(this._player.getPosition())&&this._player.setPartsAppearedFlag();this._wwaData=a;this._replaceAllRandomObjects();this.updateCSSRule()};
g.prototype._restartGame=function(){this._quickLoad(!0)};g.prototype._fadeout=function(a){var b=0,e=c.MAP_WINDOW_WIDTH,d=c.FADEOUT_SPEED,g=wwa_util.$id("wwa-fader");g.style.display="block";var f=setInterval(function(){b+=d;e-=2*d;0>=e||2*b>c.MAP_WINDOW_WIDTH?(g.removeAttribute("style"),g.style.display="block",g.style.borderWidth="0",g.style.width=c.MAP_WINDOW_WIDTH+"px",g.style.height=c.MAP_WINDOW_HEIGHT+"px",g.style.backgroundColor="#808080",clearInterval(f),a()):(g.style.width=e+"px",g.style.height=
e+"px",g.style.borderWidth=b+"px")},20)};g.prototype.moveObjects=function(a){var b=this._camera.getPosition();this._player.getPosition();b.getPartsCoord();var e=b.getPartsCoord().x,b=b.getPartsCoord().y,d,g,f;if(this.getMapAttributeByPosition(this._player.getPosition(),c.ATR_TYPE)!==c.MAP_LOCALGATE&&this.getObjectAttributeByPosition(this._player.getPosition(),c.ATR_TYPE)!==c.OBJECT_LOCALGATE){d=Array(c.V_PARTS_NUM_IN_WINDOW+2);this.hoge=Array(c.V_PARTS_NUM_IN_WINDOW+2);for(f=-1;f<=c.V_PARTS_NUM_IN_WINDOW;f++)for(d[f+
1]=Array(c.H_PARTS_NUM_IN_WINDOW+2),this.hoge[f+1]=Array(c.H_PARTS_NUM_IN_WINDOW+2),g=-1;g<=c.H_PARTS_NUM_IN_WINDOW;g++)if(0>b+f||b+f>=this._wwaData.mapWidth||0>e+g||e+g>=this._wwaData.mapWidth)d[f+1][g+1]=0,this.hoge[f+1][g+1]=0;else{try{var l=new A(this,e+g,b+f,0,0),h=l.getPartsCoord()}catch(t){d[f+1][g+1]=0;this.hoge[f+1][g+1]=0;continue}d[f+1][g+1]=this._wwaData.mapObject[h.y][h.x];this.hoge[f+1][g+1]=-this._wwaData.mapObject[h.y][h.x]}for(g=-1;g<=c.H_PARTS_NUM_IN_WINDOW;g++)if(!(0>e+g||e+g>=
this._wwaData.mapWidth))for(f=-1;f<=c.V_PARTS_NUM_IN_WINDOW;f++)if(!(0>b+f||b+f>=this._wwaData.mapWidth)){try{l=new A(this,e+g,b+f,0,0),h=l.getPartsCoord()}catch(t){continue}var k=this._wwaData.mapObject[h.y][h.x];if(0!==k&&this._wwaData.objectAttribute[k][c.ATR_MOVE]!==wwa_data.MoveType.STATIC&&this._wwaData.objectAttribute[k][c.ATR_TYPE]!==c.OBJECT_LOCALGATE&&this._wwaData.objectAttribute[k][c.ATR_TYPE]!==c.OBJECT_RANDOM){var x=this._wwaData.objectAttribute[k][c.ATR_MOVE];if(x!==wwa_data.MoveType.HANG_AROUND){var B=
this._getCandidateCoord(a,l,x),n=new y(B.x,h.y),r=new y(h.x,B.y);if(this._objectCanMoveTo(a,B,d))this._setObjectsInNextFrame(h,B,e,b,d,k);else{var q=this._getSecondCandidateMoveMode(a,h,B,n,r,this._wwaData.objectAttribute[k][c.ATR_TYPE]===c.OBJECT_MONSTER,d);q===wwa_data.SecondCandidateMoveType.MODE_X?this._setObjectsInNextFrame(h,n,e,b,d,k):q===wwa_data.SecondCandidateMoveType.MODE_Y?this._setObjectsInNextFrame(h,r,e,b,d,k):(x=this._getThirdCandidate(a,l,B,x,d),null===x&&(x=this._getRandomMoveCoord(a,
l,d)),this._setObjectsInNextFrame(h,x,e,b,d,k))}}else x=this._getRandomMoveCoord(a,l,d),this._setObjectsInNextFrame(h,x,e,b,d,k)}}}};g.prototype._getCandidateCoord=function(a,b,c){b=b.getPartsCoord();this._player.getPosition().getOffsetCoord();this._player.getPosition().getPartsCoord();try{var e=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord()}catch(F){throw Error("\u4e88\u671f\u305b\u306c\u65b9\u5411\u3078\u306e\u79fb\u52d5\u306e\u3088\u3046\u3067\u3059\u3002");
}a=b.clone();var d=0,g=0;c===wwa_data.MoveType.CHASE_PLAYER?(d=b.x>e.x?1:b.x<e.x?-1:0,g=b.y>e.y?1:b.y<e.y?-1:0):c===wwa_data.MoveType.RUN_OUT&&(d=b.x>e.x?-1:b.x<e.x?1:0,g=b.y>e.y?-1:b.y<e.y?1:0);a.x-=d;a.y-=g;a.x=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.x));a.y=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.y));return a};g.prototype._getSecondCandidateMoveMode=function(a,b,c,d,g,f,l){return!a||(this._player.getDir()!==wwa_data.Direction.UP&&this._player.getDir()!==wwa_data.Direction.DOWN||!f)&&
(this._player.getDir()!==wwa_data.Direction.LEFT&&this._player.getDir()!==wwa_data.Direction.RIGHT||f)?this._objectCanMoveTo(a,d,l)?wwa_data.SecondCandidateMoveType.MODE_X:this._objectCanMoveTo(a,g,l)?wwa_data.SecondCandidateMoveType.MODE_Y:wwa_data.SecondCandidateMoveType.UNDECIDED:this._objectCanMoveTo(a,g,l)?wwa_data.SecondCandidateMoveType.MODE_Y:this._objectCanMoveTo(a,d,l)?wwa_data.SecondCandidateMoveType.MODE_X:wwa_data.SecondCandidateMoveType.UNDECIDED};g.prototype._getThirdCandidate=function(a,
b,c,d,g){d=d===wwa_data.MoveType.CHASE_PLAYER?1:d===wwa_data.MoveType.RUN_OUT?-1:0;var e=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord();b=b.getPartsCoord();var f;if(e.x!==b.x){f=new y(c.x,b.y+1*d);if(this._objectCanMoveTo(a,f,g))return f;f=new y(c.x,b.y-1*d);if(this._objectCanMoveTo(a,f,g))return f;f=new y(b.x,b.y+1*d);if(this._objectCanMoveTo(a,f,g))return f;f=new y(b.x,b.y-1*d);if(this._objectCanMoveTo(a,f,g))return f}if(e.y!==b.y){f=
new y(b.x+1*d,c.y);if(this._objectCanMoveTo(a,f,g))return f;f=new y(b.x-1*d,c.y);if(this._objectCanMoveTo(a,f,g))return f;f=new y(b.x+1*d,b.y);if(this._objectCanMoveTo(a,f,g))return f;f=new y(b.x-1*d,b.y);if(this._objectCanMoveTo(a,f,g))return f}return null};g.prototype._getRandomMoveCoord=function(a,b,d){b=b.getPartsCoord();for(var e=b.clone(),g=0;g<c.RANDOM_MOVE_ITERATION_NUM;g++){var f=Math.floor(8*Math.random());e.x=b.x+wwa_data.vx[f];e.y=b.y+wwa_data.vy[f];if(this._objectCanMoveTo(a,e,d))return e}return b};
g.prototype.isPrevFrameEventExecuted=function(){return this._prevFrameEventExected};g.prototype._objectCanMoveTo=function(a,b,d){if(0>b.x||0>b.y||this._wwaData.mapWidth<=b.x||this._wwaData.mapWidth<=b.y)return!1;var e=this._wwaData.map[b.y][b.x],g=this._wwaData.mapObject[b.y][b.x],f=this._wwaData.mapAttribute[e][c.ATR_TYPE],l=this._camera.getPosition(),h=l.getPartsCoord().x,l=l.getPartsCoord().y;if(0===e&&!this.isOldMap()||f===c.MAP_WALL)return!1;e=b.x-h+1;f=b.y-l+1;if(0<=e&&0<=f&&e<d.length&&f<d.length){if(0!==
d[f][e])return!1}else if(0!==g)return!1;if(a){if(this._player.getPosition().getNextJustPosition().getPartsCoord().equals(b))return!1}else if(this._player.getPosition().getPartsCoord().equals(b))return!1;return!0};g.prototype._setObjectsInNextFrame=function(a,b,c,d,g,f){var e=b.x-c+1,l=b.y-d+1;0<=b.x&&b.x<=this._wwaData.mapWidth&&0<=b.y&&b.y<=this._wwaData.mapWidth&&(0<=e&&e<g.length&&0<=l&&l<g.length&&(g[a.y-d+1][a.x-c+1]=0,g[b.y-d+1][b.x-c+1]=f,this.hoge[b.y-d+1][b.x-c+1]=f),this._objectMovingDataManager.add(f,
a.convertIntoPosition(this),b.convertIntoPosition(this),a.getDirectionTo(b)))};g.prototype.launchBattleEstimateWindow=function(){var a=this._camera.getPosition().getPartsCoord(),b=Math.max(0,a.x),d=Math.min(this._wwaData.mapWidth-1,a.x+c.H_PARTS_NUM_IN_WINDOW-1),g=Math.max(0,a.y),a=Math.min(this._wwaData.mapWidth-1,a.y+c.V_PARTS_NUM_IN_WINDOW)-1,f=[];for(this.playSound(wwa_data.SystemSound.DECISION);b<=d;b++)for(var l=g;l<=a;l++){var h=this._wwaData.mapObject[l][b];this._wwaData.objectAttribute[h][c.ATR_TYPE]===
c.OBJECT_MONSTER&&-1===f.indexOf(h)&&f.push(h)}if(0===f.length)return!1;this._battleEstimateWindow.update(this._player.getStatus(),f);this._battleEstimateWindow.show();this._player.setEstimateWindowWating();return!0};g.prototype.hideBattleEstimateWindow=function(){this._battleEstimateWindow.hide();this._player.clearEstimateWindowWaiting()};g.prototype.hidePasswordWindow=function(a){void 0===a&&(a=!1);this._passwordWindow.hide();if(a||this._passwordWindow.mode===wwa_password_window.Mode.SAVE)this._player.clearPasswordWindowWaiting();
else{try{var b=this._quickLoad(!1,this._passwordWindow.password,!1)}catch(p){this._player.clearPasswordWindowWaiting();alert("\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u6b63\u5e38\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u30a8\u30e9\u30fc\u8a73\u7d30:\n"+p.message);return}this._passwordLoadExecInNextFrame=!0;this._passwordSaveExtractData=b}};g.prototype._displayHelp=function(){this._player.isControllable()&&this.setMessageQueue("\u3010\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30ad\u30fc\u306e\u4e00\u89a7\u3011\n\uff26\uff11\u3001\uff2d\uff1a\u6226\u95d8\u7d50\u679c\u4e88\u6e2c\u306e\u8868\u793a\n\uff26\uff13\uff1a\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\n\uff26\uff14\uff1a\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u8868\u793a\n\uff26\uff15\uff1a\u4e00\u6642\u4fdd\u5b58\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\n\uff26\uff16\uff1a\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\n\uff26\uff17\uff1a\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\n\uff26\uff18\uff1a\uff37\uff37\uff21\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\n\uff26\uff11\uff12\uff1a\u3053\u306e\u30ea\u30b9\u30c8\u306e\u8868\u793a\n\u30ad\u30fc\u30dc\u30fc\u30c9\u306e\u300c\uff11\uff12\uff13\u3001\uff31\uff37\uff25\u3001\uff21\uff33\uff24\u3001\uff3a\uff38\uff23\u300d\u306f\u53f3\u306e\u30a2\u30a4\u30c6\u30e0\u30dc\u30c3\u30af\u30b9\u306b\u5bfe\u5fdc\u3002\n\u300c\uff25\uff4e\uff54\uff45\uff52\u3001\uff39\u300d\u306f\uff39\uff45\uff53,\u300c\uff25\uff53\uff43\u3001\uff2e\u300d\u306f\uff2e\uff4f\u306b\u5bfe\u5fdc\u3002\n I : \u79fb\u52d5\u901f\u5ea6\u3092\u843d\u3068\u3059\uff0f\uff30: \u79fb\u52d5\u901f\u5ea6\u3092\u4e0a\u3052\u308b\n\u73fe\u5728\u306e\u79fb\u52d5\u56de\u6570\uff1a"+
this._player.getMoveCount()+"\nWWA Wing \u30d0\u30fc\u30b8\u30e7\u30f3:"+c.VERSION_WWAJS+"\n\u30de\u30c3\u30d7\u30c7\u30fc\u30bf \u30d0\u30fc\u30b8\u30e7\u30f3: "+Math.floor(this._wwaData.version/10)+"."+this._wwaData.version%10,!1,!0)};g.prototype._setNextMessage=function(a){void 0===a&&(a=!1);this._clearFacesInNextFrame=!0;this._scoreWindow.isVisible()&&this._scoreWindow.hide();this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),
this._reservedMoveMacroTurn=void 0);if(0===this._messageQueue.length)this._hideMessageWindow();else{var b=this._messageQueue.shift(),c=b.message,e=b.macro;this._lastMessage=b;for(b=0;b<e.length;b++)this._execMacroListInNextFrame.push(e[b]);""!==c?(this._messageWindow.hide(),this._messageWindow.setMessage(c),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),a,this._player.getPosition(),this._camera.getPosition()),this._messageWindow.show()):0===this._messageQueue.length?
this._hideMessageWindow():this._setNextMessage()}};g.prototype._hideMessageWindow=function(a){void 0===a&&(a=!0);var b=0;this._player.isReadyToUseItem()&&(b=this._player.useItem());var d=this.getObjectAttributeById(b,c.ATR_STRING);this.clearFaces();0===d?(a&&(this._messageWindow.hide(),this._keyStore.allClear(),this._mouseStore.clear()),this._player.clearMessageWaiting()):this.setMessageQueue(this.getMessageById(d),!1,!1,b,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord(),!0)};
g.prototype.replaceParts=function(a,b,d,g){void 0===d&&(d=wwa_data.PartsType.OBJECT);void 0===g&&(g=!1);var e=this._camera.getPosition().getPartsCoord(),f=g?Math.min(this._wwaData.mapWidth-1,e.x+c.H_PARTS_NUM_IN_WINDOW-1):this._wwaData.mapWidth-1,l=g?Math.max(0,e.y):0,h=g?Math.min(this._wwaData.mapWidth-1,e.y+c.V_PARTS_NUM_IN_WINDOW)-1:this._wwaData.mapWidth-1;for(g=g?Math.max(0,e.x):0;g<=f;g++)for(e=l;e<=h;e++)if(d===wwa_data.PartsType.OBJECT){var k=this._wwaData.mapObject[e][g];k===a&&(this._wwaData.mapObject[e][g]=
b)}else k=this._wwaData.map[e][g],k===a&&(this._wwaData.map[e][g]=b)};g.prototype.getYesNoImgCoord=function(){return new y(this._wwaData.yesnoImgPosX,this._wwaData.yesnoImgPosY)};g.prototype.setYesNoImgCoord=function(a){this._wwaData.yesnoImgPosX=a.x;this._wwaData.yesnoImgPosY=a.y;return a};g.prototype.getPlayerImgCoord=function(){return new y(this._wwaData.playerImgPosX,this._wwaData.playerImgPosY)};g.prototype.setPlayerImgCoord=function(a){this._wwaData.playerImgPosX=a.x;this._wwaData.playerImgPosY=
a.y;return a};g.prototype.setPlayerEnergyMax=function(a){return this._player.setEnergyMax(a)};g.prototype.getMapPartsNum=function(){return this._wwaData.mapPartsMax};g.prototype.getObjectPartsNum=function(){return this._wwaData.objPartsMax};g.prototype.setMoveMacroWaitingToPlayer=function(a){this._reservedMoveMacroTurn=a};g.prototype.disableSave=function(a){return this._wwaData.disableSaveFlag=a};g.prototype.isOldMap=function(){return this._wwaData.isOldMap};g.prototype.setOldMap=function(a){return this._wwaData.isOldMap=
a};g.prototype.setObjectNotCollapseOnPartsOnPlayer=function(a){return this._wwaData.objectNoCollapseDefaultFlag=a};g.prototype.setGameOverPosition=function(a){if(0>a.x||a.x>=this.getMapWidth()||0>a.y||a.y>=this.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");this._wwaData.gameoverX=a.x;this._wwaData.gameoverY=a.y;return a};g.prototype.setPlayerStatus=function(a,b){if(a===wwa_data.MacroStatusIndex.ENERGY)this._player.setEnergy(b);
else if(a===wwa_data.MacroStatusIndex.STRENGTH)this._player.setStrength(b);else if(a===wwa_data.MacroStatusIndex.DEFENCE)this._player.setDefence(b);else if(a===wwa_data.MacroStatusIndex.GOLD)this._player.setGold(b);else if(a===wwa_data.MacroStatusIndex.MOVES)this._player.setMoveCount(b);else throw Error("\u672a\u5b9a\u7fa9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30bf\u30a4\u30d7\u3067\u3059");};g.prototype.setDelPlayer=function(a){return this._wwaData.delPlayerFlag=a};g.prototype.setPlayerGetItem=function(a,
b){try{this._player.addItem(b,a,!0)}catch(p){}};g.prototype.setFrameCoord=function(a){return this._frameCoord=a.clone()};g.prototype.setBattleEffectCoord=function(a){return this._battleEffectCoord=a.clone()};g.prototype.canInput=function(){return!this._temporaryInputDisable};g.prototype.setWaitTime=function(a){this._waitTimeInCurrentFrame+=a;this._temporaryInputDisable=!0};g.prototype.setEffect=function(a,b){this._wwaData.effectWaits=a;this._wwaData.effectCoords=b};g.prototype.stopEffect=function(){this._wwaData.effectCoords=
[]};g.prototype.setImgClick=function(a){this._wwaData.imgClickX=a.x;this._wwaData.imgClickY=a.y;if(a.equals(new y(0,0)))Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage="url('"+wwa_data.WWAConsts.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0"});else{var b=this._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(d){d.style.backgroundImage=
"url('"+b+"')";d.style.backgroundPosition="-"+a.x*c.CHIP_SIZE+"px -"+a.y*c.CHIP_SIZE+"px"})}};g.prototype.addFace=function(a){this._faces.push(a)};g.prototype.clearFaces=function(){this._faces=[]};g.prototype.initCSSRule=function(){this._styleElm=wwa_util.$id(c.WWA_STYLE_TAG_ID);this._sheet=this._styleElm.sheet;this.updateCSSRule()};g.prototype.updateCSSRule=function(){if(void 0===this._stylePos)this._stylePos=Array(2);else if(void 0!==this._sheet.addRule)for(var a=0;a<this._stylePos.length;a++)this._sheet.removeRule(this._stylePos[this._styleElm[a]]);
else for(a=0;a<this._stylePos.length;a++)this._sheet.deleteRule(this._stylePos[this._styleElm[a]]);void 0!==this._sheet.addRule?(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=this._sheet.addRule("div.wwa-message-window, div#wwa-battle-estimate, div#wwa-password-window","background-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+",0.9);border-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+
",1);color: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);"),this._stylePos[wwa_data.SelectorType.SIDEBAR]=this._sheet.addRule("div#wwa-sidebar","color: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);font-weight: bold;")):(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=this._sheet.insertRule("div.wwa-message-window, div#wwa-battle-estimate, div#wwa-password-window {\nbackground-color: rgba("+
this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+",0.9);\nborder-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+",1);\ncolor: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);\n}",0),this._stylePos[wwa_data.SelectorType.SIDEBAR]=this._sheet.insertRule("div#wwa-sidebar {\ncolor: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+
",1);\nfont-weight: bold;\n}",1))};g.prototype.changeStyleRule=function(a,b,c,d){a===wwa_data.ChangeStyleType.COLOR_FRAME?(this._wwaData.frameColorR=b,this._wwaData.frameColorG=c,this._wwaData.frameColorB=d):a===wwa_data.ChangeStyleType.COLOR_FRAMEOUT?(this._wwaData.frameOutColorR=b,this._wwaData.frameOutColorG=c,this._wwaData.frameOutColorB=d):a===wwa_data.ChangeStyleType.COLOR_STR?(this._wwaData.fontColorR=b,this._wwaData.fontColorG=c,this._wwaData.fontColorB=d):a===wwa_data.ChangeStyleType.COLOR_STATUS_STR&&
(this._wwaData.statusColorR=b,this._wwaData.statusColorG=c,this._wwaData.statusColorB=d);this.updateCSSRule()};g.prototype.showMonsterWindow=function(){this._monsterWindow.show()};g.prototype.isConsoleOutputMode=function(){return this._useConsole};return g}();f.WWA=B;var x=!1;"complete"===document.readyState?k():window.addEventListener("load",k)})(wwa_main||(wwa_main={}));
var CryptoJS=CryptoJS||function(f,d){var k={},b=k.lib={},r=function(){},h=b.Base={extend:function(a){r.prototype=this;var b=new r;a&&b.mixIn(a);b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)});b.init.prototype=b;b.$super=this;return b},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
a=b.WordArray=h.extend({init:function(a,b){a=this.words=a||[];this.sigBytes=b!=d?b:4*a.length},toString:function(a){return(a||n).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);this.sigBytes+=a;return this},clamp:function(){var a=this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-
b%4*8;a.length=f.ceil(b/4)},clone:function(){var a=h.clone.call(this);a.words=this.words.slice(0);return a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*f.random()|0);return new a.init(c,b)}}),w=k.enc={},n=w.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(b){for(var c=b.length,d=[],g=0;g<c;g+=2)d[g>>>3]|=parseInt(b.substr(g,2),16)<<
24-g%8*4;return new a.init(d,c/2)}},c=w.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(b){for(var c=b.length,d=[],g=0;g<c;g++)d[g>>>2]|=(b.charCodeAt(g)&255)<<24-g%4*8;return new a.init(d,c)}},y=w.Utf8={stringify:function(a){try{return decodeURIComponent(escape(c.stringify(a)))}catch(B){throw Error("Malformed UTF-8 data");}},parse:function(a){return c.parse(unescape(encodeURIComponent(a)))}},
A=b.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new a.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=y.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,g=c.sigBytes,e=this.blockSize,h=g/(4*e),h=b?f.ceil(h):f.max((h|0)-this._minBufferSize,0);b=h*e;g=f.min(4*b,g);if(b){for(var k=0;k<b;k+=e)this._doProcessBlock(d,k);k=d.splice(0,b);c.sigBytes-=g}return new a.init(k,g)},clone:function(){var a=h.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});b.Hasher=A.extend({cfg:h.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){A.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return(new a.init(c)).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return(new C.HMAC.init(a,
c)).finalize(b)}}});var C=k.algo={};return k}(Math);
(function(){var f=CryptoJS,d=f.lib.WordArray;f.enc.Base64={stringify:function(d){var b=d.words,f=d.sigBytes,h=this._map;d.clamp();d=[];for(var a=0;a<f;a+=3)for(var k=(b[a>>>2]>>>24-a%4*8&255)<<16|(b[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|b[a+2>>>2]>>>24-(a+2)%4*8&255,n=0;4>n&&a+.75*n<f;n++)d.push(h.charAt(k>>>6*(3-n)&63));if(b=h.charAt(64))for(;d.length%4;)d.push(b);return d.join("")},parse:function(f){var b=f.length,k=this._map,h=k.charAt(64);h&&(h=f.indexOf(h),-1!=h&&(b=h));for(var h=[],a=0,w=0;w<b;w++)if(w%
4){var n=k.indexOf(f.charAt(w-1))<<w%4*2,c=k.indexOf(f.charAt(w))>>>6-w%4*2;h[a>>>2]|=(n|c)<<24-a%4*8;a++}return d.create(h,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();
(function(f){function d(a,b,c,d,f,g,e){a=a+(b&c|~b&d)+f+e;return(a<<g|a>>>32-g)+b}function k(a,b,c,d,f,g,e){a=a+(b&d|c&~d)+f+e;return(a<<g|a>>>32-g)+b}function b(a,b,c,d,f,g,e){a=a+(b^c^d)+f+e;return(a<<g|a>>>32-g)+b}function r(a,b,c,d,f,g,e){a=a+(c^(b|~d))+f+e;return(a<<g|a>>>32-g)+b}for(var h=CryptoJS,a=h.lib,w=a.WordArray,n=a.Hasher,a=h.algo,c=[],y=0;64>y;y++)c[y]=4294967296*f.abs(f.sin(y+1))|0;a=a.MD5=n.extend({_doReset:function(){this._hash=new w.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(a,f){for(var h=0;16>h;h++){var n=f+h,x=a[n];a[n]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360}var h=this._hash.words,n=a[f+0],x=a[f+1],g=a[f+2],e=a[f+3],m=a[f+4],p=a[f+5],w=a[f+6],y=a[f+7],A=a[f+8],F=a[f+9],J=a[f+10],E=a[f+11],C=a[f+12],G=a[f+13],H=a[f+14],I=a[f+15],q=h[0],t=h[1],u=h[2],v=h[3],q=d(q,t,u,v,n,7,c[0]),v=d(v,q,t,u,x,12,c[1]),u=d(u,v,q,t,g,17,c[2]),t=d(t,u,v,q,e,22,c[3]),q=d(q,t,u,v,m,7,c[4]),v=d(v,q,t,u,p,12,c[5]),u=d(u,v,q,t,w,17,c[6]),t=d(t,u,v,q,y,22,c[7]),
q=d(q,t,u,v,A,7,c[8]),v=d(v,q,t,u,F,12,c[9]),u=d(u,v,q,t,J,17,c[10]),t=d(t,u,v,q,E,22,c[11]),q=d(q,t,u,v,C,7,c[12]),v=d(v,q,t,u,G,12,c[13]),u=d(u,v,q,t,H,17,c[14]),t=d(t,u,v,q,I,22,c[15]),q=k(q,t,u,v,x,5,c[16]),v=k(v,q,t,u,w,9,c[17]),u=k(u,v,q,t,E,14,c[18]),t=k(t,u,v,q,n,20,c[19]),q=k(q,t,u,v,p,5,c[20]),v=k(v,q,t,u,J,9,c[21]),u=k(u,v,q,t,I,14,c[22]),t=k(t,u,v,q,m,20,c[23]),q=k(q,t,u,v,F,5,c[24]),v=k(v,q,t,u,H,9,c[25]),u=k(u,v,q,t,e,14,c[26]),t=k(t,u,v,q,A,20,c[27]),q=k(q,t,u,v,G,5,c[28]),v=k(v,q,
t,u,g,9,c[29]),u=k(u,v,q,t,y,14,c[30]),t=k(t,u,v,q,C,20,c[31]),q=b(q,t,u,v,p,4,c[32]),v=b(v,q,t,u,A,11,c[33]),u=b(u,v,q,t,E,16,c[34]),t=b(t,u,v,q,H,23,c[35]),q=b(q,t,u,v,x,4,c[36]),v=b(v,q,t,u,m,11,c[37]),u=b(u,v,q,t,y,16,c[38]),t=b(t,u,v,q,J,23,c[39]),q=b(q,t,u,v,G,4,c[40]),v=b(v,q,t,u,n,11,c[41]),u=b(u,v,q,t,e,16,c[42]),t=b(t,u,v,q,w,23,c[43]),q=b(q,t,u,v,F,4,c[44]),v=b(v,q,t,u,C,11,c[45]),u=b(u,v,q,t,I,16,c[46]),t=b(t,u,v,q,g,23,c[47]),q=r(q,t,u,v,n,6,c[48]),v=r(v,q,t,u,y,10,c[49]),u=r(u,v,q,t,
H,15,c[50]),t=r(t,u,v,q,p,21,c[51]),q=r(q,t,u,v,C,6,c[52]),v=r(v,q,t,u,e,10,c[53]),u=r(u,v,q,t,J,15,c[54]),t=r(t,u,v,q,x,21,c[55]),q=r(q,t,u,v,A,6,c[56]),v=r(v,q,t,u,I,10,c[57]),u=r(u,v,q,t,w,15,c[58]),t=r(t,u,v,q,G,21,c[59]),q=r(q,t,u,v,m,6,c[60]),v=r(v,q,t,u,E,10,c[61]),u=r(u,v,q,t,g,15,c[62]),t=r(t,u,v,q,F,21,c[63]);h[0]=h[0]+q|0;h[1]=h[1]+t|0;h[2]=h[2]+u|0;h[3]=h[3]+v|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;b[d>>>5]|=128<<24-d%32;var h=f.floor(c/
4294967296);b[(d+64>>>9<<4)+15]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;b[(d+64>>>9<<4)+14]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360;a.sigBytes=4*(b.length+1);this._process();a=this._hash;b=a.words;for(c=0;4>c;c++)d=b[c],b[c]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360;return a},clone:function(){var a=n.clone.call(this);a._hash=this._hash.clone();return a}});h.MD5=n._createHelper(a);h.HmacMD5=n._createHmacHelper(a)})(Math);
(function(){var f=CryptoJS,d=f.lib,k=d.Base,b=d.WordArray,d=f.algo,r=d.EvpKDF=k.extend({cfg:k.extend({keySize:4,hasher:d.MD5,iterations:1}),init:function(b){this.cfg=this.cfg.extend(b)},compute:function(d,a){for(var f=this.cfg,h=f.hasher.create(),c=b.create(),k=c.words,r=f.keySize,f=f.iterations;k.length<r;){C&&h.update(C);var C=h.update(d).finalize(a);h.reset();for(var l=1;l<f;l++)C=h.finalize(C),h.reset();c.concat(C)}c.sigBytes=4*r;return c}});f.EvpKDF=function(b,a,d){return r.create(d).compute(b,
a)}})();
CryptoJS.lib.Cipher||function(f){var d=CryptoJS,k=d.lib,b=k.Base,r=k.WordArray,h=k.BufferedBlockAlgorithm,a=d.enc.Base64,w=d.algo.EvpKDF,n=k.Cipher=h.extend({cfg:b.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c);this._xformMode=a;this._key=b;this.reset()},reset:function(){h.reset.call(this);this._doReset()},process:function(a){this._append(a);return this._process()},
finalize:function(a){a&&this._append(a);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(b,c,d){return("string"==typeof c?B:l).encrypt(a,b,c,d)},decrypt:function(b,c,d){return("string"==typeof c?B:l).decrypt(a,b,c,d)}}}});k.StreamCipher=n.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=d.mode={},y=function(a,b,c){var d=this._iv;d?this._iv=f:d=this._prevBlock;for(var e=0;e<c;e++)a[b+e]^=
d[e]},A=(k.BlockCipherMode=b.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a;this._iv=b}})).extend();A.Encryptor=A.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize;y.call(this,a,b,d);c.encryptBlock(a,b);this._prevBlock=a.slice(b,b+d)}});A.Decryptor=A.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize,f=a.slice(b,b+d);c.decryptBlock(a,b);y.call(this,
a,b,d);this._prevBlock=f}});c=c.CBC=A;A=(d.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,f=[],g=0;g<c;g+=4)f.push(d);c=r.create(f,c);a.concat(c)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};k.BlockCipher=n.extend({cfg:n.cfg.extend({mode:c,padding:A}),reset:function(){n.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,
this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var C=k.CipherParams=b.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),c=(d.format={}).OpenSSL={stringify:function(b){var c=b.ciphertext;b=b.salt;return(b?r.create([1398893684,
1701076831]).concat(b).concat(c):c).toString(a)},parse:function(b){b=a.parse(b);var c=b.words;if(1398893684==c[0]&&1701076831==c[1]){var d=r.create(c.slice(2,4));c.splice(0,4);b.sigBytes-=16}return C.create({ciphertext:b,salt:d})}},l=k.SerializableCipher=b.extend({cfg:b.extend({format:c}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d);b=e.finalize(b);e=e.cfg;return C.create({ciphertext:b,key:c,iv:e.iv,algorithm:a,mode:e.mode,padding:e.padding,blockSize:a.blockSize,formatter:d.format})},
decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);return a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),d=(d.kdf={}).OpenSSL={execute:function(a,b,c,d){d||(d=r.random(8));a=w.create({keySize:b+c}).compute(a,d);c=r.create(a.words.slice(b),4*c);a.sigBytes=4*b;return C.create({key:a,iv:c,salt:d})}},B=k.PasswordBasedCipher=l.extend({cfg:l.cfg.extend({kdf:d}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);c=d.kdf.execute(c,
a.keySize,a.ivSize);d.iv=c.iv;a=l.encrypt.call(this,a,b,c.key,d);a.mixIn(c);return a},decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);c=d.kdf.execute(c,a.keySize,a.ivSize,b.salt);d.iv=c.iv;return l.decrypt.call(this,a,b,c.key,d)}})}();
(function(){for(var f=CryptoJS,d=f.lib.BlockCipher,k=f.algo,b=[],r=[],h=[],a=[],w=[],n=[],c=[],y=[],A=[],C=[],l=[],B=0;256>B;B++)l[B]=128>B?B<<1:B<<1^283;for(var x=0,g=0,B=0;256>B;B++){var e=g^g<<1^g<<2^g<<3^g<<4,e=e>>>8^e&255^99;b[x]=e;r[e]=x;var m=l[x],p=l[m],z=l[p],D=257*l[e]^16843008*e;h[x]=D<<24|D>>>8;a[x]=D<<16|D>>>16;w[x]=D<<8|D>>>24;n[x]=D;D=16843009*z^65537*p^257*m^16843008*x;c[e]=D<<24|D>>>8;y[e]=D<<16|D>>>16;A[e]=D<<8|D>>>24;C[e]=D;x?(x=m^l[l[l[z^m]]],g^=l[l[g]]):x=g=1}var K=[0,1,2,4,8,
16,32,64,128,27,54],k=k.AES=d.extend({_doReset:function(){for(var a=this._key,d=a.words,e=a.sigBytes/4,a=4*((this._nRounds=e+6)+1),f=this._keySchedule=[],g=0;g<a;g++)if(g<e)f[g]=d[g];else{var h=f[g-1];g%e?6<e&&4==g%e&&(h=b[h>>>24]<<24|b[h>>>16&255]<<16|b[h>>>8&255]<<8|b[h&255]):(h=h<<8|h>>>24,h=b[h>>>24]<<24|b[h>>>16&255]<<16|b[h>>>8&255]<<8|b[h&255],h^=K[g/e|0]<<24);f[g]=f[g-e]^h}d=this._invKeySchedule=[];for(e=0;e<a;e++)g=a-e,h=e%4?f[g]:f[g-4],d[e]=4>e||4>=g?h:c[b[h>>>24]]^y[b[h>>>16&255]]^A[b[h>>>
8&255]]^C[b[h&255]]},encryptBlock:function(c,d){this._doCryptBlock(c,d,this._keySchedule,h,a,w,n,b)},decryptBlock:function(a,b){var d=a[b+1];a[b+1]=a[b+3];a[b+3]=d;this._doCryptBlock(a,b,this._invKeySchedule,c,y,A,C,r);d=a[b+1];a[b+1]=a[b+3];a[b+3]=d},_doCryptBlock:function(a,b,c,d,e,f,g,h){for(var k=this._nRounds,l=a[b]^c[0],m=a[b+1]^c[1],n=a[b+2]^c[2],p=a[b+3]^c[3],q=4,r=1;r<k;r++)var w=d[l>>>24]^e[m>>>16&255]^f[n>>>8&255]^g[p&255]^c[q++],x=d[m>>>24]^e[n>>>16&255]^f[p>>>8&255]^g[l&255]^c[q++],y=
d[n>>>24]^e[p>>>16&255]^f[l>>>8&255]^g[m&255]^c[q++],p=d[p>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[n&255]^c[q++],l=w,m=x,n=y;w=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[n>>>8&255]<<8|h[p&255])^c[q++];x=(h[m>>>24]<<24|h[n>>>16&255]<<16|h[p>>>8&255]<<8|h[l&255])^c[q++];y=(h[n>>>24]<<24|h[p>>>16&255]<<16|h[l>>>8&255]<<8|h[m&255])^c[q++];p=(h[p>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[n&255])^c[q++];a[b]=w;a[b+1]=x;a[b+2]=y;a[b+3]=p},keySize:8});f.AES=d._createHelper(k)})();
