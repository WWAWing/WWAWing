var __extends=this.__extends||function(f,d){function c(){this.constructor=f}for(var h in d)d.hasOwnProperty(h)&&(f[h]=d[h]);c.prototype=d.prototype;f.prototype=new c},wwa_data;
(function(f){var d=function(){function a(b,a){this.strength=b;this.defence=a}a.prototype.add=function(b){this.strength+=b.strength;this.defence+=b.defence;return this};a.prototype.plus=function(b){return new a(this.strength+b.strength,this.defence+b.defence)};a.prototype.minus=function(b){return new a(this.strength-b.strength,this.defence-b.defence)};a.prototype.equals=function(b){return this.strength===b.strength&&this.defence===b.defence};return a}();f.EquipmentStatus=d;d=function(a){function b(b,
k,c,d){this.energy=b;this.gold=d;a.call(this,k,c)}__extends(b,a);b.prototype.add=function(a){a instanceof b&&(this.energy+=a.energy,this.gold+=a.gold);this.strength+=a.strength;this.defence+=a.defence;return this};b.prototype.plus=function(a){return a instanceof b?new b(this.energy+a.energy,this.strength+a.strength,this.defence+a.defence,this.gold+a.gold):new b(this.energy,this.strength+a.strength,this.defence+a.defence,this.gold)};b.prototype.minus=function(a){return a instanceof b?new b(this.energy-
a.energy,this.strength-a.strength,this.defence-a.defence,this.gold-a.gold):new b(this.energy,this.strength-a.strength,this.defence-a.defence,this.gold)};b.prototype.equals=function(b){return this.energy===b.energy&&this.strength===b.strength&&this.defence===b.defence&&this.gold===b.gold};return b}(d);f.Status=d;var c=function(){function a(b,a){void 0===b&&(b=0);void 0===a&&(a=0);this.x=b;this.y=a}a.prototype.equals=function(b){return this.x===b.x&&this.y===b.y};a.prototype.substract=function(b){return new a(this.x-
b.x,this.y-b.y)};a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.convertIntoPosition=function(b){return new h(b,this.x,this.y,0,0)};a.prototype.getDirectionTo=function(b){return this.x<b.x?this.y>b.y?7:this.y===b.y?1:6:this.x===b.x?this.y>b.y?3:this.y===b.y?8:2:this.y>b.y?5:this.y===b.y?0:4};return a}();f.Coord=c;var h=function(){function a(b,a,k,d,h){void 0===d&&(d=0);void 0===h&&(h=0);this._wwa=b;if(void 0===this._wwa)throw Error("WWA\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3057\u307e\u305b\u3093. ");
b=this._wwa.getMapWidth();if(0>a||a>=b||a>=b-1&&0<d||0>k||k>=b||k>=b-1&&0<h)throw Error("\u7bc4\u56f2\u5916\u306e\u5ea7\u6a19\u3067\u3059!! parts:("+a+", "+k+"), offset:("+d+", "+h+"), mapWidth = "+b);this._partsCoord=new c(a,k);this._offsetCoord=new c(d,h)}a.prototype.getPartsCoord=function(){return this._partsCoord};a.prototype.getOffsetCoord=function(){return this._offsetCoord};a.prototype.getScreenTopPosition=function(){return new a(this._wwa,Math.floor(this._partsCoord.x/(l.H_PARTS_NUM_IN_WINDOW-
1))*(l.H_PARTS_NUM_IN_WINDOW-1),Math.floor(this._partsCoord.y/(l.V_PARTS_NUM_IN_WINDOW-1))*(l.V_PARTS_NUM_IN_WINDOW-1),0,0)};a.prototype.getNextJustPosition=function(b){if(void 0!==b){var g=this._partsCoord;return new a(this._wwa,g.x+f.vx[b],g.y+f.vy[b],0,0)}b=this._partsCoord.x;g=this._partsCoord.y;0>this._offsetCoord.x?b--:0<this._offsetCoord.x&&b++;0>this._offsetCoord.y?g--:0<this._offsetCoord.y&&g++;return new a(this._wwa,b,g,0,0)};a.prototype.getNextFramePosition=function(b,g,k){var d=this._partsCoord.x,
c=this._partsCoord.y;g=this._offsetCoord.x+f.vx[b]*g;b=this._offsetCoord.y+f.vy[b]*k;0>g&&(k=Math.floor(Math.abs(g)/l.CHIP_SIZE),d-=k,g=(g+k*l.CHIP_SIZE)%l.CHIP_SIZE);0>b&&(k=Math.floor(Math.abs(b)/l.CHIP_SIZE),c-=k,b=(b+k*l.CHIP_SIZE)%l.CHIP_SIZE);g>=l.CHIP_SIZE&&(d+=Math.floor(g/l.CHIP_SIZE),g=(g+l.CHIP_SIZE)%l.CHIP_SIZE);b>=l.CHIP_SIZE&&(c+=Math.floor(b/l.CHIP_SIZE),b=(b+l.CHIP_SIZE)%l.CHIP_SIZE);return new a(this._wwa,d,c,g,b)};a.prototype.isJustPosition=function(){return 0==this._offsetCoord.x&&
0==this._offsetCoord.y};a.prototype.isScreenTopPosition=function(){var b=this.getScreenTopPosition();return this.equals(b)};a.prototype.equals=function(b){return this._partsCoord.equals(b.getPartsCoord())&&this._offsetCoord.equals(b.getOffsetCoord())};a.prototype.isInCameraRange=function(b){b=b.getPosition()._partsCoord;var a=this._partsCoord.x,k=this._partsCoord.y;return b.x<=a&&a<b.x+l.H_PARTS_NUM_IN_WINDOW&&b.y<=k&&k<b.y+l.V_PARTS_NUM_IN_WINDOW};a.prototype.hasLocalGate=function(){return this._wwa.getMapTypeByPosition(this)===
l.MAP_LOCALGATE||this._wwa.getObjectTypeByPosition(this)===l.OBJECT_LOCALGATE};a.prototype.clone=function(){return new a(this._wwa,this._partsCoord.x,this._partsCoord.y,this._offsetCoord.x,this._offsetCoord.y)};return a}();f.Position=h;d=function(){return function(a,b,g){this.destPos=a.clone();this.srcPos=b.clone();this.srcSize=g.clone()}}();f.Face=d;(function(a){a[a.LEFT=0]="LEFT";a[a.RIGHT=1]="RIGHT";a[a.DOWN=2]="DOWN";a[a.UP=3]="UP";a[a.LEFT_DOWN=4]="LEFT_DOWN";a[a.LEFT_UP=5]="LEFT_UP";a[a.RIGHT_DOWN=
6]="RIGHT_DOWN";a[a.RIGHT_UP=7]="RIGHT_UP";a[a.NO_DIRECTION=8]="NO_DIRECTION"})(f.Direction||(f.Direction={}));f.vx=[-1,1,0,0,-1,-1,1,1,0];f.vy=[0,0,1,-1,1,-1,1,-1,0];f.dirToPos=[4,6,2,0];f.dirToKey=[37,39,40,38];(function(a){a[a.YES=0]="YES";a[a.NO=1]="NO";a[a.UNSELECTED=2]="UNSELECTED"})(f.YesNoState||(f.YesNoState={}));(function(a){a[a.MAP=0]="MAP";a[a.OBJECT=1]="OBJECT";a[a.CHOICE_YES=2]="CHOICE_YES";a[a.CHOICE_NO=3]="CHOICE_NO"})(f.AppearanceTriggerType||(f.AppearanceTriggerType={}));(function(a){a[a.NORMAL=
0]="NORMAL";a[a.CAN_USE=1]="CAN_USE";a[a.NOT_DISAPPEAR=2]="NOT_DISAPPEAR"})(f.ItemMode||(f.ItemMode={}));(function(a){a[a.MAP=1]="MAP";a[a.OBJECT=0]="OBJECT"})(f.PartsType||(f.PartsType={}));(function(a){a[a.NONE=0]="NONE";a[a.CALL_BY_MAP_PARTS=1]="CALL_BY_MAP_PARTS";a[a.CALL_BY_OBJECT_PARTS=2]="CALL_BY_OBJECT_PARTS";a[a.CALL_BY_ITEM_USE=3]="CALL_BY_ITEM_USE";a[a.CALL_BY_QUICK_SAVE=4]="CALL_BY_QUICK_SAVE";a[a.CALL_BY_QUICK_LOAD=5]="CALL_BY_QUICK_LOAD";a[a.CALL_BY_RESTART_GAME=6]="CALL_BY_RESTART_GAME";
a[a.CALL_BY_GOTO_WWA=7]="CALL_BY_GOTO_WWA"})(f.ChoiceCallInfo||(f.ChoiceCallInfo={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.QUICK_SAVE=1]="QUICK_SAVE";a[a.RESTART_GAME=2]="RESTART_GAME";a[a.GOTO_WWA=3]="GOTO_WWA"})(f.SidebarButton||(f.SidebarButton={}));(function(a){a[a.UP=0]="UP";a[a.DOWN=1]="DOWN"})(f.SpeedChange||(f.SpeedChange={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.RESTART_GAME=1]="RESTART_GAME"})(f.LoadType||(f.LoadType={}));(function(a){a[a.STATIC=0]="STATIC";a[a.CHASE_PLAYER=
1]="CHASE_PLAYER";a[a.RUN_OUT=2]="RUN_OUT";a[a.HANG_AROUND=3]="HANG_AROUND"})(f.MoveType||(f.MoveType={}));(function(a){a[a.MODE_X=0]="MODE_X";a[a.MODE_Y=1]="MODE_Y";a[a.UNDECIDED=2]="UNDECIDED"})(f.SecondCandidateMoveType||(f.SecondCandidateMoveType={}));f.sidebarButtonCellElementID=["cell-load","cell-save","cell-restart","cell-gotowwa"];(function(a){a[a.ASK_LINK=5]="ASK_LINK";a[a.NO_MONEY=6]="NO_MONEY";a[a.NO_ITEM=7]="NO_ITEM";a[a.USE_ITEM=8]="USE_ITEM"})(f.SystemMessage1||(f.SystemMessage1={}));
(function(a){a[a.CLICKABLE_ITEM=0]="CLICKABLE_ITEM";a[a.FULL_ITEM=1]="FULL_ITEM";a[a.LOAD_SE=2]="LOAD_SE"})(f.SystemMessage2||(f.SystemMessage2={}));(function(a){a[a.UNDEFINED=0]="UNDEFINED";a[a.IMGPLAYER=1]="IMGPLAYER";a[a.IMGYESNO=2]="IMGYESNO";a[a.HPMAX=3]="HPMAX";a[a.SAVE=4]="SAVE";a[a.ITEM=5]="ITEM";a[a.DEFAULT=6]="DEFAULT";a[a.OLDMAP=7]="OLDMAP";a[a.PARTS=8]="PARTS";a[a.MOVE=9]="MOVE";a[a.MAP=10]="MAP";a[a.DIRMAP=11]="DIRMAP";a[a.IMGFRAME=12]="IMGFRAME";a[a.IMGBOM=13]="IMGBOM";a[a.DELPLAYER=
14]="DELPLAYER";a[a.FACE=15]="FACE";a[a.EFFECT=16]="EFFECT";a[a.GAMEOVER=17]="GAMEOVER";a[a.IMGCLICK=18]="IMGCLICK";a[a.STATUS=19]="STATUS";a[a.EFFITEM=20]="EFFITEM";a[a.COLOR=21]="COLOR";a[a.WAIT=22]="WAIT";a[a.SOUND=23]="SOUND"})(f.MacroType||(f.MacroType={}));f.macrotable={"":0,$imgplayer:1,$imgyesno:2,$hpmax:3,$save:4,$item:5,$default:6,$oldmap:7,$parts:8,$move:9,$map:10,$dirmap:11,$imgframe:12,$imgbom:13,$delplayer:14,$face:15,$effect:16,$gameover:17,$imgclick:18,$status:19,$effitem:20,$color:21,
$wait:22,$sound:23};(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.MOVES=4]="MOVES"})(f.MacroStatusIndex||(f.MacroStatusIndex={}));(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.WIDE_CELL_ROW=4]="WIDE_CELL_ROW";a[a.ITEM_BG=5]="ITEM_BG";a[a.MAIN_FRAME=6]="MAIN_FRAME"})(f.MacroImgFrameIndex||(f.MacroImgFrameIndex={}));(function(a){a[a.DECISION=1]="DECISION";a[a.ATTACK=3]="ATTACK";
a[a.BGM_LB=70]="BGM_LB";a[a.NO_SOUND=99]="NO_SOUND"})(f.SystemSound||(f.SystemSound={}));f.speedList=[2,5,8,10];f.speedNameList=["\u4f4e\u901f","\u6e96\u4f4e\u901f","\u4e2d\u901f","\u9ad8\u901f"];var l=function(){function a(){}a.VERSION_WWAJS="W3.13b+";a.WWA_HOME="http://wwajp.com";a.ITEMBOX_SIZE=12;a.MAP_ATR_MAX=60;a.OBJ_ATR_MAX=60;a.OLD_MAP_ATR_MAX=40;a.OLD_OBJ_ATR_MAX=40;a.ATR_TYPE=3;a.ATR_MODE=4;a.ATR_STRING=5;a.ATR_X=6;a.ATR_Y=7;a.ATR_X2=8;a.ATR_Y2=9;a.ATR_ENERGY=10;a.ATR_STRENGTH=11;a.ATR_DEFENCE=
12;a.ATR_GOLD=13;a.ATR_ITEM=14;a.ATR_NUMBER=15;a.ATR_JUMP_X=16;a.ATR_MOVE=16;a.ATR_JUMP_Y=17;a.ATR_SOUND=19;a.ATR_APPERANCE_BASE=20;a.REL_ATR_APPERANCE_ID=0;a.REL_ATR_APPERANCE_X=1;a.REL_ATR_APPERANCE_Y=2;a.REL_ATR_APPERANCE_TYPE=3;a.REL_ATR_APPERANCE_UNIT_LENGTH=4;a.ATR_RANDOM_BASE=10;a.RANDOM_ATR_NUM=10;a.RANDOM_ITERATION_MAX=10;a.MAP_STREET=0;a.MAP_WALL=1;a.MAP_LOCALGATE=2;a.MAP_URLGATE=4;a.OBJECT_NORMAL=0;a.OBJECT_MESSAGE=1;a.OBJECT_URLGATE=2;a.OBJECT_STATUS=3;a.OBJECT_ITEM=4;a.OBJECT_DOOR=5;
a.OBJECT_MONSTER=6;a.OBJECT_SCORE=11;a.OBJECT_SELL=14;a.OBJECT_BUY=15;a.OBJECT_RANDOM=16;a.OBJECT_SELECT=17;a.OBJECT_LOCALGATE=18;a.SYSTEM_MESSAGE_NUM=20;a.IMGPOS_DEFAULT_YESNO_X=3;a.IMGPOS_DEFAULT_YESNO_Y=1;a.IMGRELPOS_YESNO_YES_X=0;a.IMGRELPOS_YESNO_NO_X=1;a.IMGRELPOS_YESNO_YESP_X=2;a.IMGRELPOS_YESNO_NOP_X=3;a.IMGPOS_DEFAULT_PLAYER_X=2;a.IMGPOS_DEFAULT_PLAYER_Y=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y=0;a.IMGPOS_DEFAULT_FRAME_X=0;a.IMGPOS_DEFAULT_FRAME_Y=
1;a.IMGPOS_DEFAULT_BATTLE_EFFECT_X=3;a.IMGPOS_DEFAULT_BATTLE_EFFECT_Y=3;a.DEFAULT_DISABLE_SAVE=!1;a.DEFAULT_OLDMAP=!1;a.DEFAULT_OBJECT_NO_COLLAPSE=!1;a.SPLASH_SCREEN_DISP_MILLS=100;a.DEFAULT_FRAME_INTERVAL=20;a.GAMEOVER_FRAME_INTERVAL=50;a.YESNO_PRESS_DISP_FRAME_NUM=20;a.CHIP_SIZE=40;a.MAP_WINDOW_WIDTH=440;a.MAP_WINDOW_HEIGHT=440;a.H_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_WIDTH/a.CHIP_SIZE;a.V_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_HEIGHT/a.CHIP_SIZE;a.DEFAULT_SPEED_INDEX=2;a.MIN_SPEED_INDEX=0;a.MAX_SPEED_INDEX=
f.speedList.length-1;a.ANIMATION_REP_HALF_FRAME=22;a.PLAYER_LOOKING_AROUND_START_FRAME=4*a.ANIMATION_REP_HALF_FRAME;a.RELATIVE_COORD_BIAS=1E4;a.RELATIVE_COORD_LOWER=a.RELATIVE_COORD_BIAS-1E3;a.PLAYER_COORD=a.RELATIVE_COORD_BIAS-1E3;a.LOCALGATE_PLAYER_WAIT_FRAME=5;a.STATUS_CHANGED_EFFECT_FRAME_NUM=20;a.PASSABLE_OBJECT=1;a.APPERANCE_PARTS_MIN_INDEX=0;a.APPERANCE_PARTS_MAX_INDEX=9;a.APPERANCE_PARTS_MIN_INDEX_NO=5;a.APPERANCE_PARTS_MAX_INDEX_YES=4;a.FADEOUT_SPEED=8;a.STATUS_MINUS_BORDER=3E4;a.ITEMBOX_IS_FULL=
-1;a.BATTLE_INTERVAL_FRAME_NUM=10;a.BATTLE_SPEED_CHANGE_TURN_NUM=40;a.RANDOM_MOVE_ITERATION_NUM=50;a.BATTLE_ESTIMATE_MONSTER_TYPE_MAX=8;a.SOUND_MAX=100;a.ITEM_BORDER_IMG_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAArklEQVRYR+2Y0QqAIAxFt///aENJHwxxuJUSxzeh3S7HXaNpEkly4FIRzba0GEyHeVTN7jqDWvb7V4Y1NLibZIY0NbiL5G3MZLCe / 1fn3XJgJYjB7mgg6O1VCEKwXo79JeklY62nB62kRs9BEIKkeNIDhISQEBJC4k0BBCF4D7D4cV9shf99ixdB + MrM0y3fa3zV05D45GOqhwPMGPkYlccIOEY2VKUN0UNVXxC7ADj7mDi9aFZZAAAAAElFTkSuQmCC";
a.LOAD_STAGE_MAX_EXCEPT_AUDIO=7;a.WWA_STYLE_TAG_ID="wwa-additional-style";a.DEFAULT_FRAME_COLOR_R=255;a.DEFAULT_FRAME_COLOR_G=255;a.DEFAULT_FRAME_COLOR_B=255;a.DEFAULT_FRAMEOUT_COLOR_R=96;a.DEFAULT_FRAMEOUT_COLOR_G=96;a.DEFAULT_FRAMEOUT_COLOR_B=96;a.DEFAULT_STRBACK_COLOR_R=0;a.DEFAULT_STRBACK_COLOR_G=0;a.DEFAULT_STRBACK_COLOR_B=0;a.DEFAULT_STATUS_COLOR_R=0;a.DEFAULT_STATUS_COLOR_G=0;a.DEFAULT_STATUS_COLOR_B=0;a.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM=20;a.WWAP_SERVER="http://wwawing.com/wwap";a.WWAP_SERVER_AUDIO_DIR=
"audio";a.WWAP_SERVER_TITLE_IMG="cover_p.gif";a.WWAP_SERVER_LOADER_NO_WORKER="wwaload.noworker.js";return a}();f.WWAConsts=l;d=function(){return function(){}}();f.LoaderResponse=d;d=function(){return function(){}}();f.LoaderError=d;d=function(){return function(){}}();f.LoaderProgress=d;(function(a){a[a.INIT=0]="INIT";a[a.MAP_LOAD=1]="MAP_LOAD";a[a.OBJ_LOAD=2]="OBJ_LOAD";a[a.MAP_ATTR=3]="MAP_ATTR";a[a.OBJ_ATTR=4]="OBJ_ATTR";a[a.RAND_PARTS=5]="RAND_PARTS";a[a.MESSAGE=6]="MESSAGE";a[a.GAME_INIT=7]="GAME_INIT";
a[a.AUDIO=8]="AUDIO"})(f.LoadStage||(f.LoadStage={}));f.loadMessages="\u30ed\u30fc\u30c9\u306e\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u30e9\u30f3\u30c0\u30e0\u30d1\u30fc\u30c4\u3092\u7f6e\u63db\u3057\u3066\u3044\u307e\u3059\u3002;\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;Welcome to WWA Wing!".split(";");
(function(a){a[a.COLOR_FRAME=0]="COLOR_FRAME";a[a.COLOR_FRAMEOUT=1]="COLOR_FRAMEOUT";a[a.COLOR_STR=2]="COLOR_STR";a[a.COLOR_STATUS_STR=4]="COLOR_STATUS_STR"})(f.ChangeStyleType||(f.ChangeStyleType={}));(function(a){a[a.MESSAGE_WINDOW=0]="MESSAGE_WINDOW";a[a.SIDEBAR=1]="SIDEBAR"})(f.SelectorType||(f.SelectorType={}));d=function(){return function(){this.statusColorB=this.statusColorG=this.statusColorR=this.fontColorB=this.fontColorG=this.fontColorR=this.frameOutColorB=this.frameOutColorG=this.frameOutColorR=
this.frameColorB=this.frameColorG=this.frameColorR=this.imgClickY=this.imgClickX=this.bgm=this.delPlayerFlag=this.objectNoCollapseDefaultFlag=this.compatibleForOldMapFlag=this.disableSaveFlag=this.clickableItemSignImgPosY=this.clickableItemSignImgPosX=this.playerImgPosY=this.playerImgPosX=this.yesnoImgPosY=this.yesnoImgPosX=this.moves=this.systemMessage=this.mapCGName=this.charCGName=this.worldPassNumber=this.worldName=this.message=this.worldPassword=this.objectAttribute=this.mapAttribute=this.mapObject=
this.map=this.messageNum=this.mapWidth=this.itemBox=this.statusGold=this.statusDefence=this.statusStrength=this.statusEnergy=this.statusEnergyMax=this.isOldMap=this.objPartsMax=this.mapPartsMax=this.playerY=this.playerX=this.gameoverY=this.gameoverX=this.version=void 0}}();f.WWAData=d})(wwa_data||(wwa_data={}));var wwa_camera;
(function(f){var d=wwa_data.WWAConsts,c=function(){function c(d){this._position=null;this.reset(d)}c.prototype.setPlayer=function(c){this._player=c};c.prototype.isResetting=function(){return this._isResetting};c.prototype.getPosition=function(){return this._position};c.prototype.getPreviousPosition=function(){return this._positionPrev};c.prototype.resetPreviousPosition=function(){this._positionPrev=null};c.prototype.move=function(c){var a=wwa_data.speedList[this._player.getSpeedIndex()];this._position=
this._position.getNextFramePosition(c,a*(d.H_PARTS_NUM_IN_WINDOW-1),a*(d.V_PARTS_NUM_IN_WINDOW-1))};c.prototype.getTransitionStepNum=function(){return this._transitionStep};c.prototype.advanceTransitionStepNum=function(){++this._transitionStep;this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW&&(this._isResetting=!1,this._transitionStep=0);return this._transitionStep};c.prototype.isFinalStep=function(){if(!1===this._isResetting)throw Error("\u30ea\u30bb\u30c3\u30c8\u4e2d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002");
return this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW-1};c.prototype.reset=function(c){this._positionPrev=this._position;this._position=c.getScreenTopPosition();this._transitionStep=0;this._isResetting=!0};return c}();f.Camera=c})(wwa_camera||(wwa_camera={}));var wwa_cgmanager;
(function(f){var d=wwa_data.WWAConsts,c=function(){function c(d,a,b,g){this._isLoaded=!1;this._ctx=d;this._ctxSub=a;this._fileName=b;this._loadCompleteCallBack=g;this._load()}c.prototype._load=function(){var c=this;this._isLoaded||(this._image=new Image,this._image.addEventListener("load",function(){c._loadCompleteCallBack()}),this._image.addEventListener("error",function(){throw Error("Image Load Failed!!\nfile name:"+c._fileName);}),this._image.src=this._fileName,this._isLoaded=!0)};c.prototype.drawCanvas=
function(c,a,b,g,k){void 0===k&&(k=!1);k=k?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");k.drawImage(this._image,d.CHIP_SIZE*c,d.CHIP_SIZE*a,d.CHIP_SIZE,d.CHIP_SIZE,b,g,d.CHIP_SIZE,d.CHIP_SIZE)};c.prototype.drawCanvasWithSize=function(c,a,b,g,k,f,h){void 0===h&&(h=!1);h=h?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");h.drawImage(this._image,d.CHIP_SIZE*c,d.CHIP_SIZE*a,d.CHIP_SIZE*b,d.CHIP_SIZE*g,k,f,2*d.CHIP_SIZE,2*d.CHIP_SIZE)};c.prototype.drawCanvasWithUpperYLimit=
function(c,a,b,g,k,h){void 0===h&&(h=!1);h=h?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");k=Math.max(0,g+d.CHIP_SIZE-k);k>=d.CHIP_SIZE||h.drawImage(this._image,d.CHIP_SIZE*c,d.CHIP_SIZE*a,d.CHIP_SIZE,d.CHIP_SIZE-k,b,g,d.CHIP_SIZE,d.CHIP_SIZE)};c.prototype.drawCanvasWithLowerYLimit=function(c,a,b,g,k,h){void 0===h&&(h=!1);h=h?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");k=Math.max(0,k-g);k>=d.CHIP_SIZE||h.drawImage(this._image,d.CHIP_SIZE*
c,d.CHIP_SIZE*a+k,d.CHIP_SIZE,d.CHIP_SIZE-k,b,g+k,d.CHIP_SIZE,d.CHIP_SIZE)};c.prototype.clearCanvas=function(c,a,b,g,k){void 0===k&&(k=!1);(k?this._ctxSub:this._ctx).clearRect(c,a,b,g)};c.prototype.drawBase=function(c,a,b,g,k){void 0===k&&(k=!1);k=k?this._ctxSub:this._ctx;k.fillStyle="#9E9E9E";k.fillRect(c,a,b,g)};return c}();f.CGManager=c})(wwa_cgmanager||(wwa_cgmanager={}));var wwa_estimate_battle;
(function(f){var d=function(){function c(a,b,g){this.id=a;this.imgFileName=b;this.parent=g;this.elem=document.createElement("div");this.elem.classList.add("est");this.elem.setAttribute("id","wwa-est-"+a);this.imgElem=document.createElement("div");this.imgElem.classList.add("est-img-wrapper");this.imgElem.style.backgroundImage="url("+this.imgFileName.replace("(","\\(").replace(")","\\)")+")";this.statusElem=document.createElement("div");this.statusElem.classList.add("est-status-wrapper");this.energyElem=
document.createElement("div");this.energyElem.classList.add("est-energy");this.energyDispElem=document.createElement("span");this.energyDispElem.classList.add("est-energy-disp");this.energyElem.appendChild(this.energyDispElem);this.statusElem.appendChild(this.energyElem);this.strengthElem=document.createElement("div");this.strengthElem.classList.add("est-strength");this.strengthDispElem=document.createElement("span");this.strengthDispElem.classList.add("est-strength-disp");this.strengthElem.appendChild(this.strengthDispElem);
this.statusElem.appendChild(this.strengthElem);this.defenceElem=document.createElement("div");this.defenceElem.classList.add("est-defence");this.defenceDispElem=document.createElement("span");this.defenceDispElem.classList.add("est-defence-disp");this.defenceElem.appendChild(this.defenceDispElem);this.statusElem.appendChild(this.defenceElem);this.damageElem=document.createElement("div");this.damageElem.classList.add("est-damage");this.damageDispElem=document.createElement("span");this.damageDispElem.classList.add("est-damage-disp");
this.damageElem.appendChild(this.damageDispElem);this.statusElem.appendChild(this.damageElem);this.elem.appendChild(this.imgElem);this.elem.appendChild(this.statusElem)}c.prototype.hide=function(){this.elem.style.display="none"};c.prototype.show=function(){this.elem.style.display="block"};c.prototype.setResult=function(a,b,g){this.imgElem.style.backgroundPosition="-"+a.x+"px -"+a.y+"px";this.energyDispElem.textContent="\u751f\u547d\u529b "+b.energy;this.strengthDispElem.textContent="\u653b\u6483\u529b "+
b.strength;this.defenceDispElem.textContent="\u9632\u5fa1\u529b "+b.defence;this.damageDispElem.textContent=g.isNoEffect?"\u653b\u6483\u7121\u52b9":g.isOverMaxTurn?"\u9577\u671f\u6226\u304c\u4e88\u60f3\u3055\u308c\u307e\u3059":"\u4e88\u60f3\u30c0\u30e1\u30fc\u30b8 "+g.damage};return c}(),c=function(){function c(a,b,g){var k=this;this._wwa=a;this._imgFileName=b;this._parent=g;this._element=document.createElement("div");this._element.setAttribute("id","wwa-battle-estimate");this._element.style.display=
"none";this._edes=[];for(b=0;b<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;b++)a=new d(b,this._imgFileName,this._element),this._edes.push(a),this._element.appendChild(a.elem);this._element.addEventListener("click",function(){k._wwa.hideBattleEstimateWindow()});this._parent.appendChild(this._element)}c.prototype.update=function(a,b){for(var g=0;g<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;g++)if(g>=b.length)this._edes[g].hide();else{var c=this._wwa.getObjectAttributeById(b[g],wwa_data.WWAConsts.ATR_X),
d=this._wwa.getObjectAttributeById(b[g],wwa_data.WWAConsts.ATR_Y),c=new wwa_data.Coord(c,d),d=this._wwa.getObjectAttributeById(b[g],wwa_data.WWAConsts.ATR_ENERGY),f=this._wwa.getObjectAttributeById(b[g],wwa_data.WWAConsts.ATR_STRENGTH),l=this._wwa.getObjectAttributeById(b[g],wwa_data.WWAConsts.ATR_DEFENCE),d=new wwa_data.Status(d,f,l,0);a:{var f=d.energy,l=a.strength-d.defence,w=Math.max(0,d.strength-a.defence),x=0,p=0;if(0<l)for(;;){x++;f-=l;if(0>=f){f=new h(!1,!1,p);break a}p+=w;if(1E4<x){f=new h(!1,
!0,0);break a}}else f=new h(!0,!1,0)}this._edes[g].setResult(c,d,f);this._edes[g].show()}};c.prototype.show=function(){this._element.style.display="block"};c.prototype.hide=function(){this._element.style.display="none"};return c}();f.BattleEstimateWindow=c;var h=function(){return function(c,a,b){this.isNoEffect=c;this.isOverMaxTurn=a;this.damage=b}}()})(wwa_estimate_battle||(wwa_estimate_battle={}));var wwa_inject_html;
(function(f){f.inject=function(d,c){var h=document.createElement("style");h.type="text/css";h.setAttribute("id",wwa_data.WWAConsts.WWA_STYLE_TAG_ID);wwa_util.$tag("head")[0].appendChild(h);d.innerHTML='            <canvas id="wwa-map" class="wwa-canvas" width="440" height="440">                \u3053\u306e\u30d6\u30e9\u30a6\u30b6\u306f\u3001Canvas\u8981\u7d20\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002            </canvas>            <canvas id="wwa-map-sub" class="wwa-canvas" width="440" height="440"></canvas>            <div id="wwa-sidebar">                <div class="wide-cell-row" id="disp-energy"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-strength"><div class="status-icon"></div><div class="status-value-box"> 0 </div></div>                <div class="wide-cell-row" id="disp-defence"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-gold"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="item-cell" id="item0"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item1"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item2"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item3"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item4"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item5"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item6"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item7"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item8"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item9"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item10"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item11"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="wide-cell-row" id="cell-load">Quick Load</div><div class="wide-button" id="button-load"></div>                <div class="wide-cell-row" id="cell-save">Quick Save</div><div class="wide-button" id="button-save"></div>                <div class="wide-cell-row" id="cell-restart">Restart Game</div><div class="wide-button" id="button-restart"></div>                <div class="wide-cell-row" id="cell-gotowwa">Go to WWA</div><div class="wide-button" id="button-gotowwa"></div>            </div>            <div id="wwa-controller"></div>            <div id="wwa-fader"></div>            <div id="wwa-cover">                 <div id="version"></div>                 <div id="progress-message-container">\u958b\u59cb\u3057\u3066\u3044\u307e\u3059...</div>                 <div id="progress-bar-bg"></div>                 <div id="progress-bar" class="progress-bar"></div>                 <div id="progress-bar-audio" class="progress-bar"></div>                 <div id="progress-disp">---</div>            </div>            <div id="wwa-audio-wrapper"></div>    ';
h=document.createElement("img");h.src=c;wwa_util.$id("wwa-cover").appendChild(h)}})(wwa_inject_html||(wwa_inject_html={}));var wwa_input;
(function(f){(function(c){c[c.NONE=0]="NONE";c[c.KEYDOWN=1]="KEYDOWN";c[c.KEYPRESS=2]="KEYPRESS";c[c.KEYUP=3]="KEYUP";c[c.KEYPRESS_MESSAGECHANGE=4]="KEYPRESS_MESSAGECHANGE"})(f.KeyState||(f.KeyState={}));(function(c){c[c.KEY_ENTER=13]="KEY_ENTER";c[c.KEY_SHIFT=16]="KEY_SHIFT";c[c.KEY_ESC=27]="KEY_ESC";c[c.KEY_SPACE=32]="KEY_SPACE";c[c.KEY_LEFT=37]="KEY_LEFT";c[c.KEY_UP=38]="KEY_UP";c[c.KEY_RIGHT=39]="KEY_RIGHT";c[c.KEY_DOWN=40]="KEY_DOWN";c[c.KEY_1=49]="KEY_1";c[c.KEY_2=50]="KEY_2";c[c.KEY_3=51]=
"KEY_3";c[c.KEY_A=65]="KEY_A";c[c.KEY_C=67]="KEY_C";c[c.KEY_D=68]="KEY_D";c[c.KEY_E=69]="KEY_E";c[c.KEY_I=73]="KEY_I";c[c.KEY_M=77]="KEY_M";c[c.KEY_N=78]="KEY_N";c[c.KEY_P=80]="KEY_P";c[c.KEY_Q=81]="KEY_Q";c[c.KEY_S=83]="KEY_S";c[c.KEY_W=87]="KEY_W";c[c.KEY_X=88]="KEY_X";c[c.KEY_Y=89]="KEY_Y";c[c.KEY_Z=90]="KEY_Z";c[c.KEY_F1=112]="KEY_F1";c[c.KEY_F3=114]="KEY_F3";c[c.KEY_F4=115]="KEY_F4";c[c.KEY_F5=116]="KEY_F5";c[c.KEY_F6=117]="KEY_F6";c[c.KEY_F7=118]="KEY_F7";c[c.KEY_F8=119]="KEY_F8";c[c.KEY_F12=
123]="KEY_F12"})(f.KeyCode||(f.KeyCode={}));var d=function(){function c(){var d;this._nextKeyState=Array(c.KEY_BUFFER_MAX);this._keyState=Array(c.KEY_BUFFER_MAX);this._prevKeyState=Array(c.KEY_BUFFER_MAX);this._prevKeyStateOnControllable=Array(c.KEY_BUFFER_MAX);this._keyInputContinueFrameNum=Array(c.KEY_BUFFER_MAX);for(d=0;d<c.KEY_BUFFER_MAX;d++)this._nextKeyState[d]=!1,this._keyState[d]=!1,this._prevKeyState[d]=!1,this._prevKeyStateOnControllable[d]=!1,this._keyInputContinueFrameNum[d]=0}c.prototype.checkHitKey=
function(c){c=this.getKeyState(c);return 1===c||2===c};c.prototype.getKeyState=function(c){return this._prevKeyState[c]?this._keyState[c]?2:3:this._keyState[c]?1:0};c.prototype.getKeyStateForControllPlayer=function(c){return this._prevKeyStateOnControllable[c]?this._keyState[c]?2:3:this._keyState[c]?1:0};c.prototype.getKeyStateForMessageCheck=function(c){return this._prevKeyState[c]?this._keyState[c]?this._keyInputContinueFrameNum[c]>=wwa_data.WWAConsts.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM?4:2:3:this._keyState[c]?
1:0};c.prototype.setPressInfo=function(c){this._nextKeyState[c]=!0;this._keyInputContinueFrameNum[c]=-1};c.prototype.setReleaseInfo=function(c){this._nextKeyState[c]=!1;this._keyInputContinueFrameNum[c]=-1};c.prototype.update=function(){var d;this._prevKeyState=this._keyState.slice();this._keyState=this._nextKeyState.slice();for(d=0;d<c.KEY_BUFFER_MAX;d++)this._keyState[d]&&this._keyInputContinueFrameNum[d]++};c.prototype.memorizeKeyStateOnControllableFrame=function(){this._prevKeyStateOnControllable=
this._keyState.slice()};c.prototype.allClear=function(){var d;this._nextKeyState=Array(c.KEY_BUFFER_MAX);for(d=0;d<c.KEY_BUFFER_MAX;d++)this._nextKeyState[d]=!1};c.KEY_BUFFER_MAX=256;return c}();f.KeyStore=d;(function(c){c[c.NONE=0]="NONE";c[c.MOUSEDOWN=1]="MOUSEDOWN";c[c.MOUSEPRESS=2]="MOUSEPRESS";c[c.MOUSEUP=3]="MOUSEUP"})(f.MouseState||(f.MouseState={}));d=function(){function c(){this._nextMouseState=this._mouseState=this._prevMouseState=!1}c.prototype.checkClickMouse=function(c){c=void 0!==c?
this.getMouseState(c):this.getMouseState();return 1===c||2===c};c.prototype.getMouseState=function(c){return void 0!==c&&this._inputDir!==c?0:this._prevMouseState?this._mouseState?2:3:this._mouseState?1:0};c.prototype.getMouseStateForControllPlayer=function(c){return void 0!==c&&this._inputDir!==c?0:this._prevMouseStateOnControllable?this._mouseState?2:3:this._mouseState?1:0};c.prototype.setPressInfo=function(c,d){this._nextMouseState=!0;this._inputDir=c;this._touchID=d};c.prototype.setReleaseInfo=
function(){this._touchID=void 0;this._nextMouseState=!1};c.prototype.memorizeMouseStateOnControllableFrame=function(){this._prevMouseStateOnControllable=this._mouseState};c.prototype.update=function(){this._prevMouseState=this._mouseState;this._mouseState=this._nextMouseState};c.prototype.clear=function(){this._nextMouseState=!1};c.prototype.getTouchID=function(){return this._touchID};return c}();f.MouseStore=d})(wwa_input||(wwa_input={}));var wwa_util;
(function(f){f.$id=function(d){return document.getElementById(d)};f.$class=function(d){return document.getElementsByClassName(d)};f.$tag=function(d){return document.getElementsByTagName(d)};f.$qs=function(d){return document.querySelector(d)};f.$qsh=function(d){return document.querySelector(d)};f.$qsAll=function(d){return document.querySelectorAll(d)};f.$localPos=function(d,c){var h,l;h=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;l=window.pageYOffset||document.body.scrollTop||
document.documentElement.scrollTop;h=d-f.$id("wwa-wrapper").offsetLeft+h;l=c-f.$id("wwa-wrapper").offsetTop+l;return new wwa_data.Coord(h,l)};f.$escapedURI=function(d){return d.match(/^https?:\/\//)||d.match(/^\.\.\//)?d:location.href="./"+d}})(wwa_util||(wwa_util={}));var wwa_message;
(function(f){var d=function(){return function(a,b,g,c){this.message=a;this.isSystemMessage=b;this.isEndOfPartsEvent=g;this.macro=c;void 0===this.macro&&(this.macro=[])}}();f.MessageInfo=d;f.strArrayToMessageInfoArray=function(a,b){var g=[];a.forEach(function(a){g.push(new d(a,b))});return g};var c=function(){function a(b,a,c,d,f,h){this._wwa=b;this._triggerPartsID=a;this._triggerPartsType=c;this._triggerPartsPosition=d;this.macroType=f;this.macroArgs=h}a.prototype.execute=function(){try{1===this.macroType?
this._executeImgPlayerMacro():2===this.macroType?this._executeImgYesNoMacro():3===this.macroType?this._executeHPMaxMacro():4===this.macroType?this._executeSaveMacro():5===this.macroType?this._executeItemMacro():6===this.macroType?this._executeDefaultMacro():7===this.macroType?this._executeOldMapMacro():8===this.macroType?this._executePartsMacro():9===this.macroType?this._executeMoveMacro():10===this.macroType?this._executeMapMacro():11===this.macroType?this._executeDirMapMacro():12===this.macroType?
this._executeImgFrameMacro():13===this.macroType?this._executeImgBomMacro():14===this.macroType?this._executeDelPlayerMacro():15===this.macroType?this._executeFaceMacro():16===this.macroType?this._executeEffectMacro():17===this.macroType?this._executeGameOverMacro():18===this.macroType?this._executeImgClickMacro():19===this.macroType?this._executeStatusMacro():21===this.macroType?this._executeColorMacro():22===this.macroType?this._executeWaitMacro():23===this.macroType&&this._executeSoundMacro()}catch(b){}};
a.prototype._concatEmptyArgs=function(b){if(this.macroArgs.length<b){b=Array(b-this.macroArgs.length);for(var a=0;a<b.length;a++)b[a]="";this.macroArgs=this.macroArgs.concat(b)}};a.prototype._parseInt=function(b,a){void 0===a&&(a=0);var c=parseInt(this.macroArgs[b]);return isNaN(c)?a:c};a.prototype._executeImgPlayerMacro=function(){this._concatEmptyArgs(2);var b=this._parseInt(0),a=this._parseInt(1);this._wwa.setPlayerImgCoord(new wwa_data.Coord(b,a))};a.prototype._executeImgYesNoMacro=function(){this._concatEmptyArgs(2);
var b=this._parseInt(0),a=this._parseInt(1);this._wwa.setYesNoImgCoord(new wwa_data.Coord(b,a))};a.prototype._executeHPMaxMacro=function(){this._concatEmptyArgs(1);var b=Math.max(0,this._parseInt(0));this._wwa.setPlayerEnergyMax(b)};a.prototype._executeSaveMacro=function(){this._concatEmptyArgs(1);var b=!!this._parseInt(0);this._wwa.disableSave(b)};a.prototype._executeItemMacro=function(){this._concatEmptyArgs(2);var b=this._parseInt(0),a=this._parseInt(1);this._wwa.setPlayerGetItem(b,a)};a.prototype._executeDefaultMacro=
function(){this._concatEmptyArgs(1);var b=!!this._parseInt(0);this._wwa.setObjectNotCollapseOnPartsOnPlayer(b)};a.prototype._executeOldMapMacro=function(){this._concatEmptyArgs(1);var b=!!this._parseInt(0);this._wwa.setOldMap(b)};a.prototype._executePartsMacro=function(){this._concatEmptyArgs(4);var b=this._parseInt(0),a=this._parseInt(1),c=this._parseInt(2,0),d=this._parseInt(3);if(0!==c&&1!==c)throw Error("\u30d1\u30fc\u30c4\u7a2e\u5225\u304c\u4e0d\u660e\u3067\u3059");0!==d&&1!==d&&(d=1);if(0>b||
0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(0===c){if(b>=this._wwa.getObjectPartsNum()||a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(b>=this._wwa.getMapPartsNum()||a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.replaceParts(b,a,c,!!d)};a.prototype._executeMoveMacro=function(){this._concatEmptyArgs(1);var b=this._parseInt(0);
this._wwa.setMoveMacroWaitingToPlayer(b)};a.prototype._executeMapMacro=function(){this._concatEmptyArgs(4);var b=this._parseInt(0),a=this.macroArgs[1],c=this.macroArgs[2],d=this._parseInt(3,0);if(0>b)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(0===d){if(b>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(b>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
this._wwa.appearPartsEval(this._triggerPartsPosition,a,c,b,d)};a.prototype._executeDirMapMacro=function(){this._concatEmptyArgs(3);var b=this._parseInt(0),a=this._parseInt(1),c=this._parseInt(2,0);if(isNaN(b)||isNaN(a)||isNaN(c))throw Error("\u5f15\u6570\u304c\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(0>b)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(0===c){if(b>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
}else if(b>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.appearPartsByDirection(a,b,c)};a.prototype._executeImgFrameMacro=function(){this._concatEmptyArgs(3);var b=this._parseInt(0),a=this._parseInt(1),c=this._parseInt(2),d=a*wwa_data.WWAConsts.CHIP_SIZE,f=c*wwa_data.WWAConsts.CHIP_SIZE;if(0>a||0>c)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(0===b)wwa_util.$qsh("#disp-energy>.status-icon").style.backgroundPosition=
"-"+d+"px -"+f+"px";else if(1===b)wwa_util.$qsh("#disp-strength>.status-icon").style.backgroundPosition="-"+d+"px -"+f+"px";else if(2===b)wwa_util.$qsh("#disp-defence>.status-icon").style.backgroundPosition="-"+d+"px -"+f+"px";else if(3===b)wwa_util.$qsh("#disp-gold>.status-icon").style.backgroundPosition="-"+d+"px -"+f+"px";else if(4===b)Array.prototype.forEach.call(wwa_util.$qsAll("div.wide-cell-row"),function(b){b.style.backgroundPosition="-"+d+"px -"+f+"px"});else if(5===b)Array.prototype.forEach.call(wwa_util.$qsAll("div.item-cell"),
function(b){b.style.backgroundPosition="-"+d+"px -"+f+"px"});else if(6===b)this._wwa.setFrameCoord(new wwa_data.Coord(a,c));else throw Error("\u7a2e\u5225\u304c\u4e0d\u6b63\u3067\u3059\u3002");};a.prototype._executeImgBomMacro=function(){this._concatEmptyArgs(2);var b=this._parseInt(0),a=this._parseInt(1);if(0>b||0>a)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");this._wwa.setBattleEffectCoord(new wwa_data.Coord(b,a))};a.prototype._executeDelPlayerMacro=
function(){this._concatEmptyArgs(1);var b=parseInt(this.macroArgs[0]);this._wwa.setDelPlayer(!!b)};a.prototype._executeFaceMacro=function(){this._concatEmptyArgs(6);var b=this._parseInt(0),a=this._parseInt(1),c=this._parseInt(2),d=this._parseInt(3),f=this._parseInt(4),h=this._parseInt(5);if(0>b||0>a||0>c||0>d||0>f||0>h)throw Error("\u5404\u5f15\u6570\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");b=new wwa_data.Face(new wwa_data.Coord(b,a),
new wwa_data.Coord(c,d),new wwa_data.Coord(f,h));this._wwa.addFace(b)};a.prototype._executeEffectMacro=function(){this._concatEmptyArgs(1);var b=this._parseInt(0);if(0>b)throw Error("\u5f85\u3061\u6642\u9593\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");0===b&&this._wwa.stopEffect();for(var a=[],c=1;c<this.macroArgs.length;c+=2){var d=this._parseInt(c),f=0;if(0>d)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");
if(c+1===this.macroArgs.length)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u3067\u3001Y\u5ea7\u6a19\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");f=this._parseInt(c+1);if(0>f)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");a.push(new wwa_data.Coord(d,f))}this._wwa.setEffect(b,a)};a.prototype._executeGameOverMacro=function(){this._concatEmptyArgs(2);
var b=this._parseInt(0),a=this._parseInt(1);if(0>b||b>=this._wwa.getMapWidth()||0>a||a>=this._wwa.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");this._wwa.setGameOverPosition(new wwa_data.Coord(b,a))};a.prototype._executeImgClickMacro=function(){this._concatEmptyArgs(2);if(1>this.macroArgs.length)throw Error("\u5f15\u6570\u304c\u5c11\u306a\u3059\u304e\u307e\u3059");var b=this._parseInt(0),a=this._parseInt(1);if(0>b||0>
a)throw Error("\u5f15\u6570\u304c0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");this._wwa.setImgClick(new wwa_data.Coord(b,a))};a.prototype._executeStatusMacro=function(){this._concatEmptyArgs(2);var b=this._parseInt(0),a=this._parseInt(1);if(0>b||4<b)throw Error("\u30b9\u30c6\u30fc\u30bf\u30b9\u7a2e\u5225\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");this._wwa.setPlayerStatus(b,a)};a.prototype._executeColorMacro=function(){this._concatEmptyArgs(4);var b=this._parseInt(0),
a=this._parseInt(1),c=this._parseInt(2),d=this._parseInt(3);if(0>b||5<b)throw Error("\u7a2e\u5225\u306f0\u304b\u30895\u307e\u3067\u3067\u3059");if(0>a||255<a||0>c||255<c||0>d||255<d)throw Error("\u8272\u304c\u7bc4\u56f2\u5916\u3067\u3059");this._wwa.changeStyleRule(b,a,c,d)};a.prototype._executeWaitMacro=function(){throw Error("Not implemented!");};a.prototype._executeSoundMacro=function(){this._concatEmptyArgs(1);var b=parseInt(this.macroArgs[0]);this._wwa.playSound(b)};return a}();f.Macro=c;f.parseMacro=
function(a,b,g,d,f){f=f.match(/^\$([a-zA-Z_][a-zA-Z0-9_]*)\=(.*)$/);if(null===f||3!==f.length)throw Error("\u30de\u30af\u30ed\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var h=wwa_data.macrotable["$"+f[1].toLowerCase()];return void 0===h?new c(a,b,g,d,0,f[2].split(",")):new c(a,b,g,d,h,f[2].split(",").map(function(b){return b.trim()}))};var h=function(){function a(b,a,c,d,f,h,l){this._wwa=b;this._coord=a;this._width=c;this._height=d;this._isVisible=f;this._parentElement=h;this._element=document.createElement("div");
this._element.style.position="absolute";this._element.style.borderWidth="1px";this._element.style.borderStyle="solid";this._element.style.borderRadius="5px";this._element.classList.add("wwa-message-window");this._element.style.zIndex=l+"";this._element.style.opacity="0.9";this._element.style.left=this._coord.x+"px";this._element.style.top=this._coord.y+"px";this._element.style.width=this._width+"px";this._element.style.height=this._height+"px";this._parentElement.appendChild(this._element)}a.prototype.update=
function(b){};a.prototype.show=function(){this._isVisible=!0;this._element.style.display="block";this.update()};a.prototype.hide=function(){this._isVisible=!1;this._element.style.display="none";this.update()};a.prototype.isVisible=function(){return this._isVisible};return a}(),l=function(a){function b(b,c,d,f,h,l,x){a.call(this,b,new wwa_data.Coord(c.x,c.y),d,f,h,l,201);this._cgFileName=x;this._monsterBox=document.createElement("div");this._monsterBox.style.width=wwa_data.WWAConsts.CHIP_SIZE+"px";
this._monsterBox.style.height=wwa_data.WWAConsts.CHIP_SIZE+"px";this._monsterBox.style.position="absolute";this._monsterBox.style.left="10px";this._monsterBox.style.top="10px";this._monsterBox.style.backgroundImage="url("+this._cgFileName.replace("(","\\(").replace(")","\\)")+")";this._monsterBox.style.backgroundPosition="0 0";this._element.appendChild(this._monsterBox);this._energyBox=document.createElement("div");this._energyBox.style.position="absolute";this._energyBox.style.left="80px";this._energyBox.style.top=
"10px";this._energyBox.textContent="\u751f\u547d\u529b 0";this._element.appendChild(this._energyBox);this._strengthBox=document.createElement("div");this._strengthBox.style.position="absolute";this._strengthBox.style.left="80px";this._strengthBox.style.top="30px";this._strengthBox.textContent="\u653b\u6483\u529b 0";this._element.appendChild(this._strengthBox);this._defenceBox=document.createElement("div");this._defenceBox.style.position="absolute";this._defenceBox.style.left="180px";this._defenceBox.style.top=
"30px";this._defenceBox.textContent="\u9632\u5fa1\u529b 0";this._element.appendChild(this._defenceBox);this._element.style.display=this._isVisible?"block":"none"}__extends(b,a);b.prototype.update=function(b){void 0!==b&&(this._monsterBox.style.backgroundPosition="-"+b.imgCoord.x+"px -"+b.imgCoord.y+"px",this._energyBox.textContent="\u751f\u547d\u529b "+b.status.energy,this._strengthBox.textContent="\u653b\u6483\u529b "+b.status.strength,this._defenceBox.textContent="\u9632\u5fa1\u529b "+b.status.defence)};
return b}(h);f.MosterWindow=l;h=function(a){function b(b,c,d,f){a.call(this,b,new wwa_data.Coord(c.x,c.y),340,30,d,f,202);this._element.style.textAlign="center";this._element.style.display=this._isVisible?"block":"none";this.update(0)}__extends(b,a);b.prototype.update=function(b){void 0!==b&&(this._element.textContent="Score: "+b)};return b}(h);f.ScoreWindow=h;(function(a){a[a.TOP=0]="TOP";a[a.CENTER=1]="CENTER";a[a.BOTTOM=2]="BOTTOM";a[a.SCORE=3]="SCORE"})(f.Positioning||(f.Positioning={}));h=function(){function a(b,
a,c,d,f,h,l,x,p,q){var n=this,e=l.replace("(","\\(").replace(")","\\)");this._wwa=b;this._cgFileName=l;this._x=a;this._y=c;this._width=d;this._height=f;this._message=h;this._isVisible=x;this._isYesno=p;this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.borderWidth="1px";this._element.style.borderStyle="solid";this._element.style.borderRadius="5px";this._element.classList.add("wwa-message-window");this._element.style.zIndex="400";this._element.style.opacity=
"0.9";this._msgWrapperElement=document.createElement("div");this._msgWrapperElement.style.padding="5px";this._msgWrapperElement.style.margin="0";this._msgWrapperElement.style.textAlign="left";this._msgWrapperElement.style.wordWrap="break-word";this._element.appendChild(this._msgWrapperElement);this._dummyElement=document.createElement("div");this._dummyElement.style.display="none";this._dummyElement.style.padding="0";this._dummyElement.style.margin="0";this._dummyElement.style.height="55px";this._element.appendChild(this._dummyElement);
this._ynWrapperElement=document.createElement("div");this._ynWrapperElement.style.padding="0";this._ynWrapperElement.style.margin="0";this._ynWrapperElement.style.position="absolute";this._ynWrapperElement.style.left="246px";this._ynWrapperElement.style.bottom="10px";this._ynWrapperElement.style.width="80px";this._ynWrapperElement.style.height="40px";this._ynWrapperElement.style.zIndex="10";this._element.appendChild(this._ynWrapperElement);this._parentElement=q;this._parentElement.appendChild(this._element);
this._divYesElement=document.createElement("div");this._divYesElement.style.padding="0";this._divYesElement.style.margin="0";this._divYesElement.style.cssFloat="left";this._divYesElement.style.width="40px";this._divYesElement.style.height="40px";this._divYesElement.style.background="url("+e+")";this._divYesElement.onclick=function(){n._isInputDisable||(b.setYesNoInput(0),n.update())};this._divYesElement.style.cursor="pointer";this._divNoElement=document.createElement("div");this._divNoElement.style.padding=
"0";this._divNoElement.style.margin="0";this._divNoElement.style.cssFloat="left";this._divNoElement.style.width="40px";this._divNoElement.style.height="40px";this._divNoElement.style.background="url("+e+")";this._divNoElement.onclick=function(){n._isInputDisable||(b.setYesNoInput(1),n.update())};this._divNoElement.style.cursor="pointer";this._ynWrapperElement.appendChild(this._divYesElement);this._ynWrapperElement.appendChild(this._divNoElement);n._isInputDisable=!1;this.update()}a.prototype.setPosition=
function(b,a,c,d){this._x=b;this._y=a;this._width=c;this._height=d;this.update()};a.prototype.setPositionByPlayerPosition=function(b,a,c,d,f){d=d.getPartsCoord().substract(f.getPartsCoord()).y;b=b?2:a?3:c?1:d>=Math.ceil(wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW/2)?0:2;this.setPositionEasy(b)};a.prototype.setPositionEasy=function(b){var a=Math.floor(this._element.clientHeight/2);1===b?(this._y=wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/2-a,this.update()):0===b?(this._y=Math.max(20,wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/
4-a)+10,this.update()):2===b?(this._y=Math.min(wwa_data.WWAConsts.MAP_WINDOW_HEIGHT-20-this._element.clientHeight,3*wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/4-a),this.update()):3===b&&(this._y=80,this.update())};a.prototype.setMessage=function(b){this._message=b;this.update()};a.prototype.setYesNoChoice=function(b){this._isInputDisable=!1;this._isYesno=b;this.update();return this._isYesno};a.prototype.isYesNoChoice=function(){return this._isYesno};a.prototype.setInputDisable=function(){this._isInputDisable=
!0};a.prototype.isInputDisable=function(){return this._isInputDisable};a.prototype.show=function(){this._isVisible=!0;this.update()};a.prototype.hide=function(){this._isVisible=!1;this.update()};a.prototype.isVisible=function(){return this._isVisible};a.prototype.update=function(){var b=this._wwa.getYesNoImgCoord();this._isYesno?(0===this._wwa.getYesNoState()?(this._divYesElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YESP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+
"px",this._divNoElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):1===this._wwa.getYesNoState()?(this._divYesElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NOP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+
b.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):(this._divYesElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px"),this._ynWrapperElement.style.display="block"):this._ynWrapperElement.style.display="none";this._msgWrapperElement.textContent=
"";for(var b=this._message.split("\n"),a=0;a<b.length;a++){var c=document.createElement("span");c.textContent=b[a];this._msgWrapperElement.appendChild(c);this._msgWrapperElement.appendChild(document.createElement("br"))}this._isVisible?(this._element.style.left=this._x+"px",this._element.style.top=this._y+"px"):(this._element.style.left="-999999px",this._element.style.top="-999999px");this._element.style.width=this._width+"px";this._element.style.minHeight=this._height+"px";this._dummyElement.style.display=
this._isYesno?"block":"none"};return a}();f.MessageWindow=h})(wwa_message||(wwa_message={}));var postMessage_noWorker=function(f){},wwa_main;
(function(f){function d(b,a,q){var c=new wwa_data.LoaderProgress;c.current=b;c.total=a;c.stage=q;return c}function c(){void 0===window.wwap_mode&&(wwap_mode=!1);Array.prototype.forEach.call(m.$qsAll("a.wwa-copyright"),function(b){b.addEventListener("click",function(){w=!0})});window.addEventListener("beforeunload",function(b){if(w)return w=!1,b.returnValue="\u3053\u306e\u30da\u30fc\u30b8\u3092\u96e2\u308c\u307e\u3059\u304b\uff1f"});var a=wwap_mode?b.WWAP_SERVER+"/"+b.WWAP_SERVER_TITLE_IMG:m.$id("wwa-wrapper").getAttribute("data-wwa-title-img");
wwa_inject_html.inject(m.$id("wwa-wrapper"),null===a?"cover.gif":a);var a=m.$id("wwa-wrapper").getAttribute("data-wwa-mapdata"),p=m.$id("wwa-wrapper").getAttribute("data-wwa-loader"),q=!0;m.$id("wwa-wrapper").getAttribute("data-wwa-urlgate-enable").match(/^false$/i)&&(q=!1);new z(a,p,q)}var h=wwa_input.KeyStore,l=wwa_input.MouseStore,a=wwa_cgmanager.CGManager,b=wwa_data.WWAConsts,g=wwa_data.Coord,k=wwa_data.Position,r=wwa_camera.Camera,m=wwa_util;f.getProgress=d;var z=function(){function c(p,q,n){var e=
this;void 0===n&&(n=!1);try{m.$id("version").textContent="WWA Wing Ver."+b.VERSION_WWAJS}catch(f){}this._isURLGateEnable=n;this._animationCounter=this._mainCallCounter=0;this._statusPressCounter=new wwa_data.Status(0,0,0,0);var A=(new Date).getTime();location.href.match(/^file/)&&alert("\u3010\u8b66\u544a\u3011\u76f4\u63a5HTML\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u78ba\u8a8d\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u540c\u68b1\u306e\u300cWWA Debugger\u300d\u3092\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002");
if(void 0===window.audiojs)alert("Audio.js\u306e\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002audio\u30d5\u30a9\u30eb\u30c0\u306e\u4e2d\u306baudio.min.js\u306f\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3059\u304b\uff1f");else if(this._loadHandler=function(p){if(null!==p.data.error&&void 0!==p.data.error)alert("\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002: \n"+p.data.error.message);else if(null!==p.data.progress&&void 0!==p.data.progress)e._setProgressBar(p.data.progress);
else{e._wwaData=p.data.wwaData;e.initCSSRule();e._setProgressBar(d(0,4,7));p=new Image;p.src=e._wwaData.mapCGName;p.addEventListener("error",function(){alert("\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u300c"+e._wwaData.mapCGName+"\u300d\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u7ba1\u7406\u8005\u306e\u65b9\u3078: \u30c7\u30fc\u30bf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u304b\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002")});
e._restartData=JSON.parse(JSON.stringify(e._wwaData));var c=e._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(m.$qsAll("div.item-cell"),function(b){b.style.backgroundPosition="-40px -80px";b.style.backgroundImage="url("+c+")"});Array.prototype.forEach.call(m.$qsAll("div.wide-cell-row"),function(b){b.style.backgroundPosition="-160px -120px";b.style.backgroundImage="url("+c+")"});Array.prototype.forEach.call(m.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage=
"url('"+b.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0";a.style.display="none";a.style.cursor="pointer"});Array.prototype.forEach.call(m.$qsAll(".item-cell>.item-disp"),function(b){b.style.backgroundImage="url("+c+")"});p=m.$qsh("#disp-energy>.status-icon");p.style.backgroundPosition="-120px -80px";p.style.backgroundImage="url("+c+")";p=m.$qsh("#disp-strength>.status-icon");p.style.backgroundPosition="-160px -80px";p.style.backgroundImage="url("+c+")";p=m.$qsh("#disp-defence>.status-icon");
p.style.backgroundPosition="-200px -80px";p.style.backgroundImage="url("+c+")";p=m.$qsh("#disp-gold>.status-icon");p.style.backgroundPosition="-240px -80px";p.style.backgroundImage="url("+c+")";e._setProgressBar(d(1,4,7));e._replaceAllRandomObjects();p=(new Date).getTime();console.log("Loading Complete!"+(p-A)+"ms");e._cvs=m.$id("wwa-map");e._cvsSub=m.$id("wwa-map-sub");p=e._cvs.getContext("2d");var q=e._cvsSub.getContext("2d");p.fillStyle="rgba( 255, 255, 255, 0.5)";p.fillRect(0,0,440,440);var n=
new k(e,e._wwaData.playerX,e._wwaData.playerY);e._camera=new r(n);var f=new wwa_data.Status(e._wwaData.statusEnergy,e._wwaData.statusStrength,e._wwaData.statusDefence,e._wwaData.statusGold);e._player=new wwa_parts_player.Player(e,n,e._camera,f,e._wwaData.statusEnergyMax);e._objectMovingDataManager=new wwa_motion.ObjectMovingDataManager(e,e._player);e._camera.setPlayer(e._player);e._keyStore=new h;e._mouseStore=new l;e._messageQueue=[];e._yesNoJudge=2;e._yesNoJudgeInNextFrame=2;e._yesNoChoiceCallInfo=
0;e._prevFrameEventExected=!1;e._lastMessage=new wwa_message.MessageInfo("",!1,!1,[]);e._execMacroListInNextFrame=[];e._setProgressBar(d(2,4,7));window.addEventListener("keydown",function(b){e._keyStore.setPressInfo(b.keyCode);40!==b.keyCode&&37!==b.keyCode&&39!==b.keyCode&&38!==b.keyCode&&16!==b.keyCode&&13!==b.keyCode&&49!==b.keyCode&&50!==b.keyCode&&51!==b.keyCode&&65!==b.keyCode&&67!==b.keyCode&&68!==b.keyCode&&69!==b.keyCode&&77!==b.keyCode&&78!==b.keyCode&&81!==b.keyCode&&83!==b.keyCode&&87!==
b.keyCode&&88!==b.keyCode&&89!==b.keyCode&&90!==b.keyCode&&27!==b.keyCode&&112!==b.keyCode&&114!==b.keyCode&&115!==b.keyCode&&116!==b.keyCode&&117!==b.keyCode&&118!==b.keyCode&&119!==b.keyCode&&123!==b.keyCode&&32!==b.keyCode||b.preventDefault()});window.addEventListener("keyup",function(b){e._keyStore.setReleaseInfo(b.keyCode);40!==b.keyCode&&37!==b.keyCode&&39!==b.keyCode&&38!==b.keyCode&&16!==b.keyCode&&13!==b.keyCode&&49!==b.keyCode&&50!==b.keyCode&&51!==b.keyCode&&65!==b.keyCode&&67!==b.keyCode&&
68!==b.keyCode&&69!==b.keyCode&&77!==b.keyCode&&78!==b.keyCode&&81!==b.keyCode&&83!==b.keyCode&&87!==b.keyCode&&88!==b.keyCode&&89!==b.keyCode&&90!==b.keyCode&&27!==b.keyCode&&112!==b.keyCode&&114!==b.keyCode&&115!==b.keyCode&&116!==b.keyCode&&117!==b.keyCode&&118!==b.keyCode&&119!==b.keyCode&&123!==b.keyCode&&32!==b.keyCode||b.preventDefault()});window.addEventListener("blur",function(b){e._keyStore.allClear();e._mouseStore.clear()});window.addEventListener("contextmenu",function(b){e._keyStore.allClear();
e._mouseStore.clear()});window.addEventListener("help",function(b){b.preventDefault()});e._wwaWrapperElement=wwa_util.$id("wwa-wrapper");e._mouseControllerElement=wwa_util.$id("wwa-controller");e._mouseControllerElement.addEventListener("mousedown",function(b){if(1===b.which){if(0===e._mouseStore.getMouseState()){var a=wwa_util.$localPos(b.clientX,b.clientY),p=e._player.getDrawingCenterPosition(),a=a.substract(p),p=Math.abs(a.x),c=Math.abs(a.y),q;0<a.y&&c>p?q=2:0>a.y&&c>p?q=3:0<a.x&&c<p?q=1:0>a.x&&
c<p&&(q=0);e._mouseStore.setPressInfo(q)}b.preventDefault()}});e._mouseControllerElement.addEventListener("mouseleave",function(b){e._mouseStore.clear()});e._mouseControllerElement.addEventListener("mouseup",function(b){1===b.which&&(e._mouseStore.setReleaseInfo(),b.preventDefault())});window.TouchEvent&&(e._mouseControllerElement.addEventListener("touchstart",function(b){if(0!==e._mouseStore.getMouseState())b.preventDefault();else{var a=wwa_util.$localPos(b.changedTouches[0].clientX,b.changedTouches[0].clientY),
p=e._player.getDrawingCenterPosition(),a=a.substract(p),p=Math.abs(a.x),c=Math.abs(a.y),q;0<a.y&&c>p?q=2:0>a.y&&c>p?q=3:0<a.x&&c<p?q=1:0>a.x&&c<p&&(q=0);e._mouseStore.setPressInfo(q,b.changedTouches[0].identifier);b.cancelable&&b.preventDefault()}}),e._mouseControllerElement.addEventListener("touchend",function(b){for(var a=0;a<b.changedTouches.length;a++)if(e._mouseStore.getTouchID()===b.changedTouches[a].identifier){e._mouseStore.setReleaseInfo();b.preventDefault();break}}),e._mouseControllerElement.addEventListener("touchcancel",
function(b){for(var a=0;a<b.changedTouches.length;a++)if(e._mouseStore.getTouchID()===b.changedTouches[a].identifier){e._mouseStore.setReleaseInfo();b.preventDefault();break}}));m.$id("button-load").addEventListener("click",function(){if(e._player.isControllable())e.onselectbutton(0)});m.$id("button-save").addEventListener("click",function(){if(e._player.isControllable())e.onselectbutton(1)});m.$id("button-restart").addEventListener("click",function(){if(e._player.isControllable())e.onselectbutton(2)});
m.$id("button-gotowwa").addEventListener("click",function(){if(e._player.isControllable())e.onselectbutton(3)});Array.prototype.forEach.call(m.$qsAll(".wide-cell-row"),function(b){b.addEventListener("click",function(){e._displayHelp()})});e._frameCoord=new g(b.IMGPOS_DEFAULT_FRAME_X,b.IMGPOS_DEFAULT_YESNO_Y);e._battleEffectCoord=new g(b.IMGPOS_DEFAULT_BATTLE_EFFECT_X,b.IMGPOS_DEFAULT_BATTLE_EFFECT_Y);e._battleEstimateWindow=new wwa_estimate_battle.BattleEstimateWindow(e,e._wwaData.mapCGName,wwa_util.$id("wwa-wrapper"));
e._messageWindow=new wwa_message.MessageWindow(e,50,180,340,0,"",e._wwaData.mapCGName,!1,!0,m.$id("wwa-wrapper"));e._monsterWindow=new wwa_message.MosterWindow(e,new g(50,180),340,60,!1,m.$id("wwa-wrapper"),e._wwaData.mapCGName);e._scoreWindow=new wwa_message.ScoreWindow(e,new g(50,50),!1,m.$id("wwa-wrapper"));e._setProgressBar(d(3,4,7));e._isLoadedSound=!1;e._temporaryInputDisable=!1;e._paintSkipByDoorOpen=!1;e._clearFacesInNextFrame=!1;e._useConsole=!1;e.clearFaces();e._cgManager=new a(p,q,e._wwaData.mapCGName,
function(){if("ON"===e._wwaData.systemMessage[2])e._isLoadedSound=!0,e.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n(iOS, Android\u7aef\u672b\u3067\u306f\u97f3\u697d\u306f\u518d\u751f\u3055\u308c\u307e\u305b\u3093\u3002)",!1,!0),e.loadSound(),setTimeout(e.soundCheckCaller,b.DEFAULT_FRAME_INTERVAL,e);else if("OFF"===e._wwaData.systemMessage[2])e._isLoadedSound=!1,e.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002",
!1,!0),e.openGameWindow();else{e._messageWindow.setMessage((""===e._wwaData.systemMessage[2]?"\u52b9\u679c\u97f3\u30fb\uff22\uff27\uff2d\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u304b\uff1f":e._wwaData.systemMessage[2])+"\n(iOS, Android\u7aef\u672b\u3067\u306f\u97f3\u697d\u306f\u518d\u751f\u3055\u308c\u307e\u305b\u3093\u3002)");e._messageWindow.show();e._setProgressBar(d(4,4,7));var a=setInterval(function(){e._keyStore.update();if(2===e._yesNoJudgeInNextFrame)if(1===e._keyStore.getKeyState(13)||
1===e._keyStore.getKeyState(89))e._yesNoJudgeInNextFrame=0;else if(1===e._keyStore.getKeyState(78)||1===e._keyStore.getKeyState(27))e._yesNoJudgeInNextFrame=1;0===e._yesNoJudgeInNextFrame?(clearInterval(a),e._messageWindow.update(),e._yesNoJudge=e._yesNoJudgeInNextFrame,e._messageWindow.setInputDisable(),setTimeout(function(){e._messageWindow.update();setTimeout(function(){e._messageWindow.hide();e._yesNoJudge=2;e._yesNoJudgeInNextFrame=2;e._isLoadedSound=!0;e.loadSound();setTimeout(e.soundCheckCaller,
b.DEFAULT_FRAME_INTERVAL,e)},b.YESNO_PRESS_DISP_FRAME_NUM*b.DEFAULT_FRAME_INTERVAL)},b.DEFAULT_FRAME_INTERVAL)):1===e._yesNoJudgeInNextFrame&&(clearInterval(a),e._messageWindow.update(),e._yesNoJudge=e._yesNoJudgeInNextFrame,e._messageWindow.setInputDisable(),setTimeout(function(){e._messageWindow.update();setTimeout(function(){e._messageWindow.hide();e._yesNoJudge=2;e._yesNoJudgeInNextFrame=2;e._isLoadedSound=!1;e.openGameWindow()},b.YESNO_PRESS_DISP_FRAME_NUM*b.DEFAULT_FRAME_INTERVAL)},b.DEFAULT_FRAME_INTERVAL))},
b.DEFAULT_FRAME_INTERVAL)}})}},wwap_mode||void 0===Worker){if(external_script_inject_mode){if(q=document.getElementById("wwaloader-ex"),!q.src.match(/^http:\/\/wwawing\.com/)&&!q.src.match(/^http:\/\/www\.wwawing\.com/))throw Error("SCRIPT ORIGIN ERROR");}else q=document.createElement("script"),q.src=wwap_mode?b.WWAP_SERVER+"/"+b.WWAP_SERVER_LOADER_NO_WORKER:"wwaload.noworker.js",document.getElementsByTagName("head")[0].appendChild(q);var C=this;postMessage_noWorker=function(b){C._loadHandler(b)};
try{loader_start({data:{fileName:p+"?date="+A}})}catch(D){alert(D.message),q.onload=function(){loader_start({data:{fileName:p+"?date="+A}})}}}else try{var B=new Worker(q+"?date="+A);B.postMessage({fileName:p+"?date="+A});B.addEventListener("message",this._loadHandler)}catch(E){alert("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u30ed\u30fc\u30c9\u6642\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002:\nWebWorker\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"+
E.message)}}c.prototype._setProgressBar=function(a){a.stage<=b.LOAD_STAGE_MAX_EXCEPT_AUDIO?(wwa_util.$id("progress-message-container").textContent=a.stage===b.LOAD_STAGE_MAX_EXCEPT_AUDIO?"World Name: "+this._wwaData.worldName:wwa_data.loadMessages[a.stage],wwa_util.$id("progress-bar").style.width=(1*a.stage+a.current/a.total*1)/(b.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*b.MAP_WINDOW_WIDTH+"px",wwa_util.$id("progress-disp").textContent=((1*a.stage+a.current/a.total*1)/(b.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*100).toFixed(2)+
"%"):(wwa_util.$id("progress-message-container").textContent="\u52b9\u679c\u97f3/BGM\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002(\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u30b9\u30ad\u30c3\u30d7\uff09",wwa_util.$id("progress-bar-audio").style.width=a.current*b.MAP_WINDOW_WIDTH/a.total+"px",wwa_util.$id("progress-disp").textContent=(a.current/a.total*100).toFixed(2)+"%")};c.prototype.createAudioJSInstance=function(a,c){if(0!==a&&void 0===this._audioJSInstances[a]&&99!==a){var n=wwap_mode?
b.WWAP_SERVER+"/"+b.WWAP_SERVER_AUDIO_DIR+"/"+a+".mp3":"./audio/"+a+".mp3",e=new Audio(n);e.preload="auto";70<=a&&(e.loop=!0);m.$id("wwa-audio-wrapper").appendChild(e);this._audioJSInstances[a]=audiojs.create(e);70>a&&(n=new Audio(n),n.preload="auto",m.$id("wwa-audio-wrapper").appendChild(n),this._audioJSInstancesSub[a]=audiojs.create(n))}};c.prototype.loadSound=function(){this._audioJSInstances=Array(b.SOUND_MAX+1);this._audioJSInstancesSub=Array(b.SOUND_MAX+1);this.createAudioJSInstance(1);this.createAudioJSInstance(3);
for(var a=1;a<this._wwaData.mapPartsMax;a++){var c=this._wwaData.mapAttribute[a][b.ATR_SOUND];this.createAudioJSInstance(c)}for(a=1;a<this._wwaData.objPartsMax;a++)this._wwaData.objectAttribute[a][b.ATR_TYPE]!==b.OBJECT_RANDOM&&(c=this._wwaData.objectAttribute[a][b.ATR_SOUND],this.createAudioJSInstance(c));this._wwaData.bgm=0;this._soundLoadSkipFlag=!1};c.prototype.checkAllSoundLoaded=function(){var a=0,c=0;this._keyStore.update();1===this._keyStore.getKeyState(32)&&(this._soundLoadSkipFlag=!0);for(var n=
1;n<=b.SOUND_MAX;n++)void 0===this._audioJSInstances[n]||this._audioJSInstances[n].wrapper.classList.contains("error")||(c++,this._audioJSInstances[n].wrapper.classList.contains("loading")||a++);a<c&&!this._soundLoadSkipFlag?(this._setProgressBar(d(a,c,8)),setTimeout(this.soundCheckCaller,b.DEFAULT_FRAME_INTERVAL,this)):(this._setProgressBar(d(b.SOUND_MAX,b.SOUND_MAX,8)),this.openGameWindow())};c.prototype.playSound=function(a){var c=this;if(this._isLoadedSound){if(0>a||a>b.SOUND_MAX)throw Error("\u30b5\u30a6\u30f3\u30c9\u756a\u53f7\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");
if(!(70<=a&&this._wwaData.bgm===a)&&((99===a||70<=a)&&0!==this._wwaData.bgm&&(this._audioJSInstances[this._wwaData.bgm].wrapper.classList.contains("loading")||this._audioJSInstances[this._wwaData.bgm].pause(),this._wwaData.bgm=0),0!==a&&99!==a))if(this._audioJSInstances[a].wrapper.classList.contains("loading")){if(70<=a){var n=function(b,a){var p=setInterval(function(){a._wwaData.bgm===b?a._audioJSInstances[b].wrapper.classList.contains("loading")||(c._audioJSInstances[b].skipTo(0),c._audioJSInstances[b].play(),
c._wwaData.bgm=b,clearInterval(p)):(clearInterval(p),99!==a._wwaData.bgm&&n(a._wwaData.bgm,a))},4)};n(a,this)}this._wwaData.bgm=a}else 0===a||this._audioJSInstances[a].wrapper.classList.contains("error")||(70<=a?(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._wwaData.bgm=a):this._nextSoundIsSub?(this._audioJSInstancesSub[a].skipTo(0),this._audioJSInstancesSub[a].play(),this._nextSoundIsSub=!1):(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._nextSoundIsSub=
!0))}};c.prototype.openGameWindow=function(){var a=this,c=this._player.getPosition();m.$id("wwa-cover").style.opacity="0";0!==this.getObjectIdByPosition(c)&&this._player.setPartsAppearedFlag();setTimeout(function(){m.$id("wwa-wrapper").removeChild(m.$id("wwa-cover"));a._main()},b.SPLASH_SCREEN_DISP_MILLS)};c.prototype.mainCaller=function(b){b._main()};c.prototype.soundCheckCaller=function(b){b.checkAllSoundLoaded()};c.prototype.onselectitem=function(a){if(this._player.canUseItem(a))if(wwa_util.$id("item"+
(a-1)).classList.add("onpress"),this.playSound(1),"BLANK"===this._wwaData.message[8]){this._player.readyToUseItem(a);a=this._player.useItem();var c=this.getObjectAttributeById(a,b.ATR_STRING);this.setMessageQueue(this.getMessageById(c),!1,!1,a,0,this._player.getPosition().getPartsCoord())}else this.setMessageQueue(""===this._wwaData.message[8]?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b?":this._wwaData.message[8],!0,!0),
this._yesNoChoiceCallInfo=3,this._yesNoUseItemPos=a};c.prototype.onselectbutton=function(b){var a=wwa_util.$id(wwa_data.sidebarButtonCellElementID[b]);this.playSound(1);a.classList.add("onpress");0===b?void 0!==this._quickSaveData?(this.setMessageQueue("\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u304b\uff1f\n\u203b\u30d1\u30b9\u30ef\u30fc\u30c9\u30ed\u30fc\u30c9\u306f\u3001\u73fe\u5728\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002",!0,!0),this._yesNoChoiceCallInfo=
5):this.setMessageQueue("\u30bb\u30fc\u30d6\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u203b\u30d1\u30b9\u30ef\u30fc\u30c9\u30ed\u30fc\u30c9\u306f\u3001\u73fe\u5728\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002",!1,!0):1===b?this._wwaData.disableSaveFlag?this.setMessageQueue("\u3053\u3053\u3067\u306f\u30bb\u30fc\u30d6\u6a5f\u80fd\u306f\n\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002",!1,!0):(this.setMessageQueue("\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\u3092\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n\u203b\u30d1\u30b9\u30ef\u30fc\u30c9\u30bb\u30fc\u30d6\u306f\u3001\u73fe\u5728\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002",
!0,!0),this._yesNoChoiceCallInfo=4):2===b?(this.setMessageQueue("\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3057\u306a\u304a\u3057\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=6):3===b&&(this.setMessageQueue("\uff37\uff37\uff21\u306e\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u958b\u304d\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=7)};c.prototype.onchangespeed=function(a){a=0===a?this._player.speedUp():this._player.speedDown();this.setMessageQueue("\u79fb\u52d5\u901f\u5ea6\u3092\u3010"+
wwa_data.speedNameList[a]+"\u3011\u306b\u5207\u308a\u66ff\u3048\u307e\u3057\u305f\u3002\n"+(a===b.MAX_SPEED_INDEX?"\u6226\u95d8\u3082\u901f\u304f\u306a\u308a\u307e\u3059\u3002\n":"")+"("+(b.MAX_SPEED_INDEX+1)+"\u6bb5\u968e\u4e2d"+(a+1)+"\uff09 \u901f\u5ea6\u3092\u843d\u3068\u3059\u306b\u306fI\u30ad\u30fc, \u901f\u5ea6\u3092\u4e0a\u3052\u308b\u306b\u306fP\u30ad\u30fc\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002",!1,!0)};c.prototype._main=function(){var a=this;this._temporaryInputDisable=!1;
this._waitTimeInCurrentFrame=b.DEFAULT_FRAME_INTERVAL;this._stopUpdateByLoadFlag=!1;this._keyStore.update();this._mouseStore.update();void 0!==this._yesNoJudgeInNextFrame&&(this._yesNoJudge=this._yesNoJudgeInNextFrame,this._yesNoJudgeInNextFrame=void 0);this._clearFacesInNextFrame&&(this.clearFaces(),this._clearFacesInNextFrame=!1);for(var c=0;c<this._execMacroListInNextFrame.length;c++)this._execMacroListInNextFrame[c].execute();""===this._lastMessage.message&&this._lastMessage.isEndOfPartsEvent&&
void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);this._execMacroListInNextFrame=[];this._player.getPosition();c=this._player.getDir();if(this._player.isControllable()){if(1===this._keyStore.getKeyStateForControllPlayer(37)||1===this._mouseStore.getMouseStateForControllPlayer(0))this._player.controll(0),this._objectMovingDataManager.update();else if(1===this._keyStore.getKeyStateForControllPlayer(38)||1===this._mouseStore.getMouseStateForControllPlayer(3))this._player.controll(3),
this._objectMovingDataManager.update();else if(1===this._keyStore.getKeyStateForControllPlayer(39)||1===this._mouseStore.getMouseStateForControllPlayer(1))this._player.controll(1),this._objectMovingDataManager.update();else if(1===this._keyStore.getKeyStateForControllPlayer(40)||1===this._mouseStore.getMouseStateForControllPlayer(2))this._player.controll(2),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(wwa_data.dirToKey[c]))this._player.controll(c),this._objectMovingDataManager.update();
else if(this._keyStore.checkHitKey(37)||this._mouseStore.checkClickMouse(0))this._player.controll(0),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(38)||this._mouseStore.checkClickMouse(3))this._player.controll(3),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(39)||this._mouseStore.checkClickMouse(1))this._player.controll(1),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(40)||this._mouseStore.checkClickMouse(2))this._player.controll(2),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(37)||this._mouseStore.checkClickMouse(0))this._player.controll(0),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(38)||this._mouseStore.checkClickMouse(3))this._player.controll(3),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(39)||this._mouseStore.checkClickMouse(1))this._player.controll(1),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(40)||this._mouseStore.checkClickMouse(2))this._player.controll(2),
this._objectMovingDataManager.update();else if(1===this._keyStore.getKeyState(49))this.onselectitem(1);else if(1===this._keyStore.getKeyState(50))this.onselectitem(2);else if(1===this._keyStore.getKeyState(51))this.onselectitem(3);else if(1===this._keyStore.getKeyState(81))this.onselectitem(4);else if(1===this._keyStore.getKeyState(87))this.onselectitem(5);else if(1===this._keyStore.getKeyState(69))this.onselectitem(6);else if(1===this._keyStore.getKeyState(65))this.onselectitem(7);else if(1===this._keyStore.getKeyState(83))this.onselectitem(8);
else if(1===this._keyStore.getKeyState(68))this.onselectitem(9);else if(1===this._keyStore.getKeyState(90))this.onselectitem(10);else if(1===this._keyStore.getKeyState(88))this.onselectitem(11);else if(1===this._keyStore.getKeyState(67))this.onselectitem(12);else if(this._keyStore.getKeyState(73))this.onchangespeed(1);else if(this._keyStore.checkHitKey(80))this.onchangespeed(0);else if(1===this._keyStore.getKeyState(112)||1===this._keyStore.getKeyState(77))this.launchBattleEstimateWindow();else if(!this._keyStore.checkHitKey(114)&&
!this._keyStore.checkHitKey(115))if(this._keyStore.checkHitKey(116))this.onselectbutton(0);else if(this._keyStore.checkHitKey(117))this.onselectbutton(1);else if(this._keyStore.checkHitKey(118))this.onselectbutton(2);else if(this._keyStore.checkHitKey(119))this.onselectbutton(3);else this._keyStore.checkHitKey(123)&&this._displayHelp();this._keyStore.memorizeKeyStateOnControllableFrame();this._mouseStore.memorizeMouseStateOnControllableFrame()}else if(this._player.isJumped())this._camera.isResetting()||
this._player.processAfterJump();else if(this._player.isMoving())this._player.move(),this._objectMovingDataManager.update();else if(this._player.isWaitingMessage())if(this._messageWindow.isVisible()||this._messageWindow.show(),!this._messageWindow.isYesNoChoice()){var c=this._keyStore.getKeyStateForMessageCheck(13),n=this._keyStore.getKeyStateForMessageCheck(32),e=this._keyStore.getKeyStateForMessageCheck(27);if(1===c||4===c||1===n||4===n||1===e||4===e||1===this._mouseStore.getMouseState()){for(c=
0;c<wwa_data.sidebarButtonCellElementID.length;c++)n=wwa_util.$id(wwa_data.sidebarButtonCellElementID[c]),n.classList.contains("onpress")&&n.classList.remove("onpress");this._setNextMessage()}}else{if(!this._messageWindow.isInputDisable()){if(2===this._yesNoJudge)if(1===this._keyStore.getKeyState(13)||1===this._keyStore.getKeyState(89))this._yesNoJudge=0;else if(1===this._keyStore.getKeyState(78)||1===this._keyStore.getKeyState(27))this._yesNoJudge=1;0===this._yesNoJudge?(this.playSound(1),this._yesNoDispCounter=
b.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update()):1===this._yesNoJudge&&(this.playSound(1),this._yesNoDispCounter=b.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update())}}else this._player.isWatingEstimateWindow()?1!==this._keyStore.getKeyState(13)&&1!==this._keyStore.getKeyState(32)||this.hideBattleEstimateWindow():this._player.isFighting()?(this._player.fight(),this._monsterWindow.update(this._monster)):this._player.isWaitingMoveMacro()&&
(this._player.isMoveObjectAutoExecTime()&&(this.moveObjects(!1),this._player.resetMoveObjectAutoExecTimer()),this._objectMovingDataManager.update());this._prevFrameEventExected=!1;this._player.getPosition().isJustPosition()&&this._camera.getPosition().isScreenTopPosition()&&(this._player.isJumped()||this._player.isWaitingMessage()||this._player.isWaitingMoveMacro()||this._player.isFighting()||(this._player.isPartsAppearedTime()&&this._player.clearPartsAppearedFlag(),this._replaceRandomObjectsInScreen(),
(c=this.checkMap())||this.checkObject(),this._prevFrameEventExected=c),this._player.isWaitingMessage()&&this._messageWindow.isYesNoChoice()&&2!==this._yesNoJudge&&!this._player.isWaitingMoveMacro()&&!this._player.isFighting()&&this._execChoiceWindowRunningEvent());this._drawAll();this._mainCallCounter++;this._mainCallCounter%=1E9;this._animationCounter=(this._animationCounter+1)%(2*b.ANIMATION_REP_HALF_FRAME);this._camera.isResetting()&&this._camera.advanceTransitionStepNum();this._player.isWaitingMessage()||
(this._player.decrementLookingAroundTimer(),0<this._statusPressCounter.energy&&0===--this._statusPressCounter.energy&&wwa_util.$id("disp-energy").classList.remove("onpress"),0<this._statusPressCounter.strength&&0===--this._statusPressCounter.strength&&wwa_util.$id("disp-strength").classList.remove("onpress"),0<this._statusPressCounter.defence&&0===--this._statusPressCounter.defence&&wwa_util.$id("disp-defence").classList.remove("onpress"),0<this._statusPressCounter.gold&&0===--this._statusPressCounter.gold&&
wwa_util.$id("disp-gold").classList.remove("onpress"));this._player.isWaitingMoveMacro()&&this._player.decrementMoveObjectAutoExecTimer();this._stopUpdateByLoadFlag?this._fadeout(function(){0===a._loadType?a._quickLoad():1===a._loadType&&a._restartGame();setTimeout(a.mainCaller,a._waitTimeInCurrentFrame,a)}):setTimeout(this.mainCaller,this._waitTimeInCurrentFrame,this)};c.prototype._drawAll=function(){var a=this._camera.getPosition().getPartsCoord(),c=this._camera.getPosition().getOffsetCoord(),n=
b.MAP_WINDOW_HEIGHT,e;e=this._player.getPosition().getPartsCoord();if(this._paintSkipByDoorOpen)this._paintSkipByDoorOpen=!1;else{this._cgManager.clearCanvas(0,0,b.MAP_WINDOW_WIDTH,b.MAP_WINDOW_HEIGHT);this._cgManager.drawBase(0,0,b.MAP_WINDOW_WIDTH,b.MAP_WINDOW_HEIGHT);if(this._camera.isResetting()){if(null!==this._camera.getPreviousPosition())var g=this._camera.getPreviousPosition().getPartsCoord(),d=this._camera.getPreviousPosition().getOffsetCoord();n=this._camera.getTransitionStepNum()*b.CHIP_SIZE;
this._drawMap(g,d,n,!0);this._drawPlayer(g,d,n,!0);this._drawObjects(g,d,n,!0);if(this._camera.isFinalStep())var f=255,k=setInterval(function(){var a=wwa_util.$id("wwa-fader");f-=3*b.FADEOUT_SPEED;0>=f?(clearInterval(k),a.style.backgroundColor="transparent",a.removeAttribute("style"),a.style.display="none"):a.style.opacity=f/255+""},20)}this._drawMap(a,c,n);this._drawPlayer(a,c,n);this._drawObjects(a,c,n);this._player.isFighting()&&!this._player.isBattleStartFrame()&&(n=this._player.isTurn()?this._monster.position.x:
e.x,e=this._player.isTurn()?this._monster.position.y:e.y,this._cgManager.drawCanvas(this._battleEffectCoord.x,this._battleEffectCoord.y,b.CHIP_SIZE*(n-a.x)-c.x,b.CHIP_SIZE*(e-a.y)-c.y,!1));this._drawEffect();this._drawFaces();this._drawFrame()}};c.prototype._drawMap=function(a,c,n,e){void 0===e&&(e=!1);if(void 0!==a)for(var g=Math.max(0,a.x-1),d=Math.min(this._wwaData.mapWidth-1,a.x+b.H_PARTS_NUM_IN_WINDOW),f=Math.max(0,a.y-1),k=Math.min(this._wwaData.mapWidth-1,a.y+b.V_PARTS_NUM_IN_WINDOW);g<=d;g++)for(var h=
f;h<=k;h++){var l=this._wwaData.map[h][g],m=this._wwaData.mapAttribute[l][b.ATR_X]/b.CHIP_SIZE,l=this._wwaData.mapAttribute[l][b.ATR_Y]/b.CHIP_SIZE,r=b.CHIP_SIZE*(g-a.x)-c.x,u=b.CHIP_SIZE*(h-a.y)-c.y;e?this._cgManager.drawCanvasWithLowerYLimit(m,l,r,u,n):this._cgManager.drawCanvasWithUpperYLimit(m,l,r,u,n)}};c.prototype._drawPlayer=function(a,c,n,e){void 0===e&&(e=!1);if(void 0!==a&&!this._wwaData.delPlayerFlag){var g=this._player.getPosition().getPartsCoord(),d=this._player.getPosition().getOffsetCoord(),
f=wwa_data.dirToPos[this._player.getDir()],k=(g.x-a.x)*b.CHIP_SIZE+d.x-c.x;a=(g.y-a.y)*b.CHIP_SIZE+d.y-c.y;Math.abs(d.x);Math.abs(d.y);c=this._player.getDir();g=[2,3,4,5,0,1,6,7];d=this._player.isLookingAround()&&!this._player.isWaitingMessage()?this._wwaData.playerImgPosX+g[Math.floor(this._mainCallCounter%64/8)]:(0===c||1===c)&&Math.abs(d.x)>Math.floor(b.CHIP_SIZE/2)||(3===c||2===c)&&Math.abs(d.y)>Math.floor(b.CHIP_SIZE/2)?this._wwaData.playerImgPosX+f+1:this._wwaData.playerImgPosX+f;e?this._cgManager.drawCanvasWithLowerYLimit(d,
this._wwaData.playerImgPosY,k,a,n):this._cgManager.drawCanvasWithUpperYLimit(d,this._wwaData.playerImgPosY,k,a,n)}};c.prototype._drawObjects=function(a,c,n,e){void 0===e&&(e=!1);if(void 0!==a)for(var d=Math.max(0,a.x-1),f=Math.min(this._wwaData.mapWidth-1,a.x+b.H_PARTS_NUM_IN_WINDOW),k=Math.max(0,a.y-1),h=Math.min(this._wwaData.mapWidth-1,a.y+b.V_PARTS_NUM_IN_WINDOW),l;d<=f;d++)for(var m=k;m<=h;m++)if(!(this._player.isFighting()&&this._player.isTurn()&&this._player.getPosition().getPartsCoord().equals(this._monster.position)&&
(new wwa_data.Coord(d,m)).equals(this._monster.position))){var r=this._wwaData.mapObject[m][d];l=new g(0,0);if(0!==this._wwaData.objectAttribute[r][b.ATR_MOVE]){var t=this._objectMovingDataManager.getOffsetByBeforePartsCoord(new g(d,m));null!==t&&(l=t)}var u=this._animationCounter>b.ANIMATION_REP_HALF_FRAME||0===this._wwaData.objectAttribute[r][b.ATR_X2]&&0===this._wwaData.objectAttribute[r][b.ATR_Y2],t=this._wwaData.objectAttribute[r][u?b.ATR_X:b.ATR_X2]/b.CHIP_SIZE,u=this._wwaData.objectAttribute[r][u?
b.ATR_Y:b.ATR_Y2]/b.CHIP_SIZE,z=b.CHIP_SIZE*(d-a.x)+l.x-c.x;l=b.CHIP_SIZE*(m-a.y)+l.y-c.y;var w=this._wwaData.objectAttribute[r][b.ATR_TYPE],y=this._wwaData.objectAttribute[r][b.ATR_NUMBER];0===r||this._checkNoDrawObject(new g(d,m),w,y)||(e?this._cgManager.drawCanvasWithLowerYLimit(t,u,z,l,n):this._cgManager.drawCanvasWithUpperYLimit(t,u,z,l,n))}};c.prototype._drawEffect=function(){if(0!==this._wwaData.effectCoords.length)for(var a=Math.floor(this._mainCallCounter%(this._wwaData.effectCoords.length*
this._wwaData.effectWaits)/this._wwaData.effectWaits),c=0;c<b.V_PARTS_NUM_IN_WINDOW;c++)for(var n=0;n<b.H_PARTS_NUM_IN_WINDOW;n++)this._cgManager.drawCanvas(this._wwaData.effectCoords[a].x,this._wwaData.effectCoords[a].y,n*b.CHIP_SIZE,c*b.CHIP_SIZE,!1)};c.prototype._drawFaces=function(){for(var b=0;b<this._faces.length;b++)this._cgManager.drawCanvasWithSize(this._faces[b].srcPos.x,this._faces[b].srcPos.y,this._faces[b].srcSize.x,this._faces[b].srcSize.y,this._faces[b].destPos.x,this._faces[b].destPos.y,
!1)};c.prototype._drawFrame=function(){this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y,0,0,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y,b.MAP_WINDOW_WIDTH-b.CHIP_SIZE,0,!1);this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+2,0,b.MAP_WINDOW_HEIGHT-b.CHIP_SIZE,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+2,b.MAP_WINDOW_WIDTH-b.CHIP_SIZE,b.MAP_WINDOW_HEIGHT-b.CHIP_SIZE,!1);for(var a=1;a<b.H_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x+
1,this._frameCoord.y,b.CHIP_SIZE*a,0,!1),this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y+2,b.CHIP_SIZE*a,b.MAP_WINDOW_HEIGHT-b.CHIP_SIZE,!1);for(a=1;a<b.V_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+1,0,b.CHIP_SIZE*a,!1),this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+1,b.MAP_WINDOW_WIDTH-b.CHIP_SIZE,b.CHIP_SIZE*a,!1)};c.prototype._checkNoDrawObject=function(a,c,n){var e=this._player.getPosition(),g=e.getPartsCoord();
return!e.isJustPosition()||g.x!==a.x||g.y!==a.y||this._wwaData.objectNoCollapseDefaultFlag?!1:c===b.OBJECT_DOOR&&0===n?!0:c===b.OBJECT_STATUS||c===b.OBJECT_MESSAGE||c===b.OBJECT_ITEM||c===b.OBJECT_SELL||c===b.OBJECT_BUY||c===b.OBJECT_SELL||c===b.OBJECT_LOCALGATE};c.prototype.getMapWidth=function(){if(void 0===this._wwaData)throw Error("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093");return this._wwaData.mapWidth};c.prototype.getMapIdByPosition=
function(b){b=b.getPartsCoord();return this._wwaData.map[b.y][b.x]};c.prototype.getObjectIdByPosition=function(b){b=b.getPartsCoord();return this._wwaData.mapObject[b.y][b.x]};c.prototype.getMapTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[a.y][a.x]][b.ATR_TYPE]};c.prototype.getObjectTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[a.y][a.x]][b.ATR_TYPE]};c.prototype.getMapAttributeByPosition=
function(b,a){var c=b.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[c.y][c.x]][a]};c.prototype.isCurrentPosMapPartsIncludingMessage=function(a){return 0!==this.getMapAttributeByPosition(a,b.ATR_STRING)};c.prototype.getObjectAttributeByPosition=function(b,a){var c=b.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[c.y][c.x]][a]};c.prototype.getMapAttributeById=function(b,a){return this._wwaData.mapAttribute[b][a]};c.prototype.getObjectAttributeById=
function(b,a){return this._wwaData.objectAttribute[b][a]};c.prototype.getObjectCropXById=function(a){return this._wwaData.objectAttribute[a][b.ATR_X]};c.prototype.getObjectCropYById=function(a){return this._wwaData.objectAttribute[a][b.ATR_Y]};c.prototype.getMessageById=function(a){return this._wwaData.message[a]};c.prototype.getSystemMessageById=function(a){return this._wwaData.systemMessage[a]};c.prototype.checkMap=function(a){var c=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==
a?a:c;var n=this._wwaData.map[a.y][a.x],e=this._wwaData.mapAttribute[n][b.ATR_TYPE],c=a.x===c.x&&a.y===c.y,g=!1;if(c&&this._player.getLastExecPartsIDOnSamePosition(1)===n)return!1;e===b.MAP_STREET?g=this._execMapStreetEvent(a,n,e):e===b.MAP_WALL?g=this._execMapWallEvent(a,n,e):e===b.MAP_LOCALGATE?g=this._execMapLocalGateEvent(a,n,e):e===b.MAP_URLGATE&&(g=this._execMapUrlGateEvent(a,n,e));c&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(1,n);return g};c.prototype.checkObject=
function(a){var c=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==a?a:c;var g=this._wwaData.mapObject[a.y][a.x],e=this._wwaData.objectAttribute[g][b.ATR_TYPE],c=a.x===c.x&&a.y===c.y;c&&this._player.getLastExecPartsIDOnSamePosition(0)===g||(e===b.OBJECT_NORMAL?this._execObjectNormalEvent(a,g,e):e===b.OBJECT_MESSAGE?this._execObjectMessageEvent(a,g,e):e===b.OBJECT_MONSTER?this._execObjectMonsterEvent(a,g,e):e===b.OBJECT_ITEM?this._execObjectItemEvent(a,g,e):e===b.OBJECT_DOOR?this._execObjectDoorEvent(a,
g,e):e===b.OBJECT_STATUS?this._execObjectStatusEvent(a,g,e):e===b.OBJECT_BUY?this._execObjectBuyEvent(a,g,e):e===b.OBJECT_SELL?this._execObjectSellEvent(a,g,e):e===b.OBJECT_URLGATE?this._execObjectUrlGateEvent(a,g,e):e===b.OBJECT_SCORE?this._execObjectScoreEvent(a,g,e):e===b.OBJECT_SELECT?this._execObjectYesNoChoiceEvent(a,g,e):e===b.OBJECT_LOCALGATE&&this._execObjectLocalGateEvent(a,g,e),c&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(0,g))};c.prototype._execMapStreetEvent=
function(a,c,g){g=this._wwaData.mapAttribute[c][b.ATR_ITEM];if(0!==g&&!this._player.hasItem(g))return!1;this.appearParts(a,0);g=this._wwaData.mapAttribute[c][b.ATR_STRING];var e=this._wwaData.message[g];this._waitTimeInCurrentFrame+=100*this._wwaData.mapAttribute[c][b.ATR_NUMBER];this._temporaryInputDisable=!0;a=this.setMessageQueue(e,!1,!1,c,1,a.clone());this.playSound(this._wwaData.mapAttribute[c][b.ATR_SOUND]);return 0!==g&&a};c.prototype._execMapWallEvent=function(a,c,g){g=this.getObjectIdByPosition(a.convertIntoPosition(this));
var e=this.getObjectAttributeById(g,b.ATR_TYPE);0!==g&&e!==b.OBJECT_NORMAL&&(e!==b.OBJECT_DOOR||this._player.hasItem(this.getObjectAttributeById(g,b.ATR_ITEM))&&this.getObjectAttributeById(e,b.ATR_MODE)!==b.PASSABLE_OBJECT)||(this.appearParts(a,0),this.setMessageQueue(this._wwaData.message[this._wwaData.mapAttribute[c][b.ATR_STRING]],!1,!1,c,1,a.clone()),this.playSound(this._wwaData.mapAttribute[c][b.ATR_SOUND]));return!1};c.prototype._execMapLocalGateEvent=function(a,c,g){g=this._player.getPosition().getPartsCoord();
var e=this._wwaData.mapAttribute[c][b.ATR_JUMP_X],d=this._wwaData.mapAttribute[c][b.ATR_JUMP_Y];e>b.RELATIVE_COORD_LOWER&&(e=a.x+e-b.RELATIVE_COORD_BIAS);d>b.RELATIVE_COORD_LOWER&&(d=a.y+d-b.RELATIVE_COORD_BIAS);this.appearParts(a,0);return 0<=e&&0<=d&&e<this._wwaData.mapWidth&&d<this._wwaData.mapWidth&&(e!==g.x||d!==g.y)?(this._player.jumpTo(new k(this,e,d,0,0)),this.playSound(this._wwaData.mapAttribute[c][b.ATR_SOUND]),!0):!1};c.prototype._execMapUrlGateEvent=function(a,c,g){g=this._wwaData.mapAttribute[c][b.ATR_STRING];
if(!this._isURLGateEnable)return!0;if("BLANK"===this._wwaData.message[5])location.href=wwa_util.$escapedURI(this._wwaData.message[g].split(/\s/g)[0]);else return this.setMessageQueue(""===this._wwaData.message[5]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[5],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=c,this._yesNoChoiceCallInfo=1,this._yesNoURL=this._wwaData.message[g].split(/\s/g)[0],
!0};c.prototype._execObjectNormalEvent=function(a,b,c){};c.prototype._execObjectMessageEvent=function(a,c,g){g=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];var e=this._player.getPosition().getPartsCoord(),d=this._wwaData.objectAttribute[c][b.ATR_SOUND];a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(g,!1,!1,c,0,a);this._waitTimeInCurrentFrame+=100*this._wwaData.objectAttribute[c][b.ATR_NUMBER];this._temporaryInputDisable=
!0;this.appearParts(a,1,c);this.playSound(d)};c.prototype._execObjectStatusEvent=function(a,c,g){g=new wwa_data.Status(this._wwaData.objectAttribute[c][b.ATR_ENERGY],this._wwaData.objectAttribute[c][b.ATR_STRENGTH],this._wwaData.objectAttribute[c][b.ATR_DEFENCE],this._wwaData.objectAttribute[c][b.ATR_GOLD]);var e=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]],d=this._player.getStatusWithoutEquipments();g.strength>b.STATUS_MINUS_BORDER&&d.strength<g.strength-b.STATUS_MINUS_BORDER||
g.defence>b.STATUS_MINUS_BORDER&&d.defence<g.defence-b.STATUS_MINUS_BORDER||g.gold>b.STATUS_MINUS_BORDER&&d.gold<g.gold-b.STATUS_MINUS_BORDER?this._wwaData.mapObject[a.y][a.x]=0:(g.energy=g.energy>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-g.energy:g.energy,g.strength=g.strength>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-g.strength:g.strength,g.defence=g.defence>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-g.defence:g.defence,g.gold=g.gold>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-g.gold:g.gold,
this._player.addStatusAll(g),this.setStatusChangedEffect(g),this._player.isDead()&&0!==this._wwaData.objectAttribute[c][b.ATR_ENERGY]?this.gameover():(this.setMessageQueue(e,!1,!1,c,0,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,1,c),this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])))};c.prototype._execObjectMonsterEvent=function(a,c,g){var e=this;g=new wwa_data.Coord(this._wwaData.objectAttribute[c][b.ATR_X],this._wwaData.objectAttribute[c][b.ATR_Y]);var d=new wwa_data.Status(this._wwaData.objectAttribute[c][b.ATR_ENERGY],
this._wwaData.objectAttribute[c][b.ATR_STRENGTH],this._wwaData.objectAttribute[c][b.ATR_DEFENCE],this._wwaData.objectAttribute[c][b.ATR_GOLD]);this._monster=new wwa_monster.Monster(c,a,g,d,this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]],this._wwaData.objectAttribute[c][b.ATR_ITEM],function(){e._monsterWindow.hide()});this._player.startBattleWith(this._monster)};c.prototype._execObjectBuyEvent=function(a,c,g){g=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];
var e=this._player.getPosition().getPartsCoord();a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(g,!0,!1,c,0,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=c;this._yesNoChoiceCallInfo=2;this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};c.prototype._execObjectSellEvent=function(a,c,g){g=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];var e=this._player.getPosition().getPartsCoord();
a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(g,!0,!1,c,0,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=c;this._yesNoChoiceCallInfo=2;this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};c.prototype._execObjectItemEvent=function(a,c,g){g=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];try{this._player.addItem(c,this._wwaData.objectAttribute[c][b.ATR_NUMBER]),this._wwaData.mapObject[a.y][a.x]=
0,0===this._wwaData.objectAttribute[c][b.ATR_MODE]&&(this.setMessageQueue(g,!1,!1,c,0,a.clone()),this.appearParts(a,1,c))}catch(e){"BLANK"!==this._wwaData.systemMessage[1]&&this.setMessageQueue(""===this._wwaData.systemMessage[1]?"\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002":this._wwaData.systemMessage[1],!1,!0)}this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};c.prototype._execObjectDoorEvent=function(a,c,g){g=this._wwaData.objectAttribute[c][b.ATR_ITEM];
var e=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];this._player.hasItem(g)&&(0===this._wwaData.objectAttribute[c][b.ATR_MODE]&&this._player.removeItemByPartsID(g),this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND]),this.setMessageQueue(e,!1,!1,c,0,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,1,c),this._paintSkipByDoorOpen=!0)};c.prototype._execObjectYesNoChoiceEvent=function(a,c,g){g=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];
var e=this._player.getPosition().getPartsCoord();a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(g,!0,!1,c,0,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=c;this._yesNoChoiceCallInfo=2;this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};c.prototype._execObjectLocalGateEvent=function(a,c,g){g=this._player.getPosition().getPartsCoord();a.x!==g.x||a.y!==g.y||this._wwaData.objectNoCollapseDefaultFlag||
(this._wwaData.mapObject[a.y][a.x]=0);var e=this._wwaData.objectAttribute[c][b.ATR_JUMP_X],d=this._wwaData.objectAttribute[c][b.ATR_JUMP_Y];e>b.RELATIVE_COORD_LOWER&&(e=g.x+e-b.RELATIVE_COORD_BIAS);d>b.RELATIVE_COORD_LOWER&&(d=g.y+d-b.RELATIVE_COORD_BIAS);this.appearParts(a,1,c);0<=e&&0<=d&&e<this._wwaData.mapWidth&&d<this._wwaData.mapWidth&&(e!==g.x||d!==g.y)&&(this._player.jumpTo(new k(this,e,d,0,0)),this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND]))};c.prototype._execObjectUrlGateEvent=
function(a,c,g){g=this._wwaData.objectAttribute[c][b.ATR_STRING];this._isURLGateEnable&&("BLANK"===this._wwaData.message[5]?location.href=wwa_util.$escapedURI(this._wwaData.message[g].split(/\s/g)[0]):(this.setMessageQueue(""===this._wwaData.message[5]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[5],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=c,this._yesNoChoiceCallInfo=2,
this._yesNoURL=this._wwaData.message[g].split(/\s/g)[0]))};c.prototype._execObjectScoreEvent=function(a,c,g){a=this._wwaData.objectAttribute[c][b.ATR_STRING];this._player.getPosition().getPartsCoord();g=this._player.getStatus();var e;e=0+this._wwaData.objectAttribute[c][b.ATR_ENERGY]*g.energy;e+=this._wwaData.objectAttribute[c][b.ATR_STRENGTH]*g.strength;e+=this._wwaData.objectAttribute[c][b.ATR_DEFENCE]*g.defence;e+=this._wwaData.objectAttribute[c][b.ATR_GOLD]*g.gold;this._scoreWindow.update(e);
this._scoreWindow.show();this.setMessageQueue(0===a?"\u30b9\u30b3\u30a2\u3092\u8868\u793a\u3057\u307e\u3059\u3002":this._wwaData.message[a],!1,!1);this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};c.prototype._execChoiceWindowRunningEvent=function(){var a;if(0===--this._yesNoDispCounter)if(0===this._yesNoJudge){if(1===this._yesNoChoiceCallInfo)a=this._wwaData.mapAttribute[this._yesNoChoicePartsID][b.ATR_TYPE],a===b.MAP_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else if(2===
this._yesNoChoiceCallInfo)if(a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_TYPE],a===b.OBJECT_BUY)this._player.hasItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ITEM])?(this._player.removeItemByPartsID(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ITEM]),a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_GOLD],this._player.earnGold(a),this.setStatusChangedEffect(new wwa_data.Status(0,0,0,a)),this.appearParts(this._yesNoChoicePartsCoord,
1,this._yesNoChoicePartsID)):"BLANK"!==this._wwaData.message[7]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[7]?"\u30a2\u30a4\u30c6\u30e0\u3092\u3082\u3063\u3066\u3044\u306a\u3044\u3002":this._wwaData.message[7],!0));else if(a===b.OBJECT_SELL)if(this._player.hasGold(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_GOLD]))if(this._player.canHaveMoreItems()){this._player.addItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ITEM]);a=new wwa_data.Status(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ENERGY],
this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_STRENGTH],this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_DEFENCE],-this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_GOLD]);this._player.getStatusWithoutEquipments();a.energy=a.energy>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-a.energy:a.energy;this.setStatusChangedEffect(a);this._player.addStatusAll(a);if(this._player.isDead()&&0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ENERGY]){this.gameover();
return}this.appearParts(this._yesNoChoicePartsCoord,1,this._yesNoChoicePartsID)}else this._messageQueue.push(new wwa_message.MessageInfo("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002",!0));else"BLANK"!==this._wwaData.message[6]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[6]?"\u6240\u6301\u91d1\u304c\u8db3\u308a\u306a\u3044\u3002":this._wwaData.message[6],!0));else a===b.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,
2,this._yesNoChoicePartsID):a===b.OBJECT_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else 3===this._yesNoChoiceCallInfo?this._player.readyToUseItem(this._yesNoUseItemPos):5===this._yesNoChoiceCallInfo?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[0]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=0):4===this._yesNoChoiceCallInfo?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[1]).classList.remove("onpress"),this._quickSave()):6===this._yesNoChoiceCallInfo?
(wwa_util.$id(wwa_data.sidebarButtonCellElementID[2]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=1):7===this._yesNoChoiceCallInfo&&(location.href=wwa_util.$escapedURI(b.WWA_HOME),wwa_util.$id(wwa_data.sidebarButtonCellElementID[3]).classList.remove("onpress"));this._yesNoJudge=2;this._setNextMessage();this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0;this._yesNoChoiceCallInfo=0;this._messageWindow.setYesNoChoice(!1)}else 1===this._yesNoJudge&&
(1!==this._yesNoChoiceCallInfo&&(2===this._yesNoChoiceCallInfo?(a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_TYPE],a!==b.OBJECT_BUY&&a!==b.OBJECT_SELL&&a===b.OBJECT_SELECT&&this.appearParts(this._yesNoChoicePartsCoord,3,this._yesNoChoicePartsID)):3===this._yesNoChoiceCallInfo?wwa_util.$id("item"+(this._yesNoUseItemPos-1)).classList.remove("onpress"):5===this._yesNoChoiceCallInfo?wwa_util.$id(wwa_data.sidebarButtonCellElementID[0]).classList.remove("onpress"):4===this._yesNoChoiceCallInfo?
wwa_util.$id(wwa_data.sidebarButtonCellElementID[1]).classList.remove("onpress"):6===this._yesNoChoiceCallInfo?wwa_util.$id(wwa_data.sidebarButtonCellElementID[2]).classList.remove("onpress"):7===this._yesNoChoiceCallInfo&&wwa_util.$id(wwa_data.sidebarButtonCellElementID[3]).classList.remove("onpress")),this._yesNoJudge=2,this._setNextMessage(),this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0,this._yesNoChoiceCallInfo=0,this._messageWindow.setYesNoChoice(!1))};c.prototype.setMessageQueue=
function(a,b,c,e,d,f,k){void 0===e&&(e=0);void 0===d&&(d=0);void 0===f&&(f=new g(0,0));void 0===k&&(k=!1);this._messageQueue=this._messageQueue.concat(this.getMessageQueueByRawMessage(a,e,d,f));this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);if(0!==this._messageQueue.length){a=this._messageQueue.shift();for(e=0;e<a.macro.length;e++)this._execMacroListInNextFrame.push(a.macro[e]);
this._lastMessage=a;if(""!==a.message)return this._messageWindow.setMessage(a.message),this._messageWindow.setYesNoChoice(b),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),c,this._player.getPosition(),this._camera.getPosition()),this._player.setMessageWaiting(),!0;0===this._messageQueue.length?this._hideMessageWindow(k):this._setNextMessage()}return!1};c.prototype.getMessageQueueByRawMessage=function(a,b,c,g,d){void 0===d&&(d=!1);var f=a.split(/\<c\>/i)[0].replace(/\<p\>\n/ig,
"<P>");a=[];if(""!==f)for(var f=f.split(/\<p\>/ig),k=0;k<f.length;k++){for(var h=f[k].split("\n"),l=[],m=[],r=0;r<h.length;r++){var t=h[r].match(/(\$(?:[a-zA-Z_][a-zA-Z0-9_]*)\=(?:.*))/);null!==t&&2<=t.length?(t=wwa_message.parseMacro(this,b,c,g,t[1]),m.push(t)):h[r].match(/^\$/)||l.push(h[r])}a.push(new wwa_message.MessageInfo(l.join("\n"),d,k===f.length-1,m))}return a};c.prototype.appearParts=function(a,c,d){void 0===d&&(d=0);var e=3===c?b.APPERANCE_PARTS_MIN_INDEX_NO:b.APPERANCE_PARTS_MIN_INDEX,
f=2===c?b.APPERANCE_PARTS_MAX_INDEX_YES:b.APPERANCE_PARTS_MAX_INDEX,k,h,l,m;0===c?(d=0===d?this._wwaData.map[a.y][a.x]:d,c=1):(d=0===d?this._wwaData.mapObject[a.y][a.x]:d,c=0);for(;e<=f;e++)if(h=b.ATR_APPERANCE_BASE+e*b.REL_ATR_APPERANCE_UNIT_LENGTH,k=h+b.REL_ATR_APPERANCE_ID,l=h+b.REL_ATR_APPERANCE_X,m=h+b.REL_ATR_APPERANCE_Y,h+=b.REL_ATR_APPERANCE_TYPE,k=1===c?this._wwaData.mapAttribute[d][k]:this._wwaData.objectAttribute[d][k],h=1===c?this._wwaData.mapAttribute[d][h]:this._wwaData.objectAttribute[d][h],
l=1===c?this._wwaData.mapAttribute[d][l]:this._wwaData.objectAttribute[d][l],m=1===c?this._wwaData.mapAttribute[d][m]:this._wwaData.objectAttribute[d][m],l===b.PLAYER_COORD?(l=this._player.getPosition().getPartsCoord().x,this._player.resetEventExecutionInfo()):l>b.RELATIVE_COORD_LOWER&&(l=a.x+l-b.RELATIVE_COORD_BIAS),m===b.PLAYER_COORD?(m=this._player.getPosition().getPartsCoord().y,this._player.resetEventExecutionInfo()):m>b.RELATIVE_COORD_LOWER&&(m=a.y+m-b.RELATIVE_COORD_BIAS),0!==l||0!==m)try{if(new wwa_data.Position(this,
l,m,0,0),1===h){if(k>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[m][l]=k}else{if(k>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[m][l]=k;this._replaceRandomObject(new g(l,m));l===this._player.getPosition().getPartsCoord().x&&m===this._player.getPosition().getPartsCoord().y&&
this._player.setPartsAppearedFlag()}}catch(r){}};c.prototype.appearPartsByDirection=function(a,b,c){var g=this._player.getPosition().getPartsCoord(),d=this._player.getDir(),f=wwa_data.vx[d],d=wwa_data.vy[d];this.appearPartsEval(g,(0<=f?"+":"-")+Math.abs(f)*a,(0<=d?"+":"-")+Math.abs(d)*a,b,c)};c.prototype.appearPartsEval=function(a,b,c,e,d){var f=this._player.getPosition().getPartsCoord();if("P"===b||"p"===b)b=f.x;else if("+"===b[0])b=a.x+parseInt(b.substr(1));else if("-"===b[0])b=a.x-parseInt(b.substr(1));
else if(b=parseInt(b),isNaN(b))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");if("P"===c||"p"===c)a=f.y;else if("+"===c[0])a=a.y+parseInt(c.substr(1));else if("-"===c[0])a=a.y-parseInt(c.substr(1));else if(a=parseInt(c),isNaN(a))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");try{if(new wwa_data.Position(this,
b,a,0,0),1===d){if(e>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[a][b]=e}else{if(e>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[a][b]=e;this._replaceRandomObject(new g(b,a));b===this._player.getPosition().getPartsCoord().x&&a===this._player.getPosition().getPartsCoord().y&&
this._player.setPartsAppearedFlag()}}catch(k){}};c.prototype._replaceRandomObject=function(a){var c=this._wwaData.mapObject[a.y][a.x],g;if(this._wwaData.objectAttribute[c][b.ATR_TYPE]===b.OBJECT_RANDOM){for(var e=0;e<b.RANDOM_ITERATION_MAX;e++){g=Math.floor(10*Math.random());g=this._wwaData.objectAttribute[c][b.ATR_RANDOM_BASE+g];if(g>=this._wwaData.objPartsMax){g=0;break}if(this._wwaData.objectAttribute[g][b.ATR_TYPE]!==b.OBJECT_RANDOM)break;c=g}this._wwaData.mapObject[a.y][a.x]=g}};c.prototype._replaceRandomObjectsInScreen=
function(){for(var a=this._camera.getPosition().getPartsCoord(),c=Math.max(0,a.x-1),d=Math.min(this._wwaData.mapWidth-1,a.x+b.H_PARTS_NUM_IN_WINDOW),e=Math.max(0,a.y-1),a=Math.min(this._wwaData.mapWidth-1,a.y+b.V_PARTS_NUM_IN_WINDOW);c<=d;c++)for(var f=e;f<a;f++)this._replaceRandomObject(new g(c,f))};c.prototype._replaceAllRandomObjects=function(){for(var a=0;a<this._wwaData.mapWidth;a++)for(var b=0;b<this._wwaData.mapWidth;b++)this._replaceRandomObject(new g(a,b))};c.prototype.gameover=function(){var a=
this._wwaData.gameoverX,c=this._wwaData.gameoverY;this._waitTimeInCurrentFrame=b.GAMEOVER_FRAME_INTERVAL;this._temporaryInputDisable=!0;this._player.jumpTo(new k(this,a,c,0,0))};c.prototype.setYesNoInput=function(a){this._yesNoJudgeInNextFrame=a};c.prototype.getYesNoState=function(){return void 0!==this._yesNoJudgeInNextFrame?this._yesNoJudgeInNextFrame:this._yesNoJudge};c.prototype.setStatusChangedEffect=function(a){0!==a.strength&&(wwa_util.$id("disp-strength").classList.add("onpress"),this._statusPressCounter.strength=
b.STATUS_CHANGED_EFFECT_FRAME_NUM);0!==a.defence&&(wwa_util.$id("disp-defence").classList.add("onpress"),this._statusPressCounter.defence=b.STATUS_CHANGED_EFFECT_FRAME_NUM);a instanceof wwa_data.Status&&(0!==a.energy&&(wwa_util.$id("disp-energy").classList.add("onpress"),this._statusPressCounter.energy=b.STATUS_CHANGED_EFFECT_FRAME_NUM),0!==a.gold&&(wwa_util.$id("disp-gold").classList.add("onpress"),this._statusPressCounter.gold=b.STATUS_CHANGED_EFFECT_FRAME_NUM))};c.prototype.setPartsOnPosition=
function(a,b,c){1===a?(b>=this._wwaData.mapPartsMax&&(this._wwaData.map[c.y][c.x]=0),this._wwaData.map[c.y][c.x]=b):(b>=this._wwaData.objPartsMax&&(this._wwaData.mapObject[c.y][c.x]=0),this._wwaData.mapObject[c.y][c.x]=b)};c.prototype._quickSave=function(){var a=JSON.parse(JSON.stringify(this._wwaData)),b=this._player.getPosition().getPartsCoord(),c=this._player.getStatusWithoutEquipments();a.itemBox=this._player.getCopyOfItemBox();a.playerX=b.x;a.playerY=b.y;a.statusEnergyMax=this._player.getEnergyMax();
a.statusEnergy=c.energy;a.statusStrength=c.strength;a.statusDefence=c.defence;a.statusGold=c.gold;a.moves=this._player.getMoveCount();this._quickSaveData=a};c.prototype._quickLoad=function(a){void 0===a&&(a=!1);if(!a&&void 0===this._quickSaveData)throw Error("\u30bb\u30fc\u30d6\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002");a=JSON.parse(JSON.stringify(a?this._restartData:this._quickSaveData));this._player.setEnergyMax(a.statusEnergyMax);this._player.setEnergy(a.statusEnergy);this._player.setStrength(a.statusStrength);
this._player.setDefence(a.statusDefence);this._player.setGold(a.statusGold);this._player.setMoveCount(a.moves);this._player.clearItemBox();for(var b=0;b<a.itemBox.length;b++)this._player.addItem(a.itemBox[b],b+1,!0);this._player.systemJumpTo(new wwa_data.Position(this,a.playerX,a.playerY,0,0));0===a.bgm?this.playSound(99):this.playSound(a.bgm);this.setImgClick(new g(a.imgClickX,a.imgClickY));0!==this.getObjectIdByPosition(this._player.getPosition())&&this._player.setPartsAppearedFlag();this._wwaData=
a;this.updateCSSRule()};c.prototype._restartGame=function(){this._quickLoad(!0)};c.prototype._fadeout=function(a){var c=0,g=b.MAP_WINDOW_WIDTH,e=b.FADEOUT_SPEED,d=wwa_util.$id("wwa-fader");d.style.display="block";var f=setInterval(function(){c+=e;g-=2*e;0>=g||2*c>b.MAP_WINDOW_WIDTH?(d.removeAttribute("style"),d.style.display="block",d.style.borderWidth="0",d.style.width=b.MAP_WINDOW_WIDTH+"px",d.style.height=b.MAP_WINDOW_HEIGHT+"px",d.style.backgroundColor="#808080",clearInterval(f),a()):(d.style.width=
g+"px",d.style.height=g+"px",d.style.borderWidth=c+"px")},20)};c.prototype.moveObjects=function(a){var c=this._camera.getPosition();this._player.getPosition();c.getPartsCoord();var d=c.getPartsCoord().x,c=c.getPartsCoord().y,e,f,h;if(this.getMapAttributeByPosition(this._player.getPosition(),b.ATR_TYPE)!==b.MAP_LOCALGATE&&this.getObjectAttributeByPosition(this._player.getPosition(),b.ATR_TYPE)!==b.OBJECT_LOCALGATE){e=Array(b.V_PARTS_NUM_IN_WINDOW+2);this.hoge=Array(b.V_PARTS_NUM_IN_WINDOW+2);for(h=
-1;h<=b.V_PARTS_NUM_IN_WINDOW;h++)for(e[h+1]=Array(b.H_PARTS_NUM_IN_WINDOW+2),this.hoge[h+1]=Array(b.H_PARTS_NUM_IN_WINDOW+2),f=-1;f<=b.H_PARTS_NUM_IN_WINDOW;f++)if(0>c+h||c+h>=this._wwaData.mapWidth||0>d+f||d+f>=this._wwaData.mapWidth)e[h+1][f+1]=0,this.hoge[h+1][f+1]=0;else{try{var l=new k(this,d+f,c+h,0,0),m=l.getPartsCoord()}catch(r){e[h+1][f+1]=0;this.hoge[h+1][f+1]=0;continue}e[h+1][f+1]=this._wwaData.mapObject[m.y][m.x];this.hoge[h+1][f+1]=-this._wwaData.mapObject[m.y][m.x]}for(f=-1;f<=b.H_PARTS_NUM_IN_WINDOW;f++)if(!(0>
d+f||d+f>=this._wwaData.mapWidth))for(h=-1;h<=b.V_PARTS_NUM_IN_WINDOW;h++)if(!(0>c+h||c+h>=this._wwaData.mapWidth)){try{l=new k(this,d+f,c+h,0,0),m=l.getPartsCoord()}catch(z){continue}var v=this._wwaData.mapObject[m.y][m.x];if(0!==v&&0!==this._wwaData.objectAttribute[v][b.ATR_MOVE]&&this._wwaData.objectAttribute[v][b.ATR_TYPE]!==b.OBJECT_LOCALGATE){var t=this._wwaData.objectAttribute[v][b.ATR_MOVE];if(3!==t){var u=this._getCandidateCoord(a,l,t),w=new g(u.x,m.y),x=new g(m.x,u.y),y=null;this._objectCanMoveTo(a,
u,e)?this._setObjectsInNextFrame(m,u,d,c,e,v):(y=this._getSecondCandidateMoveMode(a,m,u,w,x,this._wwaData.objectAttribute[v][b.ATR_TYPE]===b.OBJECT_MONSTER,e),0===y?this._setObjectsInNextFrame(m,w,d,c,e,v):1===y?this._setObjectsInNextFrame(m,x,d,c,e,v):(y=this._getThirdCandidate(a,l,u,t,e),null!==y?this._setObjectsInNextFrame(m,y,d,c,e,v):(t=this._getRandomMoveCoord(a,l,e),this._setObjectsInNextFrame(m,t,d,c,e,v))))}else t=this._getRandomMoveCoord(a,l,e),this._setObjectsInNextFrame(m,t,d,c,e,v)}}}};
c.prototype._getCandidateCoord=function(a,b,c){b=b.getPartsCoord();this._player.getPosition().getOffsetCoord();this._player.getPosition().getPartsCoord();try{var g=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord()}catch(d){throw Error("\u4e88\u671f\u305b\u306c\u65b9\u5411\u3078\u306e\u79fb\u52d5\u306e\u3088\u3046\u3067\u3059\u3002");}a=b.clone();var f=0,k=0;1===c?(f=b.x>g.x?1:b.x<g.x?-1:0,k=b.y>g.y?1:b.y<g.y?-1:0):2===c&&(f=b.x>g.x?-1:b.x<
g.x?1:0,k=b.y>g.y?-1:b.y<g.y?1:0);a.x-=f;a.y-=k;a.x=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.x));a.y=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.y));return a};c.prototype._getSecondCandidateMoveMode=function(a,b,c,g,d,f,k){return!a||(3!==this._player.getDir()&&2!==this._player.getDir()||!f)&&(0!==this._player.getDir()&&1!==this._player.getDir()||f)?this._objectCanMoveTo(a,g,k)?0:this._objectCanMoveTo(a,d,k)?1:2:this._objectCanMoveTo(a,d,k)?1:this._objectCanMoveTo(a,g,k)?0:2};c.prototype._getThirdCandidate=
function(a,b,c,d,f){d=1===d?1:2===d?-1:0;var k=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord();b=b.getPartsCoord();var h;if(k.x!==b.x){h=new g(c.x,b.y+1*d);if(this._objectCanMoveTo(a,h,f))return h;h=new g(c.x,b.y-1*d);if(this._objectCanMoveTo(a,h,f))return h;h=new g(b.x,b.y+1*d);if(this._objectCanMoveTo(a,h,f))return h;h=new g(b.x,b.y-1*d);if(this._objectCanMoveTo(a,h,f))return h}if(k.y!==b.y){h=new g(b.x+1*d,c.y);if(this._objectCanMoveTo(a,
h,f))return h;h=new g(b.x-1*d,c.y);if(this._objectCanMoveTo(a,h,f))return h;h=new g(b.x+1*d,b.y);if(this._objectCanMoveTo(a,h,f))return h;h=new g(b.x-1*d,b.y);if(this._objectCanMoveTo(a,h,f))return h}return null};c.prototype._getRandomMoveCoord=function(a,c,g){c=c.getPartsCoord();for(var d=c.clone(),f=0;f<b.RANDOM_MOVE_ITERATION_NUM;f++){var k=Math.floor(8*Math.random());d.x=c.x+wwa_data.vx[k];d.y=c.y+wwa_data.vy[k];if(this._objectCanMoveTo(a,d,g))return d}return c};c.prototype.isPrevFrameEventExecuted=
function(){return this._prevFrameEventExected};c.prototype._objectCanMoveTo=function(a,c,g){if(0>c.x||0>c.y||this._wwaData.mapWidth<=c.x||this._wwaData.mapWidth<=c.y)return!1;var d=this._wwaData.map[c.y][c.x],f=this._wwaData.mapObject[c.y][c.x],k=this._wwaData.mapAttribute[d][b.ATR_TYPE],h=this._camera.getPosition(),l=h.getPartsCoord().x,h=h.getPartsCoord().y;if(0===d&&!this.isOldMap()||k===b.MAP_WALL)return!1;d=c.x-l+1;k=c.y-h+1;if(0<=d&&0<=k&&d<g.length&&k<g.length){if(0!==g[k][d])return!1}else if(0!==
f)return!1;if(a){if(this._player.getPosition().getNextJustPosition().getPartsCoord().equals(c))return!1}else if(this._player.getPosition().getPartsCoord().equals(c))return!1;return!0};c.prototype._setObjectsInNextFrame=function(a,b,c,g,d,f){var k=b.x-c+1,h=b.y-g+1;0<=b.x&&b.x<=this._wwaData.mapWidth&&0<=b.y&&b.y<=this._wwaData.mapWidth&&(0<=k&&k<d.length&&0<=h&&h<d.length&&(d[a.y-g+1][a.x-c+1]=0,d[b.y-g+1][b.x-c+1]=f,this.hoge[b.y-g+1][b.x-c+1]=f),this._objectMovingDataManager.add(f,a.convertIntoPosition(this),
b.convertIntoPosition(this),a.getDirectionTo(b)))};c.prototype.launchBattleEstimateWindow=function(){var a=this._camera.getPosition().getPartsCoord(),c=Math.max(0,a.x),g=Math.min(this._wwaData.mapWidth-1,a.x+b.H_PARTS_NUM_IN_WINDOW-1),d=Math.max(0,a.y),a=Math.min(this._wwaData.mapWidth-1,a.y+b.V_PARTS_NUM_IN_WINDOW)-1,f=[];for(this.playSound(1);c<=g;c++)for(var k=d;k<=a;k++){var h=this._wwaData.mapObject[k][c];this._wwaData.objectAttribute[h][b.ATR_TYPE]===b.OBJECT_MONSTER&&-1===f.indexOf(h)&&f.push(h)}if(0===
f.length)return!1;this._battleEstimateWindow.update(this._player.getStatus(),f);this._battleEstimateWindow.show();this._player.setEstimateWindowWating();return!0};c.prototype.hideBattleEstimateWindow=function(){this._battleEstimateWindow.hide();this._player.clearEstimateWindowWaiting()};c.prototype._displayHelp=function(){this._player.isControllable()&&this.setMessageQueue("\u3010\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30ad\u30fc\u306e\u4e00\u89a7\u3011\n\uff26\uff11\u3001\uff2d\uff1a\u6226\u95d8\u7d50\u679c\u4e88\u6e2c\u306e\u8868\u793a\n\uff26\uff15\uff1a\u4e00\u6642\u4fdd\u5b58\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\n\uff26\uff16\uff1a\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\n\uff26\uff17\uff1a\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\n\uff26\uff18\uff1a\uff37\uff37\uff21\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\n\uff26\uff11\uff12\uff1a\u3053\u306e\u30ea\u30b9\u30c8\u306e\u8868\u793a\n\u30ad\u30fc\u30dc\u30fc\u30c9\u306e\u300c\uff11\uff12\uff13\u3001\uff31\uff37\uff25\u3001\uff21\uff33\uff24\u3001\uff3a\uff38\uff23\u300d\u306f\u53f3\u306e\u30a2\u30a4\u30c6\u30e0\u30dc\u30c3\u30af\u30b9\u306b\u5bfe\u5fdc\u3002\n\u300c\uff25\uff4e\uff54\uff45\uff52\u3001\uff39\u300d\u306f\uff39\uff45\uff53,\u300c\uff25\uff53\uff43\u3001\uff2e\u300d\u306f\uff2e\uff4f\u306b\u5bfe\u5fdc\u3002\n I : \u79fb\u52d5\u901f\u5ea6\u3092\u843d\u3068\u3059\uff0f\uff30: \u79fb\u52d5\u901f\u5ea6\u3092\u4e0a\u3052\u308b\n\u73fe\u5728\u306e\u79fb\u52d5\u56de\u6570\uff1a"+
this._player.getMoveCount()+"\nWWA Wing \u30d0\u30fc\u30b8\u30e7\u30f3:"+b.VERSION_WWAJS,!1,!0)};c.prototype._setNextMessage=function(a){void 0===a&&(a=!1);this._clearFacesInNextFrame=!0;this._scoreWindow.isVisible()&&this._scoreWindow.hide();this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);if(0===this._messageQueue.length)this._hideMessageWindow();else{var b=this._messageQueue.shift(),
c=b.message,g=b.macro;this._lastMessage=b;for(b=0;b<g.length;b++)this._execMacroListInNextFrame.push(g[b]);""!==c?(this._messageWindow.hide(),this._messageWindow.setMessage(c),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),a,this._player.getPosition(),this._camera.getPosition()),this._messageWindow.show()):0===this._messageQueue.length?this._hideMessageWindow():this._setNextMessage()}};c.prototype._hideMessageWindow=function(a){void 0===a&&(a=
!0);var c=0;this._player.isReadyToUseItem()&&(c=this._player.useItem());var g=this.getObjectAttributeById(c,b.ATR_STRING);this.clearFaces();0===g?(a&&(this._messageWindow.hide(),this._keyStore.allClear(),this._mouseStore.clear()),this._player.clearMessageWaiting()):this.setMessageQueue(this.getMessageById(g),!1,!1,c,0,this._player.getPosition().getPartsCoord(),!0)};c.prototype.replaceParts=function(a,c,g,d){void 0===g&&(g=0);void 0===d&&(d=!1);var f=this._camera.getPosition().getPartsCoord(),k=d?
Math.max(0,f.x):0,h=d?Math.min(this._wwaData.mapWidth-1,f.x+b.H_PARTS_NUM_IN_WINDOW-1):this._wwaData.mapWidth-1,l=d?Math.max(0,f.y):0;for(d=d?Math.min(this._wwaData.mapWidth-1,f.y+b.V_PARTS_NUM_IN_WINDOW)-1:this._wwaData.mapWidth-1;k<=h;k++)for(f=l;f<=d;f++)if(0===g){var m=this._wwaData.mapObject[f][k];m===a&&(this._wwaData.mapObject[f][k]=c)}else m=this._wwaData.map[f][k],m===a&&(this._wwaData.map[f][k]=c)};c.prototype.getYesNoImgCoord=function(){return new g(this._wwaData.yesnoImgPosX,this._wwaData.yesnoImgPosY)};
c.prototype.setYesNoImgCoord=function(a){this._wwaData.yesnoImgPosX=a.x;this._wwaData.yesnoImgPosY=a.y;return a};c.prototype.getPlayerImgCoord=function(){return new g(this._wwaData.playerImgPosX,this._wwaData.playerImgPosY)};c.prototype.setPlayerImgCoord=function(a){this._wwaData.playerImgPosX=a.x;this._wwaData.playerImgPosY=a.y;return a};c.prototype.setPlayerEnergyMax=function(a){return this._player.setEnergyMax(a)};c.prototype.getMapPartsNum=function(){return this._wwaData.mapPartsMax};c.prototype.getObjectPartsNum=
function(){return this._wwaData.objPartsMax};c.prototype.setMoveMacroWaitingToPlayer=function(a){this._reservedMoveMacroTurn=a};c.prototype.disableSave=function(a){return this._wwaData.disableSaveFlag=a};c.prototype.isOldMap=function(){return this._wwaData.isOldMap};c.prototype.setOldMap=function(a){return this._wwaData.isOldMap=a};c.prototype.setObjectNotCollapseOnPartsOnPlayer=function(a){return this._wwaData.objectNoCollapseDefaultFlag=a};c.prototype.setGameOverPosition=function(a){if(0>a.x||a.x>=
this.getMapWidth()||0>a.y||a.y>=this.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");this._wwaData.gameoverX=a.x;this._wwaData.gameoverY=a.y;return a};c.prototype.setPlayerStatus=function(a,b){if(0===a)this._player.setEnergy(b);else if(1===a)this._player.setStrength(b);else if(2===a)this._player.setDefence(b);else if(3===a)this._player.setGold(b);else if(4===a)this._player.setMoveCount(b);else throw Error("\u672a\u5b9a\u7fa9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30bf\u30a4\u30d7\u3067\u3059");
};c.prototype.setDelPlayer=function(a){return this._wwaData.delPlayerFlag=a};c.prototype.setPlayerGetItem=function(a,b){try{this._player.addItem(b,a,!0)}catch(c){}};c.prototype.setFrameCoord=function(a){return this._frameCoord=a.clone()};c.prototype.setBattleEffectCoord=function(a){return this._battleEffectCoord=a.clone()};c.prototype.canInput=function(){return!this._temporaryInputDisable};c.prototype.setWaitTime=function(a){this._waitTimeInCurrentFrame+=a;this._temporaryInputDisable=!0};c.prototype.setEffect=
function(a,b){this._wwaData.effectWaits=a;this._wwaData.effectCoords=b};c.prototype.stopEffect=function(){this._wwaData.effectCoords=[]};c.prototype.setImgClick=function(a){this._wwaData.imgClickX=a.x;this._wwaData.imgClickY=a.y;if(a.equals(new g(0,0)))Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage="url('"+wwa_data.WWAConsts.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0"});else{var c=this._wwaData.mapCGName.replace("(",
"\\(").replace(")","\\)");Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(g){g.style.backgroundImage="url('"+c+"')";g.style.backgroundPosition="-"+a.x*b.CHIP_SIZE+"px -"+a.y*b.CHIP_SIZE+"px"})}};c.prototype.addFace=function(a){this._faces.push(a)};c.prototype.clearFaces=function(){this._faces=[]};c.prototype.initCSSRule=function(){console.log(this);this._styleElm=wwa_util.$id(b.WWA_STYLE_TAG_ID);this._sheet=this._styleElm.sheet;this.updateCSSRule()};c.prototype.updateCSSRule=
function(){if(void 0===this._stylePos)this._stylePos=Array(2);else if(void 0!==this._sheet.addRule)for(var a=0;a<this._stylePos.length;a++)this._sheet.removeRule(this._stylePos[this._styleElm[a]]);else for(a=0;a<this._stylePos.length;a++)this._sheet.deleteRule(this._stylePos[this._styleElm[a]]);void 0!==this._sheet.addRule?(this._stylePos[0]=this._sheet.addRule("div.wwa-message-window","background-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+
",1) ;border-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+",1);color: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);"),this._stylePos[1]=this._sheet.addRule("div#wwa-sidebar","color: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);font-weight: bold;")):(this._stylePos[0]=this._sheet.insertRule("div.wwa-message-window {\nbackground-color: rgb("+
this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+");\nborder-color: rgb("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+");\ncolor: rgb("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+");\n}",0),this._stylePos[1]=this._sheet.insertRule("div#wwa-sidebar {\ncolor: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);\nfont-weight: bold;\n}",
1))};c.prototype.changeStyleRule=function(a,b,c,g){0===a?(this._wwaData.frameColorR=b,this._wwaData.frameColorG=c,this._wwaData.frameColorB=g):1===a?(this._wwaData.frameOutColorR=b,this._wwaData.frameOutColorG=c,this._wwaData.frameOutColorB=g):2===a?(this._wwaData.fontColorR=b,this._wwaData.fontColorG=c,this._wwaData.fontColorB=g):4===a&&(this._wwaData.statusColorR=b,this._wwaData.statusColorG=c,this._wwaData.statusColorB=g);this.updateCSSRule()};c.prototype.showMonsterWindow=function(){this._monsterWindow.show()};
c.prototype.isConsoleOutputMode=function(){return this._useConsole};return c}();f.WWA=z;var w=!1;"complete"===document.readyState?c():window.addEventListener("load",c)})(wwa_main||(wwa_main={}));var wwa_parts_player;
(function(f){var d=wwa_data.WWAConsts,c=function(){function a(a){this._position=a}a.prototype.getPosition=function(){return this._position};return a}(),h=function(a){function b(b){a.call(this,b)}__extends(b,a);return b}(c);f.PartsObject=h;c=function(a){function b(b){a.call(this,b)}__extends(b,a);return b}(c);f.PartsMap=c;var l;(function(a){a[a.CONTROLLABLE=0]="CONTROLLABLE";a[a.MOVING=1]="MOVING";a[a.CAMERA_MOVING=2]="CAMERA_MOVING";a[a.MESSAGE_WAITING=3]="MESSAGE_WAITING";a[a.LOCALGATE_JUMPED=4]=
"LOCALGATE_JUMPED";a[a.BATTLE=5]="BATTLE";a[a.ESTIMATE_WINDOW_WAITING=6]="ESTIMATE_WINDOW_WAITING"})(l||(l={}));h=function(a){function b(b,c,f,h,l){this._status=h;this._equipStatus=new wwa_data.EquipmentStatus(0,0);this._itemBox=Array(d.ITEMBOX_SIZE);this._itemBoxElement=Array(d.ITEMBOX_SIZE);this._itemUsingEvent=Array(d.ITEMBOX_SIZE);for(h=0;h<this._itemBox.length;h++)this._itemBox[h]=0,this._itemBoxElement[h]=wwa_util.$qsh("#item"+h+">.item-disp");this.updateItemBox();this._energyMax=l;this._dir=
2;this._wwa=b;this._state=0;this._camera=f;this._isPartsEventExecuted=!1;this._energyValueElement=wwa_util.$qsh("#disp-energy>.status-value-box");this._strengthValueElement=wwa_util.$qsh("#disp-strength>.status-value-box");this._defenceValueElement=wwa_util.$qsh("#disp-defence>.status-value-box");this._goldValueElement=wwa_util.$qsh("#disp-gold>.status-value-box");this._isClickableItemGot=this._isReadyToUseItem=!1;this._moveObjectAutoExecTimer=this._moveMacroWaitingRemainMoves=this._moves=0;this.updateStatusValueBox();
this._afterMoveMacroFlag=this._partsAppeared=!1;this._isPreparedForLookingAround=!0;this._lookingAroundTimer=d.PLAYER_LOOKING_AROUND_START_FRAME;this._speedIndex=d.DEFAULT_SPEED_INDEX;a.call(this,c)}__extends(b,a);b.prototype.move=function(){if(this.isControllable())this.controll(this._dir);else if(2===this._state){try{this._camera.move(this._dir)}catch(a){}this._isOnCameraStopPosition()&&(this._state=0)}else if(1===this._state){try{var b=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],
wwa_data.speedList[this._speedIndex])}catch(c){}b.isJustPosition()&&(this._state=0,this._moves++,this._isPartsEventExecuted=!1,this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0);this._position=b}};b.prototype.controll=function(a){var b,c;if(this.isControllable()){this._isPreparedForLookingAround=!1;this._dir=a;try{b=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex]),c=this._position.getNextJustPosition(a)}catch(f){return}if(this._isOnCameraMovingPosition()){if(0!==
this._wwa.getMapIdByPosition(c)||this._wwa.isOldMap()||this._wwa.debug)try{this._camera.move(this._dir),this._state=2}catch(h){this._state=0}}else this.canMoveTo(c)?(this._position=b,this._state=1,this._wwa.getMapAttributeByPosition(this._position.getNextJustPosition(a),d.ATR_TYPE)!==d.MAP_LOCALGATE&&this._wwa.moveObjects(!0)):(this._wwa.getMapTypeByPosition(c)===d.MAP_WALL&&this._wwa.checkMap(c.getPartsCoord()),this._wwa.checkObject(c.getPartsCoord()))}};b.prototype.canMoveTo=function(a){if(null===
a)return!1;if(this._wwa.debug)return!0;this._wwa.getMapWidth();a.getPartsCoord();a.getOffsetCoord();return 0===this._wwa.getMapIdByPosition(a)&&!this._wwa.isOldMap()||this._wwa.getMapTypeByPosition(a)===d.MAP_WALL?!1:0===this._wwa.getObjectIdByPosition(a)||this._wwa.getObjectTypeByPosition(a)===d.OBJECT_NORMAL&&this._wwa.getObjectAttributeByPosition(a,d.ATR_MODE)===d.PASSABLE_OBJECT?!0:this._wwa.getObjectTypeByPosition(a)===d.OBJECT_DOOR&&this._wwa.getObjectAttributeByPosition(a,d.ATR_NUMBER)===d.PASSABLE_OBJECT?
this.hasItem(this._wwa.getObjectAttributeByPosition(a,d.ATR_ITEM))?!1:!0:!1};b.prototype.isMoving=function(){return 1==this._state||2==this._state};b.prototype._isOnCameraMovingPosition=function(){var a=this._camera.getPosition().getPartsCoord(),b=this.getPosition().getPartsCoord();return b.x-a.x===d.H_PARTS_NUM_IN_WINDOW-1&&1===this._dir||b.x===a.x&&0===this._dir||b.y-a.y===d.V_PARTS_NUM_IN_WINDOW-1&&2===this._dir||b.y===a.y&&3===this._dir};b.prototype._isOnCameraStopPosition=function(){var a=this._camera.getPosition().getPartsCoord(),
b=this.getPosition().getPartsCoord();return b.x-a.x===d.H_PARTS_NUM_IN_WINDOW-1&&0===this._dir||b.x===a.x&&1===this._dir||b.y-a.y===d.V_PARTS_NUM_IN_WINDOW-1&&3===this._dir||b.y===a.y&&2===this._dir};b.prototype.isControllable=function(){var a=this._afterMoveMacroFlag;this._afterMoveMacroFlag=!1;return 0===this._state&&!this._partsAppeared&&(this._wwa.getMapTypeByPosition(this._position)!==d.MAP_LOCALGATE&&this._wwa.getMapTypeByPosition(this._position)!==d.MAP_URLGATE||!this._wwa.isPrevFrameEventExecuted())&&
0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&!a&&this._wwa.canInput()};b.prototype.getCopyOfItemBox=function(){return this._itemBox.slice()};b.prototype.getDir=function(){return this._dir};b.prototype.getEnergyMax=function(){return this._energyMax};b.prototype.isJumped=function(){return 4===this._state};b.prototype.setMessageWaiting=function(){this._state=3};b.prototype.isWaitingMessage=function(){return 3===this._state};b.prototype.clearMessageWaiting=function(){3===
this._state&&(this._state=0,this._isPartsEventExecuted=!0,this._isPreparedForLookingAround&&(this._lookingAroundTimer=d.PLAYER_LOOKING_AROUND_START_FRAME))};b.prototype.setEstimateWindowWating=function(){this._state=6};b.prototype.isWatingEstimateWindow=function(){return 6===this._state};b.prototype.clearEstimateWindowWaiting=function(){6===this._state&&(this._state=0)};b.prototype.isPartsEventExecuted=function(){return this._isPartsEventExecuted};b.prototype.resetEventExecutionInfo=function(){this._isPartsEventExecuted=
!1};b.prototype.getLastExecPartsIDOnSamePosition=function(a){return 1===a?this._samePosLastExecutedMapID:this._samePosLastExecutedObjID};b.prototype.setLastExecInfoOnSamePosition=function(a,b){1===a?this._samePosLastExecutedMapID=b:this._samePosLastExecutedObjID=b};b.prototype.processAfterJump=function(){4===this._state&&0===--this._jumpWaitFramesRemain&&(this._state=0)};b.prototype.jumpTo=function(a){var b=this._camera.getPosition();this.getPosition();if(this._position.equals(a))return!1;this._position=
a;a.isInCameraRange(this._camera)||this._camera.reset(a);this._state=4;this._jumpWaitFramesRemain=d.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;a.hasLocalGate()?this._dir=2:a.getPartsCoord().y<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(2).hasLocalGate()?this._dir=3:1<=a.getPartsCoord().y&&a.getNextJustPosition(3).hasLocalGate()?this._dir=2:a.getPartsCoord().x<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(1).hasLocalGate()?this._dir=0:
1<=a.getPartsCoord().x&&a.getNextJustPosition(0).hasLocalGate()?this._dir=1:this._dir=2;this._camera.getPosition().equals(b)||(this._isPreparedForLookingAround=!0,this._lookingAroundTimer=d.PLAYER_LOOKING_AROUND_START_FRAME);return!0};b.prototype.systemJumpTo=function(a){this._position=a;this._camera.reset(a);this._camera.resetPreviousPosition();this._state=4;this._jumpWaitFramesRemain=d.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;this._dir=2;this._isPreparedForLookingAround=
!0;this._lookingAroundTimer=d.PLAYER_LOOKING_AROUND_START_FRAME};b.prototype.addStatusAll=function(a){this._status.add(a);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return this._status};b.prototype.setEnergyMax=function(a){this._energyMax=a;0!==a&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return a};b.prototype.setEnergy=function(a){this._status.energy=
a;this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return a};b.prototype.damage=function(a){this._status.energy=Math.max(0,this._status.energy-a);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox()};b.prototype.setStrength=function(a){return this._status.strength=a};b.prototype.setDefence=
function(a){this._status.defence=a;this.updateStatusValueBox();return a};b.prototype.setGold=function(a){this._status.gold=a;this.updateStatusValueBox();return a};b.prototype.getStatus=function(){return this._status.plus(this._equipStatus)};b.prototype.getStatusWithoutEquipments=function(){return this._status.plus(new wwa_data.EquipmentStatus(0,0))};b.prototype.updateStatusValueBox=function(){var a=this._status.plus(this._equipStatus),b=a.strength,c=a.defence,d=a.gold;this._energyValueElement.textContent=
a.energy+"";this._strengthValueElement.textContent=b+"";this._defenceValueElement.textContent=c+"";this._goldValueElement.textContent=d+""};b.prototype.updateItemBox=function(){for(var a,b,c=0;c<this._itemBoxElement.length;c++)0===this._itemBox[c]?this._itemBoxElement[c].style.backgroundPosition="-40px 0px":(a=this._wwa.getObjectCropXById(this._itemBox[c]),b=this._wwa.getObjectCropYById(this._itemBox[c]),this._itemBoxElement[c].style.backgroundPosition="-"+a+"px -"+b+"px")};b.prototype.isDead=function(){return 0>=
this._status.energy};b.prototype.addItem=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=!1);var f;f=this._wwa.getObjectAttributeById(a,d.ATR_NUMBER);0===b&&0!==f&&(b=f);if(0===b){if(0===a)return;b=this._getBlankItemPos();if(b===d.ITEMBOX_IS_FULL)throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");this._forceSetItemBox(b,a)}else if(!1===c)if(f=this._itemBox[b-1],this._wwa.getObjectAttributeById(f,d.ATR_NUMBER)!==this._wwa.getObjectAttributeById(a,
d.ATR_NUMBER))if(c=this._getBlankItemPos(),c!==d.ITEMBOX_IS_FULL)this._forceSetItemBox(c,f),this._forceSetItemBox(b,a);else throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");else this._forceSetItemBox(b,a);else this._forceSetItemBox(b,a);this._updateEquipmentStatus();this.updateItemBox()};b.prototype._forceSetItemBox=function(a,b){var c=this,f=wwa_util.$qsh("#item"+(a-1)+">.item-click-border"),h=this._wwa.getObjectAttributeById(b,d.ATR_MODE);
this.removeItemByItemPosition(a);this._itemBox[a-1]=b;0!==b&&0!==h&&(h=this._wwa.getSystemMessageById(0),this._isClickableItemGot||("BLANK"!==h&&this._wwa.setMessageQueue(""===h?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u306f\u53f3\u306e\u30dc\u30c3\u30af\u30b9\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\u4f7f\u7528\u3067\u304d\u308b\u30a2\u30a4\u30c6\u30e0\u306f\u8272\u67a0\u3067\u56f2\u307e\u308c\u307e\u3059\u3002":h,!1,!0),this._isClickableItemGot=
!0),f.style.display="block",function(a){c._itemUsingEvent[a-1]=function(){if(c.isControllable())c._wwa.onselectitem(a)}}(a),f.addEventListener("click",this._itemUsingEvent[a-1]))};b.prototype._getBlankItemPos=function(){var a;for(a=1;a<this._itemBox.length+1;a++)if(0===this._itemBox[a-1])return a;return d.ITEMBOX_IS_FULL};b.prototype._updateEquipmentStatus=function(){var a,b=new wwa_data.EquipmentStatus(0,0);for(a=0;a<d.ITEMBOX_SIZE;a++)0!==this._itemBox[a]&&(b.strength+=this._wwa.getObjectAttributeById(this._itemBox[a],
d.ATR_STRENGTH),b.defence+=this._wwa.getObjectAttributeById(this._itemBox[a],d.ATR_DEFENCE));a=b.minus(this._equipStatus);this._wwa.setStatusChangedEffect(a);this._equipStatus=b;this.updateStatusValueBox()};b.prototype.hasItem=function(a){for(var b=0;b<d.ITEMBOX_SIZE;b++)if(this._itemBox[b]===a)return!0;return!1};b.prototype.canUseItem=function(a){a=this._itemBox[a-1];return 0===a||0===this._wwa.getObjectAttributeById(a,d.ATR_MODE)?!1:!0};b.prototype.useItem=function(){var a;a=this._itemBox[this._readyToUseItemPos-
1];2!==this._wwa.getObjectAttributeById(a,d.ATR_MODE)&&this.removeItemByItemPosition(this._readyToUseItemPos);var b=wwa_util.$id("item"+(this._readyToUseItemPos-1));setTimeout(function(){b.classList.contains("onpress")&&b.classList.remove("onpress")},d.DEFAULT_FRAME_INTERVAL);this._isReadyToUseItem=!1;this._readyToUseItemPos=void 0;return a};b.prototype.canHaveMoreItems=function(){return this._getBlankItemPos()!==d.ITEMBOX_IS_FULL};b.prototype.removeItemByItemPosition=function(a){var b;0!==this._itemBox[a-
1]&&(0!==this._wwa.getObjectAttributeById(this._itemBox[a-1],d.ATR_MODE)&&(b=wwa_util.$qsh("#item"+(a-1)+">.item-click-border"),b.removeEventListener("click",this._itemUsingEvent[a-1]),b.style.display="none"),this._itemBox[a-1]=0,this._updateEquipmentStatus(),this.updateItemBox())};b.prototype.removeItemByPartsID=function(a){if(!this.hasItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3063\u3066\u3044\u306a\u3044");for(var b=0;b<d.ITEMBOX_SIZE;b++)if(this._itemBox[b]===a){0!==this._wwa.getObjectAttributeById(this._itemBox[b],
d.ATR_MODE)&&(a=wwa_util.$qsh("#item"+b+">.item-click-border"),a.removeEventListener("click",this._itemUsingEvent[b]),a.style.display="none");this._itemBox[b]=0;this._updateEquipmentStatus();this.updateItemBox();break}};b.prototype.clearItemBox=function(){for(var a=1;a<=d.ITEMBOX_SIZE;a++)this.removeItemByItemPosition(a);this._updateEquipmentStatus();this.updateItemBox()};b.prototype.hasGold=function(a){return this._status.gold>=a};b.prototype.payGold=function(a){if(!this.hasGold(a))throw Error("\u304a\u91d1\u304c\u8db3\u308a\u306a\u3044");
this.setGold(this._status.gold-a)};b.prototype.earnGold=function(a){this.setGold(this._status.gold+a)};b.prototype.setPartsAppearedFlag=function(){this._partsAppeared=!0};b.prototype.clearPartsAppearedFlag=function(){this._partsAppeared=!1};b.prototype.isPartsAppearedTime=function(){return!0===this._partsAppeared};b.prototype.startBattleWith=function(a){this._isPlayerTurn=!0;this._battleFrameCounter=d.BATTLE_INTERVAL_FRAME_NUM;this._battleTurnNum=0;this._enemy=a;this._state=5};b.prototype.isFighting=
function(){return 5===this._state};b.prototype.isTurn=function(){return this._isPlayerTurn};b.prototype.getTurnNum=function(){return this._battleTurnNum};b.prototype.isBattleStartFrame=function(){return this._battleFrameCounter===d.BATTLE_INTERVAL_FRAME_NUM&&0===this._battleTurnNum};b.prototype.fight=function(){if(!this.isFighting())throw Error("\u30d0\u30c8\u30eb\u304c\u958b\u59cb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");0===this._battleTurnNum&&this._battleFrameCounter===d.BATTLE_INTERVAL_FRAME_NUM&&
this._wwa.showMonsterWindow();if(!(0<--this._battleFrameCounter)){this._battleTurnNum++;this._speedIndex===d.MAX_SPEED_INDEX||this._battleTurnNum>d.BATTLE_SPEED_CHANGE_TURN_NUM?(1===this._battleTurnNum&&this._wwa.playSound(3),this._battleFrameCounter=1):(this._battleFrameCounter=d.BATTLE_INTERVAL_FRAME_NUM,this._wwa.playSound(3));var a=this.getStatus(),b=this._enemy.status;if(this._isPlayerTurn){if(a.strength>b.defence||a.defence<b.strength){b.energy>a.strength-b.defence?a.strength>b.defence&&this._enemy.damage(a.strength-
b.defence):(this._wwa.playSound(this._wwa.getObjectAttributeById(this._enemy.partsID,d.ATR_SOUND)),this.earnGold(b.gold),this._wwa.setStatusChangedEffect(new wwa_data.Status(0,0,0,b.gold)),0!==this._enemy.item?this._wwa.setPartsOnPosition(0,this._enemy.item,this._enemy.position):this._wwa.setPartsOnPosition(0,0,this._enemy.position),this._wwa.appearParts(this._enemy.position,1,this._enemy.partsID),this._state=0,this._wwa.setMessageQueue(this._enemy.message,!1,!1),this._enemy.battleEndProcess(),this._battleTurnNum=
0,this._enemy=null);this._isPlayerTurn=!1;return}this._enemy.battleEndProcess();this._wwa.setMessageQueue("\u76f8\u624b\u306e\u9632\u5fa1\u80fd\u529b\u304c\u9ad8\u3059\u304e\u308b\uff01",!1,!0);this._battleTurnNum=0;this._enemy=null}else b.strength>a.defence&&(a.energy>b.strength-a.defence?this.damage(b.strength-a.defence):(this.setEnergy(0),this._enemy.battleEndProcess(),this._battleTurnNum=this._state=0,this._enemy=null,this._wwa.gameover()));this._isPlayerTurn=!0}};b.prototype.readyToUseItem=function(a){var b;
if(!this.canUseItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u304c\u306a\u3044\u304b\u3001\u30a2\u30a4\u30c6\u30e0\u304c\u4f7f\u3048\u307e\u305b\u3093\u3002");b=this._itemBox[a-1];this._wwa.getObjectAttributeById(b,d.ATR_STRING);this._wwa.appearParts(this._position.getPartsCoord(),1,b);this._readyToUseItemPos=a;this._isReadyToUseItem=!0};b.prototype.isReadyToUseItem=function(){return this._isReadyToUseItem};b.prototype.getDrawingCenterPosition=function(){var a=this._position.getPartsCoord(),b=this._position.getOffsetCoord(),
c=this._camera.getPosition(),f=c.getPartsCoord(),c=c.getOffsetCoord();return new wwa_data.Coord((a.x-f.x)*d.CHIP_SIZE+b.x-c.x+d.CHIP_SIZE/2,(a.y-f.y)*d.CHIP_SIZE+b.y-c.y+d.CHIP_SIZE/2)};b.prototype.getMoveCount=function(){return this._moves};b.prototype.setMoveCount=function(a){return this._moves=a};b.prototype.isMoveObjectAutoExecTime=function(){return 0===this._moveObjectAutoExecTimer};b.prototype.setMoveMacroWaiting=function(a){0>a||(this._moveMacroWaitingRemainMoves=a,this._moveObjectAutoExecTimer=
0)};b.prototype.resetMoveObjectAutoExecTimer=function(){this._moveObjectAutoExecTimer=d.CHIP_SIZE/wwa_data.speedList[this._speedIndex];this._moveMacroWaitingRemainMoves--};b.prototype.decrementMoveObjectAutoExecTimer=function(){0<=this._moveMacroWaitingRemainMoves&&0<this._moveObjectAutoExecTimer&&(this._moveObjectAutoExecTimer--,0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&(this._afterMoveMacroFlag=!0));return 0};b.prototype.isWaitingMoveMacro=function(){return 0!==this._moveMacroWaitingRemainMoves||
0!==this._moveObjectAutoExecTimer};b.prototype.decrementLookingAroundTimer=function(){return this._isPreparedForLookingAround&&0<this._lookingAroundTimer?--this._lookingAroundTimer:0};b.prototype.isLookingAround=function(){return this._isPreparedForLookingAround&&0===this._lookingAroundTimer};b.prototype.getSpeedIndex=function(){return this._speedIndex};b.prototype.speedUp=function(){return this._speedIndex=Math.min(d.MAX_SPEED_INDEX,this._speedIndex+1)};b.prototype.speedDown=function(){return this._speedIndex=
Math.max(d.MIN_SPEED_INDEX,this._speedIndex-1)};return b}(h);f.Player=h})(wwa_parts_player||(wwa_parts_player={}));var wwa_monster;
(function(f){var d=function(){function c(c,d,a,b,g,f,r){this._partsID=c;this._position=d;this._imgCoord=a;this._status=b;this._message=g;this._item=f;this._battleEndCallback=r}Object.defineProperty(c.prototype,"partsID",{get:function(){return this._partsID},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"imgCoord",{get:function(){return this._imgCoord},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"item",{get:function(){return this._item},enumerable:!0,configurable:!0});c.prototype.damage=function(c){this._status.energy=Math.max(0,this._status.energy-c)};c.prototype.battleEndProcess=function(){this._battleEndCallback()};
return c}();f.Monster=d})(wwa_monster||(wwa_monster={}));var wwa_motion;
(function(f){var d=function(){function c(d,a,b,f,h){this._player=d;this._objectID=a;this._srcPos=b;this._destPos=f;this._dir=h;this._currentPos=this._srcPos.clone()}c.prototype.update=function(){var c=this._player.getSpeedIndex();return this._currentPos=this._currentPos.getNextFramePosition(this._dir,wwa_data.speedList[c],wwa_data.speedList[c])};Object.defineProperty(c.prototype,"isAchievedDestination",{get:function(){return this._currentPos.equals(this._destPos)},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"currentPosition",{get:function(){return this._currentPos},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"beforePosition",{get:function(){return this._srcPos},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"destination",{get:function(){return this._destPos},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"objID",{get:function(){return this._objectID},enumerable:!0,configurable:!0});return c}();f.ObjectMovingData=
d;var c=function(){function c(d,a){this._wwa=d;this._player=a;this.clear()}c.prototype.add=function(c,a,b,f){this._queue.push(new d(this._player,c,a,b,f))};c.prototype.update=function(){for(var c=[],a=[],b=0;b<this._queue.length;b++)this._queue[b].update(),this._queue[b].isAchievedDestination?(c.push(this._queue[b]),this._wwa.setPartsOnPosition(0,0,this._queue[b].beforePosition.getPartsCoord()),this._wwa.setPartsOnPosition(0,this._queue[b].objID,this._queue[b].destination.getPartsCoord())):a.push(this._queue[b]);
this._queue=a;return c};c.prototype.clear=function(){this._queue=[]};Object.defineProperty(c.prototype,"objectMovingData",{get:function(){return this.objectMovingData},enumerable:!0,configurable:!0});c.prototype.getOffsetByBeforePartsCoord=function(c){var a=this._queue.filter(function(a){return a.beforePosition.getPartsCoord().equals(c)});return 0===a.length?null:a[0].currentPosition.getOffsetCoord()};return c}();f.ObjectMovingDataManager=c})(wwa_motion||(wwa_motion={}));
