/*
 WWA Wing
 http://wwawing.com/
 Copyright (c) 1996-2015 NAO
 Copyright (c) 2015 WWA Wing Team
 LICENSE: https://raw.githubusercontent.com/WWAWing/WWAWing/master/LICENSE

 CryptoJS v3.1.2
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
*/
var wwa_input,wwa_data,wwa_parts_player,wwa_camera,wwa_cgmanager,wwa_util,wwa_message,wwa_monster,wwa_motion,wwa_estimate_battle,wwa_inject_html,wwa_psave,wwa_password_window,wwa_item_menu,__extends=this&&this.__extends||function(){var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(t,e){function a(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();!function(t){var a,e,s;(e=a=t.KeyState||(t.KeyState={}))[e.NONE=0]="NONE",e[e.KEYDOWN=1]="KEYDOWN",e[e.KEYPRESS=2]="KEYPRESS",e[e.KEYUP=3]="KEYUP",e[e.KEYPRESS_MESSAGECHANGE=4]="KEYPRESS_MESSAGECHANGE",(s=t.KeyCode||(t.KeyCode={}))[s.KEY_ENTER=13]="KEY_ENTER",s[s.KEY_SHIFT=16]="KEY_SHIFT",s[s.KEY_ESC=27]="KEY_ESC",s[s.KEY_SPACE=32]="KEY_SPACE",s[s.KEY_LEFT=37]="KEY_LEFT",s[s.KEY_UP=38]="KEY_UP",s[s.KEY_RIGHT=39]="KEY_RIGHT",s[s.KEY_DOWN=40]="KEY_DOWN",s[s.KEY_1=49]="KEY_1",s[s.KEY_2=50]="KEY_2",s[s.KEY_3=51]="KEY_3",s[s.KEY_A=65]="KEY_A",s[s.KEY_C=67]="KEY_C",s[s.KEY_D=68]="KEY_D",s[s.KEY_E=69]="KEY_E",s[s.KEY_I=73]="KEY_I",s[s.KEY_M=77]="KEY_M",s[s.KEY_N=78]="KEY_N",s[s.KEY_P=80]="KEY_P",s[s.KEY_Q=81]="KEY_Q",s[s.KEY_S=83]="KEY_S",s[s.KEY_W=87]="KEY_W",s[s.KEY_X=88]="KEY_X",s[s.KEY_Y=89]="KEY_Y",s[s.KEY_Z=90]="KEY_Z",s[s.KEY_F1=112]="KEY_F1",s[s.KEY_F3=114]="KEY_F3",s[s.KEY_F4=115]="KEY_F4",s[s.KEY_F5=116]="KEY_F5",s[s.KEY_F6=117]="KEY_F6",s[s.KEY_F7=118]="KEY_F7",s[s.KEY_F8=119]="KEY_F8",s[s.KEY_F9=120]="KEY_F9",s[s.KEY_F12=123]="KEY_F12";var i,o,r=function(){function e(){var t;for(this._nextKeyState=new Array(e.KEY_BUFFER_MAX),this._keyState=new Array(e.KEY_BUFFER_MAX),this._prevKeyState=new Array(e.KEY_BUFFER_MAX),this._prevKeyStateOnControllable=new Array(e.KEY_BUFFER_MAX),this._keyInputContinueFrameNum=new Array(e.KEY_BUFFER_MAX),t=0;t<e.KEY_BUFFER_MAX;t++)this._nextKeyState[t]=!1,this._keyState[t]=!1,this._prevKeyState[t]=!1,this._prevKeyStateOnControllable[t]=!1,this._keyInputContinueFrameNum[t]=0}return e.prototype.checkHitKey=function(t){var e=this.getKeyState(t);return e===a.KEYDOWN||e===a.KEYPRESS},e.prototype.getKeyState=function(t){return this._prevKeyState[t]?this._keyState[t]?a.KEYPRESS:a.KEYUP:this._keyState[t]?a.KEYDOWN:a.NONE},e.prototype.getKeyStateForControllPlayer=function(t){return this._prevKeyStateOnControllable[t]?this._keyState[t]?a.KEYPRESS:a.KEYUP:this._keyState[t]?a.KEYDOWN:a.NONE},e.prototype.getKeyStateForMessageCheck=function(t){return this._prevKeyState[t]?this._keyState[t]?this._keyInputContinueFrameNum[t]>=wwa_data.WWAConsts.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM?a.KEYPRESS_MESSAGECHANGE:a.KEYPRESS:a.KEYUP:this._keyState[t]?a.KEYDOWN:a.NONE},e.prototype.setPressInfo=function(t){this._nextKeyState[t]=!0,this._keyInputContinueFrameNum[t]=-1},e.prototype.setReleaseInfo=function(t){this._nextKeyState[t]=!1,this._keyInputContinueFrameNum[t]=-1},e.prototype.update=function(){var t;for(this._prevKeyState=this._keyState.slice(),this._keyState=this._nextKeyState.slice(),t=0;t<e.KEY_BUFFER_MAX;t++)this._keyState[t]&&this._keyInputContinueFrameNum[t]++},e.prototype.memorizeKeyStateOnControllableFrame=function(){this._prevKeyStateOnControllable=this._keyState.slice()},e.prototype.allClear=function(){var t;for(this._nextKeyState=new Array(e.KEY_BUFFER_MAX),t=0;t<e.KEY_BUFFER_MAX;t++)this._nextKeyState[t]=!1},e.KEY_BUFFER_MAX=256,e}();t.KeyStore=r,(o=i=t.MouseState||(t.MouseState={}))[o.NONE=0]="NONE",o[o.MOUSEDOWN=1]="MOUSEDOWN",o[o.MOUSEPRESS=2]="MOUSEPRESS",o[o.MOUSEUP=3]="MOUSEUP";var _,n,h=function(){function t(){this._prevMouseState=!1,this._mouseState=!1,this._nextMouseState=!1}return t.prototype.checkClickMouse=function(t){var e;return(e=void 0!==t?this.getMouseState(t):this.getMouseState())===i.MOUSEDOWN||e===i.MOUSEPRESS},t.prototype.getMouseState=function(t){return void 0!==t&&this._inputDir!==t?i.NONE:this._prevMouseState?this._mouseState?i.MOUSEPRESS:i.MOUSEUP:this._mouseState?i.MOUSEDOWN:i.NONE},t.prototype.getMouseStateForControllPlayer=function(t){return void 0!==t&&this._inputDir!==t?i.NONE:this._prevMouseStateOnControllable?this._mouseState?i.MOUSEPRESS:i.MOUSEUP:this._mouseState?i.MOUSEDOWN:i.NONE},t.prototype.setPressInfo=function(t,e){this._nextMouseState=!0,this._inputDir=t,this._touchID=e},t.prototype.setReleaseInfo=function(){this._touchID=void 0,this._nextMouseState=!1},t.prototype.memorizeMouseStateOnControllableFrame=function(){this._prevMouseStateOnControllable=this._mouseState},t.prototype.update=function(){this._prevMouseState=this._mouseState,this._mouseState=this._nextMouseState},t.prototype.clear=function(){this._nextMouseState=!1},t.prototype.getTouchID=function(){return this._touchID},t}();t.MouseStore=h,(n=_=t.GamePadState||(t.GamePadState={}))[n.BUTTON_INDEX_B=0]="BUTTON_INDEX_B",n[n.BUTTON_INDEX_A=1]="BUTTON_INDEX_A",n[n.BUTTON_INDEX_Y=2]="BUTTON_INDEX_Y",n[n.BUTTON_INDEX_X=3]="BUTTON_INDEX_X",n[n.BUTTON_INDEX_L=4]="BUTTON_INDEX_L",n[n.BUTTON_INDEX_R=5]="BUTTON_INDEX_R",n[n.BUTTON_INDEX_ZL=6]="BUTTON_INDEX_ZL",n[n.BUTTON_INDEX_ZR=7]="BUTTON_INDEX_ZR",n[n.BUTTON_INDEX_MINUS=8]="BUTTON_INDEX_MINUS",n[n.BUTTON_INDEX_PLUS=9]="BUTTON_INDEX_PLUS",n[n.BUTTON_CROSS_KEY_UP=12]="BUTTON_CROSS_KEY_UP",n[n.BUTTON_CROSS_KEY_DOWN=13]="BUTTON_CROSS_KEY_DOWN",n[n.BUTTON_CROSS_KEY_LEFT=14]="BUTTON_CROSS_KEY_LEFT",n[n.BUTTON_CROSS_KEY_RIGHT=15]="BUTTON_CROSS_KEY_RIGHT",n[n.AXES_L_HORIZONTAL_INDEX=0]="AXES_L_HORIZONTAL_INDEX",n[n.AXES_L_VERTICAL_INDEX=1]="AXES_L_VERTICAL_INDEX",n[n.AXES_CROSS_KEY=9]="AXES_CROSS_KEY";var d=function(){function t(){var t;for(this.gamepad=null,this.triggers=[],t=0;t<16;t++)this.triggers[t]=!1}return t.prototype.update=function(){this.gamepad=null;var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];if(t&&0<t.length&&t[0]){var e=t[0];this.gamepad=e}},t.prototype.buttonTrigger=function(){for(var t,e,a,s,i,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];if(!this.gamepad)return!1;for(e=o.length,t=0;t<e;t++){a=o[t];var _=this.gamepad.buttons[a];if(!_)return!1;if(s="object"==typeof _?!0===_.pressed:1===_,i=this.triggers[a],(this.triggers[a]=s)&&!i)return!0}return!1},t.prototype.buttonPressed=function(){for(var t,e,a,s=[],i=0;i<arguments.length;i++)s[i]=arguments[i];if(!this.gamepad)return!1;for(e=s.length,t=0;t<e;t++){a=s[t];var o=this.gamepad.buttons[a];if(!o)return!1;if("object"==typeof o?!0===o.pressed:1===o)return!0}return!1},t.prototype.crossPressed=function(){for(var t,e,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];if(!this.gamepad)return!1;for(e=a.length,t=0;t<e;t++)switch(a[t]){case _.BUTTON_CROSS_KEY_UP:if(this.gamepad.axes[_.AXES_L_VERTICAL_INDEX]<=-.6||-1===this.stickFloor(_.AXES_CROSS_KEY)||this.buttonPressed(_.BUTTON_CROSS_KEY_UP))return!0;break;case _.BUTTON_CROSS_KEY_DOWN:if(.7<=this.gamepad.axes[_.AXES_L_VERTICAL_INDEX]||.1===this.stickFloor(_.AXES_CROSS_KEY)||this.buttonPressed(_.BUTTON_CROSS_KEY_DOWN))return!0;break;case _.BUTTON_CROSS_KEY_LEFT:if(this.gamepad.axes[_.AXES_L_HORIZONTAL_INDEX]<=-.7||.7===this.stickFloor(_.AXES_CROSS_KEY)||this.buttonPressed(_.BUTTON_CROSS_KEY_LEFT))return!0;break;case _.BUTTON_CROSS_KEY_RIGHT:if(.6<this.gamepad.axes[_.AXES_L_HORIZONTAL_INDEX]||-.5===this.stickFloor(_.AXES_CROSS_KEY)||this.buttonPressed(_.BUTTON_CROSS_KEY_RIGHT))return!0}return!1},t.prototype.stickFloor=function(){for(var t,e,a,s=[],i=0;i<arguments.length;i++)s[i]=arguments[i];if(!this.gamepad)return 0;for(e=s.length,t=0;t<e;t++){a=s[t];var o=this.gamepad.axes[a];return"number"!=typeof o?0:Math.floor(10*o)/10}return 0},t}();t.GamePadStore=d}(wwa_input||(wwa_input={})),function(d){var t=function(){function e(t,e){this.strength=t,this.defence=e}return e.prototype.add=function(t){return this.strength+=t.strength,this.defence+=t.defence,this},e.prototype.plus=function(t){return new e(this.strength+t.strength,this.defence+t.defence)},e.prototype.minus=function(t){return new e(this.strength-t.strength,this.defence-t.defence)},e.prototype.equals=function(t){return this.strength===t.strength&&this.defence===t.defence},e}(),e=function(o){function e(t,e,a,s){var i=o.call(this,e,a)||this;return i.energy=t,i.gold=s,i}return __extends(e,o),e.prototype.add=function(t){return t instanceof e&&(this.energy+=t.energy,this.gold+=t.gold),this.strength+=t.strength,this.defence+=t.defence,this},e.prototype.plus=function(t){return t instanceof e?new e(this.energy+t.energy,this.strength+t.strength,this.defence+t.defence,this.gold+t.gold):new e(this.energy,this.strength+t.strength,this.defence+t.defence,this.gold)},e.prototype.minus=function(t){return t instanceof e?new e(this.energy-t.energy,this.strength-t.strength,this.defence-t.defence,this.gold-t.gold):new e(this.energy,this.strength-t.strength,this.defence-t.defence,this.gold)},e.prototype.equals=function(t){return this.energy===t.energy&&this.strength===t.strength&&this.defence===t.defence&&this.gold===t.gold},e}(d.EquipmentStatus=t);d.Status=e;var r=function(){function e(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},e.prototype.substract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.convertIntoPosition=function(t){return new a(t,this.x,this.y,0,0)},e.prototype.getDirectionTo=function(t){return this.x<t.x?this.y>t.y?s.RIGHT_UP:this.y===t.y?s.RIGHT:s.RIGHT_DOWN:this.x===t.x?this.y>t.y?s.UP:this.y===t.y?s.NO_DIRECTION:s.DOWN:this.y>t.y?s.LEFT_UP:this.y===t.y?s.LEFT:s.LEFT_DOWN},e.prototype.toString=function(){return"("+this.x+", "+this.y+")"},e}();d.Coord=r;var a=function(){function h(t,e,a,s,i){if(void 0===s&&(s=0),void 0===i&&(i=0),this._wwa=t,void 0===this._wwa)throw new Error("WWAのインスタンスが存在しません. ");var o=this._wwa.getMapWidth();if(e<0||o<=e||o-1<=e&&0<s||a<0||o<=a||o-1<=a&&0<i)throw new Error("範囲外の座標です!! parts:("+e+", "+a+"), offset:("+s+", "+i+"), mapWidth = "+o);this._partsCoord=new r(e,a),this._offsetCoord=new r(s,i)}return h.prototype.getPartsCoord=function(){return this._partsCoord},h.prototype.getOffsetCoord=function(){return this._offsetCoord},h.prototype.getScreenTopPosition=function(){var t=Math.floor(this._partsCoord.x/(T.H_PARTS_NUM_IN_WINDOW-1))*(T.H_PARTS_NUM_IN_WINDOW-1),e=Math.floor(this._partsCoord.y/(T.V_PARTS_NUM_IN_WINDOW-1))*(T.V_PARTS_NUM_IN_WINDOW-1);return new h(this._wwa,t,e,0,0)},h.prototype.getDefaultCameraPosition=function(){var t=this.getScreenTopPosition(),e=t.getPartsCoord(),a=this._wwa.getMapWidth(),s=t.getPartsCoord().clone();return e.x===a-1&&s.x--,e.y===a-1&&s.y--,s.convertIntoPosition(this._wwa).getScreenTopPosition()},h.prototype.getNextJustPosition=function(t){if(void 0!==t){var e=this._partsCoord;return new h(this._wwa,e.x+d.vx[t],e.y+d.vy[t],0,0)}var a=this._partsCoord.x,s=this._partsCoord.y;return this._offsetCoord.x<0?a--:0<this._offsetCoord.x&&a++,this._offsetCoord.y<0?s--:0<this._offsetCoord.y&&s++,new h(this._wwa,a,s,0,0)},h.prototype.getNextFramePosition=function(t,e,a){var s=this._partsCoord.x,i=this._partsCoord.y,o=this._offsetCoord.x+d.vx[t]*e,r=this._offsetCoord.y+d.vy[t]*a;if(o<0){var _=Math.floor(Math.abs(o)/T.CHIP_SIZE);s-=_,o=(o+_*T.CHIP_SIZE)%T.CHIP_SIZE}if(r<0){var n=Math.floor(Math.abs(r)/T.CHIP_SIZE);i-=n,r=(r+n*T.CHIP_SIZE)%T.CHIP_SIZE}return o>=T.CHIP_SIZE&&(s+=Math.floor(o/T.CHIP_SIZE),o=(o+T.CHIP_SIZE)%T.CHIP_SIZE),r>=T.CHIP_SIZE&&(i+=Math.floor(r/T.CHIP_SIZE),r=(r+T.CHIP_SIZE)%T.CHIP_SIZE),new h(this._wwa,s,i,o,r)},h.prototype.isJustPosition=function(){return 0==this._offsetCoord.x&&0==this._offsetCoord.y},h.prototype.isScreenTopPosition=function(){var t=this.getScreenTopPosition();return this.equals(t)},h.prototype.equals=function(t){return this._partsCoord.equals(t.getPartsCoord())&&this._offsetCoord.equals(t.getOffsetCoord())},h.prototype.isInCameraRange=function(t,e){void 0===e&&(e=!1);var a=t.getPosition()._partsCoord,s=this._partsCoord.x,i=this._partsCoord.y,o=e?1:0;return a.x<=s&&s<a.x+T.H_PARTS_NUM_IN_WINDOW-o&&a.y<=i&&i<a.y+T.V_PARTS_NUM_IN_WINDOW-o},h.prototype.hasLocalGate=function(){return this._wwa.getMapTypeByPosition(this)===T.MAP_LOCALGATE||this._wwa.getObjectTypeByPosition(this)===T.OBJECT_LOCALGATE},h.prototype.clone=function(){return new h(this._wwa,this._partsCoord.x,this._partsCoord.y,this._offsetCoord.x,this._offsetCoord.y)},h}();d.Position=a;var s,i,o,_,n,h,w,c,u,p,l,E,m,y,g,S,I,A,C=function(t,e,a){this.destPos=t.clone(),this.srcPos=e.clone(),this.srcSize=a.clone()};d.Face=C,(i=s=d.Direction||(d.Direction={}))[i.LEFT=0]="LEFT",i[i.RIGHT=1]="RIGHT",i[i.DOWN=2]="DOWN",i[i.UP=3]="UP",i[i.LEFT_DOWN=4]="LEFT_DOWN",i[i.LEFT_UP=5]="LEFT_UP",i[i.RIGHT_DOWN=6]="RIGHT_DOWN",i[i.RIGHT_UP=7]="RIGHT_UP",i[i.NO_DIRECTION=8]="NO_DIRECTION",d.vx=[-1,1,0,0,-1,-1,1,1,0],d.vy=[0,0,1,-1,1,-1,1,-1,0],d.dirToPos=[4,6,2,0],d.dirToKey=[wwa_input.KeyCode.KEY_LEFT,wwa_input.KeyCode.KEY_RIGHT,wwa_input.KeyCode.KEY_DOWN,wwa_input.KeyCode.KEY_UP],(o=d.YesNoState||(d.YesNoState={}))[o.YES=0]="YES",o[o.NO=1]="NO",o[o.UNSELECTED=2]="UNSELECTED",(_=d.AppearanceTriggerType||(d.AppearanceTriggerType={}))[_.MAP=0]="MAP",_[_.OBJECT=1]="OBJECT",_[_.CHOICE_YES=2]="CHOICE_YES",_[_.CHOICE_NO=3]="CHOICE_NO",(n=d.ItemMode||(d.ItemMode={}))[n.NORMAL=0]="NORMAL",n[n.CAN_USE=1]="CAN_USE",n[n.NOT_DISAPPEAR=2]="NOT_DISAPPEAR",(h=d.PartsType||(d.PartsType={}))[h.MAP=1]="MAP",h[h.OBJECT=0]="OBJECT",(w=d.ChoiceCallInfo||(d.ChoiceCallInfo={}))[w.NONE=0]="NONE",w[w.CALL_BY_MAP_PARTS=1]="CALL_BY_MAP_PARTS",w[w.CALL_BY_OBJECT_PARTS=2]="CALL_BY_OBJECT_PARTS",w[w.CALL_BY_ITEM_USE=3]="CALL_BY_ITEM_USE",w[w.CALL_BY_QUICK_SAVE=4]="CALL_BY_QUICK_SAVE",w[w.CALL_BY_QUICK_LOAD=5]="CALL_BY_QUICK_LOAD",w[w.CALL_BY_RESTART_GAME=6]="CALL_BY_RESTART_GAME",w[w.CALL_BY_GOTO_WWA=7]="CALL_BY_GOTO_WWA",w[w.CALL_BY_PASSWORD_SAVE=8]="CALL_BY_PASSWORD_SAVE",w[w.CALL_BY_PASSWORD_LOAD=9]="CALL_BY_PASSWORD_LOAD",(c=d.SidebarButton||(d.SidebarButton={}))[c.QUICK_LOAD=0]="QUICK_LOAD",c[c.QUICK_SAVE=1]="QUICK_SAVE",c[c.RESTART_GAME=2]="RESTART_GAME",c[c.GOTO_WWA=3]="GOTO_WWA",(u=d.SpeedChange||(d.SpeedChange={}))[u.UP=0]="UP",u[u.DOWN=1]="DOWN",(p=d.LoadType||(d.LoadType={}))[p.QUICK_LOAD=0]="QUICK_LOAD",p[p.RESTART_GAME=1]="RESTART_GAME",p[p.PASSWORD=2]="PASSWORD",(l=d.MoveType||(d.MoveType={}))[l.STATIC=0]="STATIC",l[l.CHASE_PLAYER=1]="CHASE_PLAYER",l[l.RUN_OUT=2]="RUN_OUT",l[l.HANG_AROUND=3]="HANG_AROUND",(E=d.SecondCandidateMoveType||(d.SecondCandidateMoveType={}))[E.MODE_X=0]="MODE_X",E[E.MODE_Y=1]="MODE_Y",E[E.UNDECIDED=2]="UNDECIDED",d.sidebarButtonCellElementID=["cell-load","cell-save","cell-restart","cell-gotowwa"],(m=d.SystemMessage1||(d.SystemMessage1={}))[m.ASK_LINK=5]="ASK_LINK",m[m.NO_MONEY=6]="NO_MONEY",m[m.NO_ITEM=7]="NO_ITEM",m[m.USE_ITEM=8]="USE_ITEM",(y=d.SystemMessage2||(d.SystemMessage2={}))[y.CLICKABLE_ITEM=0]="CLICKABLE_ITEM",y[y.FULL_ITEM=1]="FULL_ITEM",y[y.LOAD_SE=2]="LOAD_SE",(g=d.MacroType||(d.MacroType={}))[g.UNDEFINED=0]="UNDEFINED",g[g.IMGPLAYER=1]="IMGPLAYER",g[g.IMGYESNO=2]="IMGYESNO",g[g.HPMAX=3]="HPMAX",g[g.SAVE=4]="SAVE",g[g.ITEM=5]="ITEM",g[g.DEFAULT=6]="DEFAULT",g[g.OLDMAP=7]="OLDMAP",g[g.PARTS=8]="PARTS",g[g.MOVE=9]="MOVE",g[g.MAP=10]="MAP",g[g.DIRMAP=11]="DIRMAP",g[g.IMGFRAME=12]="IMGFRAME",g[g.IMGBOM=13]="IMGBOM",g[g.DELPLAYER=14]="DELPLAYER",g[g.FACE=15]="FACE",g[g.EFFECT=16]="EFFECT",g[g.GAMEOVER=17]="GAMEOVER",g[g.IMGCLICK=18]="IMGCLICK",g[g.STATUS=19]="STATUS",g[g.EFFITEM=20]="EFFITEM",g[g.COLOR=21]="COLOR",g[g.WAIT=22]="WAIT",g[g.SOUND=23]="SOUND",d.macrotable={"":0,$imgplayer:1,$imgyesno:2,$hpmax:3,$save:4,$item:5,$default:6,$oldmap:7,$parts:8,$move:9,$map:10,$dirmap:11,$imgframe:12,$imgbom:13,$delplayer:14,$face:15,$effect:16,$gameover:17,$imgclick:18,$status:19,$effitem:20,$color:21,$wait:22,$sound:23},(S=d.MacroStatusIndex||(d.MacroStatusIndex={}))[S.ENERGY=0]="ENERGY",S[S.STRENGTH=1]="STRENGTH",S[S.DEFENCE=2]="DEFENCE",S[S.GOLD=3]="GOLD",S[S.MOVES=4]="MOVES",(I=d.MacroImgFrameIndex||(d.MacroImgFrameIndex={}))[I.ENERGY=0]="ENERGY",I[I.STRENGTH=1]="STRENGTH",I[I.DEFENCE=2]="DEFENCE",I[I.GOLD=3]="GOLD",I[I.WIDE_CELL_ROW=4]="WIDE_CELL_ROW",I[I.ITEM_BG=5]="ITEM_BG",I[I.MAIN_FRAME=6]="MAIN_FRAME",(A=d.SystemSound||(d.SystemSound={}))[A.DECISION=1]="DECISION",A[A.ATTACK=3]="ATTACK",A[A.BGM_LB=70]="BGM_LB",A[A.NO_SOUND=99]="NO_SOUND",d.speedList=[2,5,8,10],d.speedNameList=["低速","準低速","中速","高速"];var T=function(){function t(){}return t.VERSION_WWAJS="W3.14++",t.WWA_HOME="http://wwajp.com",t.ITEMBOX_SIZE=12,t.MAP_ATR_MAX=60,t.OBJ_ATR_MAX=60,t.OLD_MAP_ATR_MAX=40,t.OLD_OBJ_ATR_MAX=40,t.ATR_TYPE=3,t.ATR_MODE=4,t.ATR_STRING=5,t.ATR_X=6,t.ATR_Y=7,t.ATR_X2=8,t.ATR_Y2=9,t.ATR_ENERGY=10,t.ATR_STRENGTH=11,t.ATR_DEFENCE=12,t.ATR_GOLD=13,t.ATR_ITEM=14,t.ATR_NUMBER=15,t.ATR_JUMP_X=16,t.ATR_MOVE=16,t.ATR_JUMP_Y=17,t.ATR_SOUND=19,t.ATR_APPERANCE_BASE=20,t.REL_ATR_APPERANCE_ID=0,t.REL_ATR_APPERANCE_X=1,t.REL_ATR_APPERANCE_Y=2,t.REL_ATR_APPERANCE_TYPE=3,t.REL_ATR_APPERANCE_UNIT_LENGTH=4,t.ATR_RANDOM_BASE=10,t.RANDOM_ATR_NUM=10,t.RANDOM_ITERATION_MAX=10,t.MAP_STREET=0,t.MAP_WALL=1,t.MAP_LOCALGATE=2,t.MAP_URLGATE=4,t.OBJECT_NORMAL=0,t.OBJECT_MESSAGE=1,t.OBJECT_URLGATE=2,t.OBJECT_STATUS=3,t.OBJECT_ITEM=4,t.OBJECT_DOOR=5,t.OBJECT_MONSTER=6,t.OBJECT_SCORE=11,t.OBJECT_SELL=14,t.OBJECT_BUY=15,t.OBJECT_RANDOM=16,t.OBJECT_SELECT=17,t.OBJECT_LOCALGATE=18,t.SYSTEM_MESSAGE_NUM=20,t.IMGPOS_DEFAULT_YESNO_X=3,t.IMGPOS_DEFAULT_YESNO_Y=1,t.IMGRELPOS_YESNO_YES_X=0,t.IMGRELPOS_YESNO_NO_X=1,t.IMGRELPOS_YESNO_YESP_X=2,t.IMGRELPOS_YESNO_NOP_X=3,t.IMGPOS_DEFAULT_PLAYER_X=2,t.IMGPOS_DEFAULT_PLAYER_Y=0,t.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X=0,t.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y=0,t.IMGPOS_DEFAULT_FRAME_X=0,t.IMGPOS_DEFAULT_FRAME_Y=1,t.IMGPOS_DEFAULT_BATTLE_EFFECT_X=3,t.IMGPOS_DEFAULT_BATTLE_EFFECT_Y=3,t.DEFAULT_DISABLE_SAVE=!1,t.DEFAULT_OLDMAP=!1,t.DEFAULT_OBJECT_NO_COLLAPSE=!1,t.SPLASH_SCREEN_DISP_MILLS=100,t.DEFAULT_FRAME_INTERVAL=20,t.GAMEOVER_FRAME_INTERVAL=50,t.YESNO_PRESS_DISP_FRAME_NUM=20,t.CHIP_SIZE=40,t.MAP_WINDOW_WIDTH=440,t.MAP_WINDOW_HEIGHT=440,t.H_PARTS_NUM_IN_WINDOW=t.MAP_WINDOW_WIDTH/t.CHIP_SIZE,t.V_PARTS_NUM_IN_WINDOW=t.MAP_WINDOW_HEIGHT/t.CHIP_SIZE,t.DEFAULT_SPEED_INDEX=2,t.MIN_SPEED_INDEX=0,t.MAX_SPEED_INDEX=d.speedList.length-1,t.PLAYER_LOOKING_AROUND_START_FRAME=4*(t.ANIMATION_REP_HALF_FRAME=22),t.RELATIVE_COORD_LOWER=(t.RELATIVE_COORD_BIAS=1e4)-1e3,t.PLAYER_COORD=t.RELATIVE_COORD_BIAS-1e3,t.LOCALGATE_PLAYER_WAIT_FRAME=5,t.STATUS_CHANGED_EFFECT_FRAME_NUM=20,t.PASSABLE_OBJECT=1,t.APPERANCE_PARTS_MIN_INDEX=0,t.APPERANCE_PARTS_MAX_INDEX=9,t.APPERANCE_PARTS_MIN_INDEX_NO=5,t.APPERANCE_PARTS_MAX_INDEX_YES=4,t.FADEOUT_SPEED=8,t.STATUS_MINUS_BORDER=3e4,t.ITEMBOX_IS_FULL=-1,t.BATTLE_INTERVAL_FRAME_NUM=10,t.BATTLE_SPEED_CHANGE_TURN_NUM=40,t.RANDOM_MOVE_ITERATION_NUM=50,t.BATTLE_ESTIMATE_MONSTER_TYPE_MAX=8,t.SOUND_MAX=100,t.ITEM_BORDER_IMG_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAArklEQVRYR+2Y0QqAIAxFt///aENJHwxxuJUSxzeh3S7HXaNpEkly4FIRzba0GEyHeVTN7jqDWvb7V4Y1NLibZIY0NbiL5G3MZLCe / 1fn3XJgJYjB7mgg6O1VCEKwXo79JeklY62nB62kRs9BEIKkeNIDhISQEBJC4k0BBCF4D7D4cV9shf99ixdB + MrM0y3fa3zV05D45GOqhwPMGPkYlccIOEY2VKUN0UNVXxC7ADj7mDi9aFZZAAAAAElFTkSuQmCC",t.LOAD_STAGE_MAX_EXCEPT_AUDIO=7,t.WWA_STYLE_TAG_ID="wwa-additional-style",t.DEFAULT_FRAME_COLOR_R=255,t.DEFAULT_FRAME_COLOR_G=255,t.DEFAULT_FRAME_COLOR_B=255,t.DEFAULT_FRAMEOUT_COLOR_R=96,t.DEFAULT_FRAMEOUT_COLOR_G=96,t.DEFAULT_FRAMEOUT_COLOR_B=96,t.DEFAULT_STRBACK_COLOR_R=0,t.DEFAULT_STRBACK_COLOR_G=0,t.DEFAULT_STRBACK_COLOR_B=0,t.DEFAULT_STATUS_COLOR_R=0,t.DEFAULT_STATUS_COLOR_G=0,t.DEFAULT_STATUS_COLOR_B=0,t.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM=20,t.WWAP_SERVER="http://wwawing.com/wwap",t.WWAP_SERVER_AUDIO_DIR="audio",t.WWAP_SERVER_TITLE_IMG="cover_p.gif",t.WWAP_SERVER_LOADER_NO_WORKER="wwaload.noworker.js",t}();d.WWAConsts=T;var f=function(){};d.LoaderResponse=f;var P=function(){};d.LoaderError=P;var O,N,D,M=function(){};d.LoaderProgress=M,(O=d.LoadStage||(d.LoadStage={}))[O.INIT=0]="INIT",O[O.MAP_LOAD=1]="MAP_LOAD",O[O.OBJ_LOAD=2]="OBJ_LOAD",O[O.MAP_ATTR=3]="MAP_ATTR",O[O.OBJ_ATTR=4]="OBJ_ATTR",O[O.RAND_PARTS=5]="RAND_PARTS",O[O.MESSAGE=6]="MESSAGE",O[O.GAME_INIT=7]="GAME_INIT",O[O.AUDIO=8]="AUDIO",d.loadMessages=["ロードの準備をしています。","背景パーツを読み込んでいます。","物体パーツを読み込んでます。","背景パーツの属性を読み込んでます。","物体パーツの属性を読み込んでます。","ランダムパーツを置換しています。","メッセージを読み込んでます。","Welcome to WWA Wing!"],(N=d.ChangeStyleType||(d.ChangeStyleType={}))[N.COLOR_FRAME=0]="COLOR_FRAME",N[N.COLOR_FRAMEOUT=1]="COLOR_FRAMEOUT",N[N.COLOR_STR=2]="COLOR_STR",N[N.COLOR_STATUS_STR=4]="COLOR_STATUS_STR",(D=d.SelectorType||(d.SelectorType={}))[D.MESSAGE_WINDOW=0]="MESSAGE_WINDOW",D[D.SIDEBAR=1]="SIDEBAR";var v=function(){this.version=void 0,this.gameoverX=void 0,this.gameoverY=void 0,this.playerX=void 0,this.playerY=void 0,this.mapPartsMax=void 0,this.objPartsMax=void 0,this.isOldMap=void 0,this.statusEnergyMax=void 0,this.statusEnergy=void 0,this.statusStrength=void 0,this.statusDefence=void 0,this.statusGold=void 0,this.itemBox=void 0,this.mapWidth=void 0,this.messageNum=void 0,this.map=void 0,this.mapObject=void 0,this.mapCompressed=void 0,this.mapObjectCompressed=void 0,this.mapAttribute=void 0,this.objectAttribute=void 0,this.worldPassword=void 0,this.message=void 0,this.worldName=void 0,this.worldPassNumber=void 0,this.charCGName=void 0,this.mapCGName=void 0,this.systemMessage=void 0,this.moves=void 0,this.yesnoImgPosX=void 0,this.yesnoImgPosY=void 0,this.playerImgPosX=void 0,this.playerImgPosY=void 0,this.clickableItemSignImgPosX=void 0,this.clickableItemSignImgPosY=void 0,this.disableSaveFlag=void 0,this.compatibleForOldMapFlag=void 0,this.objectNoCollapseDefaultFlag=void 0,this.delPlayerFlag=void 0,this.bgm=void 0,this.imgClickX=void 0,this.imgClickY=void 0,this.frameColorR=void 0,this.frameColorG=void 0,this.frameColorB=void 0,this.frameOutColorR=void 0,this.frameOutColorG=void 0,this.frameOutColorB=void 0,this.fontColorR=void 0,this.fontColorG=void 0,this.fontColorB=void 0,this.statusColorR=void 0,this.statusColorG=void 0,this.statusColorB=void 0,this.checkOriginalMapString=void 0,this.checkString=void 0};d.WWAData=v}(wwa_data||(wwa_data={})),function(t){var n=wwa_data.Direction,h=wwa_data.WWAConsts,e=function(){function t(t){this._position=t}return t.prototype.getPosition=function(){return this._position},t}(),a=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(e);t.PartsObject=a;var d,s,i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(e);t.PartsMap=i,(s=d||(d={}))[s.CONTROLLABLE=0]="CONTROLLABLE",s[s.MOVING=1]="MOVING",s[s.CAMERA_MOVING=2]="CAMERA_MOVING",s[s.MESSAGE_WAITING=3]="MESSAGE_WAITING",s[s.LOCALGATE_JUMPED=4]="LOCALGATE_JUMPED",s[s.BATTLE=5]="BATTLE",s[s.ESTIMATE_WINDOW_WAITING=6]="ESTIMATE_WINDOW_WAITING",s[s.PASSWORD_WINDOW_WAITING=7]="PASSWORD_WINDOW_WAITING";var o=function(_){function t(t,e,a,s,i){var o=_.call(this,e)||this;o._status=s,o._equipStatus=new wwa_data.EquipmentStatus(0,0),o._itemBox=new Array(h.ITEMBOX_SIZE),o._itemBoxElement=new Array(h.ITEMBOX_SIZE),o._itemUsingEvent=new Array(h.ITEMBOX_SIZE);for(var r=0;r<o._itemBox.length;r++)o._itemBox[r]=0,o._itemBoxElement[r]=wwa_util.$qsh("#item"+r+">.item-disp");return o.updateItemBox(),o._energyMax=i,o._dir=n.DOWN,o._wwa=t,o._state=d.CONTROLLABLE,o._camera=a,o._isPartsEventExecuted=!1,o._energyValueElement=wwa_util.$qsh("#disp-energy>.status-value-box"),o._strengthValueElement=wwa_util.$qsh("#disp-strength>.status-value-box"),o._defenceValueElement=wwa_util.$qsh("#disp-defence>.status-value-box"),o._goldValueElement=wwa_util.$qsh("#disp-gold>.status-value-box"),o._isReadyToUseItem=!1,o._isClickableItemGot=!1,o._moves=0,o._moveMacroWaitingRemainMoves=0,o._moveObjectAutoExecTimer=0,o.updateStatusValueBox(),o._partsAppeared=!1,o._afterMoveMacroFlag=!1,o._isPreparedForLookingAround=!0,o._lookingAroundTimer=h.PLAYER_LOOKING_AROUND_START_FRAME,o._speedIndex=h.DEFAULT_SPEED_INDEX,o}return __extends(t,_),t.prototype.move=function(){if(this.isControllable())this.controll(this._dir);else if(this._state===d.CAMERA_MOVING){try{this._camera.move(this._dir)}catch(t){}this._isOnCameraStopPosition()&&(this._state=d.CONTROLLABLE)}else if(this._state===d.MOVING){try{var t=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex])}catch(t){}t.isJustPosition()&&(this._state=d.CONTROLLABLE,this._moves++,this._isPartsEventExecuted=!1,this._samePosLastExecutedMapID=void 0,this._samePosLastExecutedObjID=void 0),this._position=t}},t.prototype.controll=function(t){var e,a;if(this.isControllable()){this._isPreparedForLookingAround=!1,this._dir=t;try{e=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex]),a=this._position.getNextJustPosition(t)}catch(t){return}if(this._isOnCameraMovingPosition()){if(0!==this._wwa.getMapIdByPosition(a)||this._wwa.isOldMap()||this._wwa.debug)try{this._camera.move(this._dir),this._state=d.CAMERA_MOVING}catch(t){this._state=d.CONTROLLABLE}return}if(!this.canMoveTo(a))return this._wwa.getMapTypeByPosition(a)===h.MAP_WALL&&this._wwa.checkMap(a.getPartsCoord()),void this._wwa.checkObject(a.getPartsCoord());this._position=e,this._state=d.MOVING,this._wwa.getMapAttributeByPosition(this._position.getNextJustPosition(t),h.ATR_TYPE)!==h.MAP_LOCALGATE&&this._wwa.moveObjects(!0)}},t.prototype.canMoveTo=function(t){if(null===t)return!1;if(this._wwa.debug)return!0;this._wwa.getMapWidth(),t.getPartsCoord(),t.getOffsetCoord();return!(0===this._wwa.getMapIdByPosition(t)&&!this._wwa.isOldMap())&&(this._wwa.getMapTypeByPosition(t)!==h.MAP_WALL&&(0===this._wwa.getObjectIdByPosition(t)||(this._wwa.getObjectTypeByPosition(t)===h.OBJECT_NORMAL&&this._wwa.getObjectAttributeByPosition(t,h.ATR_MODE)===h.PASSABLE_OBJECT||this._wwa.getObjectTypeByPosition(t)===h.OBJECT_DOOR&&this._wwa.getObjectAttributeByPosition(t,h.ATR_NUMBER)===h.PASSABLE_OBJECT&&!this.hasItem(this._wwa.getObjectAttributeByPosition(t,h.ATR_ITEM)))))},t.prototype.isMoving=function(){return this._state==d.MOVING||this._state==d.CAMERA_MOVING},t.prototype._isOnCameraMovingPosition=function(){var t=this._camera.getPosition().getPartsCoord(),e=this.getPosition().getPartsCoord();return e.x-t.x==h.H_PARTS_NUM_IN_WINDOW-1&&this._dir===n.RIGHT||e.x===t.x&&this._dir===n.LEFT||e.y-t.y==h.V_PARTS_NUM_IN_WINDOW-1&&this._dir===n.DOWN||e.y===t.y&&this._dir===n.UP},t.prototype._isOnCameraStopPosition=function(){var t=this._camera.getPosition().getPartsCoord(),e=this.getPosition().getPartsCoord();return e.x-t.x==h.H_PARTS_NUM_IN_WINDOW-1&&this._dir===n.LEFT||e.x===t.x&&this._dir===n.RIGHT||e.y-t.y==h.V_PARTS_NUM_IN_WINDOW-1&&this._dir===n.UP||e.y===t.y&&this._dir===n.DOWN},t.prototype.isControllable=function(){var t=this._afterMoveMacroFlag;return this._afterMoveMacroFlag=!1,this._state===d.CONTROLLABLE&&!this._partsAppeared&&(this._wwa.getMapTypeByPosition(this._position)!==h.MAP_LOCALGATE&&this._wwa.getMapTypeByPosition(this._position)!==h.MAP_URLGATE||!this._wwa.isPrevFrameEventExecuted())&&0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&!t&&this._wwa.canInput()},t.prototype.getCopyOfItemBox=function(){return this._itemBox.slice()},t.prototype.getDir=function(){return this._dir},t.prototype.getEnergyMax=function(){return this._energyMax},t.prototype.isJumped=function(){return this._state===d.LOCALGATE_JUMPED},t.prototype.setMessageWaiting=function(){this._state=d.MESSAGE_WAITING},t.prototype.isWaitingMessage=function(){return this._state===d.MESSAGE_WAITING},t.prototype.clearMessageWaiting=function(){this._state===d.MESSAGE_WAITING&&(this._state=d.CONTROLLABLE,this._isPartsEventExecuted=!0,this._isPreparedForLookingAround&&(this._lookingAroundTimer=h.PLAYER_LOOKING_AROUND_START_FRAME))},t.prototype.setEstimateWindowWating=function(){this._state=d.ESTIMATE_WINDOW_WAITING},t.prototype.isWatingEstimateWindow=function(){return this._state===d.ESTIMATE_WINDOW_WAITING},t.prototype.clearEstimateWindowWaiting=function(){this._state===d.ESTIMATE_WINDOW_WAITING&&(this._state=d.CONTROLLABLE)},t.prototype.setPasswordWindowWating=function(){this._state=d.PASSWORD_WINDOW_WAITING},t.prototype.isWaitingPasswordWindow=function(){return this._state===d.PASSWORD_WINDOW_WAITING},t.prototype.clearPasswordWindowWaiting=function(){this._state===d.PASSWORD_WINDOW_WAITING&&(this._state=d.CONTROLLABLE)},t.prototype.isPartsEventExecuted=function(){return this._isPartsEventExecuted},t.prototype.resetEventExecutionInfo=function(){this._isPartsEventExecuted=!1},t.prototype.getLastExecPartsIDOnSamePosition=function(t){return t===wwa_data.PartsType.MAP?this._samePosLastExecutedMapID:this._samePosLastExecutedObjID},t.prototype.setLastExecInfoOnSamePosition=function(t,e){t===wwa_data.PartsType.MAP?this._samePosLastExecutedMapID=e:this._samePosLastExecutedObjID=e},t.prototype.processAfterJump=function(){this._state===d.LOCALGATE_JUMPED&&0==--this._jumpWaitFramesRemain&&(this._state=d.CONTROLLABLE)},t.prototype.jumpTo=function(t){var e=this._camera.getPosition();this.getPosition();return!this._position.equals(t)&&((this._position=t).isInCameraRange(this._camera,!0)||this._camera.reset(t),this._state=d.LOCALGATE_JUMPED,this._jumpWaitFramesRemain=h.LOCALGATE_PLAYER_WAIT_FRAME,this._samePosLastExecutedMapID=void 0,this._samePosLastExecutedObjID=void 0,t.hasLocalGate()?this._dir=n.DOWN:t.getPartsCoord().y<=this._wwa.getMapWidth()-2&&t.getNextJustPosition(n.DOWN).hasLocalGate()?this._dir=n.UP:1<=t.getPartsCoord().y&&t.getNextJustPosition(n.UP).hasLocalGate()?this._dir=n.DOWN:t.getPartsCoord().x<=this._wwa.getMapWidth()-2&&t.getNextJustPosition(n.RIGHT).hasLocalGate()?this._dir=n.LEFT:1<=t.getPartsCoord().x&&t.getNextJustPosition(n.LEFT).hasLocalGate()?this._dir=n.RIGHT:this._dir=n.DOWN,this._camera.getPosition().equals(e)||(this._isPreparedForLookingAround=!0,this._lookingAroundTimer=h.PLAYER_LOOKING_AROUND_START_FRAME),!0)},t.prototype.systemJumpTo=function(t){this._position=t,this._camera.reset(t),this._camera.resetPreviousPosition(),this._state=d.LOCALGATE_JUMPED,this._jumpWaitFramesRemain=h.LOCALGATE_PLAYER_WAIT_FRAME,this._samePosLastExecutedMapID=void 0,this._samePosLastExecutedObjID=void 0,this._dir=n.DOWN,this._isPreparedForLookingAround=!0,this._lookingAroundTimer=h.PLAYER_LOOKING_AROUND_START_FRAME},t.prototype.addStatusAll=function(t){return this._status.add(t),this.isDead()&&(this._status.energy=0),0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax)),this.updateStatusValueBox(),this._status},t.prototype.setEnergyMax=function(t){return 0!==(this._energyMax=t)&&(this._status.energy=Math.min(this._status.energy,this._energyMax)),this.updateStatusValueBox(),t},t.prototype.setEnergy=function(t){return this._status.energy=t,this.isDead()&&(this._status.energy=0),0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax)),this.updateStatusValueBox(),t},t.prototype.damage=function(t){this._status.energy=Math.max(0,this._status.energy-t),this.isDead()&&(this._status.energy=0),0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax)),this.updateStatusValueBox()},t.prototype.setStrength=function(t){return this._status.strength=t},t.prototype.setDefence=function(t){return this._status.defence=t,this.updateStatusValueBox(),t},t.prototype.setGold=function(t){return this._status.gold=t,this.updateStatusValueBox(),t},t.prototype.getStatus=function(){return this._status.plus(this._equipStatus)},t.prototype.getStatusWithoutEquipments=function(){return this._status.plus(new wwa_data.EquipmentStatus(0,0))},t.prototype.updateStatusValueBox=function(){var t=this._status.plus(this._equipStatus),e=t.energy,a=t.strength,s=t.defence,i=t.gold;this._energyValueElement.textContent=e+"",this._strengthValueElement.textContent=a+"",this._defenceValueElement.textContent=s+"",this._goldValueElement.textContent=i+""},t.prototype.updateItemBox=function(){for(var t,e,a=0;a<this._itemBoxElement.length;a++)0===this._itemBox[a]?this._itemBoxElement[a].style.backgroundPosition="-40px 0px":(t=this._wwa.getObjectCropXById(this._itemBox[a]),e=this._wwa.getObjectCropYById(this._itemBox[a]),this._itemBoxElement[a].style.backgroundPosition="-"+t+"px -"+e+"px")},t.prototype.isDead=function(){return this._status.energy<=0},t.prototype.addItem=function(t,e,a){var s,i,o;void 0===e&&(e=0),void 0===a&&(a=!1);var r=this._wwa.getObjectAttributeById(t,h.ATR_NUMBER);if(0===e&&0!==r&&(e=r),0===e){if(0===t)return;if((s=this._getBlankItemPos())===h.ITEMBOX_IS_FULL)throw new Error("これ以上、アイテムを持てません。");this._forceSetItemBox(s,t)}else if(!1===a)if(s=e,o=this._itemBox[s-1],this._wwa.getObjectAttributeById(o,h.ATR_NUMBER)!==this._wwa.getObjectAttributeById(t,h.ATR_NUMBER)){if((i=this._getBlankItemPos())===h.ITEMBOX_IS_FULL)throw new Error("これ以上、アイテムを持てません。");this._forceSetItemBox(i,o),this._forceSetItemBox(s,t)}else this._forceSetItemBox(s,t);else s=e,this._forceSetItemBox(s,t);this._updateEquipmentStatus(),this.updateItemBox()},t.prototype._forceSetItemBox=function(t,e){var a,s=this,i=wwa_util.$qsh("#item"+(t-1)+">.item-click-border"),o=this._wwa.getObjectAttributeById(e,h.ATR_MODE);if(this.removeItemByItemPosition(t),0!==(this._itemBox[t-1]=e)&&o!==wwa_data.ItemMode.NORMAL){var r=this._wwa.getSystemMessageById(wwa_data.SystemMessage2.CLICKABLE_ITEM);this._isClickableItemGot||("BLANK"!==r&&this._wwa.setMessageQueue(""===r?"このアイテムは右のボックスをクリックすることで使用できます。\n使用できるアイテムは色枠で囲まれます。":r,!1,!0),this._isClickableItemGot=!0),i.style.display="block",a=t,s._itemUsingEvent[a-1]=function(){s.isControllable()&&s._wwa.onselectitem(a)},i.addEventListener("click",this._itemUsingEvent[t-1])}},t.prototype._getBlankItemPos=function(){var t;for(t=1;t<this._itemBox.length+1;t++)if(0===this._itemBox[t-1])return t;return h.ITEMBOX_IS_FULL},t.prototype._updateEquipmentStatus=function(){var t,e=new wwa_data.EquipmentStatus(0,0);for(t=0;t<h.ITEMBOX_SIZE;t++)0!==this._itemBox[t]&&(e.strength+=this._wwa.getObjectAttributeById(this._itemBox[t],h.ATR_STRENGTH),e.defence+=this._wwa.getObjectAttributeById(this._itemBox[t],h.ATR_DEFENCE));var a=e.minus(this._equipStatus);this._wwa.setStatusChangedEffect(a),this._equipStatus=e,this.updateStatusValueBox()},t.prototype.hasItem=function(t){for(var e=0;e<h.ITEMBOX_SIZE;e++)if(this._itemBox[e]===t)return!0;return!1},t.prototype.canUseItem=function(t){var e=this._itemBox[t-1];return 0!==e&&this._wwa.getObjectAttributeById(e,h.ATR_MODE)!==wwa_data.ItemMode.NORMAL},t.prototype.useItem=function(){var t;t=this._itemBox[this._readyToUseItemPos-1],this._wwa.getObjectAttributeById(t,h.ATR_MODE)!==wwa_data.ItemMode.NOT_DISAPPEAR&&this.removeItemByItemPosition(this._readyToUseItemPos);var e=wwa_util.$id("item"+(this._readyToUseItemPos-1));return setTimeout(function(){e.classList.contains("onpress")&&e.classList.remove("onpress")},h.DEFAULT_FRAME_INTERVAL),this._isReadyToUseItem=!1,this._readyToUseItemPos=void 0,t},t.prototype.canHaveMoreItems=function(){return this._getBlankItemPos()!==h.ITEMBOX_IS_FULL},t.prototype.removeItemByItemPosition=function(t){var e;0!==this._itemBox[t-1]&&(this._wwa.getObjectAttributeById(this._itemBox[t-1],h.ATR_MODE)!==wwa_data.ItemMode.NORMAL&&((e=wwa_util.$qsh("#item"+(t-1)+">.item-click-border")).removeEventListener("click",this._itemUsingEvent[t-1]),e.style.display="none"),this._itemBox[t-1]=0,this._updateEquipmentStatus(),this.updateItemBox())},t.prototype.removeItemByPartsID=function(t){var e;if(!this.hasItem(t))throw new Error("アイテムを持っていない");for(var a=0;a<h.ITEMBOX_SIZE;a++)if(this._itemBox[a]===t)return this._wwa.getObjectAttributeById(this._itemBox[a],h.ATR_MODE)!==wwa_data.ItemMode.NORMAL&&((e=wwa_util.$qsh("#item"+a+">.item-click-border")).removeEventListener("click",this._itemUsingEvent[a]),e.style.display="none"),this._itemBox[a]=0,this._updateEquipmentStatus(),void this.updateItemBox()},t.prototype.clearItemBox=function(){for(var t=1;t<=h.ITEMBOX_SIZE;t++)this.removeItemByItemPosition(t);this._updateEquipmentStatus(),this.updateItemBox()},t.prototype.hasGold=function(t){return this._status.gold>=t},t.prototype.payGold=function(t){if(!this.hasGold(t))throw new Error("お金が足りない");this.setGold(this._status.gold-t)},t.prototype.earnGold=function(t){this.setGold(this._status.gold+t)},t.prototype.setPartsAppearedFlag=function(){this._partsAppeared=!0},t.prototype.clearPartsAppearedFlag=function(){this._partsAppeared=!1},t.prototype.isPartsAppearedTime=function(){return!0===this._partsAppeared},t.prototype.startBattleWith=function(t){this._isPlayerTurn=!0,this._battleFrameCounter=h.BATTLE_INTERVAL_FRAME_NUM,this._battleTurnNum=0,this._enemy=t,this._state=d.BATTLE},t.prototype.isFighting=function(){return this._state===d.BATTLE},t.prototype.isTurn=function(){return this._isPlayerTurn},t.prototype.getTurnNum=function(){return this._battleTurnNum},t.prototype.isBattleStartFrame=function(){return this._battleFrameCounter===h.BATTLE_INTERVAL_FRAME_NUM&&0===this._battleTurnNum},t.prototype.fight=function(){if(!this.isFighting())throw new Error("バトルが開始されていません。");if(0===this._battleTurnNum&&this._battleFrameCounter===h.BATTLE_INTERVAL_FRAME_NUM&&this._wwa.showMonsterWindow(),!(0<--this._battleFrameCounter)){this._battleTurnNum++,this._speedIndex===h.MAX_SPEED_INDEX||this._battleTurnNum>h.BATTLE_SPEED_CHANGE_TURN_NUM?(1===this._battleTurnNum&&this._wwa.playSound(wwa_data.SystemSound.ATTACK),this._battleFrameCounter=1):(this._battleFrameCounter=h.BATTLE_INTERVAL_FRAME_NUM,this._wwa.playSound(wwa_data.SystemSound.ATTACK));var t=this.getStatus(),e=this._enemy.status;if(this._isPlayerTurn){if(t.strength>e.defence||t.defence<e.strength)return e.energy>t.strength-e.defence?t.strength>e.defence&&this._enemy.damage(t.strength-e.defence):(this._wwa.playSound(this._wwa.getObjectAttributeById(this._enemy.partsID,h.ATR_SOUND)),this.earnGold(e.gold),this._wwa.setStatusChangedEffect(new wwa_data.Status(0,0,0,e.gold)),0!==this._enemy.item?this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._enemy.item,this._enemy.position):this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,0,this._enemy.position),this._wwa.appearParts(this._enemy.position,wwa_data.AppearanceTriggerType.OBJECT,this._enemy.partsID),this._state=d.CONTROLLABLE,this._wwa.setMessageQueue(this._enemy.message,!1,!1),this._enemy.battleEndProcess(),this._battleTurnNum=0,this._enemy=null),void(this._isPlayerTurn=!1);this._enemy.battleEndProcess(),this._wwa.setMessageQueue("相手の防御能力が高すぎる！",!1,!0),this._battleTurnNum=0,this._enemy=null}else e.strength>t.defence&&(t.energy>e.strength-t.defence?this.damage(e.strength-t.defence):(this.setEnergy(0),this._enemy.battleEndProcess(),this._state=d.CONTROLLABLE,this._battleTurnNum=0,this._enemy=null,this._wwa.gameover()));this._isPlayerTurn=!0}},t.prototype.readyToUseItem=function(t){var e;if(!this.canUseItem(t))throw new Error("アイテムがないか、アイテムが使えません。");e=this._itemBox[t-1],this._wwa.getObjectAttributeById(e,h.ATR_STRING),this._wwa.appearParts(this._position.getPartsCoord(),wwa_data.AppearanceTriggerType.OBJECT,e),this._readyToUseItemPos=t,this._isReadyToUseItem=!0},t.prototype.isReadyToUseItem=function(){return this._isReadyToUseItem},t.prototype.getDrawingCenterPosition=function(){var t=this._position.getPartsCoord(),e=this._position.getOffsetCoord(),a=this._camera.getPosition(),s=a.getPartsCoord(),i=a.getOffsetCoord(),o=(t.x-s.x)*h.CHIP_SIZE+e.x-i.x+h.CHIP_SIZE/2,r=(t.y-s.y)*h.CHIP_SIZE+e.y-i.y+h.CHIP_SIZE/2;return new wwa_data.Coord(o,r)},t.prototype.getMoveCount=function(){return this._moves},t.prototype.setMoveCount=function(t){return this._moves=t},t.prototype.isMoveObjectAutoExecTime=function(){return 0===this._moveObjectAutoExecTimer},t.prototype.setMoveMacroWaiting=function(t){t<0||(this._moveMacroWaitingRemainMoves=t,this._moveObjectAutoExecTimer=0)},t.prototype.resetMoveObjectAutoExecTimer=function(){this._moveObjectAutoExecTimer=h.CHIP_SIZE/wwa_data.speedList[this._speedIndex],this._moveMacroWaitingRemainMoves--},t.prototype.decrementMoveObjectAutoExecTimer=function(){return 0<=this._moveMacroWaitingRemainMoves&&0<this._moveObjectAutoExecTimer&&(this._moveObjectAutoExecTimer--,0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&(this._afterMoveMacroFlag=!0)),0},t.prototype.isWaitingMoveMacro=function(){return 0!==this._moveMacroWaitingRemainMoves||0!==this._moveObjectAutoExecTimer},t.prototype.decrementLookingAroundTimer=function(){return this._isPreparedForLookingAround&&0<this._lookingAroundTimer?--this._lookingAroundTimer:0},t.prototype.isLookingAround=function(){return this._isPreparedForLookingAround&&0===this._lookingAroundTimer},t.prototype.getSpeedIndex=function(){return this._speedIndex},t.prototype.speedUp=function(){return this._speedIndex=Math.min(h.MAX_SPEED_INDEX,this._speedIndex+1)},t.prototype.speedDown=function(){return this._speedIndex=Math.max(h.MIN_SPEED_INDEX,this._speedIndex-1)},t}(a);t.Player=o}(wwa_parts_player||(wwa_parts_player={})),function(t){var a=wwa_data.WWAConsts,e=function(){function t(t){this._position=null,this.reset(t)}return t.prototype.setPlayer=function(t){this._player=t},t.prototype.isResetting=function(){return this._isResetting},t.prototype.getPosition=function(){return this._position},t.prototype.getPreviousPosition=function(){return this._positionPrev},t.prototype.resetPreviousPosition=function(){this._positionPrev=null},t.prototype.move=function(t){var e=wwa_data.speedList[this._player.getSpeedIndex()];this._position=this._position.getNextFramePosition(t,e*(a.H_PARTS_NUM_IN_WINDOW-1),e*(a.V_PARTS_NUM_IN_WINDOW-1))},t.prototype.getTransitionStepNum=function(){return this._transitionStep},t.prototype.advanceTransitionStepNum=function(){return++this._transitionStep,this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW&&(this._isResetting=!1,this._transitionStep=0),this._transitionStep},t.prototype.isFinalStep=function(){if(!1===this._isResetting)throw new Error("リセット中ではありません。");return this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW-1},t.prototype.reset=function(t){this._positionPrev=this._position,this._position=t.getDefaultCameraPosition(),this._transitionStep=0,this._isResetting=!0},t}();t.Camera=e}(wwa_camera||(wwa_camera={})),function(t){var n=wwa_data.WWAConsts,e=function(){function t(t,e){this.cvs=document.createElement("canvas"),this.cvs.width=t,this.cvs.height=e,this.ctx=this.cvs.getContext("2d")}return t.prototype.drawCanvas=function(t,e,a,s,i,o){void 0===o&&(o=!1),this.ctx.drawImage(t,n.CHIP_SIZE*e,n.CHIP_SIZE*a,n.CHIP_SIZE,n.CHIP_SIZE,s,i,n.CHIP_SIZE,n.CHIP_SIZE)},t.prototype.clear=function(){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height)},t}();t.CacheCanvas=e;var a=function(){function t(t,e,a,s,i){this._isLoaded=!1,this.mapCache=void 0,this.mapCacheYLimit=0,this._ctx=t,this._ctxSub=e,this._fileName=a,this._loadCompleteCallBack=i,this._load(),this._frameCoord=s.clone()}return t.prototype._load=function(){var t=this;this._frameCoord,this._isLoaded||(this.mapCache=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this._image=new Image,this._image.addEventListener("load",function(){t.createFrame(),t._loadCompleteCallBack()}),this._image.addEventListener("error",function(){throw new Error("Image Load Failed!!\nfile name:"+t._fileName)}),this._image.src=this._fileName,this._isLoaded=!0)},t.prototype.createFrame=function(){this._frameCanvas=new e(n.CHIP_SIZE*n.V_PARTS_NUM_IN_WINDOW,n.CHIP_SIZE*n.H_PARTS_NUM_IN_WINDOW),this._backCanvas=new e(n.CHIP_SIZE*n.V_PARTS_NUM_IN_WINDOW,n.CHIP_SIZE*n.H_PARTS_NUM_IN_WINDOW),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x,this._frameCoord.y,0,0,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+2,this._frameCoord.y,n.MAP_WINDOW_WIDTH-n.CHIP_SIZE,0,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x,this._frameCoord.y+2,0,n.MAP_WINDOW_HEIGHT-n.CHIP_SIZE,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+2,this._frameCoord.y+2,n.MAP_WINDOW_WIDTH-n.CHIP_SIZE,n.MAP_WINDOW_HEIGHT-n.CHIP_SIZE,!1);for(var t=1;t<n.H_PARTS_NUM_IN_WINDOW-1;t++)this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+1,this._frameCoord.y,n.CHIP_SIZE*t,0,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+1,this._frameCoord.y+2,n.CHIP_SIZE*t,n.MAP_WINDOW_HEIGHT-n.CHIP_SIZE,!1);for(t=1;t<n.V_PARTS_NUM_IN_WINDOW-1;t++)this._frameCanvas.drawCanvas(this._image,this._frameCoord.x,this._frameCoord.y+1,0,n.CHIP_SIZE*t,!1),this._frameCanvas.drawCanvas(this._image,this._frameCoord.x+2,this._frameCoord.y+1,n.MAP_WINDOW_WIDTH-n.CHIP_SIZE,n.CHIP_SIZE*t,!1)},t.prototype.drawFrame=function(){this._ctx.drawImage(this._frameCanvas.cvs,0,0,n.CHIP_SIZE*n.V_PARTS_NUM_IN_WINDOW,n.CHIP_SIZE,0,0,n.CHIP_SIZE*n.V_PARTS_NUM_IN_WINDOW,n.CHIP_SIZE),this._ctx.drawImage(this._frameCanvas.cvs,0,n.CHIP_SIZE*(n.H_PARTS_NUM_IN_WINDOW-1),n.CHIP_SIZE*n.V_PARTS_NUM_IN_WINDOW,n.CHIP_SIZE,0,n.CHIP_SIZE*(n.H_PARTS_NUM_IN_WINDOW-1),n.CHIP_SIZE*n.V_PARTS_NUM_IN_WINDOW,n.CHIP_SIZE),this._ctx.drawImage(this._frameCanvas.cvs,0,n.CHIP_SIZE,n.CHIP_SIZE,n.CHIP_SIZE*(n.H_PARTS_NUM_IN_WINDOW-2),0,n.CHIP_SIZE,n.CHIP_SIZE,n.CHIP_SIZE*(n.H_PARTS_NUM_IN_WINDOW-2)),this._ctx.drawImage(this._frameCanvas.cvs,n.CHIP_SIZE*(n.H_PARTS_NUM_IN_WINDOW-1),n.CHIP_SIZE,n.CHIP_SIZE,n.CHIP_SIZE*(n.H_PARTS_NUM_IN_WINDOW-2),n.CHIP_SIZE*(n.H_PARTS_NUM_IN_WINDOW-1),n.CHIP_SIZE,n.CHIP_SIZE,n.CHIP_SIZE*(n.H_PARTS_NUM_IN_WINDOW-2))},t.prototype.drawCanvas=function(t,e,a,s,i){void 0===i&&(i=!1);var o=i?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");o.drawImage(this._image,n.CHIP_SIZE*t,n.CHIP_SIZE*e,n.CHIP_SIZE,n.CHIP_SIZE,a,s,n.CHIP_SIZE,n.CHIP_SIZE)},t.prototype.drawCanvasWithSize=function(t,e,a,s,i,o,r){void 0===r&&(r=!1);var _=r?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");_.drawImage(this._image,n.CHIP_SIZE*t,n.CHIP_SIZE*e,n.CHIP_SIZE*a,n.CHIP_SIZE*s,i,o,2*n.CHIP_SIZE,2*n.CHIP_SIZE)},t.prototype.drawCanvasWithUpperYLimit=function(t,e,a,s,i,o){void 0===o&&(o=!1);var r=o?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");var _=Math.max(0,s+n.CHIP_SIZE-i);_>=n.CHIP_SIZE||r.drawImage(this._image,n.CHIP_SIZE*t,n.CHIP_SIZE*e,n.CHIP_SIZE,n.CHIP_SIZE-_,a,s,n.CHIP_SIZE,n.CHIP_SIZE)},t.prototype.copyBackCanvasWithUpperYLimit=function(t,e,a,s,i,o){void 0===o&&(o=!1);o?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");var r=Math.max(0,s+n.CHIP_SIZE-i);r>=n.CHIP_SIZE||this._backCanvas.ctx.drawImage(this._image,n.CHIP_SIZE*t,n.CHIP_SIZE*e+r,n.CHIP_SIZE,n.CHIP_SIZE-r,a,s+r,n.CHIP_SIZE,n.CHIP_SIZE)},t.prototype.drawBackCanvas=function(t){void 0===t&&(t=!1);var e=t?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");e.drawImage(this._backCanvas.cvs,0,0,n.CHIP_SIZE*n.V_PARTS_NUM_IN_WINDOW,n.CHIP_SIZE*n.H_PARTS_NUM_IN_WINDOW,0,0,n.CHIP_SIZE*n.V_PARTS_NUM_IN_WINDOW,n.CHIP_SIZE*n.H_PARTS_NUM_IN_WINDOW)},t.prototype.clearBackCanvas=function(){this._backCanvas.clear()},t.prototype.drawCanvasWithLowerYLimit=function(t,e,a,s,i,o){void 0===o&&(o=!1);var r=o?this._ctxSub:this._ctx;if(!this._isLoaded)throw new Error("No image was loaded.");var _=Math.max(0,i-s);_>=n.CHIP_SIZE||r.drawImage(this._image,n.CHIP_SIZE*t,n.CHIP_SIZE*e+_,n.CHIP_SIZE,n.CHIP_SIZE-_,a,s+_,n.CHIP_SIZE,n.CHIP_SIZE)},t.prototype.clearCanvas=function(t,e,a,s,i){void 0===i&&(i=!1),(i?this._ctxSub:this._ctx).clearRect(t,e,a,s)},t.prototype.drawBase=function(t,e,a,s,i){void 0===i&&(i=!1);var o=i?this._ctxSub:this._ctx;o.fillStyle="#9E9E9E",o.fillRect(t,e,a,s)},t}();t.CGManager=a}(wwa_cgmanager||(wwa_cgmanager={})),function(r){r.$id=function(t){return document.getElementById(t)},r.$class=function(t){return document.getElementsByClassName(t)},r.$tag=function(t){return document.getElementsByTagName(t)},r.$qs=function(t){return document.querySelector(t)},r.$qsh=function(t){return document.querySelector(t)},r.$qsAll=function(t){return document.querySelectorAll(t)},r.$localPos=function(t,e){var a,s,i=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,o=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;return a=t-r.$id("wwa-wrapper").offsetLeft+i,s=e-r.$id("wwa-wrapper").offsetTop+o,new wwa_data.Coord(a,s)},r.$escapedURI=function(t){return t.match(/^https?:\/\//)||t.match(/^\.\.\//)?t:location.href="./"+t},r.arr2str4save=function(t){var e="";if(t instanceof Array){for(var a=0;a<t.length;a++)e+=r.arr2str4save(t[a])+"/";return e}return t+""}}(wwa_util||(wwa_util={})),function(_){var s=function(t,e,a,s){this.message=t,this.isSystemMessage=e,this.isEndOfPartsEvent=a,this.macro=s,void 0===this.macro&&(this.macro=[])};_.MessageInfo=s,_.strArrayToMessageInfoArray=function(t,e){var a=[];return t.forEach(function(t){a.push(new s(t,e))}),a};var n=function(){function t(t,e,a,s,i,o){this._wwa=t,this._triggerPartsID=e,this._triggerPartsType=a,this._triggerPartsPosition=s,this.macroType=i,this.macroArgs=o}return t.prototype.execute=function(){try{this.macroType===wwa_data.MacroType.IMGPLAYER?this._executeImgPlayerMacro():this.macroType===wwa_data.MacroType.IMGYESNO?this._executeImgYesNoMacro():this.macroType===wwa_data.MacroType.HPMAX?this._executeHPMaxMacro():this.macroType===wwa_data.MacroType.SAVE?this._executeSaveMacro():this.macroType===wwa_data.MacroType.ITEM?this._executeItemMacro():this.macroType===wwa_data.MacroType.DEFAULT?this._executeDefaultMacro():this.macroType===wwa_data.MacroType.OLDMAP?this._executeOldMapMacro():this.macroType===wwa_data.MacroType.PARTS?this._executePartsMacro():this.macroType===wwa_data.MacroType.MOVE?this._executeMoveMacro():this.macroType===wwa_data.MacroType.MAP?this._executeMapMacro():this.macroType===wwa_data.MacroType.DIRMAP?this._executeDirMapMacro():this.macroType===wwa_data.MacroType.IMGFRAME?this._executeImgFrameMacro():this.macroType===wwa_data.MacroType.IMGBOM?this._executeImgBomMacro():this.macroType===wwa_data.MacroType.DELPLAYER?this._executeDelPlayerMacro():this.macroType===wwa_data.MacroType.FACE?this._executeFaceMacro():this.macroType===wwa_data.MacroType.EFFECT?this._executeEffectMacro():this.macroType===wwa_data.MacroType.GAMEOVER?this._executeGameOverMacro():this.macroType===wwa_data.MacroType.IMGCLICK?this._executeImgClickMacro():this.macroType===wwa_data.MacroType.STATUS?this._executeStatusMacro():this.macroType===wwa_data.MacroType.COLOR?this._executeColorMacro():this.macroType===wwa_data.MacroType.WAIT?this._executeWaitMacro():this.macroType===wwa_data.MacroType.SOUND&&this._executeSoundMacro()}catch(t){}},t.prototype._concatEmptyArgs=function(t){if(this.macroArgs.length<t){for(var e=new Array(t-this.macroArgs.length),a=0;a<e.length;a++)e[a]="";this.macroArgs=this.macroArgs.concat(e)}},t.prototype._parseInt=function(t,e){void 0===e&&(e=0);var a=parseInt(this.macroArgs[t]);return isNaN(a)?e:a},t.prototype._executeImgPlayerMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);this._wwa.setPlayerImgCoord(new wwa_data.Coord(t,e))},t.prototype._executeImgYesNoMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);this._wwa.setYesNoImgCoord(new wwa_data.Coord(t,e))},t.prototype._executeHPMaxMacro=function(){this._concatEmptyArgs(1);var t=Math.max(0,this._parseInt(0));this._wwa.setPlayerEnergyMax(t)},t.prototype._executeSaveMacro=function(){this._concatEmptyArgs(1);var t=!!this._parseInt(0);this._wwa.disableSave(t)},t.prototype._executeItemMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);this._wwa.setPlayerGetItem(t,e)},t.prototype._executeDefaultMacro=function(){this._concatEmptyArgs(1);var t=!!this._parseInt(0);this._wwa.setObjectNotCollapseOnPartsOnPlayer(t)},t.prototype._executeOldMapMacro=function(){this._concatEmptyArgs(1);var t=!!this._parseInt(0);this._wwa.setOldMap(t)},t.prototype._executePartsMacro=function(){this._concatEmptyArgs(4);var t=this._parseInt(0),e=this._parseInt(1),a=this._parseInt(2,wwa_data.PartsType.OBJECT),s=this._parseInt(3);if(a!==wwa_data.PartsType.OBJECT&&a!==wwa_data.PartsType.MAP)throw new Error("パーツ種別が不明です");if(0!==s&&1!==s&&(s=1),t<0||e<0)throw new Error("パーツ番号が不正です");if(a===wwa_data.PartsType.OBJECT){if(t>=this._wwa.getObjectPartsNum()||e>=this._wwa.getObjectPartsNum())throw new Error("パーツ番号が不正です")}else if(t>=this._wwa.getMapPartsNum()||e>=this._wwa.getMapPartsNum())throw new Error("パーツ番号が不正です");this._wwa.replaceParts(t,e,a,!!s)},t.prototype._executeMoveMacro=function(){this._concatEmptyArgs(1);var t=this._parseInt(0);this._wwa.setMoveMacroWaitingToPlayer(t)},t.prototype._executeMapMacro=function(){this._concatEmptyArgs(4);var t=this._parseInt(0),e=this.macroArgs[1],a=this.macroArgs[2],s=this._parseInt(3,wwa_data.PartsType.OBJECT);if(t<0)throw new Error("パーツ番号が不正です");if(s===wwa_data.PartsType.OBJECT){if(t>=this._wwa.getObjectPartsNum())throw new Error("パーツ番号が不正です")}else if(t>=this._wwa.getMapPartsNum())throw new Error("パーツ番号が不正です");this._wwa.appearPartsEval(this._triggerPartsPosition,e,a,t,s)},t.prototype._executeDirMapMacro=function(){this._concatEmptyArgs(3);var t=this._parseInt(0),e=this._parseInt(1),a=this._parseInt(2,wwa_data.PartsType.OBJECT);if(isNaN(t)||isNaN(e)||isNaN(a))throw new Error("引数が整数ではありません");if(t<0)throw new Error("パーツ番号が不正です");if(a===wwa_data.PartsType.OBJECT){if(t>=this._wwa.getObjectPartsNum())throw new Error("パーツ番号が不正です")}else if(t>=this._wwa.getMapPartsNum())throw new Error("パーツ番号が不正です");this._wwa.appearPartsByDirection(e,t,a)},t.prototype._executeImgFrameMacro=function(){this._concatEmptyArgs(3);var t=this._parseInt(0),e=this._parseInt(1),a=this._parseInt(2),s=e*wwa_data.WWAConsts.CHIP_SIZE,i=a*wwa_data.WWAConsts.CHIP_SIZE;if(e<0||a<0)throw new Error("座標は正でなければなりません。");if(t===wwa_data.MacroImgFrameIndex.ENERGY)wwa_util.$qsh("#disp-energy>.status-icon").style.backgroundPosition="-"+s+"px -"+i+"px";else if(t===wwa_data.MacroImgFrameIndex.STRENGTH){wwa_util.$qsh("#disp-strength>.status-icon").style.backgroundPosition="-"+s+"px -"+i+"px"}else if(t===wwa_data.MacroImgFrameIndex.DEFENCE){wwa_util.$qsh("#disp-defence>.status-icon").style.backgroundPosition="-"+s+"px -"+i+"px"}else if(t===wwa_data.MacroImgFrameIndex.GOLD){wwa_util.$qsh("#disp-gold>.status-icon").style.backgroundPosition="-"+s+"px -"+i+"px"}else if(t===wwa_data.MacroImgFrameIndex.WIDE_CELL_ROW)Array.prototype.forEach.call(wwa_util.$qsAll("div.wide-cell-row"),function(t){t.style.backgroundPosition="-"+s+"px -"+i+"px"});else if(t===wwa_data.MacroImgFrameIndex.ITEM_BG)Array.prototype.forEach.call(wwa_util.$qsAll("div.item-cell"),function(t){t.style.backgroundPosition="-"+s+"px -"+i+"px"});else{if(t!==wwa_data.MacroImgFrameIndex.MAIN_FRAME)throw new Error("種別が不正です。");this._wwa.setFrameCoord(new wwa_data.Coord(e,a))}},t.prototype._executeImgBomMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);if(t<0||e<0)throw new Error("座標は正でなければなりません。");this._wwa.setBattleEffectCoord(new wwa_data.Coord(t,e))},t.prototype._executeDelPlayerMacro=function(){this._concatEmptyArgs(1);var t=parseInt(this.macroArgs[0]);this._wwa.setDelPlayer(!!t)},t.prototype._executeFaceMacro=function(){this._concatEmptyArgs(6);var t,e=this._parseInt(0),a=this._parseInt(1),s=this._parseInt(2),i=this._parseInt(3),o=this._parseInt(4),r=this._parseInt(5);if(e<0||a<0||s<0||i<0||o<0||r<0)throw new Error("各引数は0以上の整数でなければなりません。");t=new wwa_data.Face(new wwa_data.Coord(e,a),new wwa_data.Coord(s,i),new wwa_data.Coord(o,r)),this._wwa.addFace(t)},t.prototype._executeEffectMacro=function(){this._concatEmptyArgs(1);var t=this._parseInt(0);if(t<0)throw new Error("待ち時間は0以上の整数でなければなりません。");0===t&&this._wwa.stopEffect();for(var e=[],a=1;a<this.macroArgs.length;a+=2){var s,i=this._parseInt(a);if(i<0)throw new Error("画像のパーツ座標指定は0以上の整数でなければなりません。");if(a+1===this.macroArgs.length)throw new Error("画像のパーツ座標指定で、Y座標が指定されていません。");if((s=this._parseInt(a+1))<0)throw new Error("画像のパーツ座標指定は0以上の整数でなければなりません。");e.push(new wwa_data.Coord(i,s))}this._wwa.setEffect(t,e)},t.prototype._executeGameOverMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);if(t<0||t>=this._wwa.getMapWidth()||e<0||e>=this._wwa.getMapWidth())throw new Error("マップの範囲外が指定されています!");this._wwa.setGameOverPosition(new wwa_data.Coord(t,e))},t.prototype._executeImgClickMacro=function(){if(this._concatEmptyArgs(2),this.macroArgs.length<1)throw new Error("引数が少なすぎます");var t=this._parseInt(0),e=this._parseInt(1);if(t<0||e<0)throw new Error("引数が0以上の整数ではありません");this._wwa.setImgClick(new wwa_data.Coord(t,e))},t.prototype._executeStatusMacro=function(){this._concatEmptyArgs(2);var t=this._parseInt(0),e=this._parseInt(1);if(t<0||4<t)throw new Error("ステータス種別が範囲外です。");this._wwa.setPlayerStatus(t,e)},t.prototype._executeColorMacro=function(){this._concatEmptyArgs(4);var t=this._parseInt(0),e=this._parseInt(1),a=this._parseInt(2),s=this._parseInt(3);if(t<0||5<t)throw new Error("種別は0から5までです");if(e<0||255<e||a<0||255<a||s<0||255<s)throw new Error("色が範囲外です");this._wwa.changeStyleRule(t,e,a,s)},t.prototype._executeWaitMacro=function(){throw new Error("Not implemented!")},t.prototype._executeSoundMacro=function(){this._concatEmptyArgs(1);var t=parseInt(this.macroArgs[0]);this._wwa.playSound(t)},t}();_.Macro=n,_.parseMacro=function(t,e,a,s,i){var o=i.match(/^\$([a-zA-Z_][a-zA-Z0-9_]*)\=(.*)$/);if(null===o||3!==o.length)throw new Error("マクロではありません");var r=o[1],_=wwa_data.macrotable["$"+r.toLowerCase()];return void 0===_?new n(t,e,a,s,wwa_data.MacroType.UNDEFINED,o[2].split(",")):new n(t,e,a,s,_,o[2].split(",").map(function(t){return t.trim()}))};var t=function(){function t(t,e,a,s,i,o,r){this._wwa=t,this._coord=e,this._width=a,this._height=s,this._isVisible=i,this._parentElement=o,this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.borderWidth="2px",this._element.style.borderStyle="solid",this._element.style.borderRadius="10px",this._element.classList.add("wwa-message-window"),this._element.style.zIndex=r+"",this._element.style.left=this._coord.x+"px",this._element.style.top=this._coord.y+"px",this._element.style.width=this._width+"px",this._element.style.height=this._height+"px",this._parentElement.appendChild(this._element)}return t.prototype.update=function(t){},t.prototype.show=function(){this._isVisible=!0,this._element.style.display="block",this.update()},t.prototype.hide=function(){this._isVisible=!1,this._element.style.display="none",this.update()},t.prototype.isVisible=function(){return this._isVisible},t}(),e=function(n){function t(t,e,a,s,i,o,r){var _=n.call(this,t,new wwa_data.Coord(e.x,e.y),a,s,i,o,201)||this;return _._cgFileName=r,_._monsterBox=document.createElement("div"),_._monsterBox.style.width=wwa_data.WWAConsts.CHIP_SIZE+"px",_._monsterBox.style.height=wwa_data.WWAConsts.CHIP_SIZE+"px",_._monsterBox.style.position="absolute",_._monsterBox.style.left="10px",_._monsterBox.style.top="10px",_._monsterBox.style.backgroundImage="url("+_._cgFileName.replace("(","\\(").replace(")","\\)")+")",_._monsterBox.style.backgroundPosition="0 0",_._element.appendChild(_._monsterBox),_._energyBox=document.createElement("div"),_._energyBox.style.position="absolute",_._energyBox.style.left="80px",_._energyBox.style.top="10px",_._energyBox.textContent="生命力 0",_._element.appendChild(_._energyBox),_._strengthBox=document.createElement("div"),_._strengthBox.style.position="absolute",_._strengthBox.style.left="80px",_._strengthBox.style.top="30px",_._strengthBox.textContent="攻撃力 0",_._element.appendChild(_._strengthBox),_._defenceBox=document.createElement("div"),_._defenceBox.style.position="absolute",_._defenceBox.style.left="180px",_._defenceBox.style.top="30px",_._defenceBox.textContent="防御力 0",_._element.appendChild(_._defenceBox),_._isVisible?_._element.style.display="block":_._element.style.display="none",_}return __extends(t,n),t.prototype.update=function(t){void 0!==t&&(this._monsterBox.style.backgroundPosition="-"+t.imgCoord.x+"px -"+t.imgCoord.y+"px",this._energyBox.textContent="生命力 "+t.status.energy,this._strengthBox.textContent="攻撃力 "+t.status.strength,this._defenceBox.textContent="防御力 "+t.status.defence)},t}(t);_.MosterWindow=e;var a,i,o=function(o){function t(t,e,a,s){var i=o.call(this,t,new wwa_data.Coord(e.x,e.y),340,30,a,s,202)||this;return i._element.style.textAlign="center",i._isVisible?i._element.style.display="block":i._element.style.display="none",i.update(0),i}return __extends(t,o),t.prototype.update=function(t){void 0!==t&&(this._element.textContent="Score: "+t)},t}(t);_.ScoreWindow=o,(i=a=_.Positioning||(_.Positioning={}))[i.TOP=0]="TOP",i[i.CENTER=1]="CENTER",i[i.BOTTOM=2]="BOTTOM",i[i.SCORE=3]="SCORE";var r=function(){function t(t,e,a,s,i,o,r,_,n,h,d){var w=this,c=r.replace("(","\\(").replace(")","\\)");this._wwa=t,this._cgFileName=r,this._x=e,this._y=a,this._width=s,this._height=i,this._message=o,this._isVisible=_,this._isYesno=n,this._isItemMenu=h,this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.borderWidth="2px",this._element.style.borderStyle="solid",this._element.style.borderRadius="10px",this._element.classList.add("wwa-message-window"),this._element.style.zIndex="400",this._msgWrapperElement=document.createElement("div"),this._msgWrapperElement.style.padding="7px",this._msgWrapperElement.style.margin="0",this._msgWrapperElement.style.textAlign="left",this._msgWrapperElement.style.wordWrap="break-word",this._element.appendChild(this._msgWrapperElement),this._dummyElement=document.createElement("div"),this._dummyElement.style.display="none",this._dummyElement.style.padding="0",this._dummyElement.style.margin="0",this._dummyElement.style.height="55px",this._element.appendChild(this._dummyElement),this._ynWrapperElement=document.createElement("div"),this._ynWrapperElement.style.padding="0",this._ynWrapperElement.style.margin="0",this._ynWrapperElement.style.position="absolute",this._ynWrapperElement.style.left="246px",this._ynWrapperElement.style.bottom="10px",this._ynWrapperElement.style.width="80px",this._ynWrapperElement.style.height="40px",this._ynWrapperElement.style.zIndex="10",this._element.appendChild(this._ynWrapperElement),this._parentElement=d,this._parentElement.appendChild(this._element),this._divYesElement=document.createElement("div"),this._divYesElement.style.padding="0",this._divYesElement.style.margin="0",this._divYesElement.style.cssFloat="left",this._divYesElement.style.width="40px",this._divYesElement.style.height="40px",this._divYesElement.style.background="url("+c+")",this._divYesElement.onclick=function(){w._isInputDisable||(t.setYesNoInput(wwa_data.YesNoState.YES),w.update())},this._divYesElement.style.cursor="pointer",this._divNoElement=document.createElement("div"),this._divNoElement.style.padding="0",this._divNoElement.style.margin="0",this._divNoElement.style.cssFloat="left",this._divNoElement.style.width="40px",this._divNoElement.style.height="40px",this._divNoElement.style.background="url("+c+")",this._divNoElement.onclick=function(){w._isInputDisable||(t.setYesNoInput(wwa_data.YesNoState.NO),w.update())},this._divNoElement.style.cursor="pointer",this._ynWrapperElement.appendChild(this._divYesElement),this._ynWrapperElement.appendChild(this._divNoElement),w._isInputDisable=!1,this.update()}return t.prototype.setPosition=function(t,e,a,s){this._x=t,this._y=e,this._width=a,this._height=s,this.update()},t.prototype.setPositionByPlayerPosition=function(t,e,a,s,i){var o,r=s.getPartsCoord().substract(i.getPartsCoord()).y;o=t?_.Positioning.BOTTOM:e?_.Positioning.SCORE:a?_.Positioning.CENTER:r>=Math.ceil(wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW/2)?_.Positioning.TOP:_.Positioning.BOTTOM,this.setPositionEasy(o)},t.prototype.setPositionEasy=function(t){var e=Math.floor(this._element.clientHeight/2);return t===a.CENTER?(this._y=wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/2-e,void this.update()):t===a.TOP?(this._y=Math.max(20,wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/4-e)+10,void this.update()):t===a.BOTTOM?(this._y=Math.min(wwa_data.WWAConsts.MAP_WINDOW_HEIGHT-20-this._element.clientHeight,3*wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/4-e),void this.update()):t===a.SCORE?(this._y=80,void this.update()):void 0},t.prototype.setMessage=function(t){this._message=t,this.update()},t.prototype.setYesNoChoice=function(t){return this._isInputDisable=!1,this._isYesno=t,this.update(),this._isYesno},t.prototype.isYesNoChoice=function(){return this._isYesno},t.prototype.setItemMenuChoice=function(t){return this._isInputDisable=!1,this._isItemMenu=t,this.update(),this._isItemMenu},t.prototype.isItemMenuChoice=function(){return this._isItemMenu},t.prototype.setInputDisable=function(){this._isInputDisable=!0},t.prototype.isInputDisable=function(){return this._isInputDisable},t.prototype.show=function(){this._isVisible=!0,this.update()},t.prototype.hide=function(){this._isVisible=!1,this.update()},t.prototype.isVisible=function(){return this._isVisible},t.prototype.update=function(){var t=this._wwa.getYesNoImgCoord();this._isYesno?(this._wwa.getYesNoState()===wwa_data.YesNoState.YES?(this._divYesElement.style.backgroundPosition="-"+(t.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YESP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+t.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(t.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+t.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):this._wwa.getYesNoState()===wwa_data.YesNoState.NO?(this._divYesElement.style.backgroundPosition="-"+(t.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+t.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(t.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NOP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+t.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):(this._divYesElement.style.backgroundPosition="-"+(t.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+t.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(t.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+t.y*wwa_data.WWAConsts.CHIP_SIZE+"px"),this._ynWrapperElement.style.display="block"):this._ynWrapperElement.style.display="none",this._msgWrapperElement.textContent="";for(var e=this._message.split("\n"),a=0;a<e.length;a++){var s=document.createElement("span");s.textContent=e[a],this._msgWrapperElement.appendChild(s),this._msgWrapperElement.appendChild(document.createElement("br"))}this._isVisible?(this._element.style.left=this._x+"px",this._element.style.top=this._y+"px"):(this._element.style.left="-999999px",this._element.style.top="-999999px"),this._element.style.width=this._width+"px",this._element.style.minHeight=this._height+"px",this._dummyElement.style.display=this._isYesno?"block":"none"},t}();_.MessageWindow=r}(wwa_message||(wwa_message={})),function(t){var e=function(){function t(t,e,a,s,i,o,r){this._partsID=t,this._position=e,this._imgCoord=a,this._status=s,this._message=i,this._item=o,this._battleEndCallback=r}return Object.defineProperty(t.prototype,"partsID",{get:function(){return this._partsID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imgCoord",{get:function(){return this._imgCoord},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"item",{get:function(){return this._item},enumerable:!0,configurable:!0}),t.prototype.damage=function(t){this._status.energy=Math.max(0,this._status.energy-t)},t.prototype.battleEndProcess=function(){this._battleEndCallback()},t}();t.Monster=e}(wwa_monster||(wwa_monster={})),function(t){var i=function(){function t(t,e,a,s,i){this._player=t,this._objectID=e,this._srcPos=a,this._destPos=s,this._dir=i,this._currentPos=this._srcPos.clone()}return t.prototype.update=function(){var t=this._player.getSpeedIndex();return this._currentPos=this._currentPos.getNextFramePosition(this._dir,wwa_data.speedList[t],wwa_data.speedList[t]),this._currentPos},Object.defineProperty(t.prototype,"isAchievedDestination",{get:function(){return this._currentPos.equals(this._destPos)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPosition",{get:function(){return this._currentPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforePosition",{get:function(){return this._srcPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destination",{get:function(){return this._destPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"objID",{get:function(){return this._objectID},enumerable:!0,configurable:!0}),t}();t.ObjectMovingData=i;var e=function(){function t(t,e){this._wwa=t,this._player=e,this.clear()}return t.prototype.add=function(t,e,a,s){this._queue.push(new i(this._player,t,e,a,s))},t.prototype.update=function(){for(var t=[],e=[],a=0;a<this._queue.length;a++)this._queue[a].update(),this._queue[a].isAchievedDestination?(t.push(this._queue[a]),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,0,this._queue[a].beforePosition.getPartsCoord()),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._queue[a].objID,this._queue[a].destination.getPartsCoord())):e.push(this._queue[a]);return this._queue=e,t},t.prototype.clear=function(){this._queue=[]},Object.defineProperty(t.prototype,"objectMovingData",{get:function(){return this.objectMovingData},enumerable:!0,configurable:!0}),t.prototype.getOffsetByBeforePartsCoord=function(e){var t=this._queue.filter(function(t){return t.beforePosition.getPartsCoord().equals(e)});return 0===t.length?null:t[0].currentPosition.getOffsetCoord()},t}();t.ObjectMovingDataManager=e}(wwa_motion||(wwa_motion={})),function(t){var r=function(){function t(t,e,a){this.id=t,this.imgFileName=e,this.parent=a,this.elem=document.createElement("div"),this.elem.classList.add("est"),this.elem.setAttribute("id","wwa-est-"+t),this.imgElem=document.createElement("div"),this.imgElem.classList.add("est-img-wrapper"),this.imgElem.style.backgroundImage="url("+this.imgFileName.replace("(","\\(").replace(")","\\)")+")",this.statusElem=document.createElement("div"),this.statusElem.classList.add("est-status-wrapper"),this.energyElem=document.createElement("div"),this.energyElem.classList.add("est-energy"),this.energyDispElem=document.createElement("span"),this.energyDispElem.classList.add("est-energy-disp"),this.energyElem.appendChild(this.energyDispElem),this.statusElem.appendChild(this.energyElem),this.strengthElem=document.createElement("div"),this.strengthElem.classList.add("est-strength"),this.strengthDispElem=document.createElement("span"),this.strengthDispElem.classList.add("est-strength-disp"),this.strengthElem.appendChild(this.strengthDispElem),this.statusElem.appendChild(this.strengthElem),this.defenceElem=document.createElement("div"),this.defenceElem.classList.add("est-defence"),this.defenceDispElem=document.createElement("span"),this.defenceDispElem.classList.add("est-defence-disp"),this.defenceElem.appendChild(this.defenceDispElem),this.statusElem.appendChild(this.defenceElem),this.damageElem=document.createElement("div"),this.damageElem.classList.add("est-damage"),this.damageDispElem=document.createElement("span"),this.damageDispElem.classList.add("est-damage-disp"),this.damageElem.appendChild(this.damageDispElem),this.statusElem.appendChild(this.damageElem),this.elem.appendChild(this.imgElem),this.elem.appendChild(this.statusElem)}return t.prototype.hide=function(){this.elem.style.display="none"},t.prototype.show=function(){this.elem.style.display="block"},t.prototype.setResult=function(t,e,a){this.imgElem.style.backgroundPosition="-"+t.x+"px -"+t.y+"px",this.energyDispElem.textContent="生命力 "+e.energy,this.strengthDispElem.textContent="攻撃力 "+e.strength,this.defenceDispElem.textContent="防御力 "+e.defence,a.isNoEffect?this.damageDispElem.textContent="攻撃無効":a.isOverMaxTurn?this.damageDispElem.textContent="長期戦が予想されます":this.damageDispElem.textContent="予想ダメージ "+a.damage},t}(),e=function(){function t(t,e,a){var s,i=this;this._wwa=t,this._imgFileName=e,this._parent=a,this._element=document.createElement("div"),this._element.setAttribute("id","wwa-battle-estimate"),this._element.style.display="none",this._edes=[];for(var o=0;o<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;o++)s=new r(o,this._imgFileName,this._element),this._edes.push(s),this._element.appendChild(s.elem);this._element.addEventListener("click",function(){i._wwa.hideBattleEstimateWindow()}),this._parent.appendChild(this._element)}return t.prototype.update=function(t,e){for(var a=0;a<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;a++)if(a>=e.length)this._edes[a].hide();else{var s=this._wwa.getObjectAttributeById(e[a],wwa_data.WWAConsts.ATR_X),i=this._wwa.getObjectAttributeById(e[a],wwa_data.WWAConsts.ATR_Y),o=new wwa_data.Coord(s,i),r=this._wwa.getObjectAttributeById(e[a],wwa_data.WWAConsts.ATR_ENERGY),_=this._wwa.getObjectAttributeById(e[a],wwa_data.WWAConsts.ATR_STRENGTH),n=this._wwa.getObjectAttributeById(e[a],wwa_data.WWAConsts.ATR_DEFENCE),h=new wwa_data.Status(r,_,n,0),d=w(t,h);this._edes[a].setResult(o,h,d),this._edes[a].show()}},t.prototype.show=function(){this._element.style.display="block"},t.prototype.hide=function(){this._element.style.display="none"},t}();t.BattleEstimateWindow=e;var _=function(t,e,a){this.isNoEffect=t,this.isOverMaxTurn=e,this.damage=a};function w(t,e){var a=e.energy,s=t.strength-e.defence,i=Math.max(0,e.strength-t.defence),o=0,r=0;if(!(0<s))return new _(!0,!1,0);for(;;){if(o++,(a-=s)<=0)return new _(!1,!1,r);if(r+=i,1e4<o)return new _(!1,!0,0)}}}(wwa_estimate_battle||(wwa_estimate_battle={})),function(t){t.inject=function(t,e){var a=document.createElement("style");a.type="text/css",a.setAttribute("id",wwa_data.WWAConsts.WWA_STYLE_TAG_ID),wwa_util.$tag("head")[0].appendChild(a),t.innerHTML='            <canvas id="wwa-map" class="wwa-canvas" width="440" height="440">                このブラウザは、Canvas要素をサポートしていません。            </canvas>            <canvas id="wwa-map-sub" class="wwa-canvas" width="440" height="440"></canvas>            <div id="wwa-sidebar">                <div class="wide-cell-row" id="disp-energy"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-strength"><div class="status-icon"></div><div class="status-value-box"> 0 </div></div>                <div class="wide-cell-row" id="disp-defence"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-gold"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="item-cell" id="item0"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item1"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item2"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item3"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item4"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item5"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item6"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item7"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item8"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item9"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item10"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item11"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="wide-cell-row" id="cell-load">Password</div><div class="wide-button" id="button-load"></div>                <div class="wide-cell-row" id="cell-save">Quick Save</div><div class="wide-button" id="button-save"></div>                <div class="wide-cell-row" id="cell-restart">Restart Game</div><div class="wide-button" id="button-restart"></div>                <div class="wide-cell-row" id="cell-gotowwa">Go to WWA</div><div class="wide-button" id="button-gotowwa"></div>            </div>            <div id="wwa-controller"></div>            <div id="wwa-fader"></div>            <div id="wwa-cover">                 <div id="version"></div>                 <div id="progress-message-container">開始しています...</div>                 <div id="progress-bar-bg"></div>                 <div id="progress-bar" class="progress-bar"></div>                 <div id="progress-bar-audio" class="progress-bar"></div>                 <div id="progress-disp">---</div>            </div>            <div id="wwa-audio-wrapper"></div>    ';var s=document.createElement("img");s.src=e,wwa_util.$id("wwa-cover").appendChild(s)}}(wwa_inject_html||(wwa_inject_html={})),function(t){var e;t.getPressData=function(){return e},t.createSavePassword=function(t){return null==e&&(e=new Uint8Array(t.mapWidth*t.mapWidth*4)),""}}(wwa_psave||(wwa_psave={})),function(t){var i,e;(e=i=t.Mode||(t.Mode={}))[e.SAVE=0]="SAVE",e[e.LOAD=1]="LOAD";var a=function(){function t(t,e){var a=this;this._wwa=t,this._parent=e,this._element=document.createElement("div"),this._element.setAttribute("id","wwa-password-window"),this._element.style.display="none",this._descriptionElement=document.createElement("div"),this._descriptionElement.classList.add("wwa-password-description"),this._passwordBoxElement=document.createElement("textarea"),this._passwordBoxElement.setAttribute("cols","50"),this._passwordBoxElement.setAttribute("rows","16"),this._passwordBoxElement.addEventListener("focus",function(t){a._passwordBoxElement.select()}),this._buttonWrapperElement=document.createElement("div"),this._okButtonElement=document.createElement("button"),this._okButtonElement.textContent="OK",this._okButtonElement.addEventListener("click",function(){a._wwa.hidePasswordWindow()}),this._cancelButtonElement=document.createElement("button"),this._cancelButtonElement.textContent="キャンセル",this._cancelButtonElement.addEventListener("click",function(){a._wwa.hidePasswordWindow(!0)}),this._buttonWrapperElement.appendChild(this._okButtonElement),this._buttonWrapperElement.appendChild(this._cancelButtonElement),this._mode=i.LOAD,this._element.appendChild(this._descriptionElement),this._element.appendChild(this._passwordBoxElement),this._element.appendChild(this._buttonWrapperElement),this._parent.appendChild(this._element),this.update()}return Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},set:function(t){(this._mode=t)===i.LOAD&&(this.password="")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"password",{get:function(){return this._passwordBoxElement.value},set:function(t){this._passwordBoxElement.value=t},enumerable:!0,configurable:!0}),t.prototype.show=function(t){void 0!==t&&(this.mode=t),this._isVisible=!0,this.update()},t.prototype.hide=function(){this._isVisible=!1,this.update()},t.prototype.update=function(){var t="";if(this._mode===i.LOAD){t="下のボックスに前回のプレイで取得した\n復帰用パスワードを入力してください。\nテキストは、Ctrl+Cでコピー、Ctrl+Vで貼り付けできます。\n現在、Java版WWAで取得したパスワードはご利用になれません。\n作成者がマップの内容を変更した場合は\nそれ以前に取得したパスワードは使えなくなります。";try{this._passwordBoxElement.removeAttribute("readonly")}catch(t){}this._cancelButtonElement.style.display="inline"}else t="下記テキストがデータ復帰用のパスワードになっています。\nコピーしてメモ帳などのテキストエディタに貼り付けて\n保存してください。ボックスをクリックで全体を選択、\n「Ctrl+C」でコピー、「Ctrl+V」で貼り付けできます。\n通常数万文字程度ありますので、ご注意ください。",this._passwordBoxElement.setAttribute("readonly","readonly"),this._cancelButtonElement.style.display="none";var e=t.split("\n");this._descriptionElement.textContent="";for(var a=0;a<e.length;a++){var s=document.createElement("span");s.textContent=e[a],this._descriptionElement.appendChild(s),this._descriptionElement.appendChild(document.createElement("br"))}this._isVisible?this._element.style.display="block":this._element.style.display="none"},t}();t.PasswordWindow=a}(wwa_password_window||(wwa_password_window={})),function(t){var e=function(){function s(){this.allClear()}return s.prototype.update=function(){0<this.counter&&this.counter--},s.prototype.cursor_wait=function(){this.counter=6},s.prototype.allClear=function(){this.col=0,this.row=0,this.counter=0},s.prototype.cursor_up=function(){0<this.counter||0<this.row&&(this.row--,this.openView(),this.cursor_wait())},s.prototype.cursor_down=function(){0<this.counter||this.row<s.ROW_MAX-1&&(this.row++,this.openView(),this.cursor_wait())},s.prototype.cursor_left=function(){0<this.counter||0<this.col&&(this.col--,this.openView(),this.cursor_wait())},s.prototype.cursor_right=function(){0<this.counter||this.col<s.COL_MAX-1&&(this.col++,this.openView(),this.cursor_wait())},s.prototype.ok=function(){this.close();var t=null;t=wwa_util.$qsh(s.CLICK_DOM_QUERY_TABLE[this.row][this.col]);var e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});return t.dispatchEvent(e)},s.prototype.ng=function(){this.close()},s.prototype.close=function(){var t,e,a=null;for(t=0;t<s.COL_MAX;t++)for(e=0;e<s.ROW_MAX;e++)(a=wwa_util.$id(s.DOM_ID_TABLE[e][t])).classList.contains("onpress")&&a.classList.remove("onpress")},s.prototype.openView=function(){this.close();wwa_util.$id(s.DOM_ID_TABLE[this.row][this.col]).classList.add("onpress")},s.prototype.init=function(){this.allClear(),this.openView()},s.KEY_BUFFER_MAX=256,s.ROW_MAX=8,s.COL_MAX=3,s.DOM_ID_TABLE=[["item0","item1","item2"],["item3","item4","item5"],["item6","item7","item8"],["item9","item10","item11"],["cell-load","cell-load","cell-load"],["cell-save","cell-save","cell-save"],["cell-restart","cell-restart","cell-restart"],["cell-gotowwa","cell-gotowwa","cell-gotowwa"]],s.CLICK_DOM_QUERY_TABLE=[["#item0 .item-click-border","#item1 .item-click-border","#item2 .item-click-border"],["#item3 .item-click-border","#item4 .item-click-border","#item5 .item-click-border"],["#item6 .item-click-border","#item7 .item-click-border","#item8 .item-click-border"],["#item9 .item-click-border","#item10 .item-click-border","#item11 .item-click-border"],["#button-load","button-load","#button-load"],["#button-save","#button-save","#button-save"],["#button-restart","#button-restart","#button-restart"],["#button-gotowwa"," #button-gotowwa","#button-gotowwa"]],s}();t.ItemMenu=e}(wwa_item_menu||(wwa_item_menu={}));var wwa_main,postMessage_noWorker=function(t){};!function(t){var o,m=wwa_input.KeyCode,y=wwa_input.KeyState,g=wwa_input.KeyStore,n=wwa_input.MouseState,S=wwa_input.MouseStore,I=wwa_input.GamePadStore,A=wwa_cgmanager.CGManager,C=wwa_data.WWAConsts,T=wwa_data.Coord,f=wwa_data.Position,P=wwa_camera.Camera,O=wwa_item_menu.ItemMenu,N=wwa_util;function D(t,e,a){var s=new wwa_data.LoaderProgress;return s.current=t,s.total=e,s.stage=a,s}t.getProgress=D;var h=function(){function t(){this.isBgm=!1,this.buffer_sources=[],this.pos=0}return t.prototype.play=function(){var t=o.audioContext,e=o.audioGain,a=null;a=t.createBufferSource(),this.buffer_sources.push(a),a.buffer=this.buffer,this.isBgm&&(a.loop=!0),a.connect(e);var s=a.duration;(!isFinite(s)||s<0||"number"!=typeof s)&&(s=0),a.start(0,this.pos*s),a.onended=function(){var t=this.buffer_sources.indexOf(a);-1!==t&&this.buffer_sources.splice(t,1);try{a.stop()}catch(t){}a.onended=null}.bind(this),e.connect(t.destination)},t.prototype.pause=function(){var t,e=this.buffer_sources.length,a=null;for(t=0;t<e;t++){a=this.buffer_sources[t];try{a.stop()}catch(t){}a.onended=null}this.buffer_sources.length=0},t.prototype.skipTo=function(t){this.pos=t},t}();t.WWAWebAudio=h;var r=function(){function t(e,t,a,s){void 0===a&&(a=!1),void 0===s&&(s=null);var p=this;this.audioExtension="";try{N.$id("version").textContent="WWA Wing Ver."+C.VERSION_WWAJS}catch(t){}var i=window.AudioContext||window.webkitAudioContext;i&&(this.audioContext=new i,this.audioGain=this.audioContext.createGain(),this.audioGain.gain.setValueAtTime(1,this.audioContext.currentTime),this._soundDecodingFlag=!1);var o=new Audio;"no"!==o.canPlayType("audio/mpeg")&&""!==o.canPlayType("audio/mpeg")?this.audioExtension="mp3":this.audioExtension="m4a";var r=window.navigator.userAgent,l={os:"",browser:""};l.os=r.match(/windows/i)?"Windows":"",l.os=l.os||(r.match(/macintosh/i)?"Macintosh":""),l.os=l.os||(r.match(/iphone|ipad|ipod/i)?"iOS":""),l.os=l.os||(r.match(/oculus/i)?"Oculus":""),l.os=l.os||(r.match(/android/i)?"Android":""),l.os=l.os||(r.match(/nintendo/i)?"Nintendo":""),l.os=l.os||(r.match(/playstation/i)?"PlayStation":""),l.os=l.os||(r.match(/linux/i)?"Linux":""),this._isURLGateEnable=a,this._mainCallCounter=0,this._animationCounter=0,this._statusPressCounter=new wwa_data.Status(0,0,0,0),s||(s="./audio/"),this._audioDirectory=s;var E=(new Date).getTime();switch(!!location.href.match(/^file/)&&("Nintendo"===l.os?C.BATTLE_INTERVAL_FRAME_NUM=6:alert("【警告】直接HTMLファイルを開いているようです。\nこのプログラムは正常に動作しない可能性があります。\nマップデータの確認を行う場合には同梱の「WWA Debugger」をご利用ください。")),this._usePassword="Nintendo"!==l.os,this._useBattleReportButton=!0,this._useHelp=!0,l.os){case"Android":case"iOS":case"Oculus":case"Nintendo":case"PlayStation":this._useHelp=!1}if(this._usePassword||(N.$id("cell-load").textContent="Quick Load"),this._useBattleReportButton&&(N.$id("cell-gotowwa").textContent="Battle Report"),void 0!==window.audiojs)if(this._loadHandler=function(t){if(null===t.data.error||void 0===t.data.error)if(null===t.data.progress||void 0===t.data.progress){p._wwaData=t.data.wwaData,p.initCSSRule(),p._setProgressBar(D(0,4,wwa_data.LoadStage.GAME_INIT));var e=new Image;e.src=p._wwaData.mapCGName,e.addEventListener("error",function(){alert("画像ファイル「"+p._wwaData.mapCGName+"」が見つかりませんでした。\n管理者の方へ: データがアップロードされているか、パーミッションを確かめてください。")}),p._restartData=JSON.parse(JSON.stringify(p._wwaData));var a=p._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(N.$qsAll("div.item-cell"),function(t){t.style.backgroundPosition="-40px -80px",t.style.backgroundImage="url("+a+")"}),Array.prototype.forEach.call(N.$qsAll("div.wide-cell-row"),function(t){t.style.backgroundPosition="-160px -120px",t.style.backgroundImage="url("+a+")"}),Array.prototype.forEach.call(N.$qsAll(".item-cell>.item-click-border"),function(t){t.style.backgroundImage="url('"+C.ITEM_BORDER_IMG_DATA_URL+"')",t.style.backgroundPosition="0 0",t.style.display="none",t.style.cursor="pointer"}),Array.prototype.forEach.call(N.$qsAll(".item-cell>.item-disp"),function(t){t.style.backgroundImage="url("+a+")"});var s=N.$qsh("#disp-energy>.status-icon");s.style.backgroundPosition="-120px -80px",s.style.backgroundImage="url("+a+")";var i=N.$qsh("#disp-strength>.status-icon");i.style.backgroundPosition="-160px -80px",i.style.backgroundImage="url("+a+")";var o=N.$qsh("#disp-defence>.status-icon");o.style.backgroundPosition="-200px -80px",o.style.backgroundImage="url("+a+")";var r=N.$qsh("#disp-gold>.status-icon");r.style.backgroundPosition="-240px -80px",r.style.backgroundImage="url("+a+")",p._setProgressBar(D(1,4,wwa_data.LoadStage.GAME_INIT)),p._replaceAllRandomObjects();var _=(new Date).getTime();console.log("Loading Complete!"+(_-E)+"ms"),p._cvs=N.$id("wwa-map"),p._cvsSub=N.$id("wwa-map-sub");var n=p._cvs.getContext("2d"),h=p._cvsSub.getContext("2d");n.fillStyle="rgba( 255, 255, 255, 0.5)",n.fillRect(0,0,440,440);var d=new f(p,p._wwaData.playerX,p._wwaData.playerY);p._camera=new P(d),p._itemMenu=new O;var w=new wwa_data.Status(p._wwaData.statusEnergy,p._wwaData.statusStrength,p._wwaData.statusDefence,p._wwaData.statusGold);if(p._player=new wwa_parts_player.Player(p,d,p._camera,w,p._wwaData.statusEnergyMax),p._objectMovingDataManager=new wwa_motion.ObjectMovingDataManager(p,p._player),p._camera.setPlayer(p._player),p._keyStore=new g,p._mouseStore=new S,p._gamePadStore=new I,p._messageQueue=[],p._yesNoJudge=wwa_data.YesNoState.UNSELECTED,p._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED,p._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE,p._prevFrameEventExected=!1,p._lastMessage=new wwa_message.MessageInfo("",!1,!1,[]),p._execMacroListInNextFrame=[],p._passwordLoadExecInNextFrame=!1,p._setProgressBar(D(2,4,wwa_data.LoadStage.GAME_INIT)),window.addEventListener("keydown",function(t){if("Nintendo"===l.os)return t.preventDefault(),void t.stopPropagation();p._keyStore.setPressInfo(t.keyCode),t.keyCode===m.KEY_F5?t.preventDefault():t.keyCode!==m.KEY_DOWN&&t.keyCode!==m.KEY_LEFT&&t.keyCode!==m.KEY_RIGHT&&t.keyCode!==m.KEY_UP&&t.keyCode!==m.KEY_SHIFT&&t.keyCode!==m.KEY_ENTER&&t.keyCode!==m.KEY_1&&t.keyCode!==m.KEY_2&&t.keyCode!==m.KEY_3&&t.keyCode!==m.KEY_A&&t.keyCode!==m.KEY_C&&t.keyCode!==m.KEY_D&&t.keyCode!==m.KEY_E&&t.keyCode!==m.KEY_M&&t.keyCode!==m.KEY_N&&t.keyCode!==m.KEY_Q&&t.keyCode!==m.KEY_S&&t.keyCode!==m.KEY_W&&t.keyCode!==m.KEY_X&&t.keyCode!==m.KEY_Y&&t.keyCode!==m.KEY_Z&&t.keyCode!==m.KEY_ESC&&t.keyCode!==m.KEY_F1&&t.keyCode!==m.KEY_F3&&t.keyCode!==m.KEY_F4&&t.keyCode!==m.KEY_F6&&t.keyCode!==m.KEY_F7&&t.keyCode!==m.KEY_F8&&t.keyCode!==m.KEY_F9&&t.keyCode!==m.KEY_F12&&t.keyCode!==m.KEY_SPACE||p._player.isWaitingMessage()||p._player.isWaitingPasswordWindow()||t.preventDefault()}),window.addEventListener("keyup",function(t){if("Nintendo"===l.os)return t.preventDefault(),void t.stopPropagation();p._keyStore.setReleaseInfo(t.keyCode),t.keyCode===m.KEY_F5?t.preventDefault():t.keyCode!==m.KEY_DOWN&&t.keyCode!==m.KEY_LEFT&&t.keyCode!==m.KEY_RIGHT&&t.keyCode!==m.KEY_UP&&t.keyCode!==m.KEY_SHIFT&&t.keyCode!==m.KEY_ENTER&&t.keyCode!==m.KEY_1&&t.keyCode!==m.KEY_2&&t.keyCode!==m.KEY_3&&t.keyCode!==m.KEY_A&&t.keyCode!==m.KEY_C&&t.keyCode!==m.KEY_D&&t.keyCode!==m.KEY_E&&t.keyCode!==m.KEY_M&&t.keyCode!==m.KEY_N&&t.keyCode!==m.KEY_Q&&t.keyCode!==m.KEY_S&&t.keyCode!==m.KEY_W&&t.keyCode!==m.KEY_X&&t.keyCode!==m.KEY_Y&&t.keyCode!==m.KEY_Z&&t.keyCode!==m.KEY_ESC&&t.keyCode!==m.KEY_F1&&t.keyCode!==m.KEY_F3&&t.keyCode!==m.KEY_F4&&t.keyCode!==m.KEY_F6&&t.keyCode!==m.KEY_F7&&t.keyCode!==m.KEY_F8&&t.keyCode!==m.KEY_F9&&t.keyCode!==m.KEY_F12&&t.keyCode!==m.KEY_SPACE||p._player.isWaitingMessage()||p._player.isWaitingPasswordWindow()||t.preventDefault()}),window.addEventListener("blur",function(t){p._keyStore.allClear(),p._mouseStore.clear()}),window.addEventListener("contextmenu",function(t){p._keyStore.allClear(),p._mouseStore.clear()}),window.addEventListener("help",function(t){t.preventDefault()}),p._wwaWrapperElement=wwa_util.$id("wwa-wrapper"),p._mouseControllerElement=wwa_util.$id("wwa-controller"),p._mouseControllerElement.addEventListener("mousedown",function(t){if(1===t.which){if(p._mouseStore.getMouseState()!==wwa_input.MouseState.NONE)return void t.preventDefault();var e=wwa_util.$localPos(t.clientX,t.clientY),a=p._player.getDrawingCenterPosition(),s=e.substract(a),i=Math.abs(s.x),o=Math.abs(s.y),r=!1;if(i<C.CHIP_SIZE&&o<C.CHIP_SIZE){switch(a.x/C.CHIP_SIZE|0){case 0:r=!0,dir=wwa_data.Direction.LEFT;break;case C.H_PARTS_NUM_IN_WINDOW-1:r=!0,dir=wwa_data.Direction.RIGHT}switch(a.y/C.CHIP_SIZE|0){case 0:r=!0,dir=wwa_data.Direction.UP;break;case C.V_PARTS_NUM_IN_WINDOW-1:r=!0,dir=wwa_data.Direction.DOWN}}r||(0<s.y&&i<o?dir=wwa_data.Direction.DOWN:s.y<0&&i<o?dir=wwa_data.Direction.UP:0<s.x&&o<i?dir=wwa_data.Direction.RIGHT:s.x<0&&o<i&&(dir=wwa_data.Direction.LEFT)),p._mouseStore.setPressInfo(dir),t.preventDefault()}}),p._mouseControllerElement.addEventListener("mouseleave",function(t){p._mouseStore.clear()}),p._mouseControllerElement.addEventListener("mouseup",function(t){1===t.which&&(p._mouseStore.setReleaseInfo(),t.preventDefault())}),window.TouchEvent){if(p.audioContext){var c=function(){this.audioContext.createBufferSource().start(0),this._mouseControllerElement.removeEventListener("touchstart",c),c=null}.bind(p);p._mouseControllerElement.addEventListener("touchstart",c)}p._mouseControllerElement.addEventListener("touchstart",function(t){if(p._mouseStore.getMouseState()===wwa_input.MouseState.NONE){var e,a=wwa_util.$localPos(t.changedTouches[0].clientX,t.changedTouches[0].clientY),s=p._player.getDrawingCenterPosition(),i=a.substract(s),o=Math.abs(i.x),r=Math.abs(i.y),_=!1;if(o<C.CHIP_SIZE&&r<C.CHIP_SIZE){switch(s.x/C.CHIP_SIZE|0){case 0:_=!0,e=wwa_data.Direction.LEFT;break;case C.H_PARTS_NUM_IN_WINDOW-1:_=!0,e=wwa_data.Direction.RIGHT}switch(s.y/C.CHIP_SIZE|0){case 0:_=!0,e=wwa_data.Direction.UP;break;case C.V_PARTS_NUM_IN_WINDOW-1:_=!0,e=wwa_data.Direction.DOWN}}_||(0<i.y&&o<r?e=wwa_data.Direction.DOWN:i.y<0&&o<r?e=wwa_data.Direction.UP:0<i.x&&r<o?e=wwa_data.Direction.RIGHT:i.x<0&&r<o&&(e=wwa_data.Direction.LEFT)),p._mouseStore.setPressInfo(e,t.changedTouches[0].identifier),t.cancelable&&t.preventDefault()}else t.preventDefault()}),p._mouseControllerElement.addEventListener("touchend",function(t){for(var e=0;e<t.changedTouches.length;e++)if(p._mouseStore.getTouchID()===t.changedTouches[e].identifier){p._mouseStore.setReleaseInfo(),t.preventDefault();break}}),p._mouseControllerElement.addEventListener("touchcancel",function(t){for(var e=0;e<t.changedTouches.length;e++)if(p._mouseStore.getTouchID()===t.changedTouches[e].identifier){p._mouseStore.setReleaseInfo(),t.preventDefault();break}})}N.$id("button-load").addEventListener("click",function(){p._player.isControllable()&&p.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD)}),N.$id("button-save").addEventListener("click",function(){p._player.isControllable()&&p.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE)}),N.$id("button-restart").addEventListener("click",function(){p._player.isControllable()&&p.onselectbutton(wwa_data.SidebarButton.RESTART_GAME)}),N.$id("button-gotowwa").addEventListener("click",function(){p._player.isControllable()&&p.onselectbutton(wwa_data.SidebarButton.GOTO_WWA)}),Array.prototype.forEach.call(N.$qsAll(".wide-cell-row"),function(t){t.addEventListener("click",function(){p._displayHelp()})}),p._frameCoord=new T(C.IMGPOS_DEFAULT_FRAME_X,C.IMGPOS_DEFAULT_YESNO_Y),p._battleEffectCoord=new T(C.IMGPOS_DEFAULT_BATTLE_EFFECT_X,C.IMGPOS_DEFAULT_BATTLE_EFFECT_Y),p._battleEstimateWindow=new wwa_estimate_battle.BattleEstimateWindow(p,p._wwaData.mapCGName,wwa_util.$id("wwa-wrapper")),p._passwordWindow=new wwa_password_window.PasswordWindow(p,wwa_util.$id("wwa-wrapper")),p._messageWindow=new wwa_message.MessageWindow(p,50,180,340,0,"",p._wwaData.mapCGName,!1,!0,!1,N.$id("wwa-wrapper")),p._monsterWindow=new wwa_message.MosterWindow(p,new T(50,180),340,60,!1,N.$id("wwa-wrapper"),p._wwaData.mapCGName),p._scoreWindow=new wwa_message.ScoreWindow(p,new T(50,50),!1,N.$id("wwa-wrapper")),p._setProgressBar(D(3,4,wwa_data.LoadStage.GAME_INIT)),p._isLoadedSound=!1,p._temporaryInputDisable=!1,p._paintSkipByDoorOpen=!1,p._clearFacesInNextFrame=!1,p._useConsole=!1,p.clearFaces();var u=p;p._cgManager=new A(n,h,p._wwaData.mapCGName,p._frameCoord,function(){if("ON"===p._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])return p._isLoadedSound=!0,p.setMessageQueue("ゲームを開始します。\n画面をクリックしてください。\n※iOS, Android端末では、音楽は再生されないことがあります。",!1,!0),p.loadSound(),void setTimeout(p.soundCheckCaller,C.DEFAULT_FRAME_INTERVAL,p);if("OFF"===p._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])return p._isLoadedSound=!1,p.setMessageQueue("ゲームを開始します。\n画面をクリックしてください。",!1,!0),void p.openGameWindow();if(p._usePassword){p._messageWindow.setMessage((""===p._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE]?"効果音・ＢＧＭデータをロードしますか？":p._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])+"\n※iOS, Android端末では、選択に関わらず音楽が再生されないことがあります。"),p._messageWindow.show(),p._setProgressBar(D(4,4,wwa_data.LoadStage.GAME_INIT));var t=setInterval(function(){u._keyStore.update(),u._gamePadStore.update(),u._yesNoJudgeInNextFrame===wwa_data.YesNoState.UNSELECTED&&(u._keyStore.getKeyState(m.KEY_ENTER)===y.KEYDOWN||u._keyStore.getKeyState(m.KEY_Y)===y.KEYDOWN||u._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_A)?u._yesNoJudgeInNextFrame=wwa_data.YesNoState.YES:(u._keyStore.getKeyState(m.KEY_N)===y.KEYDOWN||u._keyStore.getKeyState(m.KEY_ESC)===y.KEYDOWN||u._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_B))&&(u._yesNoJudgeInNextFrame=wwa_data.YesNoState.NO)),u._yesNoJudgeInNextFrame===wwa_data.YesNoState.YES?(clearInterval(t),u._messageWindow.update(),u._yesNoJudge=u._yesNoJudgeInNextFrame,u._messageWindow.setInputDisable(),setTimeout(function(){u._messageWindow.update(),setTimeout(function(){u._messageWindow.hide(),u._yesNoJudge=wwa_data.YesNoState.UNSELECTED,u._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED,u._isLoadedSound=!0,u.loadSound(),setTimeout(p.soundCheckCaller,C.DEFAULT_FRAME_INTERVAL,p)},C.YESNO_PRESS_DISP_FRAME_NUM*C.DEFAULT_FRAME_INTERVAL)},C.DEFAULT_FRAME_INTERVAL)):u._yesNoJudgeInNextFrame===wwa_data.YesNoState.NO&&(clearInterval(t),u._messageWindow.update(),u._yesNoJudge=u._yesNoJudgeInNextFrame,u._messageWindow.setInputDisable(),setTimeout(function(){u._messageWindow.update(),setTimeout(function(){u._messageWindow.hide(),u._yesNoJudge=wwa_data.YesNoState.UNSELECTED,u._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED,u._isLoadedSound=!1,u.openGameWindow()},C.YESNO_PRESS_DISP_FRAME_NUM*C.DEFAULT_FRAME_INTERVAL)},C.DEFAULT_FRAME_INTERVAL))},C.DEFAULT_FRAME_INTERVAL)}else u._messageWindow.hide(),u._yesNoJudge=wwa_data.YesNoState.UNSELECTED,u._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED,u._isLoadedSound=!0,u.loadSound(),setTimeout(p.soundCheckCaller,C.DEFAULT_FRAME_INTERVAL,p)})}else p._setProgressBar(t.data.progress);else alert("下記のエラーが発生しました。: \n"+t.data.error.message)},wwap_mode||void 0===Worker){var _;if(external_script_inject_mode){if(!(_=document.getElementById("wwaloader-ex")).src.match(/^http:\/\/wwawing\.com/)&&!_.src.match(/^http:\/\/www\.wwawing\.com/))throw new Error("SCRIPT ORIGIN ERROR")}else _=document.createElement("script"),wwap_mode?_.src=C.WWAP_SERVER+"/"+C.WWAP_SERVER_LOADER_NO_WORKER:_.src="wwaload.noworker.js",document.getElementsByTagName("head")[0].appendChild(_);var n=this;postMessage_noWorker=function(t){n._loadHandler(t)};try{loader_start({data:{fileName:e+"?date="+E}})}catch(t){_.onload=function(){loader_start({data:{fileName:e+"?date="+E}})}}}else try{var h=new Worker(t+"?date="+E);h.postMessage({fileName:e+"?date="+E}),h.addEventListener("message",this._loadHandler)}catch(t){return void alert("マップデータのロード時のエラーが発生しました。:\nWebWorkerの生成に失敗しました。"+t.message)}else alert("Audio.jsのロードに失敗しました。audioフォルダの中にaudio.min.jsは配置されていますか？")}return t.prototype._setProgressBar=function(t){t.stage<=C.LOAD_STAGE_MAX_EXCEPT_AUDIO?(wwa_util.$id("progress-message-container").textContent=t.stage===C.LOAD_STAGE_MAX_EXCEPT_AUDIO?"World Name: "+this._wwaData.worldName:wwa_data.loadMessages[t.stage],wwa_util.$id("progress-bar").style.width=(1*t.stage+t.current/t.total*1)/(C.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*C.MAP_WINDOW_WIDTH+"px",wwa_util.$id("progress-disp").textContent=((1*t.stage+t.current/t.total*1)/(C.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*100).toFixed(2)+"%"):(this._usePassword?wwa_util.$id("progress-message-container").textContent="効果音/BGMを読み込んでいます。(スペースキーでスキップ）":wwa_util.$id("progress-message-container").textContent="ゲームデータを読み込んでいます。",wwa_util.$id("progress-bar-audio").style.width=t.current*C.MAP_WINDOW_WIDTH/t.total+"px",wwa_util.$id("progress-disp").textContent=(t.current/t.total*100).toFixed(2)+"%")},t.prototype.createAudioJSInstance=function(e,t){void 0===t&&(t=!1);var a=this.audioContext;if(a){if(0===e||void 0!==this._webAudioJSInstances[e]||e===wwa_data.SystemSound.NO_SOUND)return}else if(0===e||void 0!==this._audioJSInstances[e]||e===wwa_data.SystemSound.NO_SOUND)return;var s=wwap_mode?C.WWAP_SERVER+"/"+C.WWAP_SERVER_AUDIO_DIR+"/"+e+"."+this.audioExtension:this._audioDirectory+e+"."+this.audioExtension;if(a){var i=this;this._webAudioJSInstances[e]=new h,e>=wwa_data.SystemSound.BGM_LB&&(this._webAudioJSInstances[e].isBgm=!0);var o=function(){if(i._soundDecodingFlag)setTimeout(function(){o()},100);else{i._soundDecodingFlag=!0;var t=new XMLHttpRequest;t.responseType="arraybuffer",t.onreadystatechange=function(){if(4===this.readyState&&(0===this.status||200===this.status)){new Date;a.decodeAudioData(this.response,function(t){0!==t.length?(i._soundDecodingFlag=!1,i._webAudioJSInstances[e].buffer=t):setTimeout(function(){o()},100)})}},t.open("GET",s,!0),t.send("")}};o()}else{var r=new Audio(s);if(r.preload="auto",e>=wwa_data.SystemSound.BGM_LB&&(r.loop=!0),N.$id("wwa-audio-wrapper").appendChild(r),this._audioJSInstances[e]=audiojs.create(r),e<wwa_data.SystemSound.BGM_LB){var _=new Audio(s);_.preload="auto",N.$id("wwa-audio-wrapper").appendChild(_),this._audioJSInstancesSub[e]=audiojs.create(_)}}},t.prototype.loadSound=function(){this._webAudioJSInstances=new Array(C.SOUND_MAX+1),this._audioJSInstances=new Array(C.SOUND_MAX+1),this._audioJSInstancesSub=new Array(C.SOUND_MAX+1),this.createAudioJSInstance(wwa_data.SystemSound.DECISION),this.createAudioJSInstance(wwa_data.SystemSound.ATTACK);for(var t=1;t<this._wwaData.mapPartsMax;t++){var e=this._wwaData.mapAttribute[t][C.ATR_SOUND];this.createAudioJSInstance(e)}for(t=1;t<this._wwaData.objPartsMax;t++)if(this._wwaData.objectAttribute[t][C.ATR_TYPE]!==C.OBJECT_RANDOM){e=this._wwaData.objectAttribute[t][C.ATR_SOUND];this.createAudioJSInstance(e)}this._wwaData.bgm=0,this._soundLoadSkipFlag=!1},t.prototype.checkAllSoundLoaded=function(){var t=0,e=0;if(this._keyStore.update(),this._keyStore.getKeyState(wwa_input.KeyCode.KEY_SPACE)===wwa_input.KeyState.KEYDOWN&&(this._soundLoadSkipFlag=!0),this.audioContext)for(var a=1;a<=C.SOUND_MAX;a++)void 0!==this._webAudioJSInstances[a]&&(e++,this._webAudioJSInstances[a].buffer&&t++);else for(a=1;a<=C.SOUND_MAX;a++)void 0!==this._audioJSInstances[a]&&(this._audioJSInstances[a].wrapper.classList.contains("error")||(e++,this._audioJSInstances[a].wrapper.classList.contains("loading")||t++));if(t<e&&!this._soundLoadSkipFlag)return this._setProgressBar(D(t,e,wwa_data.LoadStage.AUDIO)),void setTimeout(this.soundCheckCaller,C.DEFAULT_FRAME_INTERVAL,this);this._setProgressBar(D(C.SOUND_MAX,C.SOUND_MAX,wwa_data.LoadStage.AUDIO)),this.openGameWindow()},t.prototype.playSound=function(t){var s=this;if(this._isLoadedSound){if(t<0||t>C.SOUND_MAX)throw new Error("サウンド番号が範囲外です。");if(!(t>=wwa_data.SystemSound.BGM_LB&&this._wwaData.bgm===t)&&((t===wwa_data.SystemSound.NO_SOUND||t>=wwa_data.SystemSound.BGM_LB)&&0!==this._wwaData.bgm&&(this.audioContext?this._webAudioJSInstances[this._wwaData.bgm].buffer&&this._webAudioJSInstances[this._wwaData.bgm].pause():this._audioJSInstances[this._wwaData.bgm].wrapper.classList.contains("loading")||this._audioJSInstances[this._wwaData.bgm].pause(),this._wwaData.bgm=0),0!==t&&t!==wwa_data.SystemSound.NO_SOUND)){if(this.audioContext){if(!this._webAudioJSInstances[t].buffer){if(t>=wwa_data.SystemSound.BGM_LB)(i=function(t,e){var a=setInterval(function(){e._wwaData.bgm===t?e._webAudioJSInstances[t].buffer||(s._webAudioJSInstances[t].skipTo(0),s._webAudioJSInstances[t].play(),s._wwaData.bgm=t,clearInterval(a)):(clearInterval(a),e._wwaData.bgm!==wwa_data.SystemSound.NO_SOUND&&i(e._wwaData.bgm,e))},4)})(t,this);return void(this._wwaData.bgm=t)}}else if(this._audioJSInstances[t].wrapper.classList.contains("loading")){var i;if(t>=wwa_data.SystemSound.BGM_LB)(i=function(t,e){var a=setInterval(function(){e._wwaData.bgm===t?e._audioJSInstances[t].wrapper.classList.contains("loading")||(s._audioJSInstances[t].skipTo(0),s._audioJSInstances[t].play(),s._wwaData.bgm=t,clearInterval(a)):(clearInterval(a),e._wwaData.bgm!==wwa_data.SystemSound.NO_SOUND&&i(e._wwaData.bgm,e))},4)})(t,this);return void(this._wwaData.bgm=t)}this.audioContext?0!==t&&this._webAudioJSInstances[t].buffer&&(t>=wwa_data.SystemSound.BGM_LB?(this._webAudioJSInstances[t].skipTo(0),this._webAudioJSInstances[t].play(),this._wwaData.bgm=t):(this._webAudioJSInstances[t].skipTo(0),this._webAudioJSInstances[t].play())):0===t||this._audioJSInstances[t].wrapper.classList.contains("error")||(t>=wwa_data.SystemSound.BGM_LB?(this._audioJSInstances[t].skipTo(0),this._audioJSInstances[t].play(),this._wwaData.bgm=t):this._nextSoundIsSub?(this._audioJSInstancesSub[t].skipTo(0),this._audioJSInstancesSub[t].play(),this._nextSoundIsSub=!1):(this._audioJSInstances[t].skipTo(0),this._audioJSInstances[t].play(),this._nextSoundIsSub=!0))}}},t.prototype.openGameWindow=function(){var t=this,e=this._player.getPosition();N.$id("wwa-cover").style.opacity="0",0!==this.getObjectIdByPosition(e)&&this._player.setPartsAppearedFlag(),setTimeout(function(){N.$id("wwa-wrapper").removeChild(N.$id("wwa-cover")),t._main()},C.SPLASH_SCREEN_DISP_MILLS)},t.prototype.mainCaller=function(t){t._main()},t.prototype.soundCheckCaller=function(t){t.checkAllSoundLoaded()},t.prototype.onselectitem=function(t){if(this._player.canUseItem(t))if(wwa_util.$id("item"+(t-1)).classList.add("onpress"),this.playSound(wwa_data.SystemSound.DECISION),"BLANK"===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]){this._player.readyToUseItem(t);var e=this._player.useItem(),a=this.getObjectAttributeById(e,C.ATR_STRING);this.setMessageQueue(this.getMessageById(a),!1,!1,e,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord())}else this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]?"このアイテムを使用します。\nよろしいですか?":this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM],!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE,this._yesNoUseItemPos=t},t.prototype.onselectbutton=function(t,e){void 0===e&&(e=!1);var a=wwa_util.$id(wwa_data.sidebarButtonCellElementID[t]);this.playSound(wwa_data.SystemSound.DECISION),a.classList.add("onpress"),t===wwa_data.SidebarButton.QUICK_LOAD?void 0===this._quickSaveData||e?this.onpasswordloadcalled():(this._usePassword?this.setMessageQueue("データを読み込みますか？\n→Ｎｏでデータ復帰用パスワードの\n　入力選択ができます。",!0,!0):this.setMessageQueue("データを読み込みますか？",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD):t===wwa_data.SidebarButton.QUICK_SAVE?this._wwaData.disableSaveFlag?this.setMessageQueue("ここではセーブ機能は\n使用できません。",!1,!0):(this._usePassword?this.setMessageQueue("データの一時保存をします。\nよろしいですか？\n→Ｎｏでデータ復帰用パスワードの\n　表示選択ができます。",!0,!0):this.setMessageQueue("データの一時保存をします。\nよろしいですか？",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE):t===wwa_data.SidebarButton.RESTART_GAME?(this.setMessageQueue("初めからスタートしなおしますか？",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME):t===wwa_data.SidebarButton.GOTO_WWA&&(this._useBattleReportButton?(this.launchBattleEstimateWindow(),wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress")):(this.setMessageQueue("ＷＷＡの公式サイトを開きますか？",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA))},t.prototype.onpasswordloadcalled=function(){this._usePassword?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.add("onpress"),this.setMessageQueue("データ復帰用のパスワードを入力しますか？",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD):this.setMessageQueue("セーブデータがありません。",!1,!0)},t.prototype.onpasswordsavecalled=function(){wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.add("onpress"),this._wwaData.disableSaveFlag?this.setMessageQueue("ここではセーブ機能は\n使用できません。",!1,!0):this._usePassword&&(this.setMessageQueue("データ復帰用のパスワードを表示しますか？",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE)},t.prototype.onitemmenucalled=function(){this.setMessageQueue("右のメニューを選択してください。",!1,!0),this._messageWindow.setItemMenuChoice(!0),this.playSound(wwa_data.SystemSound.DECISION),this._itemMenu.init()},t.prototype.onchangespeed=function(t){var e;e=t===wwa_data.SpeedChange.UP?this._player.speedUp():this._player.speedDown(),this.setMessageQueue("移動速度を【"+wwa_data.speedNameList[e]+"】に切り替えました。\n"+(e===C.MAX_SPEED_INDEX?"戦闘も速くなります。\n":"")+"("+(C.MAX_SPEED_INDEX+1)+"段階中"+(e+1)+"） 速度を落とすにはIキー, 速度を上げるにはPキーを押してください。",!1,!0)},t.prototype._main=function(){var t=this;this._temporaryInputDisable=!1,this._waitTimeInCurrentFrame=C.DEFAULT_FRAME_INTERVAL,this._stopUpdateByLoadFlag=!1,this._keyStore.update(),this._mouseStore.update(),this._gamePadStore.update(),void 0!==this._yesNoJudgeInNextFrame&&(this._yesNoJudge=this._yesNoJudgeInNextFrame,this._yesNoJudgeInNextFrame=void 0),this._clearFacesInNextFrame&&(this.clearFaces(),this._clearFacesInNextFrame=!1);for(var e=0;e<this._execMacroListInNextFrame.length;e++)this._execMacroListInNextFrame[e].execute();""===this._lastMessage.message&&this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0),this._execMacroListInNextFrame=[];this._player.getPosition();var a=this._player.getDir();if(this._player.isControllable())this._keyStore.getKeyStateForControllPlayer(m.KEY_LEFT)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.LEFT)===wwa_input.MouseState.MOUSEDOWN?(this._player.controll(wwa_data.Direction.LEFT),this._objectMovingDataManager.update()):this._keyStore.getKeyStateForControllPlayer(m.KEY_UP)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.UP)===wwa_input.MouseState.MOUSEDOWN?(this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update()):this._keyStore.getKeyStateForControllPlayer(m.KEY_RIGHT)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.RIGHT)===wwa_input.MouseState.MOUSEDOWN?(this._player.controll(wwa_data.Direction.RIGHT),this._objectMovingDataManager.update()):this._keyStore.getKeyStateForControllPlayer(m.KEY_DOWN)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.DOWN)===wwa_input.MouseState.MOUSEDOWN?(this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(wwa_data.dirToKey[a])?(this._player.controll(a),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(m.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT)||this._gamePadStore.crossPressed(wwa_input.GamePadState.BUTTON_CROSS_KEY_LEFT)?(this._player.controll(wwa_data.Direction.LEFT),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(m.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP)||this._gamePadStore.crossPressed(wwa_input.GamePadState.BUTTON_CROSS_KEY_UP)?(this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(m.KEY_RIGHT)||this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT)||this._gamePadStore.crossPressed(wwa_input.GamePadState.BUTTON_CROSS_KEY_RIGHT)?(this._player.controll(wwa_data.Direction.RIGHT),this._objectMovingDataManager.update()):this._keyStore.checkHitKey(m.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN)||this._gamePadStore.crossPressed(wwa_input.GamePadState.BUTTON_CROSS_KEY_DOWN)?(this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update()):this._keyStore.getKeyState(m.KEY_1)===wwa_input.KeyState.KEYDOWN?this.onselectitem(1):this._keyStore.getKeyState(m.KEY_2)===wwa_input.KeyState.KEYDOWN?this.onselectitem(2):this._keyStore.getKeyState(m.KEY_3)===wwa_input.KeyState.KEYDOWN?this.onselectitem(3):this._keyStore.getKeyState(m.KEY_Q)===wwa_input.KeyState.KEYDOWN?this.onselectitem(4):this._keyStore.getKeyState(m.KEY_W)===wwa_input.KeyState.KEYDOWN?this.onselectitem(5):this._keyStore.getKeyState(m.KEY_E)===wwa_input.KeyState.KEYDOWN?this.onselectitem(6):this._keyStore.getKeyState(m.KEY_A)===wwa_input.KeyState.KEYDOWN?this.onselectitem(7):this._keyStore.getKeyState(m.KEY_S)===wwa_input.KeyState.KEYDOWN?this.onselectitem(8):this._keyStore.getKeyState(m.KEY_D)===wwa_input.KeyState.KEYDOWN?this.onselectitem(9):this._keyStore.getKeyState(m.KEY_Z)===wwa_input.KeyState.KEYDOWN?this.onselectitem(10):this._keyStore.getKeyState(m.KEY_X)===wwa_input.KeyState.KEYDOWN?this.onselectitem(11):this._keyStore.getKeyState(m.KEY_C)===wwa_input.KeyState.KEYDOWN?this.onselectitem(12):this._keyStore.getKeyState(m.KEY_I)?this.onchangespeed(wwa_data.SpeedChange.DOWN):this._keyStore.checkHitKey(m.KEY_P)?this.onchangespeed(wwa_data.SpeedChange.UP):this._keyStore.getKeyState(m.KEY_F1)===wwa_input.KeyState.KEYDOWN||this._keyStore.getKeyState(m.KEY_M)===wwa_input.KeyState.KEYDOWN||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_A)?this.launchBattleEstimateWindow():this._keyStore.checkHitKey(m.KEY_F3)?(this.playSound(wwa_data.SystemSound.DECISION),this.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD,!0)):this._keyStore.checkHitKey(m.KEY_F4)?(this.playSound(wwa_data.SystemSound.DECISION),this.onpasswordsavecalled()):this._keyStore.checkHitKey(m.KEY_F5)||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_A,wwa_input.GamePadState.BUTTON_INDEX_ZR)?this.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD):this._keyStore.checkHitKey(m.KEY_F6)||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_A,wwa_input.GamePadState.BUTTON_INDEX_ZL)?this.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE):this._keyStore.checkHitKey(m.KEY_F7)||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_A,wwa_input.GamePadState.BUTTON_INDEX_R)?this.onselectbutton(wwa_data.SidebarButton.RESTART_GAME):this._keyStore.checkHitKey(m.KEY_F8)?this.onselectbutton(wwa_data.SidebarButton.GOTO_WWA):this._keyStore.checkHitKey(m.KEY_F9)||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_X)?this.onitemmenucalled():this._keyStore.checkHitKey(m.KEY_F12)&&this._displayHelp(),this._keyStore.memorizeKeyStateOnControllableFrame(),this._mouseStore.memorizeMouseStateOnControllableFrame();else if(this._player.isJumped())this._camera.isResetting()||this._player.processAfterJump();else if(this._player.isMoving())this._player.move(),this._objectMovingDataManager.update();else if(this._player.isWaitingMessage())if(this._messageWindow.isVisible()||this._messageWindow.show(),this._messageWindow.isYesNoChoice())this._messageWindow.isInputDisable()||(this._yesNoJudge===wwa_data.YesNoState.UNSELECTED&&(this._keyStore.getKeyState(m.KEY_ENTER)===y.KEYDOWN||this._keyStore.getKeyState(m.KEY_Y)===y.KEYDOWN||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_A)?this._yesNoJudge=wwa_data.YesNoState.YES:(this._keyStore.getKeyState(m.KEY_N)===y.KEYDOWN||this._keyStore.getKeyState(m.KEY_ESC)===y.KEYDOWN||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_B))&&(this._yesNoJudge=wwa_data.YesNoState.NO)),this._yesNoJudge===wwa_data.YesNoState.YES?(this.playSound(wwa_data.SystemSound.DECISION),this._yesNoDispCounter=C.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update()):this._yesNoJudge===wwa_data.YesNoState.NO&&(this.playSound(wwa_data.SystemSound.DECISION),this._yesNoDispCounter=C.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update()));else if(this._messageWindow.isItemMenuChoice()){if(this._itemMenu.update(),this._keyStore.checkHitKey(m.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT)||this._gamePadStore.crossPressed(wwa_input.GamePadState.BUTTON_CROSS_KEY_LEFT)?this._itemMenu.cursor_left():this._keyStore.checkHitKey(m.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP)||this._gamePadStore.crossPressed(wwa_input.GamePadState.BUTTON_CROSS_KEY_UP)?this._itemMenu.cursor_up():this._keyStore.checkHitKey(m.KEY_RIGHT)||this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT)||this._gamePadStore.crossPressed(wwa_input.GamePadState.BUTTON_CROSS_KEY_RIGHT)?this._itemMenu.cursor_right():(this._keyStore.checkHitKey(m.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN)||this._gamePadStore.crossPressed(wwa_input.GamePadState.BUTTON_CROSS_KEY_DOWN))&&this._itemMenu.cursor_down(),this._keyStore.getKeyState(m.KEY_ENTER)===y.KEYDOWN||this._keyStore.getKeyState(m.KEY_Y)===y.KEYDOWN||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_A))this._setNextMessage(),this._messageWindow.setItemMenuChoice(!1),this._itemMenu.ok();else if(this._keyStore.getKeyState(m.KEY_N)===y.KEYDOWN||this._keyStore.getKeyState(m.KEY_ESC)===y.KEYDOWN||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_B)){for(e=0;e<wwa_data.sidebarButtonCellElementID.length;e++){(r=wwa_util.$id(wwa_data.sidebarButtonCellElementID[e])).classList.contains("onpress")&&r.classList.remove("onpress")}this._itemMenu.ng(),this._setNextMessage(),this.playSound(wwa_data.SystemSound.DECISION),this._messageWindow.setItemMenuChoice(!1)}}else{var s=this._keyStore.getKeyStateForMessageCheck(m.KEY_ENTER),i=this._keyStore.getKeyStateForMessageCheck(m.KEY_SPACE),o=this._keyStore.getKeyStateForMessageCheck(m.KEY_ESC);if(s===y.KEYDOWN||s===y.KEYPRESS_MESSAGECHANGE||i===y.KEYDOWN||i===y.KEYPRESS_MESSAGECHANGE||o===y.KEYDOWN||o===y.KEYPRESS_MESSAGECHANGE||this._mouseStore.getMouseState()===n.MOUSEDOWN||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_A,wwa_input.GamePadState.BUTTON_INDEX_B)){for(e=0;e<wwa_data.sidebarButtonCellElementID.length;e++){var r;(r=wwa_util.$id(wwa_data.sidebarButtonCellElementID[e])).classList.contains("onpress")&&r.classList.remove("onpress")}this._setNextMessage()}}else this._player.isWatingEstimateWindow()?(this._keyStore.getKeyState(m.KEY_ENTER)===y.KEYDOWN||this._keyStore.getKeyState(m.KEY_SPACE)===y.KEYDOWN||this._gamePadStore.buttonTrigger(wwa_input.GamePadState.BUTTON_INDEX_A,wwa_input.GamePadState.BUTTON_INDEX_B))&&this.hideBattleEstimateWindow():this._player.isFighting()?(this._player.fight(),this._monsterWindow.update(this._monster)):this._player.isWaitingMoveMacro()&&(this._player.isMoveObjectAutoExecTime()&&(this.moveObjects(!1),this._player.resetMoveObjectAutoExecTimer()),this._objectMovingDataManager.update());if(this._prevFrameEventExected=!1,this._player.getPosition().isJustPosition()&&this._camera.getPosition().isScreenTopPosition()){if(!(this._player.isJumped()||this._player.isWaitingMessage()||this._player.isWaitingMoveMacro()||this._player.isFighting())){this._player.isPartsAppearedTime()&&this._player.clearPartsAppearedFlag(),this._replaceRandomObjectsInScreen();var _=this.checkMap();_||this.checkObject(),this._prevFrameEventExected=_}this._player.isWaitingMessage()&&this._messageWindow.isYesNoChoice()&&this._yesNoJudge!==wwa_data.YesNoState.UNSELECTED&&!this._player.isWaitingMoveMacro()&&!this._player.isFighting()&&this._execChoiceWindowRunningEvent()}this._passwordLoadExecInNextFrame&&(this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.PASSWORD,this._player.clearPasswordWindowWaiting(),this._passwordLoadExecInNextFrame=!1),this._drawAll(),this._mainCallCounter++,this._mainCallCounter%=1e9,this._animationCounter=(this._animationCounter+1)%(2*C.ANIMATION_REP_HALF_FRAME),this._camera.isResetting()&&this._camera.advanceTransitionStepNum(),this._player.isWaitingMessage()||(this._player.decrementLookingAroundTimer(),0<this._statusPressCounter.energy&&0==--this._statusPressCounter.energy&&wwa_util.$id("disp-energy").classList.remove("onpress"),0<this._statusPressCounter.strength&&0==--this._statusPressCounter.strength&&wwa_util.$id("disp-strength").classList.remove("onpress"),0<this._statusPressCounter.defence&&0==--this._statusPressCounter.defence&&wwa_util.$id("disp-defence").classList.remove("onpress"),0<this._statusPressCounter.gold&&0==--this._statusPressCounter.gold&&wwa_util.$id("disp-gold").classList.remove("onpress")),this._player.isWaitingMoveMacro()&&this._player.decrementMoveObjectAutoExecTimer(),this._stopUpdateByLoadFlag?this._fadeout(function(){t._loadType===wwa_data.LoadType.QUICK_LOAD?t._quickLoad():t._loadType===wwa_data.LoadType.RESTART_GAME?t._restartGame():t._loadType===wwa_data.LoadType.PASSWORD&&(t._applyQuickLoad(t._passwordSaveExtractData),t._passwordSaveExtractData=void 0),setTimeout(t.mainCaller,t._waitTimeInCurrentFrame,t)}):setTimeout(this.mainCaller,this._waitTimeInCurrentFrame,this)},t.prototype._drawAll=function(){var t,e,a=this._camera.getPosition().getPartsCoord(),s=this._camera.getPosition().getOffsetCoord(),i=C.MAP_WINDOW_HEIGHT,o=this._player.getPosition().getPartsCoord();if(this._paintSkipByDoorOpen)this._paintSkipByDoorOpen=!1;else{if(this._cgManager.clearCanvas(0,0,C.MAP_WINDOW_WIDTH,C.MAP_WINDOW_HEIGHT),this._cgManager.drawBase(0,0,C.MAP_WINDOW_WIDTH,C.MAP_WINDOW_HEIGHT),this._camera.isResetting()){if(null!==this._camera.getPreviousPosition())var r=this._camera.getPreviousPosition().getPartsCoord(),_=this._camera.getPreviousPosition().getOffsetCoord();if(i=this._camera.getTransitionStepNum()*C.CHIP_SIZE,this._drawMap(r,_,i,!0),this._drawPlayer(r,_,i,!0),this._drawObjects(r,_,i,!0),this._camera.isFinalStep())var n=255,h=setInterval(function(){var t=wwa_util.$id("wwa-fader");if((n-=3*C.FADEOUT_SPEED)<=0)return clearInterval(h),t.style.backgroundColor="transparent",t.removeAttribute("style"),void(t.style.display="none");t.style.opacity=n/255+""},20)}this._drawMap(a,s,i),this._drawPlayer(a,s,i),this._drawObjects(a,s,i),this._player.isFighting()&&!this._player.isBattleStartFrame()&&(t=this._player.isTurn()?this._monster.position.x:o.x,e=this._player.isTurn()?this._monster.position.y:o.y,this._cgManager.drawCanvas(this._battleEffectCoord.x,this._battleEffectCoord.y,C.CHIP_SIZE*(t-a.x)-s.x,C.CHIP_SIZE*(e-a.y)-s.y,!1)),this._drawEffect(),this._drawFaces(),this._drawFrame()}},t.prototype._drawMap=function(t,e,a,s){if(void 0===s&&(s=!1),void 0!==t){var i,o,r=Math.max(0,t.x-1),_=Math.min(this._wwaData.mapWidth-1,t.x+C.H_PARTS_NUM_IN_WINDOW),n=Math.max(0,t.y-1),h=Math.min(this._wwaData.mapWidth-1,t.y+C.V_PARTS_NUM_IN_WINDOW);if(o=!1,i=0,s)for(var d=r;d<=_;d++)for(var w=n;w<=h;w++){var c=this._wwaData.map[w][d],u=this._wwaData.mapAttribute[c][C.ATR_X]/C.CHIP_SIZE,p=this._wwaData.mapAttribute[c][C.ATR_Y]/C.CHIP_SIZE,l=C.CHIP_SIZE*(d-t.x)-e.x,E=C.CHIP_SIZE*(w-t.y)-e.y;this._cgManager.drawCanvasWithLowerYLimit(u,p,l,E,a)}else{for(d=r;d<=_;d++)for(w=n;w<=h;w++){c=this._wwaData.map[w][d];this._cgManager.mapCache[i]!==c&&(this._cgManager.mapCache[i]=c,o=!0),i++}if(a!==this._cgManager.mapCacheYLimit&&(this._cgManager.mapCacheYLimit=a,o=!0),o){this._cgManager.clearBackCanvas();for(d=r;d<=_;d++)for(w=n;w<=h;w++){c=this._wwaData.map[w][d],u=this._wwaData.mapAttribute[c][C.ATR_X]/C.CHIP_SIZE,p=this._wwaData.mapAttribute[c][C.ATR_Y]/C.CHIP_SIZE,l=C.CHIP_SIZE*(d-t.x)-e.x,E=C.CHIP_SIZE*(w-t.y)-e.y;this._cgManager.copyBackCanvasWithUpperYLimit(u,p,l,E,a)}}this._cgManager.drawBackCanvas()}}},t.prototype._drawPlayer=function(t,e,a,s){if(void 0===s&&(s=!1),void 0!==t&&!this._wwaData.delPlayerFlag){var i,o=this._player.getPosition().getPartsCoord(),r=this._player.getPosition().getOffsetCoord(),_=wwa_data.dirToPos[this._player.getDir()],n=(o.x-t.x)*C.CHIP_SIZE+r.x-e.x,h=(o.y-t.y)*C.CHIP_SIZE+r.y-e.y,d=(Math.abs(r.x),Math.abs(r.y),this._player.getDir());i=this._player.isLookingAround()&&!this._player.isWaitingMessage()?this._wwaData.playerImgPosX+[2,3,4,5,0,1,6,7][Math.floor(this._mainCallCounter%64/8)]:(d===wwa_data.Direction.LEFT||d===wwa_data.Direction.RIGHT)&&Math.abs(r.x)>Math.floor(C.CHIP_SIZE/2)||(d===wwa_data.Direction.UP||d===wwa_data.Direction.DOWN)&&Math.abs(r.y)>Math.floor(C.CHIP_SIZE/2)?this._wwaData.playerImgPosX+_+1:this._wwaData.playerImgPosX+_,s?this._cgManager.drawCanvasWithLowerYLimit(i,this._wwaData.playerImgPosY,n,h,a):this._cgManager.drawCanvasWithUpperYLimit(i,this._wwaData.playerImgPosY,n,h,a)}},t.prototype._drawObjects=function(t,e,a,s){if(void 0===s&&(s=!1),void 0!==t)for(var i,o=Math.max(0,t.x-1),r=Math.min(this._wwaData.mapWidth-1,t.x+C.H_PARTS_NUM_IN_WINDOW),_=Math.max(0,t.y-1),n=Math.min(this._wwaData.mapWidth-1,t.y+C.V_PARTS_NUM_IN_WINDOW),h=o;h<=r;h++)for(var d=_;d<=n;d++)if(!(this._player.isFighting()&&this._player.isTurn()&&this._player.getPosition().getPartsCoord().equals(this._monster.position)&&new wwa_data.Coord(h,d).equals(this._monster.position))){var w=this._wwaData.mapObject[d][h];if(i=new T(0,0),this._wwaData.objectAttribute[w][C.ATR_MOVE]!==wwa_data.MoveType.STATIC){var c=this._objectMovingDataManager.getOffsetByBeforePartsCoord(new T(h,d));null!==c&&(i=c)}var u=this._animationCounter>C.ANIMATION_REP_HALF_FRAME||0===this._wwaData.objectAttribute[w][C.ATR_X2]&&0===this._wwaData.objectAttribute[w][C.ATR_Y2],p=this._wwaData.objectAttribute[w][u?C.ATR_X:C.ATR_X2]/C.CHIP_SIZE,l=this._wwaData.objectAttribute[w][u?C.ATR_Y:C.ATR_Y2]/C.CHIP_SIZE,E=C.CHIP_SIZE*(h-t.x)+i.x-e.x,m=C.CHIP_SIZE*(d-t.y)+i.y-e.y,y=this._wwaData.objectAttribute[w][C.ATR_TYPE],g=this._wwaData.objectAttribute[w][C.ATR_NUMBER];0===w||this._checkNoDrawObject(new T(h,d),y,g)||(s?this._cgManager.drawCanvasWithLowerYLimit(p,l,E,m,a):this._cgManager.drawCanvasWithUpperYLimit(p,l,E,m,a))}},t.prototype._drawEffect=function(){if(0!==this._wwaData.effectCoords.length)for(var t=Math.floor(this._mainCallCounter%(this._wwaData.effectCoords.length*this._wwaData.effectWaits)/this._wwaData.effectWaits),e=0;e<C.V_PARTS_NUM_IN_WINDOW;e++)for(var a=0;a<C.H_PARTS_NUM_IN_WINDOW;a++)this._cgManager.drawCanvas(this._wwaData.effectCoords[t].x,this._wwaData.effectCoords[t].y,a*C.CHIP_SIZE,e*C.CHIP_SIZE,!1)},t.prototype._drawFaces=function(){for(var t=0;t<this._faces.length;t++)this._cgManager.drawCanvasWithSize(this._faces[t].srcPos.x,this._faces[t].srcPos.y,this._faces[t].srcSize.x,this._faces[t].srcSize.y,this._faces[t].destPos.x,this._faces[t].destPos.y,!1)},t.prototype._drawFrame=function(){this._cgManager.drawFrame()},t.prototype._checkNoDrawObject=function(t,e,a){var s=this._player.getPosition(),i=s.getPartsCoord();return!(!s.isJustPosition()||i.x!==t.x||i.y!==t.y||this._wwaData.objectNoCollapseDefaultFlag)&&(e===C.OBJECT_DOOR&&0===a||(e===C.OBJECT_STATUS||e===C.OBJECT_MESSAGE||e===C.OBJECT_ITEM||e===C.OBJECT_SELL||e===C.OBJECT_BUY||e===C.OBJECT_SELL||e===C.OBJECT_LOCALGATE))},t.prototype.getMapWidth=function(){if(void 0===this._wwaData)throw new Error("マップデータがロードされていません");return this._wwaData.mapWidth},t.prototype.getMapIdByPosition=function(t){var e=t.getPartsCoord();return this._wwaData.map[e.y][e.x]},t.prototype.getObjectIdByPosition=function(t){var e=t.getPartsCoord();return this._wwaData.mapObject[e.y][e.x]},t.prototype.getMapTypeByPosition=function(t){var e=t.getPartsCoord(),a=this._wwaData.map[e.y][e.x];return this._wwaData.mapAttribute[a][C.ATR_TYPE]},t.prototype.getObjectTypeByPosition=function(t){var e=t.getPartsCoord(),a=this._wwaData.mapObject[e.y][e.x];return this._wwaData.objectAttribute[a][C.ATR_TYPE]},t.prototype.getMapAttributeByPosition=function(t,e){var a=t.getPartsCoord(),s=this._wwaData.map[a.y][a.x];return this._wwaData.mapAttribute[s][e]},t.prototype.isCurrentPosMapPartsIncludingMessage=function(t){return 0!==this.getMapAttributeByPosition(t,C.ATR_STRING)},t.prototype.getObjectAttributeByPosition=function(t,e){var a=t.getPartsCoord(),s=this._wwaData.mapObject[a.y][a.x];return this._wwaData.objectAttribute[s][e]},t.prototype.getMapAttributeById=function(t,e){return this._wwaData.mapAttribute[t][e]},t.prototype.getObjectAttributeById=function(t,e){return this._wwaData.objectAttribute[t][e]},t.prototype.getObjectCropXById=function(t){return this._wwaData.objectAttribute[t][C.ATR_X]},t.prototype.getObjectCropYById=function(t){return this._wwaData.objectAttribute[t][C.ATR_Y]},t.prototype.getMessageById=function(t){return this._wwaData.message[t]},t.prototype.getSystemMessageById=function(t){return this._wwaData.systemMessage[t]},t.prototype.checkMap=function(t){var e=this._player.getPosition().getPartsCoord();t=null!=t?t:e;var a=this._wwaData.map[t.y][t.x],s=this._wwaData.mapAttribute[a][C.ATR_TYPE],i=t.x===e.x&&t.y===e.y,o=!1;return(!i||this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.MAP)!==a)&&(s===C.MAP_STREET?o=this._execMapStreetEvent(t,a,s):s===C.MAP_WALL?o=this._execMapWallEvent(t,a,s):s===C.MAP_LOCALGATE?o=this._execMapLocalGateEvent(t,a,s):s===C.MAP_URLGATE&&(o=this._execMapUrlGateEvent(t,a,s)),i&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.MAP,a),o)},t.prototype.checkObject=function(t){var e=this._player.getPosition().getPartsCoord();t=null!=t?t:e;var a=this._wwaData.mapObject[t.y][t.x],s=this._wwaData.objectAttribute[a][C.ATR_TYPE],i=t.x===e.x&&t.y===e.y;i&&this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.OBJECT)===a||(s===C.OBJECT_NORMAL?this._execObjectNormalEvent(t,a,s):s===C.OBJECT_MESSAGE?this._execObjectMessageEvent(t,a,s):s===C.OBJECT_MONSTER?this._execObjectMonsterEvent(t,a,s):s===C.OBJECT_ITEM?this._execObjectItemEvent(t,a,s):s===C.OBJECT_DOOR?this._execObjectDoorEvent(t,a,s):s===C.OBJECT_STATUS?this._execObjectStatusEvent(t,a,s):s===C.OBJECT_BUY?this._execObjectBuyEvent(t,a,s):s===C.OBJECT_SELL?this._execObjectSellEvent(t,a,s):s===C.OBJECT_URLGATE?this._execObjectUrlGateEvent(t,a,s):s===C.OBJECT_SCORE?this._execObjectScoreEvent(t,a,s):s===C.OBJECT_SELECT?this._execObjectYesNoChoiceEvent(t,a,s):s===C.OBJECT_LOCALGATE&&this._execObjectLocalGateEvent(t,a,s),i&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.OBJECT,a))},t.prototype._execMapStreetEvent=function(t,e,a){var s=this._wwaData.mapAttribute[e][C.ATR_ITEM];if(0!==s&&!this._player.hasItem(s))return!1;this.appearParts(t,wwa_data.AppearanceTriggerType.MAP);var i=this._wwaData.mapAttribute[e][C.ATR_STRING],o=this._wwaData.message[i];this._waitTimeInCurrentFrame+=100*this._wwaData.mapAttribute[e][C.ATR_NUMBER],this._temporaryInputDisable=!0;var r=this.setMessageQueue(o,!1,!1,e,wwa_data.PartsType.MAP,t.clone());return this.playSound(this._wwaData.mapAttribute[e][C.ATR_SOUND]),0!==i&&r},t.prototype._execMapWallEvent=function(t,e,a){var s=this.getObjectIdByPosition(t.convertIntoPosition(this)),i=this.getObjectAttributeById(s,C.ATR_TYPE);if(0===s||i===C.OBJECT_NORMAL||i===C.OBJECT_DOOR&&(!this._player.hasItem(this.getObjectAttributeById(s,C.ATR_ITEM))||this.getObjectAttributeById(i,C.ATR_MODE)===C.PASSABLE_OBJECT)){this.appearParts(t,wwa_data.AppearanceTriggerType.MAP);var o=this._wwaData.mapAttribute[e][C.ATR_STRING],r=this._wwaData.message[o];return this.setMessageQueue(r,!1,!1,e,wwa_data.PartsType.MAP,t.clone()),this.playSound(this._wwaData.mapAttribute[e][C.ATR_SOUND]),!1}return!1},t.prototype._execMapLocalGateEvent=function(t,e,a){var s=this._player.getPosition().getPartsCoord(),i=this._wwaData.mapAttribute[e][C.ATR_JUMP_X],o=this._wwaData.mapAttribute[e][C.ATR_JUMP_Y];return i>C.RELATIVE_COORD_LOWER&&(i=t.x+i-C.RELATIVE_COORD_BIAS),o>C.RELATIVE_COORD_LOWER&&(o=t.y+o-C.RELATIVE_COORD_BIAS),this.appearParts(t,wwa_data.AppearanceTriggerType.MAP),0<=i&&0<=o&&i<this._wwaData.mapWidth&&o<this._wwaData.mapWidth&&(i!==s.x||o!==s.y)&&(this._player.jumpTo(new f(this,i,o,0,0)),this.playSound(this._wwaData.mapAttribute[e][C.ATR_SOUND]),!0)},t.prototype._execMapUrlGateEvent=function(t,e,a){var s=this._wwaData.mapAttribute[e][C.ATR_STRING];return!this._isURLGateEnable||("BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?(this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?"他のページにリンクします。\nよろしいですか？":this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS,this._yesNoURL=this._wwaData.message[s].split(/\s/g)[0],!0):void(location.href=wwa_util.$escapedURI(this._wwaData.message[s].split(/\s/g)[0])))},t.prototype._execObjectNormalEvent=function(t,e,a){},t.prototype._execObjectMessageEvent=function(t,e,a){var s=this._wwaData.objectAttribute[e][C.ATR_STRING],i=this._wwaData.message[s],o=this._player.getPosition().getPartsCoord(),r=this._wwaData.objectAttribute[e][C.ATR_SOUND];t.x!==o.x||t.y!==o.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[t.y][t.x]=0),this.setMessageQueue(i,!1,!1,e,wwa_data.PartsType.OBJECT,t),this._waitTimeInCurrentFrame+=100*this._wwaData.objectAttribute[e][C.ATR_NUMBER],this._temporaryInputDisable=!0,this.appearParts(t,wwa_data.AppearanceTriggerType.OBJECT,e),this.playSound(r)},t.prototype._execObjectStatusEvent=function(t,e,a){var s=new wwa_data.Status(this._wwaData.objectAttribute[e][C.ATR_ENERGY],this._wwaData.objectAttribute[e][C.ATR_STRENGTH],this._wwaData.objectAttribute[e][C.ATR_DEFENCE],this._wwaData.objectAttribute[e][C.ATR_GOLD]),i=this._wwaData.objectAttribute[e][C.ATR_STRING],o=this._wwaData.message[i],r=this._player.getStatusWithoutEquipments();s.strength>C.STATUS_MINUS_BORDER&&r.strength<s.strength-C.STATUS_MINUS_BORDER||s.defence>C.STATUS_MINUS_BORDER&&r.defence<s.defence-C.STATUS_MINUS_BORDER||s.gold>C.STATUS_MINUS_BORDER&&r.gold<s.gold-C.STATUS_MINUS_BORDER?this._wwaData.mapObject[t.y][t.x]=0:(s.energy=s.energy>C.STATUS_MINUS_BORDER?C.STATUS_MINUS_BORDER-s.energy:s.energy,s.strength=s.strength>C.STATUS_MINUS_BORDER?C.STATUS_MINUS_BORDER-s.strength:s.strength,s.defence=s.defence>C.STATUS_MINUS_BORDER?C.STATUS_MINUS_BORDER-s.defence:s.defence,s.gold=s.gold>C.STATUS_MINUS_BORDER?C.STATUS_MINUS_BORDER-s.gold:s.gold,this._player.addStatusAll(s),this.setStatusChangedEffect(s),this._player.isDead()&&0!==this._wwaData.objectAttribute[e][C.ATR_ENERGY]?this.gameover():(this.setMessageQueue(o,!1,!1,e,wwa_data.PartsType.OBJECT,t.clone()),this._wwaData.mapObject[t.y][t.x]=0,this.appearParts(t,wwa_data.AppearanceTriggerType.OBJECT,e),this.playSound(this._wwaData.objectAttribute[e][C.ATR_SOUND])))},t.prototype._execObjectMonsterEvent=function(t,e,a){var s=this,i=new wwa_data.Coord(this._wwaData.objectAttribute[e][C.ATR_X],this._wwaData.objectAttribute[e][C.ATR_Y]),o=new wwa_data.Status(this._wwaData.objectAttribute[e][C.ATR_ENERGY],this._wwaData.objectAttribute[e][C.ATR_STRENGTH],this._wwaData.objectAttribute[e][C.ATR_DEFENCE],this._wwaData.objectAttribute[e][C.ATR_GOLD]),r=this._wwaData.message[this._wwaData.objectAttribute[e][C.ATR_STRING]],_=this._wwaData.objectAttribute[e][C.ATR_ITEM];this._monster=new wwa_monster.Monster(e,t,i,o,r,_,function(){s._monsterWindow.hide()}),this._player.startBattleWith(this._monster)},t.prototype._execObjectBuyEvent=function(t,e,a){var s=this._wwaData.objectAttribute[e][C.ATR_STRING],i=this._wwaData.message[s],o=this._player.getPosition().getPartsCoord();t.x!==o.x||t.y!==o.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[t.y][t.x]=0),this.setMessageQueue(i,!0,!1,e,wwa_data.PartsType.OBJECT,t.clone()),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS,this.playSound(this._wwaData.objectAttribute[e][C.ATR_SOUND])},t.prototype._execObjectSellEvent=function(t,e,a){var s=this._wwaData.objectAttribute[e][C.ATR_STRING],i=this._wwaData.message[s],o=this._player.getPosition().getPartsCoord();t.x!==o.x||t.y!==o.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[t.y][t.x]=0),this.setMessageQueue(i,!0,!1,e,wwa_data.PartsType.OBJECT,t.clone()),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS,this.playSound(this._wwaData.objectAttribute[e][C.ATR_SOUND])},t.prototype._execObjectItemEvent=function(t,e,a){var s=this._wwaData.objectAttribute[e][C.ATR_STRING],i=this._wwaData.message[s];try{this._player.addItem(e,this._wwaData.objectAttribute[e][C.ATR_NUMBER]),(this._wwaData.mapObject[t.y][t.x]=0)!==this._wwaData.objectAttribute[e][C.ATR_MODE]||(this.setMessageQueue(i,!1,!1,e,wwa_data.PartsType.OBJECT,t.clone()),this.appearParts(t,wwa_data.AppearanceTriggerType.OBJECT,e))}catch(t){"BLANK"!==this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]&&this.setMessageQueue(""===this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]?"これ以上、アイテムを持てません。":this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM],!1,!0)}this.playSound(this._wwaData.objectAttribute[e][C.ATR_SOUND])},t.prototype._execObjectDoorEvent=function(t,e,a){var s=this._wwaData.objectAttribute[e][C.ATR_ITEM],i=this._wwaData.objectAttribute[e][C.ATR_STRING],o=this._wwaData.message[i];this._player.hasItem(s)&&(0===this._wwaData.objectAttribute[e][C.ATR_MODE]&&this._player.removeItemByPartsID(s),this.playSound(this._wwaData.objectAttribute[e][C.ATR_SOUND]),this.setMessageQueue(o,!1,!1,e,wwa_data.PartsType.OBJECT,t.clone()),this._wwaData.mapObject[t.y][t.x]=0,this.appearParts(t,wwa_data.AppearanceTriggerType.OBJECT,e),this._paintSkipByDoorOpen=!0)},t.prototype._execObjectYesNoChoiceEvent=function(t,e,a){var s=this._wwaData.objectAttribute[e][C.ATR_STRING],i=this._wwaData.message[s],o=this._player.getPosition().getPartsCoord();t.x!==o.x||t.y!==o.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[t.y][t.x]=0),this.setMessageQueue(i,!0,!1,e,wwa_data.PartsType.OBJECT,t.clone()),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS,this.playSound(this._wwaData.objectAttribute[e][C.ATR_SOUND])},t.prototype._execObjectLocalGateEvent=function(t,e,a){var s=this._player.getPosition().getPartsCoord();t.x!==s.x||t.y!==s.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[t.y][t.x]=0);var i=this._wwaData.objectAttribute[e][C.ATR_JUMP_X],o=this._wwaData.objectAttribute[e][C.ATR_JUMP_Y];i>C.RELATIVE_COORD_LOWER&&(i=s.x+i-C.RELATIVE_COORD_BIAS),o>C.RELATIVE_COORD_LOWER&&(o=s.y+o-C.RELATIVE_COORD_BIAS),this.appearParts(t,wwa_data.AppearanceTriggerType.OBJECT,e),0<=i&&0<=o&&i<this._wwaData.mapWidth&&o<this._wwaData.mapWidth&&(i!==s.x||o!==s.y)&&(this._player.jumpTo(new f(this,i,o,0,0)),this.playSound(this._wwaData.objectAttribute[e][C.ATR_SOUND]))},t.prototype._execObjectUrlGateEvent=function(t,e,a){var s=this._wwaData.objectAttribute[e][C.ATR_STRING];this._isURLGateEnable&&("BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?(this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?"他のページにリンクします。\nよろしいですか？":this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=t,this._yesNoChoicePartsID=e,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS,this._yesNoURL=this._wwaData.message[s].split(/\s/g)[0]):location.href=wwa_util.$escapedURI(this._wwaData.message[s].split(/\s/g)[0]))},t.prototype._execObjectScoreEvent=function(t,e,a){var s=this._wwaData.objectAttribute[e][C.ATR_STRING],i=(this._player.getPosition().getPartsCoord(),this._player.getStatus()),o=0;o+=this._wwaData.objectAttribute[e][C.ATR_ENERGY]*i.energy,o+=this._wwaData.objectAttribute[e][C.ATR_STRENGTH]*i.strength,o+=this._wwaData.objectAttribute[e][C.ATR_DEFENCE]*i.defence,o+=this._wwaData.objectAttribute[e][C.ATR_GOLD]*i.gold,this._scoreWindow.update(o),this._scoreWindow.show(),this.setMessageQueue(0===s?"スコアを表示します。":this._wwaData.message[s],!1,!1),this.playSound(this._wwaData.objectAttribute[e][C.ATR_SOUND])},t.prototype._execChoiceWindowRunningEvent=function(){var t,e;if(0==--this._yesNoDispCounter)if(this._yesNoJudge===wwa_data.YesNoState.YES){if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS)(t=this._wwaData.mapAttribute[this._yesNoChoicePartsID][C.ATR_TYPE])===C.MAP_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS)if((t=this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_TYPE])===C.OBJECT_BUY)this._player.hasItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_ITEM])?(this._player.removeItemByPartsID(this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_ITEM]),e=this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_GOLD],this._player.earnGold(e),this.setStatusChangedEffect(new wwa_data.Status(0,0,0,e)),this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,this._yesNoChoicePartsID)):"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]?"アイテムをもっていない。":this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM],!0));else if(t===C.OBJECT_SELL)if(this._player.hasGold(this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_GOLD]))if(this._player.canHaveMoreItems()||0===this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_ITEM]){0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_ITEM]&&this._player.addItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_ITEM]);var a=new wwa_data.Status(this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_ENERGY],this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_STRENGTH],this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_DEFENCE],-this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_GOLD]);this._player.getStatusWithoutEquipments();if(a.energy=a.energy>C.STATUS_MINUS_BORDER?C.STATUS_MINUS_BORDER-a.energy:a.energy,this.setStatusChangedEffect(a),this._player.addStatusAll(a),this._player.isDead()&&0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_ENERGY])return void this.gameover();this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,this._yesNoChoicePartsID)}else"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]?"これ以上、アイテムを持てません。":this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM],!0));else"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]?"所持金が足りない。":this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY],!0));else t===C.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.CHOICE_YES,this._yesNoChoicePartsID):t===C.OBJECT_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE?this._player.readyToUseItem(this._yesNoUseItemPos):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.QUICK_LOAD):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"),this._quickSave()):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.RESTART_GAME):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA?(location.href=wwa_util.$escapedURI(C.WWA_HOME),wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress")):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"),this._player.setPasswordWindowWating(),this._passwordWindow.show(wwa_password_window.Mode.LOAD)):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE&&(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"),this._player.setPasswordWindowWating(),this._passwordWindow.password=this._quickSave(!0),this._passwordWindow.show(wwa_password_window.Mode.SAVE));this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,this._setNextMessage(),this._yesNoChoicePartsCoord=void 0,this._yesNoChoicePartsID=void 0,this._yesNoUseItemPos=void 0,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE,this._messageWindow.setYesNoChoice(!1)}else if(this._yesNoJudge===wwa_data.YesNoState.NO){if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS)t=this._wwaData.mapAttribute[this._yesNoChoicePartsID][C.ATR_TYPE],C.MAP_URLGATE;else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS)(t=this._wwaData.objectAttribute[this._yesNoChoicePartsID][C.ATR_TYPE])===C.OBJECT_BUY||t===C.OBJECT_SELL||(t===C.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.CHOICE_NO,this._yesNoChoicePartsID):C.OBJECT_URLGATE);else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE){wwa_util.$id("item"+(this._yesNoUseItemPos-1)).classList.remove("onpress")}else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD){if(this._usePassword)return this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,void this.onpasswordloadcalled();wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress")}else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE){if(this._usePassword)return this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,void this.onpasswordsavecalled();wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress")}else this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE&&wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress");this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,this._setNextMessage(),this._yesNoChoicePartsCoord=void 0,this._yesNoChoicePartsID=void 0,this._yesNoUseItemPos=void 0,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE,this._messageWindow.setYesNoChoice(!1)}},t.prototype.setMessageQueue=function(t,e,a,s,i,o,r){if(void 0===s&&(s=0),void 0===i&&(i=wwa_data.PartsType.OBJECT),void 0===o&&(o=new T(0,0)),void 0===r&&(r=!1),this._messageQueue=this._messageQueue.concat(this.getMessageQueueByRawMessage(t,s,i,o)),this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0),0!==this._messageQueue.length){for(var _=this._messageQueue.shift(),n=0;n<_.macro.length;n++)this._execMacroListInNextFrame.push(_.macro[n]);if(""!==(this._lastMessage=_).message)return this._messageWindow.setMessage(_.message),this._messageWindow.setYesNoChoice(e),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),a,this._player.getPosition(),this._camera.getPosition()),this._player.setMessageWaiting(),!0;0===this._messageQueue.length?this._hideMessageWindow(r):this._setNextMessage()}return!1},t.prototype.getMessageQueueByRawMessage=function(t,e,a,s,i){void 0===i&&(i=!1);var o=t.split(/\n\<c\>/i)[0].split(/\<c\>/i)[0].replace(/\n\<p\>\n/gi,"<P>").replace(/\n\<p\>/gi,"<P>").replace(/\<p\>\n/gi,"<P>").replace(/\<p\>/gi,"<P>"),r=[];if(""!==o)for(var _=o.split(/\<p\>/gi),n=0;n<_.length;n++){for(var h=_[n].split("\n"),d=[],w=[],c=0;c<h.length;c++){var u=h[c].match(/(\$(?:[a-zA-Z_][a-zA-Z0-9_]*)\=(?:.*))/);if(null!==u&&2<=u.length){var p=wwa_message.parseMacro(this,e,a,s,u[1]);w.push(p)}else h[c].match(/^\$/)||d.push(h[c])}r.push(new wwa_message.MessageInfo(d.join("\n"),i,n===_.length-1,w))}return r},t.prototype.appearParts=function(t,e,a){var s;void 0===a&&(a=0);var i,o,r,_,n,h=e===wwa_data.AppearanceTriggerType.CHOICE_NO?C.APPERANCE_PARTS_MIN_INDEX_NO:C.APPERANCE_PARTS_MIN_INDEX,d=e===wwa_data.AppearanceTriggerType.CHOICE_YES?C.APPERANCE_PARTS_MAX_INDEX_YES:C.APPERANCE_PARTS_MAX_INDEX;for(e===wwa_data.AppearanceTriggerType.MAP?(a=0===a?this._wwaData.map[t.y][t.x]:a,s=wwa_data.PartsType.MAP):(a=0===a?this._wwaData.mapObject[t.y][t.x]:a,s=wwa_data.PartsType.OBJECT),n=h;n<=d;n++){var w=C.ATR_APPERANCE_BASE+n*C.REL_ATR_APPERANCE_UNIT_LENGTH,c=w+C.REL_ATR_APPERANCE_ID,u=w+C.REL_ATR_APPERANCE_X,p=w+C.REL_ATR_APPERANCE_Y,l=w+C.REL_ATR_APPERANCE_TYPE;if(i=s===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[a][c]:this._wwaData.objectAttribute[a][c],o=s===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[a][l]:this._wwaData.objectAttribute[a][l],r=s===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[a][u]:this._wwaData.objectAttribute[a][u],_=s===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[a][p]:this._wwaData.objectAttribute[a][p],r===C.PLAYER_COORD?(r=this._player.getPosition().getPartsCoord().x,this._player.resetEventExecutionInfo()):r>C.RELATIVE_COORD_LOWER&&(r=t.x+r-C.RELATIVE_COORD_BIAS),_===C.PLAYER_COORD?(_=this._player.getPosition().getPartsCoord().y,this._player.resetEventExecutionInfo()):_>C.RELATIVE_COORD_LOWER&&(_=t.y+_-C.RELATIVE_COORD_BIAS),0!==r||0!==_)try{if(new wwa_data.Position(this,r,_,0,0),o===wwa_data.PartsType.MAP){if(i>=this._wwaData.mapPartsMax)throw new Error("背景パーツの範囲外IDが指定されました");this._wwaData.map[_][r]=i}else{if(i>=this._wwaData.objPartsMax)throw new Error("物体パーツの範囲外IDが指定されました");this._wwaData.mapObject[_][r]=i,this._replaceRandomObject(new T(r,_)),r===this._player.getPosition().getPartsCoord().x&&_===this._player.getPosition().getPartsCoord().y&&this._player.setPartsAppearedFlag()}}catch(t){}}},t.prototype.appearPartsByDirection=function(t,e,a){var s=this._player.getPosition().getPartsCoord(),i=this._player.getDir(),o=wwa_data.vx[i],r=wwa_data.vy[i];this.appearPartsEval(s,(0<=o?"+":"-")+Math.abs(o)*t,(0<=r?"+":"-")+Math.abs(r)*t,e,a)},t.prototype.appearPartsEval=function(t,e,a,s,i){var o,r,_=this._player.getPosition().getPartsCoord();if("P"===e||"p"===e)o=_.x;else if("+"===e[0])o=t.x+parseInt(e.substr(1));else if("-"===e[0])o=t.x-parseInt(e.substr(1));else if(o=parseInt(e),isNaN(o))throw new Error("座標として解釈できない文字が含まれています。");if("P"===a||"p"===a)r=_.y;else if("+"===a[0])r=t.y+parseInt(a.substr(1));else if("-"===a[0])r=t.y-parseInt(a.substr(1));else if(r=parseInt(a),isNaN(r))throw new Error("座標として解釈できない文字が含まれています。");try{new wwa_data.Position(this,o,r,0,0);if(i===wwa_data.PartsType.MAP){if(s>=this._wwaData.mapPartsMax)throw new Error("背景パーツの範囲外IDが指定されました");this._wwaData.map[r][o]=s}else{if(s>=this._wwaData.objPartsMax)throw new Error("物体パーツの範囲外IDが指定されました");this._wwaData.mapObject[r][o]=s,this._replaceRandomObject(new T(o,r)),o===this._player.getPosition().getPartsCoord().x&&r===this._player.getPosition().getPartsCoord().y&&this._player.setPartsAppearedFlag()}}catch(t){}},t.prototype._replaceRandomObject=function(t){var e,a,s=this._wwaData.mapObject[t.y][t.x];if(this._wwaData.objectAttribute[s][C.ATR_TYPE]===C.OBJECT_RANDOM){for(var i=0;i<C.RANDOM_ITERATION_MAX;i++){if(a=Math.floor(10*Math.random()),(e=this._wwaData.objectAttribute[s][C.ATR_RANDOM_BASE+a])>=this._wwaData.objPartsMax){e=0;break}if(this._wwaData.objectAttribute[e][C.ATR_TYPE]!==C.OBJECT_RANDOM)break;s=e}this._wwaData.mapObject[t.y][t.x]=e}},t.prototype._replaceRandomObjectsInScreen=function(){for(var t=this._camera.getPosition().getPartsCoord(),e=Math.max(0,t.x-1),a=Math.min(this._wwaData.mapWidth-1,t.x+C.H_PARTS_NUM_IN_WINDOW),s=Math.max(0,t.y-1),i=Math.min(this._wwaData.mapWidth-1,t.y+C.V_PARTS_NUM_IN_WINDOW),o=e;o<=a;o++)for(var r=s;r<i;r++)this._replaceRandomObject(new T(o,r))},t.prototype._replaceAllRandomObjects=function(){for(var t=0;t<this._wwaData.mapWidth;t++)for(var e=0;e<this._wwaData.mapWidth;e++)this._replaceRandomObject(new T(t,e))},t.prototype.gameover=function(){var t=this._wwaData.gameoverX,e=this._wwaData.gameoverY;this._messageWindow.isVisible()&&(this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,this._messageQueue=[],this._messageWindow.hide(),this._yesNoChoicePartsCoord=void 0,this._yesNoChoicePartsID=void 0,this._yesNoUseItemPos=void 0,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE,this._messageWindow.setYesNoChoice(!1)),this._waitTimeInCurrentFrame=C.GAMEOVER_FRAME_INTERVAL,this._temporaryInputDisable=!0,this._player.jumpTo(new f(this,t,e,0,0))},t.prototype.setYesNoInput=function(t){this._yesNoJudgeInNextFrame=t},t.prototype.getYesNoState=function(){return void 0!==this._yesNoJudgeInNextFrame?this._yesNoJudgeInNextFrame:this._yesNoJudge},t.prototype.setStatusChangedEffect=function(t){0!==t.strength&&(wwa_util.$id("disp-strength").classList.add("onpress"),this._statusPressCounter.strength=C.STATUS_CHANGED_EFFECT_FRAME_NUM),0!==t.defence&&(wwa_util.$id("disp-defence").classList.add("onpress"),this._statusPressCounter.defence=C.STATUS_CHANGED_EFFECT_FRAME_NUM),t instanceof wwa_data.Status&&(0!==t.energy&&(wwa_util.$id("disp-energy").classList.add("onpress"),this._statusPressCounter.energy=C.STATUS_CHANGED_EFFECT_FRAME_NUM),0!==t.gold&&(wwa_util.$id("disp-gold").classList.add("onpress"),this._statusPressCounter.gold=C.STATUS_CHANGED_EFFECT_FRAME_NUM))},t.prototype.setPartsOnPosition=function(t,e,a){t===wwa_data.PartsType.MAP?(e>=this._wwaData.mapPartsMax&&(this._wwaData.map[a.y][a.x]=0),this._wwaData.map[a.y][a.x]=e):(e>=this._wwaData.objPartsMax&&(this._wwaData.mapObject[a.y][a.x]=0),this._wwaData.mapObject[a.y][a.x]=e)},t.prototype._countSamePartsLength=function(t,e){var a;for(a=e+1;a<t.length&&t[a]===t[a-1];a++);return a-e},t.prototype._compressMap=function(t){for(var e=[],a=0;a<t.length;a++){e[a]=[];for(var s=0;s<t[a].length;){var i=this._countSamePartsLength(t[a],s);e[a].push([t[a][s],i]),s+=i}}return e},t.prototype._decompressMap=function(t){for(var e=[],a=0;a<t.length;a++){e[a]=[];for(var s=0;s<t[a].length;s++)for(var i=t[a][s][1],o=0;o<i;o++)e[a].push(t[a][s][0])}return e},t.prototype._generateMapDataHash=function(t){var e="A",a=0,s=0,i=0;for(i=0;i<t.map.length;i++){for(s=0;s<t.map[i].length;)a=this._countSamePartsLength(t.map[i],s),e+=t.map[i][s]+"|"+a+"/",s+=a;for(s=0;s<t.mapObject[i].length;)a=this._countSamePartsLength(t.mapObject[i],s),e+=t.mapObject[i][s]+"|"+a+"/",s+=a}for(var o=0;o<t.mapAttribute.length;o++)for(var r=0;r<t.mapAttribute[o].length;r++)e+=t.mapAttribute[o][r]+"/";for(var _=0;_<t.objectAttribute.length;_++)for(var n=0;n<t.objectAttribute[_].length;n++)e+=t.objectAttribute[_][n]+"/";return e+="Z",CryptoJS.MD5(e).toString()},t.prototype._generateSaveDataHash=function(t){var e=this._generateMapDataHash(t),a=[];for(var s in t)"map"!==s&&"mapObject"!==s&&"mapCompressed"!==s&&"mapObjectCompressed"!==s&&"mapAttribute"!==s&&"objectAttribute"!==s&&"checkString"!==s&&a.push(s);a.sort();for(var i=0;i<a.length;i++)e+=wwa_util.arr2str4save(t[a[i]]);return CryptoJS.MD5(e).toString()},t.prototype._quickSave=function(t){void 0===t&&(t=!1);var e=JSON.parse(JSON.stringify(this._wwaData)),a=this._player.getPosition().getPartsCoord(),s=this._player.getStatusWithoutEquipments();if(e.itemBox=this._player.getCopyOfItemBox(),e.playerX=a.x,e.playerY=a.y,e.statusEnergyMax=this._player.getEnergyMax(),e.statusEnergy=s.energy,e.statusStrength=s.strength,e.statusDefence=s.defence,e.statusGold=s.gold,e.moves=this._player.getMoveCount(),t&&(e.checkOriginalMapString=this._generateMapDataHash(this._restartData),e.mapCompressed=this._compressMap(e.map),e.mapObjectCompressed=this._compressMap(e.mapObject),e.checkString=this._generateSaveDataHash(e),e.map=void 0,e.mapObject=void 0),e.message=void 0,e.mapAttribute=void 0,e.objectAttribute=void 0,t){var i=JSON.stringify(e);return CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(i),"^ /"+(231*this._wwaData.worldPassNumber+8310+e.checkOriginalMapString)+"P+>A[]").toString()}return this._quickSaveData=e,N.$id("cell-load").textContent="Quick Load",""},t.prototype._decodePassword=function(t){var e,a=this._generateMapDataHash(this._restartData);try{var s=CryptoJS.AES.decrypt(t,"^ /"+(231*this._wwaData.worldPassNumber+8310+a)+"P+>A[]").toString(CryptoJS.enc.Utf8)}catch(t){throw new Error("データが破損しています。\n"+t.message)}try{e=JSON.parse(s)}catch(t){throw new Error("マップデータ以外のものが暗号化されたか、マップデータに何かが不足しているようです。\nJSON PARSE FAILED")}return e},t.prototype._quickLoad=function(t,e,a){if(void 0===t&&(t=!1),void 0===e&&(e=null),void 0===a&&(a=!0),!t&&void 0===this._quickSaveData&&null===e)throw new Error("セーブデータがありません。");var s;if((s=null!==e?this._decodePassword(e):JSON.parse(JSON.stringify(t?this._restartData:this._quickSaveData))).message=JSON.parse(JSON.stringify(this._restartData.message)),s.mapAttribute=JSON.parse(JSON.stringify(this._restartData.mapAttribute)),s.objectAttribute=JSON.parse(JSON.stringify(this._restartData.objectAttribute)),void 0===s.map&&(s.map=this._decompressMap(s.mapCompressed),s.mapCompressed=void 0),void 0===s.mapObject&&(s.mapObject=this._decompressMap(s.mapObjectCompressed),s.mapObjectCompressed=void 0),null!==e){var i=this._generateSaveDataHash(s);if(s.checkString!==i)throw new Error("データが壊れているようです。\nInvalid hash (ALL DATA)= "+s.checkString+" "+this._generateSaveDataHash(s));var o=this._generateMapDataHash(this._restartData);if(s.checkOriginalMapString!==o)throw new Error("管理者によってマップが変更されたようです。\nInvalid hash (ORIGINAL MAP)= "+s.checkString+" "+this._generateSaveDataHash(s));console.log("Valid Password!")}return a&&this._applyQuickLoad(s),s},t.prototype._applyQuickLoad=function(t){this._player.setEnergyMax(t.statusEnergyMax),this._player.setEnergy(t.statusEnergy),this._player.setStrength(t.statusStrength),this._player.setDefence(t.statusDefence),this._player.setGold(t.statusGold),this._player.setMoveCount(t.moves),this._player.clearItemBox();for(var e=0;e<t.itemBox.length;e++)this._player.addItem(t.itemBox[e],e+1,!0);this._player.systemJumpTo(new wwa_data.Position(this,t.playerX,t.playerY,0,0)),0===t.bgm?this.playSound(wwa_data.SystemSound.NO_SOUND):this.playSound(t.bgm),this.setImgClick(new T(t.imgClickX,t.imgClickY)),0!==this.getObjectIdByPosition(this._player.getPosition())&&this._player.setPartsAppearedFlag(),this._wwaData=t,this.updateCSSRule()},t.prototype._restartGame=function(){this._quickLoad(!0)},t.prototype._fadeout=function(t){var e=0,a=C.MAP_WINDOW_WIDTH,s=C.FADEOUT_SPEED,i=wwa_util.$id("wwa-fader");i.style.display="block";var o=setInterval(function(){if(e+=s,(a-=2*s)<=0||2*e>C.MAP_WINDOW_WIDTH)return i.removeAttribute("style"),i.style.display="block",i.style.borderWidth="0",i.style.width=C.MAP_WINDOW_WIDTH+"px",i.style.height=C.MAP_WINDOW_HEIGHT+"px",i.style.backgroundColor="#808080",clearInterval(o),void t();i.style.width=a+"px",i.style.height=a+"px",i.style.borderWidth=e+"px"},20)},t.prototype.moveObjects=function(t){var e,a,s,i=this._camera.getPosition(),o=(this._player.getPosition(),i.getPartsCoord(),i.getPartsCoord().x),r=i.getPartsCoord().y;if(this.getMapAttributeByPosition(this._player.getPosition(),C.ATR_TYPE)!==C.MAP_LOCALGATE&&this.getObjectAttributeByPosition(this._player.getPosition(),C.ATR_TYPE)!==C.OBJECT_LOCALGATE){for(e=new Array(C.V_PARTS_NUM_IN_WINDOW+2),this.hoge=new Array(C.V_PARTS_NUM_IN_WINDOW+2),s=-1;s<=C.V_PARTS_NUM_IN_WINDOW;s++)for(e[s+1]=new Array(C.H_PARTS_NUM_IN_WINDOW+2),this.hoge[s+1]=new Array(C.H_PARTS_NUM_IN_WINDOW+2),a=-1;a<=C.H_PARTS_NUM_IN_WINDOW;a++)if(r+s<0||r+s>=this._wwaData.mapWidth||o+a<0||o+a>=this._wwaData.mapWidth)e[s+1][a+1]=0,this.hoge[s+1][a+1]=0;else{try{var _=(n=new f(this,o+a,r+s,0,0)).getPartsCoord()}catch(t){e[s+1][a+1]=0,this.hoge[s+1][a+1]=0;continue}this._wwaData.mapObject[_.y][_.x];e[s+1][a+1]=this._wwaData.mapObject[_.y][_.x],this.hoge[s+1][a+1]=-this._wwaData.mapObject[_.y][_.x]}for(a=-1;a<=C.H_PARTS_NUM_IN_WINDOW;a++)if(!(o+a<0||o+a>=this._wwaData.mapWidth))for(s=-1;s<=C.V_PARTS_NUM_IN_WINDOW;s++)if(!(r+s<0||r+s>=this._wwaData.mapWidth)){try{var n;_=(n=new f(this,o+a,r+s,0,0)).getPartsCoord()}catch(t){continue}var h=this._wwaData.mapObject[_.y][_.x];if(0!==h&&this._wwaData.objectAttribute[h][C.ATR_MOVE]!==wwa_data.MoveType.STATIC&&this._wwaData.objectAttribute[h][C.ATR_TYPE]!==C.OBJECT_LOCALGATE){var d=this._wwaData.objectAttribute[h][C.ATR_MOVE];if(d!==wwa_data.MoveType.HANG_AROUND){var w,c=this._getCandidateCoord(t,n,d),u=new T(c.x,_.y),p=new T(_.x,c.y),l=null;if(this._objectCanMoveTo(t,c,e))this._setObjectsInNextFrame(_,c,o,r,e,h);else{var E=this._getSecondCandidateMoveMode(t,_,c,u,p,this._wwaData.objectAttribute[h][C.ATR_TYPE]===C.OBJECT_MONSTER,e);E===wwa_data.SecondCandidateMoveType.MODE_X?this._setObjectsInNextFrame(_,u,o,r,e,h):E===wwa_data.SecondCandidateMoveType.MODE_Y?this._setObjectsInNextFrame(_,p,o,r,e,h):null!==(l=this._getThirdCandidate(t,n,c,d,e))?this._setObjectsInNextFrame(_,l,o,r,e,h):(w=this._getRandomMoveCoord(t,n,e),this._setObjectsInNextFrame(_,w,o,r,e,h))}}else w=this._getRandomMoveCoord(t,n,e),this._setObjectsInNextFrame(_,w,o,r,e,h)}}}},t.prototype._getCandidateCoord=function(t,e,a){var s=e.getPartsCoord();this._player.getPosition().getOffsetCoord(),this._player.getPosition().getPartsCoord();try{var i=t?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord()}catch(t){throw new Error("予期せぬ方向への移動のようです。")}var o=s.clone(),r=0,_=0;return a===wwa_data.MoveType.CHASE_PLAYER?(r=s.x>i.x?1:s.x<i.x?-1:0,_=s.y>i.y?1:s.y<i.y?-1:0):a===wwa_data.MoveType.RUN_OUT&&(r=s.x>i.x?-1:s.x<i.x?1:0,_=s.y>i.y?-1:s.y<i.y?1:0),o.x-=r,o.y-=_,o.x=Math.min(this._wwaData.mapWidth-1,Math.max(0,o.x)),o.y=Math.min(this._wwaData.mapWidth-1,Math.max(0,o.y)),o},t.prototype._getSecondCandidateMoveMode=function(t,e,a,s,i,o,r){return!t||(this._player.getDir()!==wwa_data.Direction.UP&&this._player.getDir()!==wwa_data.Direction.DOWN||!o)&&(this._player.getDir()!==wwa_data.Direction.LEFT&&this._player.getDir()!==wwa_data.Direction.RIGHT||o)?this._objectCanMoveTo(t,s,r)?wwa_data.SecondCandidateMoveType.MODE_X:this._objectCanMoveTo(t,i,r)?wwa_data.SecondCandidateMoveType.MODE_Y:wwa_data.SecondCandidateMoveType.UNDECIDED:this._objectCanMoveTo(t,i,r)?wwa_data.SecondCandidateMoveType.MODE_Y:this._objectCanMoveTo(t,s,r)?wwa_data.SecondCandidateMoveType.MODE_X:wwa_data.SecondCandidateMoveType.UNDECIDED},t.prototype._getThirdCandidate=function(t,e,a,s,i){var o,r=s===wwa_data.MoveType.CHASE_PLAYER?1:s===wwa_data.MoveType.RUN_OUT?-1:0,_=t?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord(),n=e.getPartsCoord();if(_.x!==n.x){if(o=new T(a.x,n.y+1*r),this._objectCanMoveTo(t,o,i))return o;if(o=new T(a.x,n.y-1*r),this._objectCanMoveTo(t,o,i))return o;if(o=new T(n.x,n.y+1*r),this._objectCanMoveTo(t,o,i))return o;if(o=new T(n.x,n.y-1*r),this._objectCanMoveTo(t,o,i))return o}if(_.y!==n.y){if(o=new T(n.x+1*r,a.y),this._objectCanMoveTo(t,o,i))return o;if(o=new T(n.x-1*r,a.y),this._objectCanMoveTo(t,o,i))return o;if(o=new T(n.x+1*r,n.y),this._objectCanMoveTo(t,o,i))return o;if(o=new T(n.x-1*r,n.y),this._objectCanMoveTo(t,o,i))return o}return null},t.prototype._getRandomMoveCoord=function(t,e,a){for(var s=e.getPartsCoord(),i=s.clone(),o=0;o<C.RANDOM_MOVE_ITERATION_NUM;o++){var r=Math.floor(8*Math.random());if(i.x=s.x+wwa_data.vx[r],i.y=s.y+wwa_data.vy[r],this._objectCanMoveTo(t,i,a))return i}return s},t.prototype.isPrevFrameEventExecuted=function(){return this._prevFrameEventExected},t.prototype._objectCanMoveTo=function(t,e,a){if(e.x<0||e.y<0||this._wwaData.mapWidth<=e.x||this._wwaData.mapWidth<=e.y)return!1;var s=this._wwaData.map[e.y][e.x],i=this._wwaData.mapObject[e.y][e.x],o=this._wwaData.mapAttribute[s][C.ATR_TYPE],r=this._camera.getPosition(),_=r.getPartsCoord().x,n=r.getPartsCoord().y;if(0===s&&!this.isOldMap()||o===C.MAP_WALL)return!1;var h=e.x-_+1,d=e.y-n+1;if(0<=h&&0<=d&&h<a.length&&d<a.length){if(0!==a[d][h])return!1}else if(0!==i)return!1;if(t){if(this._player.getPosition().getNextJustPosition().getPartsCoord().equals(e))return!1}else if(this._player.getPosition().getPartsCoord().equals(e))return!1;return!0},t.prototype._setObjectsInNextFrame=function(t,e,a,s,i,o){var r=e.x-a+1,_=e.y-s+1;0<=e.x&&e.x<=this._wwaData.mapWidth&&0<=e.y&&e.y<=this._wwaData.mapWidth&&(0<=r&&r<i.length&&0<=_&&_<i.length&&(i[t.y-s+1][t.x-a+1]=0,i[e.y-s+1][e.x-a+1]=o,this.hoge[e.y-s+1][e.x-a+1]=o),this._objectMovingDataManager.add(o,t.convertIntoPosition(this),e.convertIntoPosition(this),t.getDirectionTo(e)))},t.prototype.launchBattleEstimateWindow=function(){var t=this._camera.getPosition().getPartsCoord(),e=Math.max(0,t.x),a=Math.min(this._wwaData.mapWidth-1,t.x+C.H_PARTS_NUM_IN_WINDOW-1),s=Math.max(0,t.y),i=Math.min(this._wwaData.mapWidth-1,t.y+C.V_PARTS_NUM_IN_WINDOW)-1,o=[];this.playSound(wwa_data.SystemSound.DECISION);for(var r=e;r<=a;r++)for(var _=s;_<=i;_++){var n=this._wwaData.mapObject[_][r];this._wwaData.objectAttribute[n][C.ATR_TYPE]===C.OBJECT_MONSTER&&-1===o.indexOf(n)&&o.push(n)}return 0!==o.length&&(this._battleEstimateWindow.update(this._player.getStatus(),o),this._battleEstimateWindow.show(),this._player.setEstimateWindowWating(),!0)},t.prototype.hideBattleEstimateWindow=function(){this._battleEstimateWindow.hide(),this._player.clearEstimateWindowWaiting()},t.prototype.hidePasswordWindow=function(t){if(void 0===t&&(t=!1),this._passwordWindow.hide(),t||this._passwordWindow.mode===wwa_password_window.Mode.SAVE)this._player.clearPasswordWindowWaiting();else{try{var e=this._quickLoad(!1,this._passwordWindow.password,!1)}catch(t){return this._player.clearPasswordWindowWaiting(),void alert("パスワードが正常ではありません。\nエラー詳細:\n"+t.message)}this._passwordLoadExecInNextFrame=!0,this._passwordSaveExtractData=e}},t.prototype._displayHelp=function(){this._useHelp&&this._player.isControllable()&&this.setMessageQueue("【ショートカットキーの一覧】\nＦ１、Ｍ：戦闘結果予測の表示\nＦ３：復帰用パスワード入力\nＦ４：復帰用パスワード表示\nＦ５：一時保存データの読み込み\nＦ６：データの一時保存\nＦ７：初めからスタート\nＦ８：ＷＷＡ公式ページにリンク\nＦ１２：このリストの表示\nキーボードの「１２３、ＱＷＥ、ＡＳＤ、ＺＸＣ」は右のアイテムボックスに対応。\n「Ｅｎｔｅｒ、Ｙ」はＹｅｓ,「Ｅｓｃ、Ｎ」はＮｏに対応。\n I : 移動速度を落とす／Ｐ: 移動速度を上げる\n現在の移動回数："+this._player.getMoveCount()+"\nWWA Wing バージョン:"+C.VERSION_WWAJS,!1,!0)},t.prototype._setNextMessage=function(t){if(void 0===t&&(t=!1),this._clearFacesInNextFrame=!0,this._scoreWindow.isVisible()&&this._scoreWindow.hide(),this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0),0===this._messageQueue.length)this._hideMessageWindow();else{var e=this._messageQueue.shift(),a=e.message,s=e.macro;this._lastMessage=e;for(var i=0;i<s.length;i++)this._execMacroListInNextFrame.push(s[i]);""!==a?(this._messageWindow.hide(),this._messageWindow.setMessage(a),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),t,this._player.getPosition(),this._camera.getPosition()),this._messageWindow.show()):0===this._messageQueue.length?this._hideMessageWindow():this._setNextMessage()}},t.prototype._hideMessageWindow=function(t){void 0===t&&(t=!0);var e=0;this._player.isReadyToUseItem()&&(e=this._player.useItem());var a=this.getObjectAttributeById(e,C.ATR_STRING);this.clearFaces(),0===a?(t&&(this._messageWindow.hide(),this._keyStore.allClear(),this._mouseStore.clear()),this._player.clearMessageWaiting()):this.setMessageQueue(this.getMessageById(a),!1,!1,e,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord(),!0)},t.prototype.replaceParts=function(t,e,a,s){void 0===a&&(a=wwa_data.PartsType.OBJECT),void 0===s&&(s=!1);for(var i=this._camera.getPosition().getPartsCoord(),o=s?Math.max(0,i.x):0,r=s?Math.min(this._wwaData.mapWidth-1,i.x+C.H_PARTS_NUM_IN_WINDOW-1):this._wwaData.mapWidth-1,_=s?Math.max(0,i.y):0,n=s?Math.min(this._wwaData.mapWidth-1,i.y+C.V_PARTS_NUM_IN_WINDOW)-1:this._wwaData.mapWidth-1,h=o;h<=r;h++)for(var d=_;d<=n;d++){if(a===wwa_data.PartsType.OBJECT)this._wwaData.mapObject[d][h]===t&&(this._wwaData.mapObject[d][h]=e);else this._wwaData.map[d][h]===t&&(this._wwaData.map[d][h]=e)}},t.prototype.getYesNoImgCoord=function(){return new T(this._wwaData.yesnoImgPosX,this._wwaData.yesnoImgPosY)},t.prototype.setYesNoImgCoord=function(t){return this._wwaData.yesnoImgPosX=t.x,this._wwaData.yesnoImgPosY=t.y,t},t.prototype.getPlayerImgCoord=function(){return new T(this._wwaData.playerImgPosX,this._wwaData.playerImgPosY)},t.prototype.setPlayerImgCoord=function(t){return this._wwaData.playerImgPosX=t.x,this._wwaData.playerImgPosY=t.y,t},t.prototype.setPlayerEnergyMax=function(t){return this._player.setEnergyMax(t)},t.prototype.getMapPartsNum=function(){return this._wwaData.mapPartsMax},t.prototype.getObjectPartsNum=function(){return this._wwaData.objPartsMax},t.prototype.setMoveMacroWaitingToPlayer=function(t){this._reservedMoveMacroTurn=t},t.prototype.disableSave=function(t){return this._wwaData.disableSaveFlag=t},t.prototype.isOldMap=function(){return this._wwaData.isOldMap},t.prototype.setOldMap=function(t){return this._wwaData.isOldMap=t},t.prototype.setObjectNotCollapseOnPartsOnPlayer=function(t){return this._wwaData.objectNoCollapseDefaultFlag=t},t.prototype.setGameOverPosition=function(t){if(t.x<0||t.x>=this.getMapWidth()||t.y<0||t.y>=this.getMapWidth())throw new Error("マップの範囲外が指定されています!");return this._wwaData.gameoverX=t.x,this._wwaData.gameoverY=t.y,t},t.prototype.setPlayerStatus=function(t,e){if(t===wwa_data.MacroStatusIndex.ENERGY)this._player.setEnergy(e);else if(t===wwa_data.MacroStatusIndex.STRENGTH)this._player.setStrength(e);else if(t===wwa_data.MacroStatusIndex.DEFENCE)this._player.setDefence(e);else if(t===wwa_data.MacroStatusIndex.GOLD)this._player.setGold(e);else{if(t!==wwa_data.MacroStatusIndex.MOVES)throw new Error("未定義のステータスタイプです");this._player.setMoveCount(e)}},t.prototype.setDelPlayer=function(t){return this._wwaData.delPlayerFlag=t},t.prototype.setPlayerGetItem=function(t,e){try{this._player.addItem(e,t,!0)}catch(t){}},t.prototype.setFrameCoord=function(t){return this._frameCoord=t.clone()},t.prototype.setBattleEffectCoord=function(t){return this._battleEffectCoord=t.clone()},t.prototype.canInput=function(){return!this._temporaryInputDisable},t.prototype.setWaitTime=function(t){this._waitTimeInCurrentFrame+=t,this._temporaryInputDisable=!0},t.prototype.setEffect=function(t,e){this._wwaData.effectWaits=t,this._wwaData.effectCoords=e},t.prototype.stopEffect=function(){this._wwaData.effectCoords=[]},t.prototype.setImgClick=function(e){if(this._wwaData.imgClickX=e.x,this._wwaData.imgClickY=e.y,e.equals(new T(0,0)))Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(t){t.style.backgroundImage="url('"+wwa_data.WWAConsts.ITEM_BORDER_IMG_DATA_URL+"')",t.style.backgroundPosition="0 0"});else{var a=this._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(t){t.style.backgroundImage="url('"+a+"')",t.style.backgroundPosition="-"+e.x*C.CHIP_SIZE+"px -"+e.y*C.CHIP_SIZE+"px"})}},t.prototype.addFace=function(t){this._faces.push(t)},t.prototype.clearFaces=function(){this._faces=[]},t.prototype.initCSSRule=function(){this._styleElm=wwa_util.$id(C.WWA_STYLE_TAG_ID),this._sheet=this._styleElm.sheet,this.updateCSSRule()},t.prototype.updateCSSRule=function(){if(void 0===this._stylePos)this._stylePos=new Array(2);else if(void 0!==this._sheet.addRule)for(var t=0;t<this._stylePos.length;t++)this._sheet.removeRule(this._stylePos[this._styleElm[t]]);else for(t=0;t<this._stylePos.length;t++)this._sheet.deleteRule(this._stylePos[this._styleElm[t]]);void 0!==this._sheet.addRule?(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=this._sheet.addRule("div.wwa-message-window, div#wwa-battle-estimate, div#wwa-password-window","background-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+",0.9);border-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+",1);color: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);"),this._stylePos[wwa_data.SelectorType.SIDEBAR]=this._sheet.addRule("div#wwa-sidebar","color: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);font-weight: bold;")):(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=this._sheet.insertRule("div.wwa-message-window, div#wwa-battle-estimate, div#wwa-password-window {\nbackground-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+",0.9);\nborder-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+",1);\ncolor: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);\n}",0),this._stylePos[wwa_data.SelectorType.SIDEBAR]=this._sheet.insertRule("div#wwa-sidebar {\ncolor: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);\nfont-weight: bold;\n}",1))},t.prototype.changeStyleRule=function(t,e,a,s){t===wwa_data.ChangeStyleType.COLOR_FRAME?(this._wwaData.frameColorR=e,this._wwaData.frameColorG=a,this._wwaData.frameColorB=s):t===wwa_data.ChangeStyleType.COLOR_FRAMEOUT?(this._wwaData.frameOutColorR=e,this._wwaData.frameOutColorG=a,this._wwaData.frameOutColorB=s):t===wwa_data.ChangeStyleType.COLOR_STR?(this._wwaData.fontColorR=e,this._wwaData.fontColorG=a,this._wwaData.fontColorB=s):t===wwa_data.ChangeStyleType.COLOR_STATUS_STR&&(this._wwaData.statusColorR=e,this._wwaData.statusColorG=a,this._wwaData.statusColorB=s),this.updateCSSRule()},t.prototype.showMonsterWindow=function(){this._monsterWindow.show()},t.prototype.isConsoleOutputMode=function(){return this._useConsole},t}();t.WWA=r;var _=!1;function e(){void 0===window.wwap_mode&&(wwap_mode=!1),Array.prototype.forEach.call(N.$qsAll("a.wwa-copyright"),function(t){t.addEventListener("click",function(){_=!0})}),window.addEventListener("beforeunload",function(t){var e="このページを離れますか？";if(_)return _=!1,t.returnValue=e});var t=wwap_mode?C.WWAP_SERVER+"/"+C.WWAP_SERVER_TITLE_IMG:N.$id("wwa-wrapper").getAttribute("data-wwa-title-img");wwa_inject_html.inject(N.$id("wwa-wrapper"),null===t?"cover.gif":t);var e=N.$id("wwa-wrapper").getAttribute("data-wwa-mapdata"),a=N.$id("wwa-wrapper").getAttribute("data-wwa-loader"),s=N.$id("wwa-wrapper").getAttribute("data-wwa-audio"),i=!0;N.$id("wwa-wrapper").getAttribute("data-wwa-urlgate-enable").match(/^false$/i)&&(i=!1),o=new r(e,a,i,s)}"complete"===document.readyState?e():window.addEventListener("load",e)}(wwa_main||(wwa_main={}));
var CryptoJS=CryptoJS||function(c,e){var g={},b=g.lib={},t=function(){},h=b.Base={extend:function(a){t.prototype=this;var b=new t;a&&b.mixIn(a);b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)});b.init.prototype=b;b.$super=this;return b},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
a=b.WordArray=h.extend({init:function(a,b){a=this.words=a||[];this.sigBytes=b!=e?b:4*a.length},toString:function(a){return(a||l).stringify(this)},concat:function(a){var b=this.words,d=a.words,c=this.sigBytes;a=a.sigBytes;this.clamp();if(c%4)for(var f=0;f<a;f++)b[c+f>>>2]|=(d[f>>>2]>>>24-f%4*8&255)<<24-(c+f)%4*8;else if(65535<d.length)for(f=0;f<a;f+=4)b[c+f>>>2]=d[f>>>2];else b.push.apply(b,d);this.sigBytes+=a;return this},clamp:function(){var a=this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-
b%4*8;a.length=c.ceil(b/4)},clone:function(){var a=h.clone.call(this);a.words=this.words.slice(0);return a},random:function(b){for(var d=[],e=0;e<b;e+=4)d.push(4294967296*c.random()|0);return new a.init(d,b)}}),u=g.enc={},l=u.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var d=[],c=0;c<a;c++){var f=b[c>>>2]>>>24-c%4*8&255;d.push((f>>>4).toString(16));d.push((f&15).toString(16))}return d.join("")},parse:function(b){for(var d=b.length,c=[],e=0;e<d;e+=2)c[e>>>3]|=parseInt(b.substr(e,2),16)<<
24-e%8*4;return new a.init(c,d/2)}},d=u.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var d=[],c=0;c<a;c++)d.push(String.fromCharCode(b[c>>>2]>>>24-c%4*8&255));return d.join("")},parse:function(b){for(var d=b.length,c=[],e=0;e<d;e++)c[e>>>2]|=(b.charCodeAt(e)&255)<<24-e%4*8;return new a.init(c,d)}},x=u.Utf8={stringify:function(a){try{return decodeURIComponent(escape(d.stringify(a)))}catch(B){throw Error("Malformed UTF-8 data");}},parse:function(a){return d.parse(unescape(encodeURIComponent(a)))}},
A=b.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new a.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=x.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var d=this._data,e=d.words,g=d.sigBytes,f=this.blockSize,n=g/(4*f);n=b?c.ceil(n):c.max((n|0)-this._minBufferSize,0);b=n*f;g=c.min(4*b,g);if(b){for(var w=0;w<b;w+=f)this._doProcessBlock(e,w);w=e.splice(0,b);d.sigBytes-=g}return new a.init(w,g)},clone:function(){var a=h.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});b.Hasher=A.extend({cfg:h.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){A.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,d){return(new a.init(d)).finalize(b)}},_createHmacHelper:function(a){return function(b,d){return(new w.HMAC.init(a,
d)).finalize(b)}}});var w=g.algo={};return g}(Math);
(function(){var c=CryptoJS,e=c.lib.WordArray;c.enc.Base64={stringify:function(c){var b=c.words,e=c.sigBytes,g=this._map;c.clamp();c=[];for(var a=0;a<e;a+=3)for(var u=(b[a>>>2]>>>24-a%4*8&255)<<16|(b[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|b[a+2>>>2]>>>24-(a+2)%4*8&255,l=0;4>l&&a+.75*l<e;l++)c.push(g.charAt(u>>>6*(3-l)&63));if(b=g.charAt(64))for(;c.length%4;)c.push(b);return c.join("")},parse:function(c){var b=c.length,g=this._map,h=g.charAt(64);h&&(h=c.indexOf(h),-1!=h&&(b=h));h=[];for(var a=0,u=0;u<b;u++)if(u%
4){var l=g.indexOf(c.charAt(u-1))<<u%4*2,d=g.indexOf(c.charAt(u))>>>6-u%4*2;h[a>>>2]|=(l|d)<<24-a%4*8;a++}return e.create(h,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();
(function(c){function e(a,b,d,c,e,g,f){a=a+(b&d|~b&c)+e+f;return(a<<g|a>>>32-g)+b}function g(a,b,d,c,e,g,f){a=a+(b&c|d&~c)+e+f;return(a<<g|a>>>32-g)+b}function b(a,b,d,c,e,g,f){a=a+(b^d^c)+e+f;return(a<<g|a>>>32-g)+b}function t(a,b,d,c,e,g,f){a=a+(d^(b|~c))+e+f;return(a<<g|a>>>32-g)+b}var h=CryptoJS,a=h.lib,u=a.WordArray,l=a.Hasher;a=h.algo;for(var d=[],x=0;64>x;x++)d[x]=4294967296*c.abs(c.sin(x+1))|0;a=a.MD5=l.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(a,c){for(var h,l,k=0;16>k;k++)l=c+k,h=a[l],a[l]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;k=this._hash.words;l=a[c+0];h=a[c+1];var y=a[c+2],f=a[c+3],n=a[c+4],v=a[c+5],u=a[c+6],w=a[c+7],x=a[c+8],A=a[c+9],F=a[c+10],G=a[c+11],E=a[c+12],H=a[c+13],D=a[c+14];a=a[c+15];c=k[0];var q=k[1],p=k[2],r=k[3];c=e(c,q,p,r,l,7,d[0]);r=e(r,c,q,p,h,12,d[1]);p=e(p,r,c,q,y,17,d[2]);q=e(q,p,r,c,f,22,d[3]);c=e(c,q,p,r,n,7,d[4]);r=e(r,c,q,p,v,12,d[5]);p=e(p,r,c,q,u,17,d[6]);q=e(q,p,r,c,w,22,
d[7]);c=e(c,q,p,r,x,7,d[8]);r=e(r,c,q,p,A,12,d[9]);p=e(p,r,c,q,F,17,d[10]);q=e(q,p,r,c,G,22,d[11]);c=e(c,q,p,r,E,7,d[12]);r=e(r,c,q,p,H,12,d[13]);p=e(p,r,c,q,D,17,d[14]);q=e(q,p,r,c,a,22,d[15]);c=g(c,q,p,r,h,5,d[16]);r=g(r,c,q,p,u,9,d[17]);p=g(p,r,c,q,G,14,d[18]);q=g(q,p,r,c,l,20,d[19]);c=g(c,q,p,r,v,5,d[20]);r=g(r,c,q,p,F,9,d[21]);p=g(p,r,c,q,a,14,d[22]);q=g(q,p,r,c,n,20,d[23]);c=g(c,q,p,r,A,5,d[24]);r=g(r,c,q,p,D,9,d[25]);p=g(p,r,c,q,f,14,d[26]);q=g(q,p,r,c,x,20,d[27]);c=g(c,q,p,r,H,5,d[28]);r=
g(r,c,q,p,y,9,d[29]);p=g(p,r,c,q,w,14,d[30]);q=g(q,p,r,c,E,20,d[31]);c=b(c,q,p,r,v,4,d[32]);r=b(r,c,q,p,x,11,d[33]);p=b(p,r,c,q,G,16,d[34]);q=b(q,p,r,c,D,23,d[35]);c=b(c,q,p,r,h,4,d[36]);r=b(r,c,q,p,n,11,d[37]);p=b(p,r,c,q,w,16,d[38]);q=b(q,p,r,c,F,23,d[39]);c=b(c,q,p,r,H,4,d[40]);r=b(r,c,q,p,l,11,d[41]);p=b(p,r,c,q,f,16,d[42]);q=b(q,p,r,c,u,23,d[43]);c=b(c,q,p,r,A,4,d[44]);r=b(r,c,q,p,E,11,d[45]);p=b(p,r,c,q,a,16,d[46]);q=b(q,p,r,c,y,23,d[47]);c=t(c,q,p,r,l,6,d[48]);r=t(r,c,q,p,w,10,d[49]);p=t(p,
r,c,q,D,15,d[50]);q=t(q,p,r,c,v,21,d[51]);c=t(c,q,p,r,E,6,d[52]);r=t(r,c,q,p,f,10,d[53]);p=t(p,r,c,q,F,15,d[54]);q=t(q,p,r,c,h,21,d[55]);c=t(c,q,p,r,x,6,d[56]);r=t(r,c,q,p,a,10,d[57]);p=t(p,r,c,q,u,15,d[58]);q=t(q,p,r,c,H,21,d[59]);c=t(c,q,p,r,n,6,d[60]);r=t(r,c,q,p,G,10,d[61]);p=t(p,r,c,q,y,15,d[62]);q=t(q,p,r,c,A,21,d[63]);k[0]=k[0]+c|0;k[1]=k[1]+q|0;k[2]=k[2]+p|0;k[3]=k[3]+r|0},_doFinalize:function(){var a=this._data,b=a.words,d=8*this._nDataBytes,e=8*a.sigBytes;b[e>>>5]|=128<<24-e%32;var g=c.floor(d/
4294967296);b[(e+64>>>9<<4)+15]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360;b[(e+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360;a.sigBytes=4*(b.length+1);this._process();a=this._hash;b=a.words;for(d=0;4>d;d++)e=b[d],b[d]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;return a},clone:function(){var a=l.clone.call(this);a._hash=this._hash.clone();return a}});h.MD5=l._createHelper(a);h.HmacMD5=l._createHmacHelper(a)})(Math);
(function(){var c=CryptoJS,e=c.lib,g=e.Base,b=e.WordArray;e=c.algo;var t=e.EvpKDF=g.extend({cfg:g.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(b){this.cfg=this.cfg.extend(b)},compute:function(c,a){var e=this.cfg,g=e.hasher.create(),d=b.create(),h=d.words,t=e.keySize;for(e=e.iterations;h.length<t;){w&&g.update(w);var w=g.update(c).finalize(a);g.reset();for(var m=1;m<e;m++)w=g.finalize(w),g.reset();d.concat(w)}d.sigBytes=4*t;return d}});c.EvpKDF=function(b,a,c){return t.create(c).compute(b,
a)}})();
CryptoJS.lib.Cipher||function(c){var e=CryptoJS,g=e.lib,b=g.Base,t=g.WordArray,h=g.BufferedBlockAlgorithm,a=e.enc.Base64,u=e.algo.EvpKDF,l=g.Cipher=h.extend({cfg:b.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c);this._xformMode=a;this._key=b;this.reset()},reset:function(){h.reset.call(this);this._doReset()},process:function(a){this._append(a);return this._process()},
finalize:function(a){a&&this._append(a);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(b,c,d){return("string"==typeof c?B:m).encrypt(a,b,c,d)},decrypt:function(b,c,d){return("string"==typeof c?B:m).decrypt(a,b,c,d)}}}});g.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=e.mode={},x=function(a,b,d){var e=this._iv;e?this._iv=c:e=this._prevBlock;for(var f=0;f<d;f++)a[b+f]^=
e[f]},A=(g.BlockCipherMode=b.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a;this._iv=b}})).extend();A.Encryptor=A.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize;x.call(this,a,b,d);c.encryptBlock(a,b);this._prevBlock=a.slice(b,b+d)}});A.Decryptor=A.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize,e=a.slice(b,b+d);c.decryptBlock(a,b);x.call(this,
a,b,d);this._prevBlock=e}});d=d.CBC=A;A=(e.pad={}).Pkcs7={pad:function(a,b){b*=4;b-=a.sigBytes%b;for(var c=b<<24|b<<16|b<<8|b,d=[],e=0;e<b;e+=4)d.push(c);b=t.create(d,b);a.concat(b)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};g.BlockCipher=l.extend({cfg:l.cfg.extend({mode:d,padding:A}),reset:function(){l.reset.call(this);var a=this.cfg,b=a.iv;a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,
this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var w=g.CipherParams=b.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}});d=(e.format={}).OpenSSL={stringify:function(b){var c=b.ciphertext;b=b.salt;return(b?t.create([1398893684,
1701076831]).concat(b).concat(c):c).toString(a)},parse:function(b){b=a.parse(b);var c=b.words;if(1398893684==c[0]&&1701076831==c[1]){var d=t.create(c.slice(2,4));c.splice(0,4);b.sigBytes-=16}return w.create({ciphertext:b,salt:d})}};var m=g.SerializableCipher=b.extend({cfg:b.extend({format:d}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d);b=e.finalize(b);e=e.cfg;return w.create({ciphertext:b,key:c,iv:e.iv,algorithm:a,mode:e.mode,padding:e.padding,blockSize:a.blockSize,
formatter:d.format})},decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);return a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}});e=(e.kdf={}).OpenSSL={execute:function(a,b,c,d){d||(d=t.random(8));a=u.create({keySize:b+c}).compute(a,d);c=t.create(a.words.slice(b),4*c);a.sigBytes=4*b;return w.create({key:a,iv:c,salt:d})}};var B=g.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:e}),encrypt:function(a,b,c,d){d=
this.cfg.extend(d);c=d.kdf.execute(c,a.keySize,a.ivSize);d.iv=c.iv;a=m.encrypt.call(this,a,b,c.key,d);a.mixIn(c);return a},decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);c=d.kdf.execute(c,a.keySize,a.ivSize,b.salt);d.iv=c.iv;return m.decrypt.call(this,a,b,c.key,d)}})}();
(function(){for(var c=CryptoJS,e=c.lib.BlockCipher,g=c.algo,b=[],t=[],h=[],a=[],u=[],l=[],d=[],x=[],A=[],w=[],m=[],B=0;256>B;B++)m[B]=128>B?B<<1:B<<1^283;var k=0,y=0;for(B=0;256>B;B++){var f=y^y<<1^y<<2^y<<3^y<<4;f=f>>>8^f&255^99;b[k]=f;t[f]=k;var n=m[k],v=m[n],z=m[v],C=257*m[f]^16843008*f;h[k]=C<<24|C>>>8;a[k]=C<<16|C>>>16;u[k]=C<<8|C>>>24;l[k]=C;C=16843009*z^65537*v^257*n^16843008*k;d[f]=C<<24|C>>>8;x[f]=C<<16|C>>>16;A[f]=C<<8|C>>>24;w[f]=C;k?(k=n^m[m[m[z^n]]],y^=m[m[y]]):k=y=1}var J=[0,1,2,4,8,
16,32,64,128,27,54];g=g.AES=e.extend({_doReset:function(){var a=this._key,c=a.words,e=a.sigBytes/4;a=4*((this._nRounds=e+6)+1);for(var f=this._keySchedule=[],g=0;g<a;g++)if(g<e)f[g]=c[g];else{var h=f[g-1];g%e?6<e&&4==g%e&&(h=b[h>>>24]<<24|b[h>>>16&255]<<16|b[h>>>8&255]<<8|b[h&255]):(h=h<<8|h>>>24,h=b[h>>>24]<<24|b[h>>>16&255]<<16|b[h>>>8&255]<<8|b[h&255],h^=J[g/e|0]<<24);f[g]=f[g-e]^h}c=this._invKeySchedule=[];for(e=0;e<a;e++)g=a-e,h=e%4?f[g]:f[g-4],c[e]=4>e||4>=g?h:d[b[h>>>24]]^x[b[h>>>16&255]]^
A[b[h>>>8&255]]^w[b[h&255]]},encryptBlock:function(c,d){this._doCryptBlock(c,d,this._keySchedule,h,a,u,l,b)},decryptBlock:function(a,b){var c=a[b+1];a[b+1]=a[b+3];a[b+3]=c;this._doCryptBlock(a,b,this._invKeySchedule,d,x,A,w,t);c=a[b+1];a[b+1]=a[b+3];a[b+3]=c},_doCryptBlock:function(a,b,c,d,e,f,g,h){var n=this._nRounds;var k=a[b]^c[0];var l=a[b+1]^c[1];var m=a[b+2]^c[2];var p=a[b+3]^c[3];for(var q=4,t=1;t<n;t++){var u=d[k>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[p&255]^c[q++];var v=d[l>>>24]^e[m>>>16&255]^
f[p>>>8&255]^g[k&255]^c[q++];var w=d[m>>>24]^e[p>>>16&255]^f[k>>>8&255]^g[l&255]^c[q++];p=d[p>>>24]^e[k>>>16&255]^f[l>>>8&255]^g[m&255]^c[q++];k=u;l=v;m=w}u=(h[k>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[p&255])^c[q++];v=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[p>>>8&255]<<8|h[k&255])^c[q++];w=(h[m>>>24]<<24|h[p>>>16&255]<<16|h[k>>>8&255]<<8|h[l&255])^c[q++];p=(h[p>>>24]<<24|h[k>>>16&255]<<16|h[l>>>8&255]<<8|h[m&255])^c[q++];a[b]=u;a[b+1]=v;a[b+2]=w;a[b+3]=p},keySize:8});c.AES=e._createHelper(g)})();
