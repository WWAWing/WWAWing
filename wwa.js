/*
 WWA Wing
 http://wwawing.com/
 Copyright (c) 1996-2015 NAO
 Copyright (c) 2015 WWA Wing Team
 LICENSE: https://raw.githubusercontent.com/WWAWing/WWAWing/master/LICENSE

 CryptoJS v3.1.2
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,g){c!=Array.prototype&&c!=Object.prototype&&(c[e]=g.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,e,g,b){if(e){g=$jscomp.global;c=c.split(".");for(b=0;b<c.length-1;b++){var t=c[b];t in g||(g[t]={});g=g[t]}c=c[c.length-1];b=g[c];e=e(b);e!=b&&null!=e&&$jscomp.defineProperty(g,c,{configurable:!0,writable:!0,value:e})}};$jscomp.underscoreProtoCanBeSet=function(){var c={a:!0},e={};try{return e.__proto__=c,e.a}catch(g){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(c,e){c.__proto__=e;if(c.__proto__!==e)throw new TypeError(c+" is not extensible");return c}:null;$jscomp.polyfill("Object.setPrototypeOf",function(c){return c||$jscomp.setPrototypeOf},"es6","es5");
var __extends=this&&this.__extends||function(){var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var b in g)g.hasOwnProperty(b)&&(e[b]=g[b])};return function(e,g){function b(){this.constructor=e}c(e,g);e.prototype=null===g?Object.create(g):(b.prototype=g.prototype,new b)}}(),wwa_input;
(function(c){var e;(function(b){b[b.NONE=0]="NONE";b[b.KEYDOWN=1]="KEYDOWN";b[b.KEYPRESS=2]="KEYPRESS";b[b.KEYUP=3]="KEYUP";b[b.KEYPRESS_MESSAGECHANGE=4]="KEYPRESS_MESSAGECHANGE"})(e=c.KeyState||(c.KeyState={}));(function(b){b[b.KEY_ENTER=13]="KEY_ENTER";b[b.KEY_SHIFT=16]="KEY_SHIFT";b[b.KEY_ESC=27]="KEY_ESC";b[b.KEY_SPACE=32]="KEY_SPACE";b[b.KEY_LEFT=37]="KEY_LEFT";b[b.KEY_UP=38]="KEY_UP";b[b.KEY_RIGHT=39]="KEY_RIGHT";b[b.KEY_DOWN=40]="KEY_DOWN";b[b.KEY_1=49]="KEY_1";b[b.KEY_2=50]="KEY_2";b[b.KEY_3=
51]="KEY_3";b[b.KEY_A=65]="KEY_A";b[b.KEY_C=67]="KEY_C";b[b.KEY_D=68]="KEY_D";b[b.KEY_E=69]="KEY_E";b[b.KEY_I=73]="KEY_I";b[b.KEY_M=77]="KEY_M";b[b.KEY_N=78]="KEY_N";b[b.KEY_P=80]="KEY_P";b[b.KEY_Q=81]="KEY_Q";b[b.KEY_S=83]="KEY_S";b[b.KEY_W=87]="KEY_W";b[b.KEY_X=88]="KEY_X";b[b.KEY_Y=89]="KEY_Y";b[b.KEY_Z=90]="KEY_Z";b[b.KEY_F1=112]="KEY_F1";b[b.KEY_F2=113]="KEY_F2";b[b.KEY_F3=114]="KEY_F3";b[b.KEY_F4=115]="KEY_F4";b[b.KEY_F5=116]="KEY_F5";b[b.KEY_F6=117]="KEY_F6";b[b.KEY_F7=118]="KEY_F7";b[b.KEY_F8=
119]="KEY_F8";b[b.KEY_F12=123]="KEY_F12"})(c.KeyCode||(c.KeyCode={}));var g=function(){function b(){var h;this._nextKeyState=Array(b.KEY_BUFFER_MAX);this._keyState=Array(b.KEY_BUFFER_MAX);this._prevKeyState=Array(b.KEY_BUFFER_MAX);this._prevKeyStateOnControllable=Array(b.KEY_BUFFER_MAX);this._keyInputContinueFrameNum=Array(b.KEY_BUFFER_MAX);for(h=0;h<b.KEY_BUFFER_MAX;h++)this._nextKeyState[h]=!1,this._keyState[h]=!1,this._prevKeyState[h]=!1,this._prevKeyStateOnControllable[h]=!1,this._keyInputContinueFrameNum[h]=
0}b.prototype.checkHitKey=function(b){b=this.getKeyState(b);return b===e.KEYDOWN||b===e.KEYPRESS};b.prototype.getKeyState=function(b){return this._prevKeyState[b]?this._keyState[b]?e.KEYPRESS:e.KEYUP:this._keyState[b]?e.KEYDOWN:e.NONE};b.prototype.getKeyStateForControllPlayer=function(b){return this._prevKeyStateOnControllable[b]?this._keyState[b]?e.KEYPRESS:e.KEYUP:this._keyState[b]?e.KEYDOWN:e.NONE};b.prototype.getKeyStateForMessageCheck=function(b){return this._prevKeyState[b]?this._keyState[b]?
this._keyInputContinueFrameNum[b]>=wwa_data.WWAConsts.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM?e.KEYPRESS_MESSAGECHANGE:e.KEYPRESS:e.KEYUP:this._keyState[b]?e.KEYDOWN:e.NONE};b.prototype.setPressInfo=function(b){this._nextKeyState[b]=!0;this._keyInputContinueFrameNum[b]=-1};b.prototype.setReleaseInfo=function(b){this._nextKeyState[b]=!1;this._keyInputContinueFrameNum[b]=-1};b.prototype.update=function(){var e;this._prevKeyState=this._keyState.slice();this._keyState=this._nextKeyState.slice();for(e=0;e<b.KEY_BUFFER_MAX;e++)this._keyState[e]&&
this._keyInputContinueFrameNum[e]++};b.prototype.memorizeKeyStateOnControllableFrame=function(){this._prevKeyStateOnControllable=this._keyState.slice()};b.prototype.allClear=function(){var e;this._nextKeyState=Array(b.KEY_BUFFER_MAX);for(e=0;e<b.KEY_BUFFER_MAX;e++)this._nextKeyState[e]=!1};b.KEY_BUFFER_MAX=256;return b}();c.KeyStore=g;var b;(function(b){b[b.NONE=0]="NONE";b[b.MOUSEDOWN=1]="MOUSEDOWN";b[b.MOUSEPRESS=2]="MOUSEPRESS";b[b.MOUSEUP=3]="MOUSEUP"})(b=c.MouseState||(c.MouseState={}));g=function(){function e(){this._nextMouseState=
this._mouseState=this._prevMouseState=!1}e.prototype.checkClickMouse=function(e){e=void 0!==e?this.getMouseState(e):this.getMouseState();return e===b.MOUSEDOWN||e===b.MOUSEPRESS};e.prototype.getMouseState=function(e){return void 0!==e&&this._inputDir!==e?b.NONE:this._prevMouseState?this._mouseState?b.MOUSEPRESS:b.MOUSEUP:this._mouseState?b.MOUSEDOWN:b.NONE};e.prototype.getMouseStateForControllPlayer=function(e){return void 0!==e&&this._inputDir!==e?b.NONE:this._prevMouseStateOnControllable?this._mouseState?
b.MOUSEPRESS:b.MOUSEUP:this._mouseState?b.MOUSEDOWN:b.NONE};e.prototype.setPressInfo=function(b,a){this._nextMouseState=!0;this._inputDir=b;this._touchID=a};e.prototype.setReleaseInfo=function(){this._touchID=void 0;this._nextMouseState=!1};e.prototype.memorizeMouseStateOnControllableFrame=function(){this._prevMouseStateOnControllable=this._mouseState};e.prototype.update=function(){this._prevMouseState=this._mouseState;this._mouseState=this._nextMouseState};e.prototype.clear=function(){this._nextMouseState=
!1};e.prototype.getTouchID=function(){return this._touchID};return e}();c.MouseStore=g})(wwa_input||(wwa_input={}));var wwa_data;
(function(c){var e=function(){function a(a,l){this.strength=a;this.defence=l}a.prototype.add=function(a){this.strength+=a.strength;this.defence+=a.defence;return this};a.prototype.plus=function(b){return new a(this.strength+b.strength,this.defence+b.defence)};a.prototype.minus=function(b){return new a(this.strength-b.strength,this.defence-b.defence)};a.prototype.equals=function(a){return this.strength===a.strength&&this.defence===a.defence};return a}();c.EquipmentStatus=e;e=function(a){function b(l,
d,b,u){d=a.call(this,d,b)||this;d.energy=l;d.gold=u;return d}__extends(b,a);b.prototype.add=function(a){a instanceof b&&(this.energy+=a.energy,this.gold+=a.gold);this.strength+=a.strength;this.defence+=a.defence;return this};b.prototype.plus=function(a){return a instanceof b?new b(this.energy+a.energy,this.strength+a.strength,this.defence+a.defence,this.gold+a.gold):new b(this.energy,this.strength+a.strength,this.defence+a.defence,this.gold)};b.prototype.minus=function(a){return a instanceof b?new b(this.energy-
a.energy,this.strength-a.strength,this.defence-a.defence,this.gold-a.gold):new b(this.energy,this.strength-a.strength,this.defence-a.defence,this.gold)};b.prototype.equals=function(a){return this.energy===a.energy&&this.strength===a.strength&&this.defence===a.defence&&this.gold===a.gold};return b}(e);c.Status=e;var g=function(){function a(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.x=a;this.y=b}a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y};a.prototype.substract=function(b){return new a(this.x-
b.x,this.y-b.y)};a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.convertIntoPosition=function(a){return new b(a,this.x,this.y,0,0)};a.prototype.getDirectionTo=function(a){return this.x<a.x?this.y>a.y?t.RIGHT_UP:this.y===a.y?t.RIGHT:t.RIGHT_DOWN:this.x===a.x?this.y>a.y?t.UP:this.y===a.y?t.NO_DIRECTION:t.DOWN:this.y>a.y?t.LEFT_UP:this.y===a.y?t.LEFT:t.LEFT_DOWN};a.prototype.toString=function(){return"("+this.x+", "+this.y+")"};return a}();c.Coord=g;var b=function(){function a(a,
b,d,e,c){void 0===e&&(e=0);void 0===c&&(c=0);this._wwa=a;if(void 0===this._wwa)throw Error("WWA\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3057\u307e\u305b\u3093. ");a=this._wwa.getMapWidth();if(0>b||b>=a||b>=a-1&&0<e||0>d||d>=a||d>=a-1&&0<c)throw Error("\u7bc4\u56f2\u5916\u306e\u5ea7\u6a19\u3067\u3059!! parts:("+b+", "+d+"), offset:("+e+", "+c+"), mapWidth = "+a);this._partsCoord=new g(b,d);this._offsetCoord=new g(e,c)}a.prototype.getPartsCoord=function(){return this._partsCoord};
a.prototype.getOffsetCoord=function(){return this._offsetCoord};a.prototype.getScreenTopPosition=function(){return new a(this._wwa,Math.floor(this._partsCoord.x/(h.H_PARTS_NUM_IN_WINDOW-1))*(h.H_PARTS_NUM_IN_WINDOW-1),Math.floor(this._partsCoord.y/(h.V_PARTS_NUM_IN_WINDOW-1))*(h.V_PARTS_NUM_IN_WINDOW-1),0,0)};a.prototype.getDefaultCameraPosition=function(){var a=this.getScreenTopPosition(),b=a.getPartsCoord(),d=this._wwa.getMapWidth();a=a.getPartsCoord().clone();b.x===d-1&&a.x--;b.y===d-1&&a.y--;
return a.convertIntoPosition(this._wwa).getScreenTopPosition()};a.prototype.getNextJustPosition=function(b){if(void 0!==b){var l=this._partsCoord;return new a(this._wwa,l.x+c.vx[b],l.y+c.vy[b],0,0)}b=this._partsCoord.x;l=this._partsCoord.y;0>this._offsetCoord.x?b--:0<this._offsetCoord.x&&b++;0>this._offsetCoord.y?l--:0<this._offsetCoord.y&&l++;return new a(this._wwa,b,l,0,0)};a.prototype.getNextFramePosition=function(b,l,d){var u=this._partsCoord.x,e=this._partsCoord.y;l=this._offsetCoord.x+c.vx[b]*
l;b=this._offsetCoord.y+c.vy[b]*d;0>l&&(d=Math.floor(Math.abs(l)/h.CHIP_SIZE),u-=d,l=(l+d*h.CHIP_SIZE)%h.CHIP_SIZE);0>b&&(d=Math.floor(Math.abs(b)/h.CHIP_SIZE),e-=d,b=(b+d*h.CHIP_SIZE)%h.CHIP_SIZE);l>=h.CHIP_SIZE&&(u+=Math.floor(l/h.CHIP_SIZE),l=(l+h.CHIP_SIZE)%h.CHIP_SIZE);b>=h.CHIP_SIZE&&(e+=Math.floor(b/h.CHIP_SIZE),b=(b+h.CHIP_SIZE)%h.CHIP_SIZE);return new a(this._wwa,u,e,l,b)};a.prototype.isJustPosition=function(){return 0==this._offsetCoord.x&&0==this._offsetCoord.y};a.prototype.isScreenTopPosition=
function(){var a=this.getScreenTopPosition();return this.equals(a)};a.prototype.equals=function(a){return this._partsCoord.equals(a.getPartsCoord())&&this._offsetCoord.equals(a.getOffsetCoord())};a.prototype.isInCameraRange=function(a,b){void 0===b&&(b=!1);a=a.getPosition()._partsCoord;var d=this._partsCoord.x,l=this._partsCoord.y;b=b?1:0;return a.x<=d&&d<a.x+h.H_PARTS_NUM_IN_WINDOW-b&&a.y<=l&&l<a.y+h.V_PARTS_NUM_IN_WINDOW-b};a.prototype.hasLocalGate=function(){return this._wwa.getMapTypeByPosition(this)===
h.MAP_LOCALGATE||this._wwa.getObjectTypeByPosition(this)===h.OBJECT_LOCALGATE};a.prototype.clone=function(){return new a(this._wwa,this._partsCoord.x,this._partsCoord.y,this._offsetCoord.x,this._offsetCoord.y)};return a}();c.Position=b;e=function(){return function(a,b,l){this.destPos=a.clone();this.srcPos=b.clone();this.srcSize=l.clone()}}();c.Face=e;var t;(function(a){a[a.LEFT=0]="LEFT";a[a.RIGHT=1]="RIGHT";a[a.DOWN=2]="DOWN";a[a.UP=3]="UP";a[a.LEFT_DOWN=4]="LEFT_DOWN";a[a.LEFT_UP=5]="LEFT_UP";a[a.RIGHT_DOWN=
6]="RIGHT_DOWN";a[a.RIGHT_UP=7]="RIGHT_UP";a[a.NO_DIRECTION=8]="NO_DIRECTION"})(t=c.Direction||(c.Direction={}));c.vx=[-1,1,0,0,-1,-1,1,1,0];c.vy=[0,0,1,-1,1,-1,1,-1,0];c.dirToPos=[4,6,2,0];c.dirToKey=[wwa_input.KeyCode.KEY_LEFT,wwa_input.KeyCode.KEY_RIGHT,wwa_input.KeyCode.KEY_DOWN,wwa_input.KeyCode.KEY_UP];(function(a){a[a.YES=0]="YES";a[a.NO=1]="NO";a[a.UNSELECTED=2]="UNSELECTED"})(c.YesNoState||(c.YesNoState={}));(function(a){a[a.MAP=0]="MAP";a[a.OBJECT=1]="OBJECT";a[a.CHOICE_YES=2]="CHOICE_YES";
a[a.CHOICE_NO=3]="CHOICE_NO"})(c.AppearanceTriggerType||(c.AppearanceTriggerType={}));(function(a){a[a.NORMAL=0]="NORMAL";a[a.CAN_USE=1]="CAN_USE";a[a.NOT_DISAPPEAR=2]="NOT_DISAPPEAR"})(c.ItemMode||(c.ItemMode={}));(function(a){a[a.MAP=1]="MAP";a[a.OBJECT=0]="OBJECT"})(c.PartsType||(c.PartsType={}));(function(a){a[a.NONE=0]="NONE";a[a.CALL_BY_MAP_PARTS=1]="CALL_BY_MAP_PARTS";a[a.CALL_BY_OBJECT_PARTS=2]="CALL_BY_OBJECT_PARTS";a[a.CALL_BY_ITEM_USE=3]="CALL_BY_ITEM_USE";a[a.CALL_BY_QUICK_SAVE=4]="CALL_BY_QUICK_SAVE";
a[a.CALL_BY_QUICK_LOAD=5]="CALL_BY_QUICK_LOAD";a[a.CALL_BY_RESTART_GAME=6]="CALL_BY_RESTART_GAME";a[a.CALL_BY_GOTO_WWA=7]="CALL_BY_GOTO_WWA";a[a.CALL_BY_PASSWORD_SAVE=8]="CALL_BY_PASSWORD_SAVE";a[a.CALL_BY_PASSWORD_LOAD=9]="CALL_BY_PASSWORD_LOAD"})(c.ChoiceCallInfo||(c.ChoiceCallInfo={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.QUICK_SAVE=1]="QUICK_SAVE";a[a.RESTART_GAME=2]="RESTART_GAME";a[a.GOTO_WWA=3]="GOTO_WWA"})(c.SidebarButton||(c.SidebarButton={}));(function(a){a[a.UP=0]="UP";a[a.DOWN=
1]="DOWN"})(c.SpeedChange||(c.SpeedChange={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.RESTART_GAME=1]="RESTART_GAME";a[a.PASSWORD=2]="PASSWORD"})(c.LoadType||(c.LoadType={}));(function(a){a[a.STATIC=0]="STATIC";a[a.CHASE_PLAYER=1]="CHASE_PLAYER";a[a.RUN_OUT=2]="RUN_OUT";a[a.HANG_AROUND=3]="HANG_AROUND"})(c.MoveType||(c.MoveType={}));(function(a){a[a.MODE_X=0]="MODE_X";a[a.MODE_Y=1]="MODE_Y";a[a.UNDECIDED=2]="UNDECIDED"})(c.SecondCandidateMoveType||(c.SecondCandidateMoveType={}));c.sidebarButtonCellElementID=
["cell-load","cell-save","cell-restart","cell-gotowwa"];(function(a){a[a.ASK_LINK=5]="ASK_LINK";a[a.NO_MONEY=6]="NO_MONEY";a[a.NO_ITEM=7]="NO_ITEM";a[a.USE_ITEM=8]="USE_ITEM"})(c.SystemMessage1||(c.SystemMessage1={}));(function(a){a[a.CLICKABLE_ITEM=0]="CLICKABLE_ITEM";a[a.FULL_ITEM=1]="FULL_ITEM";a[a.LOAD_SE=2]="LOAD_SE"})(c.SystemMessage2||(c.SystemMessage2={}));(function(a){a[a.UNDEFINED=0]="UNDEFINED";a[a.IMGPLAYER=1]="IMGPLAYER";a[a.IMGYESNO=2]="IMGYESNO";a[a.HPMAX=3]="HPMAX";a[a.SAVE=4]="SAVE";
a[a.ITEM=5]="ITEM";a[a.DEFAULT=6]="DEFAULT";a[a.OLDMAP=7]="OLDMAP";a[a.PARTS=8]="PARTS";a[a.MOVE=9]="MOVE";a[a.MAP=10]="MAP";a[a.DIRMAP=11]="DIRMAP";a[a.IMGFRAME=12]="IMGFRAME";a[a.IMGBOM=13]="IMGBOM";a[a.DELPLAYER=14]="DELPLAYER";a[a.FACE=15]="FACE";a[a.EFFECT=16]="EFFECT";a[a.GAMEOVER=17]="GAMEOVER";a[a.IMGCLICK=18]="IMGCLICK";a[a.STATUS=19]="STATUS";a[a.EFFITEM=20]="EFFITEM";a[a.COLOR=21]="COLOR";a[a.WAIT=22]="WAIT";a[a.SOUND=23]="SOUND"})(c.MacroType||(c.MacroType={}));c.macrotable={"":0,$imgplayer:1,
$imgyesno:2,$hpmax:3,$save:4,$item:5,$default:6,$oldmap:7,$parts:8,$move:9,$map:10,$dirmap:11,$imgframe:12,$imgbom:13,$delplayer:14,$face:15,$effect:16,$gameover:17,$imgclick:18,$status:19,$effitem:20,$color:21,$wait:22,$sound:23};(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.MOVES=4]="MOVES"})(c.MacroStatusIndex||(c.MacroStatusIndex={}));(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=
3]="GOLD";a[a.WIDE_CELL_ROW=4]="WIDE_CELL_ROW";a[a.ITEM_BG=5]="ITEM_BG";a[a.MAIN_FRAME=6]="MAIN_FRAME"})(c.MacroImgFrameIndex||(c.MacroImgFrameIndex={}));(function(a){a[a.DECISION=1]="DECISION";a[a.ATTACK=3]="ATTACK";a[a.BGM_LB=70]="BGM_LB";a[a.NO_SOUND=99]="NO_SOUND"})(c.SystemSound||(c.SystemSound={}));c.speedList=[2,5,8,10];c.speedNameList=["\u4f4e\u901f","\u6e96\u4f4e\u901f","\u4e2d\u901f","\u9ad8\u901f"];var h=function(){function a(){}a.VERSION_WWAJS="W3.15d\u03b22";a.WWA_HOME="http://wwajp.com";
a.ITEMBOX_SIZE=12;a.MAP_ATR_MAX=60;a.OBJ_ATR_MAX=60;a.OLD_MAP_ATR_MAX=40;a.OLD_OBJ_ATR_MAX=40;a.ATR_TYPE=3;a.ATR_MODE=4;a.ATR_STRING=5;a.ATR_X=6;a.ATR_Y=7;a.ATR_X2=8;a.ATR_Y2=9;a.ATR_ENERGY=10;a.ATR_STRENGTH=11;a.ATR_DEFENCE=12;a.ATR_GOLD=13;a.ATR_ITEM=14;a.ATR_NUMBER=15;a.ATR_JUMP_X=16;a.ATR_MOVE=16;a.ATR_JUMP_Y=17;a.ATR_SOUND=19;a.ATR_APPERANCE_BASE=20;a.REL_ATR_APPERANCE_ID=0;a.REL_ATR_APPERANCE_X=1;a.REL_ATR_APPERANCE_Y=2;a.REL_ATR_APPERANCE_TYPE=3;a.REL_ATR_APPERANCE_UNIT_LENGTH=4;a.ATR_RANDOM_BASE=
10;a.RANDOM_ATR_NUM=10;a.RANDOM_ITERATION_MAX=10;a.MAP_STREET=0;a.MAP_WALL=1;a.MAP_LOCALGATE=2;a.MAP_URLGATE=4;a.OBJECT_NORMAL=0;a.OBJECT_MESSAGE=1;a.OBJECT_URLGATE=2;a.OBJECT_STATUS=3;a.OBJECT_ITEM=4;a.OBJECT_DOOR=5;a.OBJECT_MONSTER=6;a.OBJECT_SCORE=11;a.OBJECT_SELL=14;a.OBJECT_BUY=15;a.OBJECT_RANDOM=16;a.OBJECT_SELECT=17;a.OBJECT_LOCALGATE=18;a.SYSTEM_MESSAGE_NUM=20;a.IMGPOS_DEFAULT_YESNO_X=3;a.IMGPOS_DEFAULT_YESNO_Y=1;a.IMGRELPOS_YESNO_YES_X=0;a.IMGRELPOS_YESNO_NO_X=1;a.IMGRELPOS_YESNO_YESP_X=
2;a.IMGRELPOS_YESNO_NOP_X=3;a.IMGPOS_DEFAULT_PLAYER_X=2;a.IMGPOS_DEFAULT_PLAYER_Y=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y=0;a.IMGPOS_DEFAULT_FRAME_X=0;a.IMGPOS_DEFAULT_FRAME_Y=1;a.IMGPOS_DEFAULT_BATTLE_EFFECT_X=3;a.IMGPOS_DEFAULT_BATTLE_EFFECT_Y=3;a.DEFAULT_DISABLE_SAVE=!1;a.DEFAULT_OLDMAP=!1;a.DEFAULT_OBJECT_NO_COLLAPSE=!1;a.SPLASH_SCREEN_DISP_MILLS=100;a.DEFAULT_FRAME_INTERVAL=20;a.GAMEOVER_FRAME_INTERVAL=50;a.YESNO_PRESS_DISP_FRAME_NUM=20;a.CHIP_SIZE=40;
a.MAP_WINDOW_WIDTH=440;a.MAP_WINDOW_HEIGHT=440;a.H_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_WIDTH/a.CHIP_SIZE;a.V_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_HEIGHT/a.CHIP_SIZE;a.DEFAULT_SPEED_INDEX=2;a.MIN_SPEED_INDEX=0;a.MAX_SPEED_INDEX=c.speedList.length-1;a.ANIMATION_REP_HALF_FRAME=22;a.PLAYER_LOOKING_AROUND_START_FRAME=4*a.ANIMATION_REP_HALF_FRAME;a.RELATIVE_COORD_BIAS=1E4;a.RELATIVE_COORD_LOWER=a.RELATIVE_COORD_BIAS-1E3;a.PLAYER_COORD=a.RELATIVE_COORD_BIAS-1E3;a.LOCALGATE_PLAYER_WAIT_FRAME=5;a.STATUS_CHANGED_EFFECT_FRAME_NUM=
20;a.PASSABLE_OBJECT=1;a.APPERANCE_PARTS_MIN_INDEX=0;a.APPERANCE_PARTS_MAX_INDEX=9;a.APPERANCE_PARTS_MIN_INDEX_NO=5;a.APPERANCE_PARTS_MAX_INDEX_YES=4;a.FADEOUT_SPEED=8;a.STATUS_MINUS_BORDER=3E4;a.ITEMBOX_IS_FULL=-1;a.BATTLE_INTERVAL_FRAME_NUM=10;a.BATTLE_SPEED_CHANGE_TURN_NUM=40;a.RANDOM_MOVE_ITERATION_NUM=50;a.RANDOM_MOVE_ITERATION_NUM_BEFORE_V31=8;a.BATTLE_ESTIMATE_MONSTER_TYPE_MAX=8;a.SOUND_MAX=100;a.ITEM_BORDER_IMG_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAArklEQVRYR+2Y0QqAIAxFt///aENJHwxxuJUSxzeh3S7HXaNpEkly4FIRzba0GEyHeVTN7jqDWvb7V4Y1NLibZIY0NbiL5G3MZLCe / 1fn3XJgJYjB7mgg6O1VCEKwXo79JeklY62nB62kRs9BEIKkeNIDhISQEBJC4k0BBCF4D7D4cV9shf99ixdB + MrM0y3fa3zV05D45GOqhwPMGPkYlccIOEY2VKUN0UNVXxC7ADj7mDi9aFZZAAAAAElFTkSuQmCC";
a.LOAD_STAGE_MAX_EXCEPT_AUDIO=7;a.WWA_STYLE_TAG_ID="wwa-additional-style";a.DEFAULT_FRAME_COLOR_R=255;a.DEFAULT_FRAME_COLOR_G=255;a.DEFAULT_FRAME_COLOR_B=255;a.DEFAULT_FRAMEOUT_COLOR_R=96;a.DEFAULT_FRAMEOUT_COLOR_G=96;a.DEFAULT_FRAMEOUT_COLOR_B=96;a.DEFAULT_STRBACK_COLOR_R=0;a.DEFAULT_STRBACK_COLOR_G=0;a.DEFAULT_STRBACK_COLOR_B=0;a.DEFAULT_STATUS_COLOR_R=0;a.DEFAULT_STATUS_COLOR_G=0;a.DEFAULT_STATUS_COLOR_B=0;a.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM=20;a.WWAP_SERVER_OLD="http://wwawing.com/wwap";a.WWAP_SERVER=
"https://wwaphoenix.github.io";a.WWAP_SERVER_AUDIO_DIR="audio";a.WWAP_SERVER_TITLE_IMG="cover_p.gif";a.WWAP_SERVER_LOADER_NO_WORKER="wwaload.noworker.js";a.SCREEN_WIDTH=560;a.SCREEN_HEIGHT=440;a.LOADING_FONT="Times New Roman";a.MSG_STR_WIDTH=16;return a}();c.WWAConsts=h;e=function(){return function(){}}();c.LoaderResponse=e;e=function(){return function(){}}();c.LoaderError=e;e=function(){return function(){}}();c.LoaderProgress=e;(function(a){a[a.INIT=0]="INIT";a[a.MAP_LOAD=1]="MAP_LOAD";a[a.OBJ_LOAD=
2]="OBJ_LOAD";a[a.MAP_ATTR=3]="MAP_ATTR";a[a.OBJ_ATTR=4]="OBJ_ATTR";a[a.RAND_PARTS=5]="RAND_PARTS";a[a.MESSAGE=6]="MESSAGE";a[a.GAME_INIT=7]="GAME_INIT";a[a.AUDIO=8]="AUDIO";a[a.FINISH=9]="FINISH"})(c.LoadStage||(c.LoadStage={}));c.loadMessages="\u30ed\u30fc\u30c9\u306e\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u30e9\u30f3\u30c0\u30e0\u30d1\u30fc\u30c4\u3092\u7f6e\u63db\u3057\u3066\u3044\u307e\u3059\u3002;\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;Welcome to WWA Wing!".split(";");
c.loadMessagesClassic=["Welcome to WWA Wing!","Now Map Data Loading .....","Now CG Data Loading .....","Now Making chara CG ....."];(function(a){a[a.LINE=30]="LINE";a[a.TITLE_X=100]="TITLE_X";a[a.TITLE_Y=70]="TITLE_Y";a[a.LOADING_X=50]="LOADING_X";a[a.LOADING_Y=140]="LOADING_Y";a[a.ERROR_X=10]="ERROR_X";a[a.ERROR_Y=180]="ERROR_Y";a[a.FOOTER_X=160]="FOOTER_X";a[a.FOOTER_Y=360]="FOOTER_Y";a[a.WORLD_Y=330]="WORLD_Y";a[a.COPYRIGHT_Y=390]="COPYRIGHT_Y"})(c.LoadingMessagePosition||(c.LoadingMessagePosition=
{}));(function(a){a[a.TITLE=32]="TITLE";a[a.LOADING=22]="LOADING";a[a.FOOTER=18]="FOOTER";a[a.ERRROR=16]="ERRROR"})(c.LoadingMessageSize||(c.LoadingMessageSize={}));(function(a){a[a.COLOR_FRAME=0]="COLOR_FRAME";a[a.COLOR_FRAMEOUT=1]="COLOR_FRAMEOUT";a[a.COLOR_STR=2]="COLOR_STR";a[a.COLOR_STATUS_STR=4]="COLOR_STATUS_STR"})(c.ChangeStyleType||(c.ChangeStyleType={}));(function(a){a[a.MESSAGE_WINDOW=0]="MESSAGE_WINDOW";a[a.SIDEBAR=1]="SIDEBAR"})(c.SelectorType||(c.SelectorType={}));e=function(){return function(){this.checkString=
this.checkOriginalMapString=this.statusColorB=this.statusColorG=this.statusColorR=this.fontColorB=this.fontColorG=this.fontColorR=this.frameOutColorB=this.frameOutColorG=this.frameOutColorR=this.frameColorB=this.frameColorG=this.frameColorR=this.imgClickY=this.imgClickX=this.bgm=this.delPlayerFlag=this.objectNoCollapseDefaultFlag=this.compatibleForOldMapFlag=this.disableSaveFlag=this.clickableItemSignImgPosY=this.clickableItemSignImgPosX=this.playerImgPosY=this.playerImgPosX=this.yesnoImgPosY=this.yesnoImgPosX=
this.moves=this.systemMessage=this.mapCGName=this.charCGName=this.worldPassNumber=this.worldName=this.message=this.worldPassword=this.objectAttribute=this.mapAttribute=this.mapObjectCompressed=this.mapCompressed=this.mapObject=this.map=this.messageNum=this.mapWidth=this.itemBox=this.statusGold=this.statusDefence=this.statusStrength=this.statusEnergy=this.statusEnergyMax=this.isOldMap=this.objPartsMax=this.mapPartsMax=this.playerY=this.playerX=this.gameoverY=this.gameoverX=this.version=void 0}}();
c.WWAData=e})(wwa_data||(wwa_data={}));var wwa_parts_player;
(function(c){var e=wwa_data.Direction,g=wwa_data.WWAConsts,b=function(){function a(a){this._position=a}a.prototype.getPosition=function(){return this._position};return a}(),t=function(a){function b(b){return a.call(this,b)||this}__extends(b,a);return b}(b);c.PartsObject=t;b=function(a){function b(b){return a.call(this,b)||this}__extends(b,a);return b}(b);c.PartsMap=b;var h;(function(a){a[a.CONTROLLABLE=0]="CONTROLLABLE";a[a.MOVING=1]="MOVING";a[a.CAMERA_MOVING=2]="CAMERA_MOVING";a[a.MESSAGE_WAITING=
3]="MESSAGE_WAITING";a[a.LOCALGATE_JUMPED=4]="LOCALGATE_JUMPED";a[a.BATTLE=5]="BATTLE";a[a.ESTIMATE_WINDOW_WAITING=6]="ESTIMATE_WINDOW_WAITING";a[a.PASSWORD_WINDOW_WAITING=7]="PASSWORD_WINDOW_WAITING"})(h||(h={}));t=function(a){function b(b,d,u,c,w){d=a.call(this,d)||this;d._status=c;d._equipStatus=new wwa_data.EquipmentStatus(0,0);d._itemBox=Array(g.ITEMBOX_SIZE);d._itemBoxElement=Array(g.ITEMBOX_SIZE);d._itemUsingEvent=Array(g.ITEMBOX_SIZE);for(c=0;c<d._itemBox.length;c++)d._itemBox[c]=0,d._itemBoxElement[c]=
wwa_util.$qsh("#item"+c+">.item-disp");d.updateItemBox();d._energyMax=w;d._dir=e.DOWN;d._isMovingImage=!1;d._wwa=b;d._state=h.CONTROLLABLE;d._camera=u;d._isPartsEventExecuted=!1;d._energyValueElement=wwa_util.$qsh("#disp-energy>.status-value-box");d._strengthValueElement=wwa_util.$qsh("#disp-strength>.status-value-box");d._defenceValueElement=wwa_util.$qsh("#disp-defence>.status-value-box");d._goldValueElement=wwa_util.$qsh("#disp-gold>.status-value-box");d._isReadyToUseItem=!1;d._isClickableItemGot=
!1;d._moves=0;d._moveMacroWaitingRemainMoves=0;d._moveObjectAutoExecTimer=0;d.updateStatusValueBox();d._partsAppeared=!1;d._afterMoveMacroFlag=!1;d._isPreparedForLookingAround=!0;d._lookingAroundTimer=g.PLAYER_LOOKING_AROUND_START_FRAME;d._speedIndex=g.DEFAULT_SPEED_INDEX;return d}__extends(b,a);b.prototype.move=function(){if(this.isControllable())this.controll(this._dir);else if(this._state===h.CAMERA_MOVING){try{this._camera.move(this._dir)}catch(d){}this._isOnCameraStopPosition()&&(this._state=
h.CONTROLLABLE)}else if(this._state===h.MOVING){try{var a=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex])}catch(d){}a.isJustPosition()&&(this._state=h.CONTROLLABLE,this.toggleMovingImage(),this._moves++,this._isPartsEventExecuted=!1,this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0);this._position=a}};b.prototype.controll=function(a){if(this.isControllable()){this._isPreparedForLookingAround=!1;this._dir=a;
try{var d=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex]);var b=this._position.getNextJustPosition(a)}catch(A){return}if(this._isOnCameraMovingPosition()){if(0!==this._wwa.getMapIdByPosition(b)||this._wwa.isOldMap()||this._wwa.debug)try{this._camera.move(this._dir),this._state=h.CAMERA_MOVING}catch(A){this._state=h.CONTROLLABLE}}else this.canMoveTo(b)?(this._position=d,this._state=h.MOVING,this._wwa.getMapAttributeByPosition(this._position.getNextJustPosition(a),
g.ATR_TYPE)!==g.MAP_LOCALGATE&&this._wwa.moveObjects(!0)):(this._wwa.getMapTypeByPosition(b)===g.MAP_WALL&&this._wwa.checkMap(b.getPartsCoord()),this._wwa.checkObject(b.getPartsCoord()))}};b.prototype.canMoveTo=function(a){if(null===a)return!1;if(this._wwa.debug)return!0;this._wwa.getMapWidth();a.getPartsCoord();a.getOffsetCoord();return 0===this._wwa.getMapIdByPosition(a)&&!this._wwa.isOldMap()||this._wwa.getMapTypeByPosition(a)===g.MAP_WALL?!1:0===this._wwa.getObjectIdByPosition(a)||this._wwa.getObjectTypeByPosition(a)===
g.OBJECT_NORMAL&&this._wwa.getObjectAttributeByPosition(a,g.ATR_MODE)===g.PASSABLE_OBJECT?!0:this._wwa.getObjectTypeByPosition(a)===g.OBJECT_DOOR&&this._wwa.getObjectAttributeByPosition(a,g.ATR_NUMBER)===g.PASSABLE_OBJECT?this.hasItem(this._wwa.getObjectAttributeByPosition(a,g.ATR_ITEM))?!1:!0:!1};b.prototype.isMoving=function(){return this._state==h.MOVING||this._state==h.CAMERA_MOVING};b.prototype._isOnCameraMovingPosition=function(){var a=this._camera.getPosition().getPartsCoord(),d=this.getPosition().getPartsCoord();
return d.x-a.x===g.H_PARTS_NUM_IN_WINDOW-1&&this._dir===e.RIGHT||d.x===a.x&&this._dir===e.LEFT||d.y-a.y===g.V_PARTS_NUM_IN_WINDOW-1&&this._dir===e.DOWN||d.y===a.y&&this._dir===e.UP};b.prototype._isOnCameraStopPosition=function(){var a=this._camera.getPosition().getPartsCoord(),d=this.getPosition().getPartsCoord();return d.x-a.x===g.H_PARTS_NUM_IN_WINDOW-1&&this._dir===e.LEFT||d.x===a.x&&this._dir===e.RIGHT||d.y-a.y===g.V_PARTS_NUM_IN_WINDOW-1&&this._dir===e.UP||d.y===a.y&&this._dir===e.DOWN};b.prototype.isControllable=
function(){var a=this._afterMoveMacroFlag;this._afterMoveMacroFlag=!1;return this._state===h.CONTROLLABLE&&!this._partsAppeared&&(this._wwa.getMapTypeByPosition(this._position)!==g.MAP_LOCALGATE&&this._wwa.getMapTypeByPosition(this._position)!==g.MAP_URLGATE||!this._wwa.isPrevFrameEventExecuted())&&0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&!a&&this._wwa.canInput()};b.prototype.getCopyOfItemBox=function(){return this._itemBox.slice()};b.prototype.getDir=function(){return this._dir};
b.prototype.isMovingImage=function(){return this._isMovingImage};b.prototype.toggleMovingImage=function(){this._isMovingImage=this._isMovingImage?!1:!0};b.prototype.getEnergyMax=function(){return this._energyMax};b.prototype.isJumped=function(){return this._state===h.LOCALGATE_JUMPED};b.prototype.setMessageWaiting=function(){this._state=h.MESSAGE_WAITING};b.prototype.isWaitingMessage=function(){return this._state===h.MESSAGE_WAITING};b.prototype.clearMessageWaiting=function(){this._state===h.MESSAGE_WAITING&&
(this._state=h.CONTROLLABLE,this._isPartsEventExecuted=!0,this._isPreparedForLookingAround&&(this._lookingAroundTimer=g.PLAYER_LOOKING_AROUND_START_FRAME))};b.prototype.setEstimateWindowWating=function(){this._state=h.ESTIMATE_WINDOW_WAITING};b.prototype.isWatingEstimateWindow=function(){return this._state===h.ESTIMATE_WINDOW_WAITING};b.prototype.clearEstimateWindowWaiting=function(){this._state===h.ESTIMATE_WINDOW_WAITING&&(this._state=h.CONTROLLABLE)};b.prototype.setPasswordWindowWating=function(){this._state=
h.PASSWORD_WINDOW_WAITING};b.prototype.isWaitingPasswordWindow=function(){return this._state===h.PASSWORD_WINDOW_WAITING};b.prototype.clearPasswordWindowWaiting=function(){this._state===h.PASSWORD_WINDOW_WAITING&&(this._state=h.CONTROLLABLE)};b.prototype.isPartsEventExecuted=function(){return this._isPartsEventExecuted};b.prototype.resetEventExecutionInfo=function(){this._isPartsEventExecuted=!1};b.prototype.getLastExecPartsIDOnSamePosition=function(a){return a===wwa_data.PartsType.MAP?this._samePosLastExecutedMapID:
this._samePosLastExecutedObjID};b.prototype.setLastExecInfoOnSamePosition=function(a,d){a===wwa_data.PartsType.MAP?this._samePosLastExecutedMapID=d:this._samePosLastExecutedObjID=d};b.prototype.processAfterJump=function(){this._state===h.LOCALGATE_JUMPED&&0===--this._jumpWaitFramesRemain&&(this._state=h.CONTROLLABLE)};b.prototype.jumpTo=function(a){var d=this._camera.getPosition();this.getPosition();if(this._position.equals(a))return!1;this._position=a;a.isInCameraRange(this._camera,!0)||this._camera.reset(a);
this._state=h.LOCALGATE_JUMPED;this._jumpWaitFramesRemain=g.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;a.hasLocalGate()?this._dir=e.DOWN:a.getPartsCoord().y<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(e.DOWN).hasLocalGate()?this._dir=e.UP:1<=a.getPartsCoord().y&&a.getNextJustPosition(e.UP).hasLocalGate()?this._dir=e.DOWN:a.getPartsCoord().x<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(e.RIGHT).hasLocalGate()?this._dir=e.LEFT:1<=a.getPartsCoord().x&&
a.getNextJustPosition(e.LEFT).hasLocalGate()?this._dir=e.RIGHT:this._dir=e.DOWN;this._camera.getPosition().equals(d)||(this._isPreparedForLookingAround=!0,this._lookingAroundTimer=g.PLAYER_LOOKING_AROUND_START_FRAME);return!0};b.prototype.systemJumpTo=function(a){this._position=a;this._camera.reset(a);this._camera.resetPreviousPosition();this._state=h.LOCALGATE_JUMPED;this._jumpWaitFramesRemain=g.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;this._dir=
e.DOWN;this._isPreparedForLookingAround=!0;this._lookingAroundTimer=g.PLAYER_LOOKING_AROUND_START_FRAME};b.prototype.addStatusAll=function(a){this._status.add(a);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return this._status};b.prototype.setEnergyMax=function(a){this._energyMax=a;0!==a&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return a};
b.prototype.setEnergy=function(a){this._status.energy=a;this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return a};b.prototype.damage=function(a){this._status.energy=Math.max(0,this._status.energy-a);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox()};b.prototype.setStrength=function(a){return this._status.strength=
a};b.prototype.setDefence=function(a){this._status.defence=a;this.updateStatusValueBox();return a};b.prototype.setGold=function(a){this._status.gold=a;this.updateStatusValueBox();return a};b.prototype.getStatus=function(){return this._status.plus(this._equipStatus)};b.prototype.getStatusWithoutEquipments=function(){return this._status.plus(new wwa_data.EquipmentStatus(0,0))};b.prototype.updateStatusValueBox=function(){var a=this._status.plus(this._equipStatus),d=a.strength,b=a.defence,e=a.gold;this._energyValueElement.textContent=
a.energy+"";this._strengthValueElement.textContent=d+"";this._defenceValueElement.textContent=b+"";this._goldValueElement.textContent=e+""};b.prototype.updateItemBox=function(){for(var a,d,b=0;b<this._itemBoxElement.length;b++)0===this._itemBox[b]?this._itemBoxElement[b].style.backgroundPosition="-40px 0px":(a=this._wwa.getObjectCropXById(this._itemBox[b]),d=this._wwa.getObjectCropYById(this._itemBox[b]),this._itemBoxElement[b].style.backgroundPosition="-"+a+"px -"+d+"px")};b.prototype.isDead=function(){return 0>=
this._status.energy};b.prototype.addItem=function(a,d,b){void 0===d&&(d=0);void 0===b&&(b=!1);var l=this._wwa.getObjectAttributeById(a,g.ATR_NUMBER);0===d&&0!==l&&(d=l);if(0===d){if(0===a)return;d=this._getBlankItemPos();if(d===g.ITEMBOX_IS_FULL)throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");this._forceSetItemBox(d,a)}else if(!1===b)if(l=this._itemBox[d-1],this._wwa.getObjectAttributeById(l,g.ATR_NUMBER)!==this._wwa.getObjectAttributeById(a,
g.ATR_NUMBER))if(b=this._getBlankItemPos(),b!==g.ITEMBOX_IS_FULL)this._forceSetItemBox(b,l),this._forceSetItemBox(d,a);else throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");else this._forceSetItemBox(d,a);else this._forceSetItemBox(d,a);this._updateEquipmentStatus();this.updateItemBox()};b.prototype._forceSetItemBox=function(a,d){var b=this,l=wwa_util.$qsh("#item"+(a-1)+">.item-click-border"),e=this._wwa.getObjectAttributeById(d,g.ATR_MODE);
this.removeItemByItemPosition(a);this._itemBox[a-1]=d;0!==d&&e!==wwa_data.ItemMode.NORMAL&&(d=this._wwa.getSystemMessageById(wwa_data.SystemMessage2.CLICKABLE_ITEM),this._isClickableItemGot||("BLANK"!==d&&this._wwa.setMessageQueue(""===d?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u306f\u53f3\u306e\u30dc\u30c3\u30af\u30b9\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\u4f7f\u7528\u3067\u304d\u308b\u30a2\u30a4\u30c6\u30e0\u306f\u8272\u67a0\u3067\u56f2\u307e\u308c\u307e\u3059\u3002":
d,!1,!0),this._isClickableItemGot=!0),l.style.display="block",function(a){b._itemUsingEvent[a-1]=function(){if(b.isControllable())b._wwa.onselectitem(a)}}(a),l.addEventListener("click",this._itemUsingEvent[a-1]))};b.prototype._getBlankItemPos=function(){var a;for(a=1;a<this._itemBox.length+1;a++)if(0===this._itemBox[a-1])return a;return g.ITEMBOX_IS_FULL};b.prototype._updateEquipmentStatus=function(){var a,d=new wwa_data.EquipmentStatus(0,0);for(a=0;a<g.ITEMBOX_SIZE;a++)0!==this._itemBox[a]&&(d.strength+=
this._wwa.getObjectAttributeById(this._itemBox[a],g.ATR_STRENGTH),d.defence+=this._wwa.getObjectAttributeById(this._itemBox[a],g.ATR_DEFENCE));a=d.minus(this._equipStatus);this._wwa.setStatusChangedEffect(a);this._equipStatus=d;this.updateStatusValueBox()};b.prototype.hasItem=function(a){for(var d=0;d<g.ITEMBOX_SIZE;d++)if(this._itemBox[d]===a)return!0;return!1};b.prototype.canUseItem=function(a){a=this._itemBox[a-1];return 0===a||this._wwa.getObjectAttributeById(a,g.ATR_MODE)===wwa_data.ItemMode.NORMAL?
!1:!0};b.prototype.useItem=function(){var a=this._itemBox[this._readyToUseItemPos-1];this._wwa.getObjectAttributeById(a,g.ATR_MODE)!==wwa_data.ItemMode.NOT_DISAPPEAR&&this.removeItemByItemPosition(this._readyToUseItemPos);var d=wwa_util.$id("item"+(this._readyToUseItemPos-1));setTimeout(function(){d.classList.contains("onpress")&&d.classList.remove("onpress")},g.DEFAULT_FRAME_INTERVAL);this._isReadyToUseItem=!1;this._readyToUseItemPos=void 0;return a};b.prototype.canHaveMoreItems=function(){return this._getBlankItemPos()!==
g.ITEMBOX_IS_FULL};b.prototype.removeItemByItemPosition=function(a){if(0!==this._itemBox[a-1]){if(this._wwa.getObjectAttributeById(this._itemBox[a-1],g.ATR_MODE)!==wwa_data.ItemMode.NORMAL){var d=wwa_util.$qsh("#item"+(a-1)+">.item-click-border");d.removeEventListener("click",this._itemUsingEvent[a-1]);d.style.display="none"}this._itemBox[a-1]=0;this._updateEquipmentStatus();this.updateItemBox()}};b.prototype.removeItemByPartsID=function(a){if(!this.hasItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3063\u3066\u3044\u306a\u3044");
for(var d=0;d<g.ITEMBOX_SIZE;d++)if(this._itemBox[d]===a){this._wwa.getObjectAttributeById(this._itemBox[d],g.ATR_MODE)!==wwa_data.ItemMode.NORMAL&&(a=wwa_util.$qsh("#item"+d+">.item-click-border"),a.removeEventListener("click",this._itemUsingEvent[d]),a.style.display="none");this._itemBox[d]=0;this._updateEquipmentStatus();this.updateItemBox();break}};b.prototype.clearItemBox=function(){for(var a=1;a<=g.ITEMBOX_SIZE;a++)this.removeItemByItemPosition(a);this._updateEquipmentStatus();this.updateItemBox()};
b.prototype.hasGold=function(a){return this._status.gold>=a};b.prototype.payGold=function(a){if(!this.hasGold(a))throw Error("\u304a\u91d1\u304c\u8db3\u308a\u306a\u3044");this.setGold(this._status.gold-a)};b.prototype.earnGold=function(a){this.setGold(this._status.gold+a)};b.prototype.setPartsAppearedFlag=function(){this._partsAppeared=!0};b.prototype.clearPartsAppearedFlag=function(){this._partsAppeared=!1};b.prototype.isPartsAppearedTime=function(){return!0===this._partsAppeared};b.prototype.startBattleWith=
function(a){this._isPlayerTurn=!0;this._battleFrameCounter=g.BATTLE_INTERVAL_FRAME_NUM;this._battleTurnNum=0;this._enemy=a;this._state=h.BATTLE};b.prototype.isFighting=function(){return this._state===h.BATTLE};b.prototype.isTurn=function(){return this._isPlayerTurn};b.prototype.getTurnNum=function(){return this._battleTurnNum};b.prototype.isBattleStartFrame=function(){return this._battleFrameCounter===g.BATTLE_INTERVAL_FRAME_NUM&&0===this._battleTurnNum};b.prototype.fight=function(){if(!this.isFighting())throw Error("\u30d0\u30c8\u30eb\u304c\u958b\u59cb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");
0===this._battleTurnNum&&this._battleFrameCounter===g.BATTLE_INTERVAL_FRAME_NUM&&this._wwa.showMonsterWindow();if(!(0<--this._battleFrameCounter)){this._battleTurnNum++;this._speedIndex===g.MAX_SPEED_INDEX||this._battleTurnNum>g.BATTLE_SPEED_CHANGE_TURN_NUM?(1===this._battleTurnNum&&this._wwa.playSound(wwa_data.SystemSound.ATTACK),this._battleFrameCounter=1):(this._battleFrameCounter=g.BATTLE_INTERVAL_FRAME_NUM,this._wwa.playSound(wwa_data.SystemSound.ATTACK));var a=this.getStatus(),d=this._enemy.status;
if(this._isPlayerTurn){if(a.strength>d.defence||a.defence<d.strength){d.energy>a.strength-d.defence?a.strength>d.defence&&this._enemy.damage(a.strength-d.defence):(this._wwa.playSound(this._wwa.getObjectAttributeById(this._enemy.partsID,g.ATR_SOUND)),this.earnGold(d.gold),this._wwa.setStatusChangedEffect(new wwa_data.Status(0,0,0,d.gold)),0!==this._enemy.item?this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._enemy.item,this._enemy.position):this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,
0,this._enemy.position),this._wwa.appearParts(this._enemy.position,wwa_data.AppearanceTriggerType.OBJECT,this._enemy.partsID),this._state=h.CONTROLLABLE,this._wwa.setMessageQueue(this._enemy.message,!1,!1),this._enemy.battleEndProcess(),this._battleTurnNum=0,this._enemy=null);this._isPlayerTurn=!1;return}this._enemy.battleEndProcess();this._wwa.setMessageQueue("\u76f8\u624b\u306e\u9632\u5fa1\u80fd\u529b\u304c\u9ad8\u3059\u304e\u308b\uff01",!1,!0);this._battleTurnNum=0;this._enemy=null}else d.strength>
a.defence&&(a.energy>d.strength-a.defence?this.damage(d.strength-a.defence):(this.setEnergy(0),this._enemy.battleEndProcess(),this._state=h.CONTROLLABLE,this._battleTurnNum=0,this._enemy=null,this._wwa.gameover()));this._isPlayerTurn=!0}};b.prototype.readyToUseItem=function(a){if(!this.canUseItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u304c\u306a\u3044\u304b\u3001\u30a2\u30a4\u30c6\u30e0\u304c\u4f7f\u3048\u307e\u305b\u3093\u3002");var d=this._itemBox[a-1];this._wwa.getObjectAttributeById(d,g.ATR_STRING);
this._wwa.appearParts(this._position.getPartsCoord(),wwa_data.AppearanceTriggerType.OBJECT,d);this._readyToUseItemPos=a;this._isReadyToUseItem=!0};b.prototype.isReadyToUseItem=function(){return this._isReadyToUseItem};b.prototype.getDrawingCenterPosition=function(){var a=this._position.getPartsCoord(),d=this._position.getOffsetCoord(),b=this._camera.getPosition(),e=b.getPartsCoord();b=b.getOffsetCoord();return new wwa_data.Coord((a.x-e.x)*g.CHIP_SIZE+d.x-b.x+g.CHIP_SIZE/2,(a.y-e.y)*g.CHIP_SIZE+d.y-
b.y+g.CHIP_SIZE/2)};b.prototype.getMoveCount=function(){return this._moves};b.prototype.setMoveCount=function(a){return this._moves=a};b.prototype.isMoveObjectAutoExecTime=function(){return 0===this._moveObjectAutoExecTimer};b.prototype.setMoveMacroWaiting=function(a){0>a||(this._moveMacroWaitingRemainMoves=a,this._moveObjectAutoExecTimer=0)};b.prototype.resetMoveObjectAutoExecTimer=function(){this._moveObjectAutoExecTimer=g.CHIP_SIZE/wwa_data.speedList[this._speedIndex];this._moveMacroWaitingRemainMoves--};
b.prototype.decrementMoveObjectAutoExecTimer=function(){0<=this._moveMacroWaitingRemainMoves&&0<this._moveObjectAutoExecTimer&&(this._moveObjectAutoExecTimer--,0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&(this._afterMoveMacroFlag=!0));return 0};b.prototype.isWaitingMoveMacro=function(){return 0!==this._moveMacroWaitingRemainMoves||0!==this._moveObjectAutoExecTimer};b.prototype.decrementLookingAroundTimer=function(){return this._isPreparedForLookingAround&&0<this._lookingAroundTimer?
--this._lookingAroundTimer:0};b.prototype.isLookingAround=function(){return this._isPreparedForLookingAround&&0===this._lookingAroundTimer};b.prototype.getSpeedIndex=function(){return this._speedIndex};b.prototype.speedUp=function(){return this._speedIndex=Math.min(g.MAX_SPEED_INDEX,this._speedIndex+1)};b.prototype.speedDown=function(){return this._speedIndex=Math.max(g.MIN_SPEED_INDEX,this._speedIndex-1)};return b}(t);c.Player=t})(wwa_parts_player||(wwa_parts_player={}));var wwa_camera;
(function(c){var e=wwa_data.WWAConsts,g=function(){function b(b){this._position=null;this.reset(b)}b.prototype.setPlayer=function(b){this._player=b};b.prototype.isResetting=function(){return this._isResetting};b.prototype.getPosition=function(){return this._position};b.prototype.getPreviousPosition=function(){return this._positionPrev};b.prototype.resetPreviousPosition=function(){this._positionPrev=null};b.prototype.move=function(b){var c=wwa_data.speedList[this._player.getSpeedIndex()];this._position=
this._position.getNextFramePosition(b,c*(e.H_PARTS_NUM_IN_WINDOW-1),c*(e.V_PARTS_NUM_IN_WINDOW-1))};b.prototype.getTransitionStepNum=function(){return this._transitionStep};b.prototype.advanceTransitionStepNum=function(){++this._transitionStep;this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW&&(this._isResetting=!1,this._transitionStep=0);return this._transitionStep};b.prototype.isFinalStep=function(){if(!1===this._isResetting)throw Error("\u30ea\u30bb\u30c3\u30c8\u4e2d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002");
return this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW-1};b.prototype.reset=function(b){this._positionPrev=this._position;this._position=b.getDefaultCameraPosition();this._transitionStep=0;this._isResetting=!0};return b}();c.Camera=g})(wwa_camera||(wwa_camera={}));var wwa_cgmanager;
(function(c){var e=wwa_data.WWAConsts,g=function(){function b(b,e,a,u){this._isLoaded=!1;this._ctx=b;this._ctxSub=e;this._fileName=a;this._loadCompleteCallBack=u;this._load()}b.prototype._load=function(){var b=this;this._isLoaded||(this._image=new Image,this._image.addEventListener("load",function(){b._loadCompleteCallBack()}),this._image.addEventListener("error",function(){throw Error("Image Load Failed!!\nfile name:"+b._fileName);}),this._image.src=this._fileName,this._isLoaded=!0)};b.prototype.drawCanvas=
function(b,c,a,u,l){void 0===l&&(l=!1);l=l?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");l.drawImage(this._image,e.CHIP_SIZE*b,e.CHIP_SIZE*c,e.CHIP_SIZE,e.CHIP_SIZE,a,u,e.CHIP_SIZE,e.CHIP_SIZE)};b.prototype.drawCanvasWithSize=function(b,c,a,u,l,d,g){void 0===g&&(g=!1);g=g?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");g.drawImage(this._image,e.CHIP_SIZE*b,e.CHIP_SIZE*c,e.CHIP_SIZE*a,e.CHIP_SIZE*u,l,d,e.CHIP_SIZE*a,e.CHIP_SIZE*u)};b.prototype.drawCanvasWithUpperYLimit=
function(b,c,a,u,l,d){void 0===d&&(d=!1);d=d?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");l=Math.max(0,u+e.CHIP_SIZE-l);l>=e.CHIP_SIZE||d.drawImage(this._image,e.CHIP_SIZE*b,e.CHIP_SIZE*c,e.CHIP_SIZE,e.CHIP_SIZE-l,a,u,e.CHIP_SIZE,e.CHIP_SIZE)};b.prototype.drawCanvasWithLowerYLimit=function(b,c,a,u,l,d){void 0===d&&(d=!1);d=d?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");l=Math.max(0,l-u);l>=e.CHIP_SIZE||d.drawImage(this._image,e.CHIP_SIZE*
b,e.CHIP_SIZE*c+l,e.CHIP_SIZE,e.CHIP_SIZE-l,a,u+l,e.CHIP_SIZE,e.CHIP_SIZE)};b.prototype.clearCanvas=function(b,e,a,u,l){void 0===l&&(l=!1);(l?this._ctxSub:this._ctx).clearRect(b,e,a,u)};b.prototype.drawBase=function(b,e,a,u,l){void 0===l&&(l=!1);l=l?this._ctxSub:this._ctx;l.fillStyle="#9E9E9E";l.fillRect(b,e,a,u)};return b}();c.CGManager=g})(wwa_cgmanager||(wwa_cgmanager={}));var wwa_util;
(function(c){c.$id=function(e){return document.getElementById(e)};c.$class=function(e){return document.getElementsByClassName(e)};c.$tag=function(e){return document.getElementsByTagName(e)};c.$qs=function(e){return document.querySelector(e)};c.$qsh=function(e){return document.querySelector(e)};c.$qsAll=function(e){return document.querySelectorAll(e)};c.$localPos=function(e,g){var b=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,t=window.pageYOffset||document.body.scrollTop||
document.documentElement.scrollTop;e=e-c.$id("wwa-wrapper").offsetLeft+b;g=g-c.$id("wwa-wrapper").offsetTop+t;return new wwa_data.Coord(e,g)};c.$escapedURI=function(e){return e.match(/^https?:\/\//)||e.match(/^\.\.\//)?e:location.href="./"+e};c.arr2str4save=function(e){var g="";if(e instanceof Array){for(var b=0;b<e.length;b++)g+=c.arr2str4save(e[b])+"/";return g}return e+""}})(wwa_util||(wwa_util={}));var wwa_message;
(function(c){var e=function(){return function(a,b,e,d){this.message=a;this.isSystemMessage=b;this.isEndOfPartsEvent=e;this.macro=d;void 0===this.macro&&(this.macro=[])}}();c.MessageInfo=e;c.strArrayToMessageInfoArray=function(a,b){var l=[];a.forEach(function(a){l.push(new e(a,b))});return l};var g=function(){function a(a,b,d,e,c,g){this._wwa=a;this._triggerPartsID=b;this._triggerPartsType=d;this._triggerPartsPosition=e;this.macroType=c;this.macroArgs=g}a.prototype.execute=function(){try{this.macroType===
wwa_data.MacroType.IMGPLAYER?this._executeImgPlayerMacro():this.macroType===wwa_data.MacroType.IMGYESNO?this._executeImgYesNoMacro():this.macroType===wwa_data.MacroType.HPMAX?this._executeHPMaxMacro():this.macroType===wwa_data.MacroType.SAVE?this._executeSaveMacro():this.macroType===wwa_data.MacroType.ITEM?this._executeItemMacro():this.macroType===wwa_data.MacroType.DEFAULT?this._executeDefaultMacro():this.macroType===wwa_data.MacroType.OLDMAP?this._executeOldMapMacro():this.macroType===wwa_data.MacroType.PARTS?
this._executePartsMacro():this.macroType===wwa_data.MacroType.MOVE?this._executeMoveMacro():this.macroType===wwa_data.MacroType.MAP?this._executeMapMacro():this.macroType===wwa_data.MacroType.DIRMAP?this._executeDirMapMacro():this.macroType===wwa_data.MacroType.IMGFRAME?this._executeImgFrameMacro():this.macroType===wwa_data.MacroType.IMGBOM?this._executeImgBomMacro():this.macroType===wwa_data.MacroType.DELPLAYER?this._executeDelPlayerMacro():this.macroType===wwa_data.MacroType.FACE?this._executeFaceMacro():
this.macroType===wwa_data.MacroType.EFFECT?this._executeEffectMacro():this.macroType===wwa_data.MacroType.GAMEOVER?this._executeGameOverMacro():this.macroType===wwa_data.MacroType.IMGCLICK?this._executeImgClickMacro():this.macroType===wwa_data.MacroType.STATUS?this._executeStatusMacro():this.macroType===wwa_data.MacroType.COLOR?this._executeColorMacro():this.macroType===wwa_data.MacroType.WAIT?this._executeWaitMacro():this.macroType===wwa_data.MacroType.SOUND&&this._executeSoundMacro()}catch(u){}};
a.prototype._concatEmptyArgs=function(a){if(this.macroArgs.length<a){a=Array(a-this.macroArgs.length);for(var b=0;b<a.length;b++)a[b]="";this.macroArgs=this.macroArgs.concat(a)}};a.prototype._parseInt=function(a,b){void 0===b&&(b=0);a=parseInt(this.macroArgs[a]);return isNaN(a)?b:a};a.prototype._executeImgPlayerMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setPlayerImgCoord(new wwa_data.Coord(a,b))};a.prototype._executeImgYesNoMacro=function(){this._concatEmptyArgs(2);
var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setYesNoImgCoord(new wwa_data.Coord(a,b))};a.prototype._executeHPMaxMacro=function(){this._concatEmptyArgs(1);var a=Math.max(0,this._parseInt(0));this._wwa.setPlayerEnergyMax(a)};a.prototype._executeSaveMacro=function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.disableSave(a)};a.prototype._executeItemMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setPlayerGetItem(a,b)};a.prototype._executeDefaultMacro=
function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.setObjectNotCollapseOnPartsOnPlayer(a)};a.prototype._executeOldMapMacro=function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.setOldMap(a)};a.prototype._executePartsMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2,wwa_data.PartsType.OBJECT),e=this._parseInt(3);if(d!==wwa_data.PartsType.OBJECT&&d!==wwa_data.PartsType.MAP)throw Error("\u30d1\u30fc\u30c4\u7a2e\u5225\u304c\u4e0d\u660e\u3067\u3059");
0!==e&&1!==e&&(e=1);if(0>a||0>b)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(d===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum()||b>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(a>=this._wwa.getMapPartsNum()||b>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.replaceParts(a,b,d,!!e)};a.prototype._executeMoveMacro=function(){this._concatEmptyArgs(1);
var a=this._parseInt(0);this._wwa.setMoveMacroWaitingToPlayer(a)};a.prototype._executeMapMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this.macroArgs[1],d=this.macroArgs[2],e=this._parseInt(3,wwa_data.PartsType.OBJECT);if(0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(e===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
this._wwa.appearPartsEval(this._triggerPartsPosition,b,d,a,e)};a.prototype._executeDirMapMacro=function(){this._concatEmptyArgs(3);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2,wwa_data.PartsType.OBJECT);if(isNaN(a)||isNaN(b)||isNaN(d))throw Error("\u5f15\u6570\u304c\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(d===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
}else if(a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.appearPartsByDirection(b,a,d)};a.prototype._executeImgFrameMacro=function(){this._concatEmptyArgs(3);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2),e=b*wwa_data.WWAConsts.CHIP_SIZE,c=d*wwa_data.WWAConsts.CHIP_SIZE;if(0>b||0>d)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(a===wwa_data.MacroImgFrameIndex.ENERGY)wwa_util.$qsh("#disp-energy>.status-icon").style.backgroundPosition=
"-"+e+"px -"+c+"px";else if(a===wwa_data.MacroImgFrameIndex.STRENGTH)wwa_util.$qsh("#disp-strength>.status-icon").style.backgroundPosition="-"+e+"px -"+c+"px";else if(a===wwa_data.MacroImgFrameIndex.DEFENCE)wwa_util.$qsh("#disp-defence>.status-icon").style.backgroundPosition="-"+e+"px -"+c+"px";else if(a===wwa_data.MacroImgFrameIndex.GOLD)wwa_util.$qsh("#disp-gold>.status-icon").style.backgroundPosition="-"+e+"px -"+c+"px";else if(a===wwa_data.MacroImgFrameIndex.WIDE_CELL_ROW)Array.prototype.forEach.call(wwa_util.$qsAll("div.wide-cell-row"),
function(a){a.style.backgroundPosition="-"+e+"px -"+c+"px"});else if(a===wwa_data.MacroImgFrameIndex.ITEM_BG)Array.prototype.forEach.call(wwa_util.$qsAll("div.item-cell"),function(a){a.style.backgroundPosition="-"+e+"px -"+c+"px"});else if(a===wwa_data.MacroImgFrameIndex.MAIN_FRAME)this._wwa.setFrameCoord(new wwa_data.Coord(b,d));else throw Error("\u7a2e\u5225\u304c\u4e0d\u6b63\u3067\u3059\u3002");};a.prototype._executeImgBomMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);
if(0>a||0>b)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");this._wwa.setBattleEffectCoord(new wwa_data.Coord(a,b))};a.prototype._executeDelPlayerMacro=function(){this._concatEmptyArgs(1);var a=parseInt(this.macroArgs[0]);this._wwa.setDelPlayer(!!a)};a.prototype._executeFaceMacro=function(){this._concatEmptyArgs(6);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2),e=this._parseInt(3),c=this._parseInt(4),g=this._parseInt(5);if(0>
a||0>b||0>d||0>e||0>c||0>g)throw Error("\u5404\u5f15\u6570\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");a=new wwa_data.Face(new wwa_data.Coord(a,b),new wwa_data.Coord(d,e),new wwa_data.Coord(c,g));this._wwa.addFace(a)};a.prototype._executeEffectMacro=function(){this._concatEmptyArgs(1);var a=this._parseInt(0);if(0>a)throw Error("\u5f85\u3061\u6642\u9593\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");
0===a&&this._wwa.stopEffect();for(var b=[],d=1;d<this.macroArgs.length;d+=2){var e=this._parseInt(d);if(0>e)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(d+1===this.macroArgs.length)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u3067\u3001Y\u5ea7\u6a19\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");var c=this._parseInt(d+
1);if(0>c)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");b.push(new wwa_data.Coord(e,c))}this._wwa.setEffect(a,b)};a.prototype._executeGameOverMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);if(0>a||a>=this._wwa.getMapWidth()||0>b||b>=this._wwa.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");
this._wwa.setGameOverPosition(new wwa_data.Coord(a,b))};a.prototype._executeImgClickMacro=function(){this._concatEmptyArgs(2);if(1>this.macroArgs.length)throw Error("\u5f15\u6570\u304c\u5c11\u306a\u3059\u304e\u307e\u3059");var a=this._parseInt(0),b=this._parseInt(1);if(0>a||0>b)throw Error("\u5f15\u6570\u304c0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");this._wwa.setImgClick(new wwa_data.Coord(a,b))};a.prototype._executeStatusMacro=function(){this._concatEmptyArgs(2);
var a=this._parseInt(0),b=this._parseInt(1);if(0>a||4<a)throw Error("\u30b9\u30c6\u30fc\u30bf\u30b9\u7a2e\u5225\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");this._wwa.setPlayerStatus(a,b)};a.prototype._executeColorMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2),e=this._parseInt(3);if(0>a||5<a)throw Error("\u7a2e\u5225\u306f0\u304b\u30895\u307e\u3067\u3067\u3059");if(0>b||255<b||0>d||255<d||0>e||255<e)throw Error("\u8272\u304c\u7bc4\u56f2\u5916\u3067\u3059");
this._wwa.changeStyleRule(a,b,d,e)};a.prototype._executeWaitMacro=function(){throw Error("Not implemented!");};a.prototype._executeSoundMacro=function(){this._concatEmptyArgs(1);var a=parseInt(this.macroArgs[0]);this._wwa.playSound(a)};return a}();c.Macro=g;c.parseMacro=function(a,b,e,d,c){c=c.match(/^\$([a-zA-Z_][a-zA-Z0-9_]*)\=(.*)$/);if(null===c||3!==c.length)throw Error("\u30de\u30af\u30ed\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var l=wwa_data.macrotable["$"+c[1].toLowerCase()];return void 0===
l?new g(a,b,e,d,wwa_data.MacroType.UNDEFINED,c[2].split(",")):new g(a,b,e,d,l,c[2].split(",").map(function(a){return a.trim()}))};var b=function(){function a(a,b,d,e,c,g,m){this._wwa=a;this._coord=b;this._width=d;this._height=e;this._isVisible=c;this._parentElement=g;this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.borderWidth="2px";this._element.style.borderStyle="solid";a.isClassicMode()?this._element.style.borderRadius="15px":this._element.style.borderRadius=
"10px";this._element.classList.add("wwa-message-window");this._element.style.zIndex=m+"";this._element.style.left=this._coord.x+"px";this._element.style.top=this._coord.y+"px";this._element.style.width=this._width+"px";this._element.style.height=this._height+"px";this._parentElement.appendChild(this._element)}a.prototype.update=function(a){};a.prototype.show=function(){this._isVisible=!0;this._element.style.display="block";this.update()};a.prototype.hide=function(){this._isVisible=!1;this._element.style.display=
"none";this.update()};a.prototype.isVisible=function(){return this._isVisible};return a}(),t=function(a){function b(b,d,e,c,g,m,h){b=a.call(this,b,new wwa_data.Coord(d.x,d.y),e,c,g,m,201)||this;b._cgFileName=h;b._monsterBox=document.createElement("div");b._monsterBox.style.width=wwa_data.WWAConsts.CHIP_SIZE+"px";b._monsterBox.style.height=wwa_data.WWAConsts.CHIP_SIZE+"px";b._monsterBox.style.position="absolute";b._monsterBox.style.left="10px";b._monsterBox.style.top="10px";b._monsterBox.style.backgroundImage=
"url("+b._cgFileName.replace("(","\\(").replace(")","\\)")+")";b._monsterBox.style.backgroundPosition="0 0";b._element.appendChild(b._monsterBox);b._energyBox=document.createElement("div");b._energyBox.style.position="absolute";b._energyBox.style.left="80px";b._energyBox.style.top="10px";b._energyBox.textContent="\u751f\u547d\u529b 0";b._element.appendChild(b._energyBox);b._strengthBox=document.createElement("div");b._strengthBox.style.position="absolute";b._strengthBox.style.left="80px";b._strengthBox.style.top=
"30px";b._strengthBox.textContent="\u653b\u6483\u529b 0";b._element.appendChild(b._strengthBox);b._defenceBox=document.createElement("div");b._defenceBox.style.position="absolute";b._defenceBox.style.left="180px";b._defenceBox.style.top="30px";b._defenceBox.textContent="\u9632\u5fa1\u529b 0";b._element.appendChild(b._defenceBox);b._element.style.display=b._isVisible?"block":"none";return b}__extends(b,a);b.prototype.update=function(a){void 0!==a&&(this._monsterBox.style.backgroundPosition="-"+a.imgCoord.x+
"px -"+a.imgCoord.y+"px",this._energyBox.textContent="\u751f\u547d\u529b "+a.status.energy,this._strengthBox.textContent="\u653b\u6483\u529b "+a.status.strength,this._defenceBox.textContent="\u9632\u5fa1\u529b "+a.status.defence)};return b}(b);c.MosterWindow=t;b=function(a){function b(b,d,e,c){b.isClassicMode()?(b=a.call(this,b,new wwa_data.Coord(2*wwa_data.WWAConsts.CHIP_SIZE,30),7*wwa_data.WWAConsts.CHIP_SIZE,40,e,c,202)||this,b._element.style.borderWidth="0",b._element.style.borderRadius="4px",
b._element.style.fontSize="20px",b._element.style.lineHeight="40px"):b=a.call(this,b,new wwa_data.Coord(d.x,d.y),340,30,e,c,202)||this;b._element.style.textAlign="center";b._element.style.display=b._isVisible?"block":"none";b.update(0);return b}__extends(b,a);b.prototype.update=function(a){void 0!==a&&(this._element.textContent="Score: "+a)};return b}(b);c.ScoreWindow=b;var h;(function(a){a[a.TOP=0]="TOP";a[a.CENTER=1]="CENTER";a[a.BOTTOM=2]="BOTTOM";a[a.SCORE=3]="SCORE"})(h=c.Positioning||(c.Positioning=
{}));b=function(){function a(a,b,d,e,c,g,m,h,k,y){var f=this,n=m.replace("(","\\(").replace(")","\\)");this._wwa=a;this._cgFileName=m;this._x=b;this._y=d;this._width=e;this._height=c;this._message=g;this._isVisible=h;this._isYesno=k;this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.borderWidth="2px";this._element.style.borderStyle="solid";a.isClassicMode()?this._element.style.borderRadius="15px":this._element.style.borderRadius="10px";this._element.classList.add("wwa-message-window");
this._element.style.zIndex="400";this._msgWrapperElement=document.createElement("div");this._msgWrapperElement.style.textAlign="left";this._msgWrapperElement.style.wordWrap="break-word";a.isClassicMode()?this._msgWrapperElement.style.margin="8px 0 8px 16px":(this._msgWrapperElement.style.margin="0",this._msgWrapperElement.style.padding="7px");this._element.appendChild(this._msgWrapperElement);this._dummyElement=document.createElement("div");this._dummyElement.style.display="none";this._dummyElement.style.padding=
"0";this._dummyElement.style.margin="0";this._dummyElement.style.height="55px";this._element.appendChild(this._dummyElement);this._ynWrapperElement=document.createElement("div");this._ynWrapperElement.style.padding="0";this._ynWrapperElement.style.margin="0";this._ynWrapperElement.style.position="absolute";this._ynWrapperElement.style.left="246px";this._ynWrapperElement.style.bottom="10px";this._ynWrapperElement.style.width="80px";this._ynWrapperElement.style.height="40px";this._ynWrapperElement.style.zIndex=
"10";this._element.appendChild(this._ynWrapperElement);this._parentElement=y;this._parentElement.appendChild(this._element);this._divYesElement=document.createElement("div");this._divYesElement.style.padding="0";this._divYesElement.style.margin="0";this._divYesElement.style.cssFloat="left";this._divYesElement.style.width="40px";this._divYesElement.style.height="40px";this._divYesElement.style.background="url("+n+")";this._divYesElement.onclick=function(){f._isInputDisable||(a.setYesNoInput(wwa_data.YesNoState.YES),
f.update())};this._divYesElement.style.cursor="pointer";this._divNoElement=document.createElement("div");this._divNoElement.style.padding="0";this._divNoElement.style.margin="0";this._divNoElement.style.cssFloat="left";this._divNoElement.style.width="40px";this._divNoElement.style.height="40px";this._divNoElement.style.background="url("+n+")";this._divNoElement.onclick=function(){f._isInputDisable||(a.setYesNoInput(wwa_data.YesNoState.NO),f.update())};this._divNoElement.style.cursor="pointer";this._ynWrapperElement.appendChild(this._divYesElement);
this._ynWrapperElement.appendChild(this._divNoElement);f._isInputDisable=!1;this.update()}a.prototype.setPosition=function(a,b,d,e){this._x=a;this._y=b;this._width=d;this._height=e;this.update()};a.prototype.setPositionByPlayerPosition=function(a,b,d,e,g){e=e.getPartsCoord().substract(g.getPartsCoord()).y;this.setPositionEasy(a?c.Positioning.BOTTOM:b?c.Positioning.SCORE:d?c.Positioning.CENTER:e>=Math.ceil(wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW/2)?c.Positioning.TOP:c.Positioning.BOTTOM)};a.prototype.setPositionEasy=
function(a){var b=Math.floor(this._element.clientHeight/2);a===h.CENTER?(this._y=wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/2-b,this.update()):a===h.TOP?(this._y=Math.max(20,wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/4-b)+10,this.update()):a===h.BOTTOM?(this._y=Math.min(wwa_data.WWAConsts.MAP_WINDOW_HEIGHT-20-this._element.clientHeight,3*wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/4-b),this.update()):a===h.SCORE&&(this._y=80,this.update())};a.prototype.setMessage=function(a){this._message=a;this.update()};a.prototype.setYesNoChoice=
function(a){this._isInputDisable=!1;this._isYesno=a;this.update();return this._isYesno};a.prototype.isYesNoChoice=function(){return this._isYesno};a.prototype.setInputDisable=function(){this._isInputDisable=!0};a.prototype.isInputDisable=function(){return this._isInputDisable};a.prototype.show=function(){this._isVisible=!0;this.update()};a.prototype.hide=function(){this._isVisible=!1;this.update()};a.prototype.isVisible=function(){return this._isVisible};a.prototype.isWideChar=function(a){return null!==
a.match(/^[^\x01-\x7E\xA1-\xDF]+$/)};a.prototype.update=function(){var a=this,b=this._wwa.getYesNoImgCoord();this._isYesno?(this._wwa.getYesNoState()===wwa_data.YesNoState.YES?(this._divYesElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YESP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+
"px"):this._wwa.getYesNoState()===wwa_data.YesNoState.NO?(this._divYesElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NOP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):(this._divYesElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+
"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px"),this._ynWrapperElement.style.display="block"):this._ynWrapperElement.style.display="none";this._msgWrapperElement.textContent="";var d=this._message.split("\n");d.forEach(function(b,e){b=document.createElement("span");if(a._wwa.isClassicMode())for(var c=0,g="",h=0;h<d[e].length||0!=c;h++){if(c=
a.isWideChar(d[e].charAt(h))?c+2:c+1,g+=d[e].charAt(h),c+1>2*wwa_data.WWAConsts.MSG_STR_WIDTH){if("\u3002"===d[e].charAt(h+1)||"\u3001"===d[e].charAt(h+1))g+=d[e].charAt(h+1),h++;c=document.createElement("span");c.style.display="inline-block";c.style.width="100%";c.textContent=g;b.appendChild(c);c=0;g=""}}else b.textContent=d[e];a._msgWrapperElement.appendChild(b);a._msgWrapperElement.appendChild(document.createElement("br"))});this._isVisible?(this._element.style.left=this._x+"px",this._element.style.top=
this._y+"px"):(this._element.style.left="-999999px",this._element.style.top="-999999px");this._element.style.width=this._width+"px";this._element.style.minHeight=this._height+"px";this._dummyElement.style.display=this._isYesno?"block":"none"};return a}();c.MessageWindow=b})(wwa_message||(wwa_message={}));var wwa_monster;
(function(c){var e=function(){function e(b,e,c,a,g,l,d){this._partsID=b;this._position=e;this._imgCoord=c;this._status=a;this._message=g;this._item=l;this._battleEndCallback=d}Object.defineProperty(e.prototype,"partsID",{get:function(){return this._partsID},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"imgCoord",{get:function(){return this._imgCoord},enumerable:!0,
configurable:!0});Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"item",{get:function(){return this._item},enumerable:!0,configurable:!0});e.prototype.damage=function(b){this._status.energy=Math.max(0,this._status.energy-b)};e.prototype.battleEndProcess=function(){this._battleEndCallback()};
return e}();c.Monster=e})(wwa_monster||(wwa_monster={}));var wwa_motion;
(function(c){var e=function(){function b(b,e,a,c,g){this._player=b;this._objectID=e;this._srcPos=a;this._destPos=c;this._dir=g;this._currentPos=this._srcPos.clone()}b.prototype.update=function(){var b=this._player.getSpeedIndex();return this._currentPos=this._currentPos.getNextFramePosition(this._dir,wwa_data.speedList[b],wwa_data.speedList[b])};Object.defineProperty(b.prototype,"isAchievedDestination",{get:function(){return this._currentPos.equals(this._destPos)},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"currentPosition",{get:function(){return this._currentPos},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"beforePosition",{get:function(){return this._srcPos},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"destination",{get:function(){return this._destPos},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objID",{get:function(){return this._objectID},enumerable:!0,configurable:!0});return b}();c.ObjectMovingData=
e;var g=function(){function b(b,e){this._wwa=b;this._player=e;this.clear()}b.prototype.add=function(b,c,a,g){this._queue.push(new e(this._player,b,c,a,g))};b.prototype.update=function(){for(var b=[],e=[],a=0;a<this._queue.length;a++)this._queue[a].update(),this._queue[a].isAchievedDestination?(b.push(this._queue[a]),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,0,this._queue[a].beforePosition.getPartsCoord()),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._queue[a].objID,this._queue[a].destination.getPartsCoord())):
e.push(this._queue[a]);this._queue=e;return b};b.prototype.clear=function(){this._queue=[]};Object.defineProperty(b.prototype,"objectMovingData",{get:function(){return this.objectMovingData},enumerable:!0,configurable:!0});b.prototype.getOffsetByBeforePartsCoord=function(b){var e=this._queue.filter(function(a){return a.beforePosition.getPartsCoord().equals(b)});return 0===e.length?null:e[0].currentPosition.getOffsetCoord()};return b}();c.ObjectMovingDataManager=g})(wwa_motion||(wwa_motion={}));var wwa_estimate_battle;
(function(c){var e=function(){function b(b,a,e){this.id=b;this.imgFileName=a;this.parent=e;this.elem=document.createElement("div");this.elem.classList.add("est");this.elem.setAttribute("id","wwa-est-"+b);this.imgElem=document.createElement("div");this.imgElem.classList.add("est-img-wrapper");this.imgElem.style.backgroundImage="url("+this.imgFileName.replace("(","\\(").replace(")","\\)")+")";this.statusElem=document.createElement("div");this.statusElem.classList.add("est-status-wrapper");this.energyElem=
document.createElement("div");this.energyElem.classList.add("est-energy");this.energyDispElem=document.createElement("span");this.energyDispElem.classList.add("est-energy-disp");this.energyElem.appendChild(this.energyDispElem);this.statusElem.appendChild(this.energyElem);this.strengthElem=document.createElement("div");this.strengthElem.classList.add("est-strength");this.strengthDispElem=document.createElement("span");this.strengthDispElem.classList.add("est-strength-disp");this.strengthElem.appendChild(this.strengthDispElem);
this.statusElem.appendChild(this.strengthElem);this.defenceElem=document.createElement("div");this.defenceElem.classList.add("est-defence");this.defenceDispElem=document.createElement("span");this.defenceDispElem.classList.add("est-defence-disp");this.defenceElem.appendChild(this.defenceDispElem);this.statusElem.appendChild(this.defenceElem);this.damageElem=document.createElement("div");this.damageElem.classList.add("est-damage");this.damageDispElem=document.createElement("span");this.damageDispElem.classList.add("est-damage-disp");
this.damageElem.appendChild(this.damageDispElem);this.statusElem.appendChild(this.damageElem);this.elem.appendChild(this.imgElem);this.elem.appendChild(this.statusElem)}b.prototype.hide=function(){this.elem.style.display="none"};b.prototype.show=function(){this.elem.style.display="block"};b.prototype.setResult=function(b,a,e){this.imgElem.style.backgroundPosition="-"+b.x+"px -"+b.y+"px";this.energyDispElem.textContent="\u751f\u547d\u529b "+a.energy;this.strengthDispElem.textContent="\u653b\u6483\u529b "+
a.strength;this.defenceDispElem.textContent="\u9632\u5fa1\u529b "+a.defence;this.damageDispElem.textContent=e.isNoEffect?"\u653b\u6483\u7121\u52b9":e.isOverMaxTurn?"\u9577\u671f\u6226\u304c\u4e88\u60f3\u3055\u308c\u307e\u3059":"\u4e88\u6e2c\u30c0\u30e1\u30fc\u30b8 "+e.damage};return b}(),g=function(){function c(b,a,c){var g=this;this._wwa=b;this._imgFileName=a;this._parent=c;this._element=document.createElement("div");this._element.setAttribute("id","wwa-battle-estimate");this._element.style.display=
"none";this._edes=[];for(a=0;a<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;a++)b=new e(a,this._imgFileName,this._element),this._edes.push(b),this._element.appendChild(b.elem);this._element.addEventListener("click",function(){g._wwa.hideBattleEstimateWindow()});this._parent.appendChild(this._element)}c.prototype.update=function(e,a){for(var c=0;c<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;c++)if(c>=a.length)this._edes[c].hide();else{var g=this._wwa.getObjectAttributeById(a[c],wwa_data.WWAConsts.ATR_X),
d=this._wwa.getObjectAttributeById(a[c],wwa_data.WWAConsts.ATR_Y);g=new wwa_data.Coord(g,d);d=this._wwa.getObjectAttributeById(a[c],wwa_data.WWAConsts.ATR_ENERGY);var h=this._wwa.getObjectAttributeById(a[c],wwa_data.WWAConsts.ATR_STRENGTH),t=this._wwa.getObjectAttributeById(a[c],wwa_data.WWAConsts.ATR_DEFENCE);d=new wwa_data.Status(d,h,t,0);a:{h=d.energy;t=e.strength-d.defence;var w=Math.max(0,d.strength-e.defence),m=0,B=0;if(0<t)for(;;){m++;h-=t;if(0>=h){h=new b(!1,!1,B);break a}B+=w;if(1E4<m){h=
new b(!1,!0,0);break a}}else h=new b(!0,!1,0)}this._edes[c].setResult(g,d,h);this._edes[c].show()}};c.prototype.show=function(){this._element.style.display="block"};c.prototype.hide=function(){this._element.style.display="none"};return c}();c.BattleEstimateWindow=g;var b=function(){return function(b,e,a){this.isNoEffect=b;this.isOverMaxTurn=e;this.damage=a}}()})(wwa_estimate_battle||(wwa_estimate_battle={}));var wwa_inject_html;
(function(c){c.inject=function(e,c){var b=document.createElement("style");b.type="text/css";b.setAttribute("id",wwa_data.WWAConsts.WWA_STYLE_TAG_ID);wwa_util.$tag("head")[0].appendChild(b);null===c?(e.innerHTML='            <canvas id="wwa-map" class="wwa-canvas" width="440" height="440">                \u3053\u306e\u30d6\u30e9\u30a6\u30b6\u306f\u3001Canvas\u8981\u7d20\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002            </canvas>            <canvas id="wwa-map-sub" class="wwa-canvas" width="440" height="440"></canvas>            <div id="wwa-sidebar">                <div class="wide-cell-row" id="disp-energy"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-strength"><div class="status-icon"></div><div class="status-value-box"> 0 </div></div>                <div class="wide-cell-row" id="disp-defence"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-gold"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="item-cell" id="item0"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item1"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item2"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item3"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item4"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item5"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item6"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item7"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item8"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item9"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item10"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item11"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="wide-cell-row" id="cell-load">Password</div><div class="wide-button" id="button-load"></div>                <div class="wide-cell-row" id="cell-save">Quick Save</div><div class="wide-button" id="button-save"></div>                <div class="wide-cell-row" id="cell-restart">Restart Game</div><div class="wide-button" id="button-restart"></div>                <div class="wide-cell-row" id="cell-gotowwa">Goto WWA</div><div class="wide-button" id="button-gotowwa"></div>            </div>            <div id="wwa-controller"></div>            <div id="wwa-fader"></div>            <div id="wwa-cover"></div>            <div id="wwa-audio-wrapper"></div>    ',
c=document.createElement("canvas"),c.height=wwa_data.WWAConsts.SCREEN_HEIGHT,c.width=wwa_data.WWAConsts.SCREEN_WIDTH,c.id="progress-panel",wwa_util.$id("wwa-cover").appendChild(c)):(e.innerHTML='            <canvas id="wwa-map" class="wwa-canvas" width="440" height="440">                \u3053\u306e\u30d6\u30e9\u30a6\u30b6\u306f\u3001Canvas\u8981\u7d20\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002            </canvas>            <canvas id="wwa-map-sub" class="wwa-canvas" width="440" height="440"></canvas>            <div id="wwa-sidebar">                <div class="wide-cell-row" id="disp-energy"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-strength"><div class="status-icon"></div><div class="status-value-box"> 0 </div></div>                <div class="wide-cell-row" id="disp-defence"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-gold"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="item-cell" id="item0"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item1"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item2"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item3"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item4"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item5"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item6"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item7"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item8"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item9"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item10"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item11"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="wide-cell-row" id="cell-load">Password</div><div class="wide-button" id="button-load"></div>                <div class="wide-cell-row" id="cell-save">Quick Save</div><div class="wide-button" id="button-save"></div>                <div class="wide-cell-row" id="cell-restart">Restart Game</div><div class="wide-button" id="button-restart"></div>                <div class="wide-cell-row" id="cell-gotowwa">Goto WWA</div><div class="wide-button" id="button-gotowwa"></div>            </div>            <div id="wwa-controller"></div>            <div id="wwa-fader"></div>            <div id="wwa-cover">                 <div id="version"></div>                 <div id="progress-message-container">\u958b\u59cb\u3057\u3066\u3044\u307e\u3059...</div>                 <div id="progress-bar-bg"></div>                 <div id="progress-bar" class="progress-bar"></div>                 <div id="progress-bar-audio" class="progress-bar"></div>                 <div id="progress-disp">---</div>            </div>            <div id="wwa-audio-wrapper"></div>    ',
e=document.createElement("img"),e.src=c,wwa_util.$id("wwa-cover").appendChild(e))}})(wwa_inject_html||(wwa_inject_html={}));var wwa_psave;(function(c){var e;c.getPressData=function(){return e};c.createSavePassword=function(c){if(void 0===e||null===e)e=new Uint8Array(c.mapWidth*c.mapWidth*4);return""}})(wwa_psave||(wwa_psave={}));var wwa_password_window;
(function(c){var e;(function(b){b[b.SAVE=0]="SAVE";b[b.LOAD=1]="LOAD"})(e=c.Mode||(c.Mode={}));var g=function(){function b(b,c){var a=this;this._wwa=b;this._parent=c;this._element=document.createElement("div");this._element.setAttribute("id","wwa-password-window");this._element.style.display="none";this._descriptionElement=document.createElement("div");this._descriptionElement.classList.add("wwa-password-description");this._passwordBoxElement=document.createElement("textarea");this._passwordBoxElement.setAttribute("cols",
"50");this._passwordBoxElement.setAttribute("rows","16");this._passwordBoxElement.addEventListener("focus",function(b){a._passwordBoxElement.select()});this._buttonWrapperElement=document.createElement("div");this._okButtonElement=document.createElement("button");this._okButtonElement.textContent="OK";this._okButtonElement.addEventListener("click",function(){a._wwa.hidePasswordWindow()});this._cancelButtonElement=document.createElement("button");this._cancelButtonElement.textContent="\u30ad\u30e3\u30f3\u30bb\u30eb";
this._cancelButtonElement.addEventListener("click",function(){a._wwa.hidePasswordWindow(!0)});this._buttonWrapperElement.appendChild(this._okButtonElement);this._buttonWrapperElement.appendChild(this._cancelButtonElement);this._mode=e.LOAD;this._element.appendChild(this._descriptionElement);this._element.appendChild(this._passwordBoxElement);this._element.appendChild(this._buttonWrapperElement);this._parent.appendChild(this._element);this.update()}Object.defineProperty(b.prototype,"mode",{get:function(){return this._mode},
set:function(b){this._mode=b;b===e.LOAD&&(this.password="")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"password",{get:function(){return this._passwordBoxElement.value},set:function(b){this._passwordBoxElement.value=b},enumerable:!0,configurable:!0});b.prototype.show=function(b){void 0!==b&&(this.mode=b);this._isVisible=!0;this.update()};b.prototype.hide=function(){this._isVisible=!1;this.update()};b.prototype.update=function(){if(this._mode===e.LOAD){var b="\u4e0b\u306e\u30dc\u30c3\u30af\u30b9\u306b\u524d\u56de\u306e\u30d7\u30ec\u30a4\u3067\u53d6\u5f97\u3057\u305f\n\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u30c6\u30ad\u30b9\u30c8\u306f\u3001Ctrl+C\u3067\u30b3\u30d4\u30fc\u3001Ctrl+V\u3067\u8cbc\u308a\u4ed8\u3051\u3067\u304d\u307e\u3059\u3002\n\u73fe\u5728\u3001Java\u7248WWA\u3067\u53d6\u5f97\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002\n\u4f5c\u6210\u8005\u304c\u30de\u30c3\u30d7\u306e\u5185\u5bb9\u3092\u5909\u66f4\u3057\u305f\u5834\u5408\u306f\n\u305d\u308c\u4ee5\u524d\u306b\u53d6\u5f97\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u4f7f\u3048\u306a\u304f\u306a\u308a\u307e\u3059\u3002";
try{this._passwordBoxElement.removeAttribute("readonly")}catch(u){}this._cancelButtonElement.style.display="inline"}else b="\u4e0b\u8a18\u30c6\u30ad\u30b9\u30c8\u304c\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30d4\u30fc\u3057\u3066\u30e1\u30e2\u5e33\u306a\u3069\u306e\u30c6\u30ad\u30b9\u30c8\u30a8\u30c7\u30a3\u30bf\u306b\u8cbc\u308a\u4ed8\u3051\u3066\n\u4fdd\u5b58\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30dc\u30c3\u30af\u30b9\u3092\u30af\u30ea\u30c3\u30af\u3067\u5168\u4f53\u3092\u9078\u629e\u3001\n\u300cCtrl+C\u300d\u3067\u30b3\u30d4\u30fc\u3001\u300cCtrl+V\u300d\u3067\u8cbc\u308a\u4ed8\u3051\u3067\u304d\u307e\u3059\u3002\n\u901a\u5e38\u6570\u4e07\u6587\u5b57\u7a0b\u5ea6\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002",
this._passwordBoxElement.setAttribute("readonly","readonly"),this._cancelButtonElement.style.display="none";b=b.split("\n");this._descriptionElement.textContent="";for(var c=0;c<b.length;c++){var a=document.createElement("span");a.textContent=b[c];this._descriptionElement.appendChild(a);this._descriptionElement.appendChild(document.createElement("br"))}this._element.style.display=this._isVisible?"block":"none"};return b}();c.PasswordWindow=g})(wwa_password_window||(wwa_password_window={}));
var postMessage_noWorker=function(c){},wwa_main;
(function(c){function e(a,b,d){var f=new wwa_data.LoaderProgress;f.current=a;f.total=b;f.stage=d;return f}function g(){void 0===window.wwap_mode&&(wwap_mode=!1);Array.prototype.forEach.call(m.$qsAll("a.wwa-copyright"),function(a){a.addEventListener("click",function(){k=!0})});window.addEventListener("beforeunload",function(a){if(k)return k=!1,a.returnValue="\u3053\u306e\u30da\u30fc\u30b8\u3092\u96e2\u308c\u307e\u3059\u304b\uff1f"});var a=wwap_mode?null:m.$id("wwa-wrapper").getAttribute("data-wwa-title-img");
wwa_inject_html.inject(m.$id("wwa-wrapper"),a);var b=m.$id("wwa-wrapper").getAttribute("data-wwa-mapdata"),d=m.$id("wwa-wrapper").getAttribute("data-wwa-loader"),v=m.$id("wwa-wrapper").getAttribute("data-wwa-audio-dir"),e=!0;m.$id("wwa-wrapper").getAttribute("data-wwa-urlgate-enable").match(/^false$/i)&&(e=!1);var c=m.$id("wwa-wrapper").getAttribute("data-wwa-classic-mode-enable"),g=!1;null!==c&&c.match(/^true$/i)&&(g=!0);new B(b,d,e,a,g,v)}var b=wwa_input.KeyCode,t=wwa_input.KeyState,h=wwa_input.KeyStore,
a=wwa_input.MouseState,u=wwa_input.MouseStore,l=wwa_cgmanager.CGManager,d=wwa_data.WWAConsts,x=wwa_data.Coord,A=wwa_data.Position,w=wwa_camera.Camera,m=wwa_util;c.getProgress=e;var B=function(){function c(a,n,c,z,g,k){void 0===c&&(c=!1);void 0===k&&(k="");var f=this;if(null===z){this._hasTitleImg=!1;this._cvsCover=m.$id("progress-panel");var v=this._cvsCover.getContext("2d");v.fillStyle="rgb(0, 0, 0)"}else this._hasTitleImg=!0;try{this._hasTitleImg?m.$id("version").textContent="WWA Wing Ver."+d.VERSION_WWAJS:
this._setLoadingMessage(v,0)}catch(D){}this._isURLGateEnable=c;this._isClassicModeEnable=g;this._animationCounter=this._mainCallCounter=0;this._statusPressCounter=new wwa_data.Status(0,0,0,0);k?"/"!==k[k.length-1]&&(k+="/"):k="./audio/";this._audioDirectory=k;var C=(new Date).getTime();location.href.match(/^file/)&&alert("\u3010\u8b66\u544a\u3011\u76f4\u63a5HTML\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u78ba\u8a8d\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u540c\u68b1\u306e\u300cWWA Debugger\u300d\u3092\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002");
if(void 0===window.audiojs)this._setErrorMessage("Audio.js\u306e\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n\u30d5\u30a9\u30eb\u30c0"+this._audioDirectory+"\u306e\u4e2d\u306baudio.min.js\u306f\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3059\u304b\uff1f \n\u30d5\u30a9\u30eb\u30c0\u3092\u5909\u66f4\u3055\u308c\u308b\u5834\u5408\u306b\u306f data-wwa-audio-dir \u5c5e\u6027\u3092\n\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044",v);else if(this._loadHandler=function(a){if(null!==
a.data.error&&void 0!==a.data.error)f._setErrorMessage("\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002: \n"+a.data.error.message,v);else if(null!==a.data.progress&&void 0!==a.data.progress)f._setProgressBar(a.data.progress);else{f._wwaData=a.data.wwaData;try{f._hasTitleImg?m.$id("version").textContent+=" (Map data Ver. "+Math.floor(f._wwaData.version/10)+"."+ +f._wwaData.version%10+")":f._setLoadingMessage(v,1)}catch(K){}f.initCSSRule();f._setProgressBar(e(0,
4,wwa_data.LoadStage.GAME_INIT));f._setLoadingMessage(v,2);a=new Image;a.src=f._wwaData.mapCGName;a.addEventListener("error",function(){f._setErrorMessage("\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u300c"+f._wwaData.mapCGName+"\u300d\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u7ba1\u7406\u8005\u306e\u65b9\u3078: \u30c7\u30fc\u30bf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u304b\u3001\n\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002",
v)});f._restartData=JSON.parse(JSON.stringify(f._wwaData));var n=f._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(m.$qsAll("div.item-cell"),function(a){a.style.backgroundPosition="-40px -80px";a.style.backgroundImage="url("+n+")"});Array.prototype.forEach.call(m.$qsAll("div.wide-cell-row"),function(a){a.style.backgroundPosition="-160px -120px";a.style.backgroundImage="url("+n+")"});Array.prototype.forEach.call(m.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage=
"url('"+d.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0";a.style.display="none";a.style.cursor="pointer"});Array.prototype.forEach.call(m.$qsAll(".item-cell>.item-disp"),function(a){a.style.backgroundImage="url("+n+")"});a=m.$qsh("#disp-energy>.status-icon");a.style.backgroundPosition="-120px -80px";a.style.backgroundImage="url("+n+")";a=m.$qsh("#disp-strength>.status-icon");a.style.backgroundPosition="-160px -80px";a.style.backgroundImage="url("+n+")";a=m.$qsh("#disp-defence>.status-icon");
a.style.backgroundPosition="-200px -80px";a.style.backgroundImage="url("+n+")";a=m.$qsh("#disp-gold>.status-icon");a.style.backgroundPosition="-240px -80px";a.style.backgroundImage="url("+n+")";f._setProgressBar(e(1,4,wwa_data.LoadStage.GAME_INIT));f._setLoadingMessage(v,3);f._replaceAllRandomObjects();a=(new Date).getTime();console.log("Loading Complete!"+(a-C)+"ms");f._cvs=m.$id("wwa-map");f._cvsSub=m.$id("wwa-map-sub");a=f._cvs.getContext("2d");var c=f._cvsSub.getContext("2d");a.fillStyle="rgba( 255, 255, 255, 0.5)";
a.fillRect(0,0,440,440);var z=new A(f,f._wwaData.playerX,f._wwaData.playerY);f._camera=new w(z);var g=new wwa_data.Status(f._wwaData.statusEnergy,f._wwaData.statusStrength,f._wwaData.statusDefence,f._wwaData.statusGold);f._player=new wwa_parts_player.Player(f,z,f._camera,g,f._wwaData.statusEnergyMax);f._objectMovingDataManager=new wwa_motion.ObjectMovingDataManager(f,f._player);f._camera.setPlayer(f._player);f._keyStore=new h;f._mouseStore=new u;f._messageQueue=[];f._yesNoJudge=wwa_data.YesNoState.UNSELECTED;
f._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;f._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;f._prevFrameEventExected=!1;f._lastMessage=new wwa_message.MessageInfo("",!1,!1,[]);f._execMacroListInNextFrame=[];f._passwordLoadExecInNextFrame=!1;f._setProgressBar(e(2,4,wwa_data.LoadStage.GAME_INIT));f._setLoadingMessage(v,4);window.addEventListener("keydown",function(a){f._keyStore.setPressInfo(a.keyCode);a.keyCode===b.KEY_F5?a.preventDefault():f._player.isWaitingMessage()?a.keyCode!==
b.KEY_DOWN&&a.keyCode!==b.KEY_LEFT&&a.keyCode!==b.KEY_RIGHT&&a.keyCode!==b.KEY_UP&&a.keyCode!==b.KEY_SHIFT&&a.keyCode!==b.KEY_ENTER&&a.keyCode!==b.KEY_ESC&&a.keyCode!==b.KEY_SPACE||a.preventDefault():f._player.isWaitingPasswordWindow()||(a.keyCode===b.KEY_DOWN||a.keyCode===b.KEY_LEFT||a.keyCode===b.KEY_RIGHT||a.keyCode===b.KEY_UP||a.keyCode===b.KEY_SHIFT||a.keyCode===b.KEY_ENTER||a.keyCode===b.KEY_1||a.keyCode===b.KEY_2||a.keyCode===b.KEY_3||a.keyCode===b.KEY_A||a.keyCode===b.KEY_C||a.keyCode===b.KEY_D||
a.keyCode===b.KEY_E||a.keyCode===b.KEY_M||a.keyCode===b.KEY_N||a.keyCode===b.KEY_Q||a.keyCode===b.KEY_S||a.keyCode===b.KEY_W||a.keyCode===b.KEY_X||a.keyCode===b.KEY_Y||a.keyCode===b.KEY_Z||a.keyCode===b.KEY_ESC||a.keyCode===b.KEY_F1||a.keyCode===b.KEY_F2||a.keyCode===b.KEY_F3||a.keyCode===b.KEY_F4||a.keyCode===b.KEY_F6||a.keyCode===b.KEY_F7||a.keyCode===b.KEY_F8||a.keyCode===b.KEY_F12||a.keyCode===b.KEY_SPACE)&&a.preventDefault()});window.addEventListener("keyup",function(a){f._keyStore.setReleaseInfo(a.keyCode);
if(a.keyCode===b.KEY_F5)a.preventDefault();else if(a.keyCode===b.KEY_DOWN||a.keyCode===b.KEY_LEFT||a.keyCode===b.KEY_RIGHT||a.keyCode===b.KEY_UP||a.keyCode===b.KEY_SHIFT||a.keyCode===b.KEY_ENTER||a.keyCode===b.KEY_1||a.keyCode===b.KEY_2||a.keyCode===b.KEY_3||a.keyCode===b.KEY_A||a.keyCode===b.KEY_C||a.keyCode===b.KEY_D||a.keyCode===b.KEY_E||a.keyCode===b.KEY_M||a.keyCode===b.KEY_N||a.keyCode===b.KEY_Q||a.keyCode===b.KEY_S||a.keyCode===b.KEY_W||a.keyCode===b.KEY_X||a.keyCode===b.KEY_Y||a.keyCode===
b.KEY_Z||a.keyCode===b.KEY_ESC||a.keyCode===b.KEY_F1||a.keyCode===b.KEY_F3||a.keyCode===b.KEY_F4||a.keyCode===b.KEY_F6||a.keyCode===b.KEY_F7||a.keyCode===b.KEY_F8||a.keyCode===b.KEY_F12||a.keyCode===b.KEY_SPACE)f._player.isWaitingMessage()||f._player.isWaitingPasswordWindow()||a.preventDefault()});window.addEventListener("blur",function(a){f._keyStore.allClear();f._mouseStore.clear()});window.addEventListener("contextmenu",function(a){f._keyStore.allClear();f._mouseStore.clear()});window.addEventListener("help",
function(a){a.preventDefault()});f._wwaWrapperElement=wwa_util.$id("wwa-wrapper");f._mouseControllerElement=wwa_util.$id("wwa-controller");f._mouseControllerElement.addEventListener("mousedown",function(a){if(1===a.which){if(f._mouseStore.getMouseState()===wwa_input.MouseState.NONE){var b=wwa_util.$localPos(a.clientX,a.clientY),d=f._player.getDrawingCenterPosition();b=b.substract(d);d=Math.abs(b.x);var n=Math.abs(b.y);if(0<b.y&&n>d)var c=wwa_data.Direction.DOWN;else 0>b.y&&n>d?c=wwa_data.Direction.UP:
0<b.x&&n<d?c=wwa_data.Direction.RIGHT:0>b.x&&n<d&&(c=wwa_data.Direction.LEFT);f._mouseStore.setPressInfo(c)}a.preventDefault()}});f._mouseControllerElement.addEventListener("mouseleave",function(a){f._mouseStore.clear()});f._mouseControllerElement.addEventListener("mouseup",function(a){1===a.which&&(f._mouseStore.setReleaseInfo(),a.preventDefault())});window.TouchEvent&&(f._mouseControllerElement.addEventListener("touchstart",function(a){if(f._mouseStore.getMouseState()!==wwa_input.MouseState.NONE)a.preventDefault();
else{var b=wwa_util.$localPos(a.changedTouches[0].clientX,a.changedTouches[0].clientY),d=f._player.getDrawingCenterPosition();b=b.substract(d);d=Math.abs(b.x);var n=Math.abs(b.y);if(0<b.y&&n>d)var c=wwa_data.Direction.DOWN;else 0>b.y&&n>d?c=wwa_data.Direction.UP:0<b.x&&n<d?c=wwa_data.Direction.RIGHT:0>b.x&&n<d&&(c=wwa_data.Direction.LEFT);f._mouseStore.setPressInfo(c,a.changedTouches[0].identifier);a.cancelable&&a.preventDefault()}}),f._mouseControllerElement.addEventListener("touchend",function(a){for(var b=
0;b<a.changedTouches.length;b++)if(f._mouseStore.getTouchID()===a.changedTouches[b].identifier){f._mouseStore.setReleaseInfo();a.preventDefault();break}}),f._mouseControllerElement.addEventListener("touchcancel",function(a){for(var b=0;b<a.changedTouches.length;b++)if(f._mouseStore.getTouchID()===a.changedTouches[b].identifier){f._mouseStore.setReleaseInfo();a.preventDefault();break}}));m.$id("button-load").addEventListener("click",function(){if(f._player.isControllable())f.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD)});
m.$id("button-save").addEventListener("click",function(){if(f._player.isControllable())f.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE)});m.$id("button-restart").addEventListener("click",function(){if(f._player.isControllable())f.onselectbutton(wwa_data.SidebarButton.RESTART_GAME)});m.$id("button-gotowwa").addEventListener("click",function(){if(f._player.isControllable())f.onselectbutton(wwa_data.SidebarButton.GOTO_WWA)});Array.prototype.forEach.call(m.$qsAll(".wide-cell-row"),function(a){a.addEventListener("click",
function(){f._displayHelp()})});f._frameCoord=new x(d.IMGPOS_DEFAULT_FRAME_X,d.IMGPOS_DEFAULT_YESNO_Y);f._battleEffectCoord=new x(d.IMGPOS_DEFAULT_BATTLE_EFFECT_X,d.IMGPOS_DEFAULT_BATTLE_EFFECT_Y);f._battleEstimateWindow=new wwa_estimate_battle.BattleEstimateWindow(f,f._wwaData.mapCGName,wwa_util.$id("wwa-wrapper"));f._passwordWindow=new wwa_password_window.PasswordWindow(f,wwa_util.$id("wwa-wrapper"));f._messageWindow=new wwa_message.MessageWindow(f,50,180,340,0,"",f._wwaData.mapCGName,!1,!0,m.$id("wwa-wrapper"));
f._monsterWindow=new wwa_message.MosterWindow(f,new x(50,180),340,60,!1,m.$id("wwa-wrapper"),f._wwaData.mapCGName);f._scoreWindow=new wwa_message.ScoreWindow(f,new x(50,50),!1,m.$id("wwa-wrapper"));f._setProgressBar(e(3,4,wwa_data.LoadStage.GAME_INIT));f._isLoadedSound=!1;f._temporaryInputDisable=!1;f._paintSkipByDoorOpen=!1;f._clearFacesInNextFrame=!1;f._useConsole=!1;f.clearFaces();f._cgManager=new l(a,c,f._wwaData.mapCGName,function(){f._isSkippedSoundMessage=!0;if("ON"===f._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])f._isLoadedSound=
!0,f.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u203biOS, Android\u7aef\u672b\u3067\u306f\u3001\u97f3\u697d\u306f\u518d\u751f\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002",!1,!0),f._setLoadingMessage(v,wwa_data.LoadStage.AUDIO),f.loadSound(),setTimeout(f.soundCheckCaller,d.DEFAULT_FRAME_INTERVAL,f);else if("OFF"===f._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])f._isLoadedSound=
!1,f.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002",!1,!0),f.openGameWindow();else{f._isSkippedSoundMessage=!1;f._hasTitleImg||v.clearRect(0,0,d.SCREEN_WIDTH,d.SCREEN_HEIGHT);f._messageWindow.setMessage((""===f._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE]?"\u52b9\u679c\u97f3\u30fb\uff22\uff27\uff2d\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u304b\uff1f":
f._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])+"\n\u203biOS, Android\u7aef\u672b\u3067\u306f\u3001\u9078\u629e\u306b\u95a2\u308f\u3089\u305a\u97f3\u697d\u304c\u518d\u751f\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002");f._messageWindow.show();f._setProgressBar(e(4,4,wwa_data.LoadStage.GAME_INIT));var a=setInterval(function(){f._keyStore.update();if(f._yesNoJudgeInNextFrame===wwa_data.YesNoState.UNSELECTED)if(f._keyStore.getKeyState(b.KEY_ENTER)===t.KEYDOWN||f._keyStore.getKeyState(b.KEY_Y)===
t.KEYDOWN)f._yesNoJudgeInNextFrame=wwa_data.YesNoState.YES;else if(f._keyStore.getKeyState(b.KEY_N)===t.KEYDOWN||f._keyStore.getKeyState(b.KEY_ESC)===t.KEYDOWN)f._yesNoJudgeInNextFrame=wwa_data.YesNoState.NO;f._yesNoJudgeInNextFrame===wwa_data.YesNoState.YES?(clearInterval(a),f._messageWindow.update(),f._yesNoJudge=f._yesNoJudgeInNextFrame,f._messageWindow.setInputDisable(),setTimeout(function(){f._messageWindow.update();setTimeout(function(){f._messageWindow.hide();f._yesNoJudge=wwa_data.YesNoState.UNSELECTED;
f._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;f._isLoadedSound=!0;f._setLoadingMessage(v,wwa_data.LoadStage.AUDIO);f.loadSound();setTimeout(f.soundCheckCaller,d.DEFAULT_FRAME_INTERVAL,f)},d.YESNO_PRESS_DISP_FRAME_NUM*d.DEFAULT_FRAME_INTERVAL)},d.DEFAULT_FRAME_INTERVAL)):f._yesNoJudgeInNextFrame===wwa_data.YesNoState.NO&&(clearInterval(a),f._messageWindow.update(),f._yesNoJudge=f._yesNoJudgeInNextFrame,f._messageWindow.setInputDisable(),setTimeout(function(){f._messageWindow.update();setTimeout(function(){f._messageWindow.hide();
f._yesNoJudge=wwa_data.YesNoState.UNSELECTED;f._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;f._isLoadedSound=!1;f.openGameWindow()},d.YESNO_PRESS_DISP_FRAME_NUM*d.DEFAULT_FRAME_INTERVAL)},d.DEFAULT_FRAME_INTERVAL))},d.DEFAULT_FRAME_INTERVAL)}})}},wwap_mode||void 0===Worker){if(external_script_inject_mode){if(n=document.getElementById("wwaloader-ex"),!(n.src.match(/^http:\/\/wwawing\.com/)||n.src.match(/^http:\/\/www\.wwawing\.com/)||n.src.match(/^https:\/\/wwaphoenix\.github\.io/)||n.src.match(/^https:\/\/www\.wwaphoenix\.github\.io/)))throw Error("SCRIPT ORIGIN ERROR");
}else n=document.createElement("script"),n.src=wwap_mode?d.WWAP_SERVER+"/"+d.WWAP_SERVER_LOADER_NO_WORKER:"wwaload.noworker.js",document.getElementsByTagName("head")[0].appendChild(n);var y=this;postMessage_noWorker=function(a){y._loadHandler(a)};try{loader_start({data:{fileName:a+"?date="+C}})}catch(D){n.onload=function(){loader_start({data:{fileName:a+"?date="+C}})}}}else try{var B=new Worker(n+"?date="+C);B.postMessage({fileName:a+"?date="+C});B.addEventListener("message",this._loadHandler)}catch(D){alert("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u30ed\u30fc\u30c9\u6642\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002:\nWebWorker\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"+
D.message)}}c.prototype._setProgressBar=function(a){this._hasTitleImg&&(a.stage<=d.LOAD_STAGE_MAX_EXCEPT_AUDIO?(wwa_util.$id("progress-message-container").textContent=a.stage===d.LOAD_STAGE_MAX_EXCEPT_AUDIO?"World Name: "+this._wwaData.worldName:wwa_data.loadMessages[a.stage],wwa_util.$id("progress-bar").style.width=(1*a.stage+a.current/a.total*1)/(d.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*d.MAP_WINDOW_WIDTH+"px",wwa_util.$id("progress-disp").textContent=((1*a.stage+a.current/a.total*1)/(d.LOAD_STAGE_MAX_EXCEPT_AUDIO+
1)*100).toFixed(2)+"%"):(wwa_util.$id("progress-message-container").textContent="\u52b9\u679c\u97f3/BGM\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002(\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u30b9\u30ad\u30c3\u30d7\uff09",wwa_util.$id("progress-bar-audio").style.width=a.current*d.MAP_WINDOW_WIDTH/a.total+"px",wwa_util.$id("progress-disp").textContent=(a.current/a.total*100).toFixed(2)+"%"))};c.prototype._setLoadingMessage=function(a,b){if(!this._hasTitleImg)if(0>=b)a.font=wwa_data.LoadingMessageSize.TITLE+
"px "+d.LOADING_FONT,a.fillText(wwa_data.loadMessagesClassic[0],wwa_data.LoadingMessagePosition.TITLE_X,wwa_data.LoadingMessagePosition.TITLE_Y),a.font=wwa_data.LoadingMessageSize.FOOTER+"px "+d.LOADING_FONT,a.fillText("WWA Wing Ver."+d.VERSION_WWAJS,wwa_data.LoadingMessagePosition.FOOTER_X,wwa_data.LoadingMessagePosition.COPYRIGHT_Y);else if(b<=wwa_data.loadMessagesClassic.length)a.font=wwa_data.LoadingMessageSize.LOADING+"px "+d.LOADING_FONT,2<=b&&(a.clearRect(wwa_data.LoadingMessagePosition.LOADING_X,
wwa_data.LoadingMessagePosition.LOADING_Y+wwa_data.LoadingMessagePosition.LINE*(b-3),d.SCREEN_WIDTH-wwa_data.LoadingMessagePosition.LOADING_X,wwa_data.LoadingMessagePosition.LINE),a.fillText(wwa_data.loadMessagesClassic[b-1]+" Complete!",wwa_data.LoadingMessagePosition.LOADING_X,wwa_data.LoadingMessagePosition.LOADING_Y+wwa_data.LoadingMessagePosition.LINE*(b-2))),b<wwa_data.loadMessagesClassic.length&&a.fillText(wwa_data.loadMessagesClassic[b],wwa_data.LoadingMessagePosition.LOADING_X,wwa_data.LoadingMessagePosition.LOADING_Y+
wwa_data.LoadingMessagePosition.LINE*(b-1)),1==b&&(a.font=wwa_data.LoadingMessageSize.FOOTER+"px "+d.LOADING_FONT,a.fillText("World Name  "+this._wwaData.worldName,wwa_data.LoadingMessagePosition.FOOTER_X,wwa_data.LoadingMessagePosition.WORLD_Y),a.fillText(" (Map data Ver. "+Math.floor(this._wwaData.version/10)+"."+this._wwaData.version%10+")",wwa_data.LoadingMessagePosition.FOOTER_X,wwa_data.LoadingMessagePosition.WORLD_Y+wwa_data.LoadingMessagePosition.LINE));else{var f=this._isSkippedSoundMessage?
wwa_data.LoadingMessagePosition.LOADING_Y+wwa_data.LoadingMessagePosition.LINE*(wwa_data.loadMessagesClassic.length-1):wwa_data.LoadingMessagePosition.FOOTER_Y;b<=wwa_data.LoadStage.AUDIO?a.fillText("Now Sound data Loading .....",wwa_data.LoadingMessagePosition.LOADING_X,f):(a.clearRect(wwa_data.LoadingMessagePosition.LOADING_X,f-wwa_data.LoadingMessagePosition.LINE,d.SCREEN_WIDTH-wwa_data.LoadingMessagePosition.LOADING_X,wwa_data.LoadingMessagePosition.LINE),a.fillText("Now Sound data Loading ..... Complete!",
wwa_data.LoadingMessagePosition.LOADING_X,f))}};c.prototype._setErrorMessage=function(a,b){this._hasTitleImg?alert(a):(b.clearRect(0,0,d.SCREEN_WIDTH,d.SCREEN_HEIGHT),b.font=wwa_data.LoadingMessageSize.ERRROR+"px "+d.LOADING_FONT,a.split("\n").forEach(function(a,f){b.fillText(a,wwa_data.LoadingMessagePosition.ERROR_X,wwa_data.LoadingMessagePosition.ERROR_Y+wwa_data.LoadingMessagePosition.LINE*f)}))};c.prototype.createAudioJSInstance=function(a,b){if(0!==a&&void 0===this._audioJSInstances[a]&&a!==
wwa_data.SystemSound.NO_SOUND){b=wwap_mode?d.WWAP_SERVER+"/"+d.WWAP_SERVER_AUDIO_DIR+"/"+a+".mp3":this._audioDirectory+a+".mp3";var f=new Audio(b);f.preload="auto";a>=wwa_data.SystemSound.BGM_LB&&(f.loop=!0);m.$id("wwa-audio-wrapper").appendChild(f);this._audioJSInstances[a]=audiojs.create(f);a<wwa_data.SystemSound.BGM_LB&&(b=new Audio(b),b.preload="auto",m.$id("wwa-audio-wrapper").appendChild(b),this._audioJSInstancesSub[a]=audiojs.create(b))}};c.prototype.loadSound=function(){this._audioJSInstances=
Array(d.SOUND_MAX+1);this._audioJSInstancesSub=Array(d.SOUND_MAX+1);this.createAudioJSInstance(wwa_data.SystemSound.DECISION);this.createAudioJSInstance(wwa_data.SystemSound.ATTACK);for(var a=1;a<this._wwaData.mapPartsMax;a++){var b=this._wwaData.mapAttribute[a][d.ATR_SOUND];this.createAudioJSInstance(b)}for(a=1;a<this._wwaData.objPartsMax;a++)this._wwaData.objectAttribute[a][d.ATR_TYPE]!==d.OBJECT_RANDOM&&(b=this._wwaData.objectAttribute[a][d.ATR_SOUND],this.createAudioJSInstance(b));this._wwaData.bgm=
0;this._soundLoadSkipFlag=!1};c.prototype.checkAllSoundLoaded=function(){var a,b=0,c=0;this._hasTitleImg||(a=this._cvsCover.getContext("2d"));this._keyStore.update();this._keyStore.getKeyState(wwa_input.KeyCode.KEY_SPACE)===wwa_input.KeyState.KEYDOWN&&(this._soundLoadSkipFlag=!0);for(var z=1;z<=d.SOUND_MAX;z++)void 0===this._audioJSInstances[z]||this._audioJSInstances[z].wrapper.classList.contains("error")||(c++,this._audioJSInstances[z].wrapper.classList.contains("loading")||b++);b<c&&!this._soundLoadSkipFlag?
(this._setProgressBar(e(b,c,wwa_data.LoadStage.AUDIO)),setTimeout(this.soundCheckCaller,d.DEFAULT_FRAME_INTERVAL,this)):(this._setProgressBar(e(d.SOUND_MAX,d.SOUND_MAX,wwa_data.LoadStage.AUDIO)),this._setLoadingMessage(a,wwa_data.LoadStage.FINISH),this.openGameWindow())};c.prototype.playSound=function(a){var b=this;if(this._isLoadedSound){if(0>a||a>d.SOUND_MAX)throw Error("\u30b5\u30a6\u30f3\u30c9\u756a\u53f7\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");if(!(a>=wwa_data.SystemSound.BGM_LB&&this._wwaData.bgm===
a)&&((a===wwa_data.SystemSound.NO_SOUND||a>=wwa_data.SystemSound.BGM_LB)&&0!==this._wwaData.bgm&&(this._audioJSInstances[this._wwaData.bgm].wrapper.classList.contains("loading")||this._audioJSInstances[this._wwaData.bgm].pause(),this._wwaData.bgm=0),0!==a&&a!==wwa_data.SystemSound.NO_SOUND))if(this._audioJSInstances[a].wrapper.classList.contains("loading")){if(a>=wwa_data.SystemSound.BGM_LB){var f=function(a,d){var n=setInterval(function(){d._wwaData.bgm===a?d._audioJSInstances[a].wrapper.classList.contains("loading")||
(b._audioJSInstances[a].skipTo(0),b._audioJSInstances[a].play(),b._wwaData.bgm=a,clearInterval(n)):(clearInterval(n),d._wwaData.bgm!==wwa_data.SystemSound.NO_SOUND&&f(d._wwaData.bgm,d))},4)};f(a,this)}this._wwaData.bgm=a}else 0===a||this._audioJSInstances[a].wrapper.classList.contains("error")||(a>=wwa_data.SystemSound.BGM_LB?(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._wwaData.bgm=a):this._nextSoundIsSub?(this._audioJSInstancesSub[a].skipTo(0),this._audioJSInstancesSub[a].play(),
this._nextSoundIsSub=!1):(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._nextSoundIsSub=!0))}};c.prototype.openGameWindow=function(){var a=this,b=this._player.getPosition();m.$id("wwa-cover").style.opacity="0";0!==this.getObjectIdByPosition(b)&&this._player.setPartsAppearedFlag();setTimeout(function(){m.$id("wwa-wrapper").removeChild(m.$id("wwa-cover"));a._main()},d.SPLASH_SCREEN_DISP_MILLS)};c.prototype.mainCaller=function(a){a._main()};c.prototype.soundCheckCaller=function(a){a.checkAllSoundLoaded()};
c.prototype.onselectitem=function(a){if(this._player.canUseItem(a))if(wwa_util.$id("item"+(a-1)).classList.add("onpress"),this.playSound(wwa_data.SystemSound.DECISION),"BLANK"===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]){this._player.readyToUseItem(a);a=this._player.useItem();var b=this.getObjectAttributeById(a,d.ATR_STRING);this.setMessageQueue(this.getMessageById(b),!1,!1,a,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord())}else this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]?
"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b?":this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM],!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE,this._yesNoUseItemPos=a};c.prototype.onselectbutton=function(a,b){void 0===b&&(b=!1);var f=wwa_util.$id(wwa_data.sidebarButtonCellElementID[a]);this.playSound(wwa_data.SystemSound.DECISION);f.classList.add("onpress");if(a===wwa_data.SidebarButton.QUICK_LOAD)if(void 0===
this._quickSaveData||b)this.onpasswordloadcalled();else this.setMessageQueue("\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u304b\uff1f\n\u2192\uff2e\uff4f\u3067\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\n\u3000\u5165\u529b\u9078\u629e\u304c\u3067\u304d\u307e\u3059\u3002",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD;else a===wwa_data.SidebarButton.QUICK_SAVE?this._wwaData.disableSaveFlag?this.setMessageQueue("\u3053\u3053\u3067\u306f\u30bb\u30fc\u30d6\u6a5f\u80fd\u306f\n\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002",
!1,!0):(this.setMessageQueue("\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\u3092\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n\u2192\uff2e\uff4f\u3067\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\n\u3000\u8868\u793a\u9078\u629e\u304c\u3067\u304d\u307e\u3059\u3002",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE):a===wwa_data.SidebarButton.RESTART_GAME?(this.setMessageQueue("\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3057\u306a\u304a\u3057\u307e\u3059\u304b\uff1f",
!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME):a===wwa_data.SidebarButton.GOTO_WWA&&(this.setMessageQueue("\uff37\uff37\uff21\u306e\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u958b\u304d\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA)};c.prototype.onpasswordloadcalled=function(){wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.add("onpress");this.setMessageQueue("\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u307e\u3059\u304b\uff1f",
!0,!0);this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD};c.prototype.onpasswordsavecalled=function(){wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.add("onpress");this._wwaData.disableSaveFlag?this.setMessageQueue("\u3053\u3053\u3067\u306f\u30bb\u30fc\u30d6\u6a5f\u80fd\u306f\n\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002",!1,!0):(this.setMessageQueue("\u30c7\u30fc\u30bf\u5fa9\u5e30\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8868\u793a\u3057\u307e\u3059\u304b\uff1f",
!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE)};c.prototype.onchangespeed=function(a){a=a===wwa_data.SpeedChange.UP?this._player.speedUp():this._player.speedDown();this.setMessageQueue("\u79fb\u52d5\u901f\u5ea6\u3092\u3010"+wwa_data.speedNameList[a]+"\u3011\u306b\u5207\u308a\u66ff\u3048\u307e\u3057\u305f\u3002\n"+(a===d.MAX_SPEED_INDEX?"\u6226\u95d8\u3082\u901f\u304f\u306a\u308a\u307e\u3059\u3002\n":"")+"("+(d.MAX_SPEED_INDEX+1)+"\u6bb5\u968e\u4e2d"+(a+1)+"\uff09 \u901f\u5ea6\u3092\u843d\u3068\u3059\u306b\u306fI\u30ad\u30fc, \u901f\u5ea6\u3092\u4e0a\u3052\u308b\u306b\u306fP\u30ad\u30fc\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002",
!1,!0)};c.prototype._main=function(){var f=this;this._temporaryInputDisable=!1;this._waitTimeInCurrentFrame=d.DEFAULT_FRAME_INTERVAL;this._stopUpdateByLoadFlag=!1;this._keyStore.update();this._mouseStore.update();void 0!==this._yesNoJudgeInNextFrame&&(this._yesNoJudge=this._yesNoJudgeInNextFrame,this._yesNoJudgeInNextFrame=void 0);this._clearFacesInNextFrame&&(this.clearFaces(),this._clearFacesInNextFrame=!1);for(var n=0;n<this._execMacroListInNextFrame.length;n++)this._execMacroListInNextFrame[n].execute();
""===this._lastMessage.message&&this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);this._execMacroListInNextFrame=[];this._player.getPosition();n=this._player.getDir();if(this._player.isControllable()){if(this._keyStore.getKeyStateForControllPlayer(b.KEY_LEFT)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.LEFT)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.LEFT),
this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(b.KEY_UP)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.UP)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(b.KEY_RIGHT)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.RIGHT)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.RIGHT),
this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(b.KEY_DOWN)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.DOWN)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(wwa_data.dirToKey[n]))this._player.controll(n),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT))this._player.controll(wwa_data.Direction.LEFT),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP))this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_RIGHT)||this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT))this._player.controll(wwa_data.Direction.RIGHT),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN))this._player.controll(wwa_data.Direction.DOWN),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT))this._player.controll(wwa_data.Direction.LEFT),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP))this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_RIGHT)||this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT))this._player.controll(wwa_data.Direction.RIGHT),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(b.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN))this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update();else if(this._keyStore.getKeyState(b.KEY_1)===wwa_input.KeyState.KEYDOWN)this.onselectitem(1);else if(this._keyStore.getKeyState(b.KEY_2)===wwa_input.KeyState.KEYDOWN)this.onselectitem(2);else if(this._keyStore.getKeyState(b.KEY_3)===wwa_input.KeyState.KEYDOWN)this.onselectitem(3);
else if(this._keyStore.getKeyState(b.KEY_Q)===wwa_input.KeyState.KEYDOWN)this.onselectitem(4);else if(this._keyStore.getKeyState(b.KEY_W)===wwa_input.KeyState.KEYDOWN)this.onselectitem(5);else if(this._keyStore.getKeyState(b.KEY_E)===wwa_input.KeyState.KEYDOWN)this.onselectitem(6);else if(this._keyStore.getKeyState(b.KEY_A)===wwa_input.KeyState.KEYDOWN)this.onselectitem(7);else if(this._keyStore.getKeyState(b.KEY_S)===wwa_input.KeyState.KEYDOWN)this.onselectitem(8);else if(this._keyStore.getKeyState(b.KEY_D)===
wwa_input.KeyState.KEYDOWN)this.onselectitem(9);else if(this._keyStore.getKeyState(b.KEY_Z)===wwa_input.KeyState.KEYDOWN)this.onselectitem(10);else if(this._keyStore.getKeyState(b.KEY_X)===wwa_input.KeyState.KEYDOWN)this.onselectitem(11);else if(this._keyStore.getKeyState(b.KEY_C)===wwa_input.KeyState.KEYDOWN)this.onselectitem(12);else if(this._keyStore.getKeyState(b.KEY_I))this.onchangespeed(wwa_data.SpeedChange.DOWN);else if(this._keyStore.checkHitKey(b.KEY_P)||this._keyStore.checkHitKey(b.KEY_F2))this.onchangespeed(wwa_data.SpeedChange.UP);
else if(this._keyStore.getKeyState(b.KEY_F1)===wwa_input.KeyState.KEYDOWN||this._keyStore.getKeyState(b.KEY_M)===wwa_input.KeyState.KEYDOWN)this.launchBattleEstimateWindow();else if(this._keyStore.checkHitKey(b.KEY_F3))this.playSound(wwa_data.SystemSound.DECISION),this.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD,!0);else if(this._keyStore.checkHitKey(b.KEY_F4))this.playSound(wwa_data.SystemSound.DECISION),this.onpasswordsavecalled();else if(this._keyStore.checkHitKey(b.KEY_F5))this.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD);
else if(this._keyStore.checkHitKey(b.KEY_F6))this.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE);else if(this._keyStore.checkHitKey(b.KEY_F7))this.onselectbutton(wwa_data.SidebarButton.RESTART_GAME);else if(this._keyStore.checkHitKey(b.KEY_F8))this.onselectbutton(wwa_data.SidebarButton.GOTO_WWA);else this._keyStore.checkHitKey(b.KEY_F12)&&this._displayHelp();this._keyStore.memorizeKeyStateOnControllableFrame();this._mouseStore.memorizeMouseStateOnControllableFrame()}else if(this._player.isJumped())this._camera.isResetting()||
this._player.processAfterJump();else if(this._player.isMoving())this._player.move(),this._objectMovingDataManager.update();else if(this._player.isWaitingMessage())if(this._messageWindow.isVisible()||this._messageWindow.show(),!this._messageWindow.isYesNoChoice()){n=this._keyStore.getKeyStateForMessageCheck(b.KEY_ENTER);var c=this._keyStore.getKeyStateForMessageCheck(b.KEY_SPACE),e=this._keyStore.getKeyStateForMessageCheck(b.KEY_ESC);if(n===t.KEYDOWN||n===t.KEYPRESS_MESSAGECHANGE||c===t.KEYDOWN||c===
t.KEYPRESS_MESSAGECHANGE||e===t.KEYDOWN||e===t.KEYPRESS_MESSAGECHANGE||this._mouseStore.getMouseState()===a.MOUSEDOWN){for(n=0;n<wwa_data.sidebarButtonCellElementID.length;n++)c=wwa_util.$id(wwa_data.sidebarButtonCellElementID[n]),c.classList.contains("onpress")&&c.classList.remove("onpress");this._setNextMessage()}}else{if(!this._messageWindow.isInputDisable()){if(this._yesNoJudge===wwa_data.YesNoState.UNSELECTED)if(this._keyStore.getKeyState(b.KEY_ENTER)===t.KEYDOWN||this._keyStore.getKeyState(b.KEY_Y)===
t.KEYDOWN)this._yesNoJudge=wwa_data.YesNoState.YES;else if(this._keyStore.getKeyState(b.KEY_N)===t.KEYDOWN||this._keyStore.getKeyState(b.KEY_ESC)===t.KEYDOWN)this._yesNoJudge=wwa_data.YesNoState.NO;this._yesNoJudge===wwa_data.YesNoState.YES?(this.playSound(wwa_data.SystemSound.DECISION),this._yesNoDispCounter=d.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update()):this._yesNoJudge===wwa_data.YesNoState.NO&&(this.playSound(wwa_data.SystemSound.DECISION),this._yesNoDispCounter=
d.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update())}}else this._player.isWatingEstimateWindow()?this._keyStore.getKeyState(b.KEY_ENTER)!==t.KEYDOWN&&this._keyStore.getKeyState(b.KEY_SPACE)!==t.KEYDOWN||this.hideBattleEstimateWindow():this._player.isFighting()?(this._player.fight(),this._monsterWindow.update(this._monster)):this._player.isWaitingMoveMacro()&&(this._player.isMoveObjectAutoExecTime()&&(this.moveObjects(!1),this._player.resetMoveObjectAutoExecTimer()),
this._objectMovingDataManager.update());this._prevFrameEventExected=!1;this._player.getPosition().isJustPosition()&&this._camera.getPosition().isScreenTopPosition()&&(this._player.isJumped()||this._player.isWaitingMessage()||this._player.isWaitingMoveMacro()||this._player.isFighting()||(this._player.isPartsAppearedTime()&&this._player.clearPartsAppearedFlag(),this._replaceRandomObjectsInScreen(),(n=this.checkMap())||this.checkObject(),this._prevFrameEventExected=n),this._player.isWaitingMessage()&&
this._messageWindow.isYesNoChoice()&&this._yesNoJudge!==wwa_data.YesNoState.UNSELECTED&&!this._player.isWaitingMoveMacro()&&!this._player.isFighting()&&this._execChoiceWindowRunningEvent());this._passwordLoadExecInNextFrame&&(this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.PASSWORD,this._player.clearPasswordWindowWaiting(),this._passwordLoadExecInNextFrame=!1);this._drawAll();this._mainCallCounter++;this._mainCallCounter%=1E9;this._player.isWaitingMessage()&&this._isClassicModeEnable||
(this._animationCounter=(this._animationCounter+1)%(2*d.ANIMATION_REP_HALF_FRAME));this._camera.isResetting()&&this._camera.advanceTransitionStepNum();this._player.isWaitingMessage()||(this._player.decrementLookingAroundTimer(),0<this._statusPressCounter.energy&&0===--this._statusPressCounter.energy&&wwa_util.$id("disp-energy").classList.remove("onpress"),0<this._statusPressCounter.strength&&0===--this._statusPressCounter.strength&&wwa_util.$id("disp-strength").classList.remove("onpress"),0<this._statusPressCounter.defence&&
0===--this._statusPressCounter.defence&&wwa_util.$id("disp-defence").classList.remove("onpress"),0<this._statusPressCounter.gold&&0===--this._statusPressCounter.gold&&wwa_util.$id("disp-gold").classList.remove("onpress"));this._player.isWaitingMoveMacro()&&this._player.decrementMoveObjectAutoExecTimer();this._stopUpdateByLoadFlag?this._fadeout(function(){f._loadType===wwa_data.LoadType.QUICK_LOAD?f._quickLoad():f._loadType===wwa_data.LoadType.RESTART_GAME?f._restartGame():f._loadType===wwa_data.LoadType.PASSWORD&&
(f._applyQuickLoad(f._passwordSaveExtractData),f._passwordSaveExtractData=void 0);setTimeout(f.mainCaller,f._waitTimeInCurrentFrame,f)}):setTimeout(this.mainCaller,this._waitTimeInCurrentFrame,this)};c.prototype._drawAll=function(){var a=this._camera.getPosition().getPartsCoord(),b=this._camera.getPosition().getOffsetCoord(),c=d.MAP_WINDOW_HEIGHT;var e=this._player.getPosition().getPartsCoord();if(this._paintSkipByDoorOpen)this._paintSkipByDoorOpen=!1;else{this._cgManager.clearCanvas(0,0,d.MAP_WINDOW_WIDTH,
d.MAP_WINDOW_HEIGHT);this._cgManager.drawBase(0,0,d.MAP_WINDOW_WIDTH,d.MAP_WINDOW_HEIGHT);if(this._camera.isResetting()){if(null!==this._camera.getPreviousPosition()){var g=this._camera.getPreviousPosition().getPartsCoord();var k=this._camera.getPreviousPosition().getOffsetCoord()}c=this._camera.getTransitionStepNum()*d.CHIP_SIZE;this._drawMap(g,k,c,!0);this._drawPlayer(g,k,c,!0);this._drawObjects(g,k,c,!0);if(this._camera.isFinalStep())var m=255,y=setInterval(function(){var a=wwa_util.$id("wwa-fader");
m-=3*d.FADEOUT_SPEED;0>=m?(clearInterval(y),a.style.backgroundColor="transparent",a.removeAttribute("style"),a.style.display="none"):a.style.opacity=m/255+""},20)}this._drawMap(a,b,c);this._drawPlayer(a,b,c);this._drawObjects(a,b,c);this._player.isFighting()&&!this._player.isBattleStartFrame()&&(k=this._player.isTurn()?this._monster.position.x:e.x,e=this._player.isTurn()?this._monster.position.y:e.y,this._cgManager.drawCanvas(this._battleEffectCoord.x,this._battleEffectCoord.y,d.CHIP_SIZE*(k-a.x)-
b.x,d.CHIP_SIZE*(e-a.y)-b.y,!1));this._drawEffect();this._drawFaces();this._drawFrame()}};c.prototype._drawMap=function(a,b,c,e){void 0===e&&(e=!1);if(void 0!==a)for(var f=Math.min(this._wwaData.mapWidth-1,a.x+d.H_PARTS_NUM_IN_WINDOW),n=Math.max(0,a.y-1),v=Math.min(this._wwaData.mapWidth-1,a.y+d.V_PARTS_NUM_IN_WINDOW),z=Math.max(0,a.x-1);z<=f;z++)for(var g=n;g<=v;g++){var k=this._wwaData.map[g][z],m=this._wwaData.mapAttribute[k][d.ATR_X]/d.CHIP_SIZE;k=this._wwaData.mapAttribute[k][d.ATR_Y]/d.CHIP_SIZE;
var y=d.CHIP_SIZE*(z-a.x)-b.x,w=d.CHIP_SIZE*(g-a.y)-b.y;e?this._cgManager.drawCanvasWithLowerYLimit(m,k,y,w,c):this._cgManager.drawCanvasWithUpperYLimit(m,k,y,w,c)}};c.prototype._drawPlayer=function(a,b,c,e){void 0===e&&(e=!1);if(void 0!==a&&!this._wwaData.delPlayerFlag){var f=this._player.getPosition().getPartsCoord(),n=this._player.getPosition().getOffsetCoord(),v=wwa_data.dirToPos[this._player.getDir()],z=(f.x-a.x)*d.CHIP_SIZE+n.x-b.x;a=(f.y-a.y)*d.CHIP_SIZE+n.y-b.y;this._player.getDir();b=[2,
3,4,5,0,1,6,7];v=this._player.isLookingAround()&&!this._player.isWaitingMessage()?this._wwaData.playerImgPosX+b[Math.floor(this._mainCallCounter%64/8)]:this._player.isMovingImage()?this._wwaData.playerImgPosX+v+1:this._wwaData.playerImgPosX+v;e?this._cgManager.drawCanvasWithLowerYLimit(v,this._wwaData.playerImgPosY,z,a,c):this._cgManager.drawCanvasWithUpperYLimit(v,this._wwaData.playerImgPosY,z,a,c)}};c.prototype._drawObjects=function(a,b,c,e){void 0===e&&(e=!1);if(void 0!==a)for(var f=Math.min(this._wwaData.mapWidth-
1,a.x+d.H_PARTS_NUM_IN_WINDOW),n=Math.max(0,a.y-1),v=Math.min(this._wwaData.mapWidth-1,a.y+d.V_PARTS_NUM_IN_WINDOW),z,g=Math.max(0,a.x-1);g<=f;g++)for(var k=n;k<=v;k++)if(!(this._player.isFighting()&&this._player.isTurn()&&this._player.getPosition().getPartsCoord().equals(this._monster.position)&&(new wwa_data.Coord(g,k)).equals(this._monster.position))){var m=this._wwaData.mapObject[k][g];z=new x(0,0);if(this._wwaData.objectAttribute[m][d.ATR_MOVE]!==wwa_data.MoveType.STATIC){var y=this._objectMovingDataManager.getOffsetByBeforePartsCoord(new x(g,
k));null!==y&&(z=y)}var w=this._animationCounter>d.ANIMATION_REP_HALF_FRAME||0===this._wwaData.objectAttribute[m][d.ATR_X2]&&0===this._wwaData.objectAttribute[m][d.ATR_Y2];y=this._wwaData.objectAttribute[m][w?d.ATR_X:d.ATR_X2]/d.CHIP_SIZE;w=this._wwaData.objectAttribute[m][w?d.ATR_Y:d.ATR_Y2]/d.CHIP_SIZE;var h=d.CHIP_SIZE*(g-a.x)+z.x-b.x;z=d.CHIP_SIZE*(k-a.y)+z.y-b.y;var l=this._wwaData.objectAttribute[m][d.ATR_TYPE],B=this._wwaData.objectAttribute[m][d.ATR_NUMBER];0===m||this._checkNoDrawObject(new x(g,
k),l,B)||(e?this._cgManager.drawCanvasWithLowerYLimit(y,w,h,z,c):this._cgManager.drawCanvasWithUpperYLimit(y,w,h,z,c))}};c.prototype._drawEffect=function(){if(0!==this._wwaData.effectCoords.length)for(var a=Math.floor(this._mainCallCounter%(this._wwaData.effectCoords.length*this._wwaData.effectWaits)/this._wwaData.effectWaits),b=0;b<d.V_PARTS_NUM_IN_WINDOW;b++)for(var c=0;c<d.H_PARTS_NUM_IN_WINDOW;c++)this._cgManager.drawCanvas(this._wwaData.effectCoords[a].x,this._wwaData.effectCoords[a].y,c*d.CHIP_SIZE,
b*d.CHIP_SIZE,!1)};c.prototype._drawFaces=function(){for(var a=0;a<this._faces.length;a++)this._cgManager.drawCanvasWithSize(this._faces[a].srcPos.x,this._faces[a].srcPos.y,this._faces[a].srcSize.x,this._faces[a].srcSize.y,this._faces[a].destPos.x,this._faces[a].destPos.y,!1)};c.prototype._drawFrame=function(){this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y,0,0,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y,d.MAP_WINDOW_WIDTH-d.CHIP_SIZE,0,!1);this._cgManager.drawCanvas(this._frameCoord.x,
this._frameCoord.y+2,0,d.MAP_WINDOW_HEIGHT-d.CHIP_SIZE,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+2,d.MAP_WINDOW_WIDTH-d.CHIP_SIZE,d.MAP_WINDOW_HEIGHT-d.CHIP_SIZE,!1);for(var a=1;a<d.H_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y,d.CHIP_SIZE*a,0,!1),this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y+2,d.CHIP_SIZE*a,d.MAP_WINDOW_HEIGHT-d.CHIP_SIZE,!1);for(a=1;a<d.V_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x,
this._frameCoord.y+1,0,d.CHIP_SIZE*a,!1),this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+1,d.MAP_WINDOW_WIDTH-d.CHIP_SIZE,d.CHIP_SIZE*a,!1)};c.prototype._checkNoDrawObject=function(a,b,c){var f=this._player.getPosition(),n=f.getPartsCoord();return!f.isJustPosition()||n.x!==a.x||n.y!==a.y||this._wwaData.objectNoCollapseDefaultFlag?!1:b===d.OBJECT_DOOR&&0===c?!0:b===d.OBJECT_STATUS||b===d.OBJECT_MESSAGE||b===d.OBJECT_ITEM||b===d.OBJECT_SELL||b===d.OBJECT_BUY||b===d.OBJECT_SELL||b===
d.OBJECT_LOCALGATE};c.prototype.getMapWidth=function(){if(void 0===this._wwaData)throw Error("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093");return this._wwaData.mapWidth};c.prototype.getMapIdByPosition=function(a){a=a.getPartsCoord();return this._wwaData.map[a.y][a.x]};c.prototype.getObjectIdByPosition=function(a){a=a.getPartsCoord();return this._wwaData.mapObject[a.y][a.x]};c.prototype.getMapTypeByPosition=function(a){a=a.getPartsCoord();
return this._wwaData.mapAttribute[this._wwaData.map[a.y][a.x]][d.ATR_TYPE]};c.prototype.getObjectTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[a.y][a.x]][d.ATR_TYPE]};c.prototype.getMapAttributeByPosition=function(a,b){a=a.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[a.y][a.x]][b]};c.prototype.isCurrentPosMapPartsIncludingMessage=function(a){return 0!==this.getMapAttributeByPosition(a,d.ATR_STRING)};c.prototype.getObjectAttributeByPosition=
function(a,b){a=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[a.y][a.x]][b]};c.prototype.getMapAttributeById=function(a,b){return this._wwaData.mapAttribute[a][b]};c.prototype.getObjectAttributeById=function(a,b){return this._wwaData.objectAttribute[a][b]};c.prototype.getObjectCropXById=function(a){return this._wwaData.objectAttribute[a][d.ATR_X]};c.prototype.getObjectCropYById=function(a){return this._wwaData.objectAttribute[a][d.ATR_Y]};c.prototype.getMessageById=
function(a){return this._wwaData.message[a]};c.prototype.getSystemMessageById=function(a){return this._wwaData.systemMessage[a]};c.prototype.checkMap=function(a){var b=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==a?a:b;var f=this._wwaData.map[a.y][a.x],c=this._wwaData.mapAttribute[f][d.ATR_TYPE];b=a.x===b.x&&a.y===b.y;var e=!1;if(b&&this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.MAP)===f)return!1;c===d.MAP_STREET?e=this._execMapStreetEvent(a,f,c):c===d.MAP_WALL?
e=this._execMapWallEvent(a,f,c):c===d.MAP_LOCALGATE?e=this._execMapLocalGateEvent(a,f,c):c===d.MAP_URLGATE&&(e=this._execMapUrlGateEvent(a,f,c));b&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.MAP,f);return e};c.prototype.checkObject=function(a){var b=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==a?a:b;var f=this._wwaData.mapObject[a.y][a.x],c=this._wwaData.objectAttribute[f][d.ATR_TYPE];b=a.x===b.x&&a.y===b.y;b&&this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.OBJECT)===
f||(c===d.OBJECT_NORMAL?this._execObjectNormalEvent(a,f,c):c===d.OBJECT_MESSAGE?this._execObjectMessageEvent(a,f,c):c===d.OBJECT_MONSTER?this._execObjectMonsterEvent(a,f,c):c===d.OBJECT_ITEM?this._execObjectItemEvent(a,f,c):c===d.OBJECT_DOOR?this._execObjectDoorEvent(a,f,c):c===d.OBJECT_STATUS?this._execObjectStatusEvent(a,f,c):c===d.OBJECT_BUY?this._execObjectBuyEvent(a,f,c):c===d.OBJECT_SELL?this._execObjectSellEvent(a,f,c):c===d.OBJECT_URLGATE?this._execObjectUrlGateEvent(a,f,c):c===d.OBJECT_SCORE?
this._execObjectScoreEvent(a,f,c):c===d.OBJECT_SELECT?this._execObjectYesNoChoiceEvent(a,f,c):c===d.OBJECT_LOCALGATE&&this._execObjectLocalGateEvent(a,f,c),b&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.OBJECT,f))};c.prototype._execMapStreetEvent=function(a,b,c){c=this._wwaData.mapAttribute[b][d.ATR_ITEM];if(0!==c&&!this._player.hasItem(c))return!1;this.appearParts(a,wwa_data.AppearanceTriggerType.MAP);c=this._wwaData.mapAttribute[b][d.ATR_STRING];var f=
this._wwaData.message[c];this._waitTimeInCurrentFrame+=100*this._wwaData.mapAttribute[b][d.ATR_NUMBER];this._temporaryInputDisable=!0;a=this.setMessageQueue(f,!1,!1,b,wwa_data.PartsType.MAP,a.clone());this.playSound(this._wwaData.mapAttribute[b][d.ATR_SOUND]);return 0!==c&&a};c.prototype._execMapWallEvent=function(a,b,c){c=this.getObjectIdByPosition(a.convertIntoPosition(this));var f=this.getObjectAttributeById(c,d.ATR_TYPE);0!==c&&f!==d.OBJECT_NORMAL&&(f!==d.OBJECT_DOOR||this._player.hasItem(this.getObjectAttributeById(c,
d.ATR_ITEM))&&this.getObjectAttributeById(f,d.ATR_MODE)!==d.PASSABLE_OBJECT)||(this.appearParts(a,wwa_data.AppearanceTriggerType.MAP),this.setMessageQueue(this._wwaData.message[this._wwaData.mapAttribute[b][d.ATR_STRING]],!1,!1,b,wwa_data.PartsType.MAP,a.clone()),this.playSound(this._wwaData.mapAttribute[b][d.ATR_SOUND]));return!1};c.prototype._execMapLocalGateEvent=function(a,b,c){c=this._player.getPosition().getPartsCoord();var f=this._wwaData.mapAttribute[b][d.ATR_JUMP_X],n=this._wwaData.mapAttribute[b][d.ATR_JUMP_Y];
f>d.RELATIVE_COORD_LOWER&&(f=a.x+f-d.RELATIVE_COORD_BIAS);n>d.RELATIVE_COORD_LOWER&&(n=a.y+n-d.RELATIVE_COORD_BIAS);this.appearParts(a,wwa_data.AppearanceTriggerType.MAP);return 0<=f&&0<=n&&f<this._wwaData.mapWidth&&n<this._wwaData.mapWidth&&(f!==c.x||n!==c.y)?(this._player.jumpTo(new A(this,f,n,0,0)),this.playSound(this._wwaData.mapAttribute[b][d.ATR_SOUND]),!0):!1};c.prototype._execMapUrlGateEvent=function(a,b,c){c=this._wwaData.mapAttribute[b][d.ATR_STRING];if(!this._isURLGateEnable)return!0;if("BLANK"===
this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK])location.href=wwa_util.$escapedURI(this._wwaData.message[c].split(/\s/g)[0]);else return this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=b,this._yesNoChoiceCallInfo=
wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS,this._yesNoURL=this._wwaData.message[c].split(/\s/g)[0],!0};c.prototype._execObjectNormalEvent=function(a,b,d){};c.prototype._execObjectMessageEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];var f=this._player.getPosition().getPartsCoord(),n=this._wwaData.objectAttribute[b][d.ATR_SOUND];a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(c,
!1,!1,b,wwa_data.PartsType.OBJECT,a);this._waitTimeInCurrentFrame+=100*this._wwaData.objectAttribute[b][d.ATR_NUMBER];this._temporaryInputDisable=!0;this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b);this.playSound(n)};c.prototype._execObjectStatusEvent=function(a,b,c){c=new wwa_data.Status(this._wwaData.objectAttribute[b][d.ATR_ENERGY],this._wwaData.objectAttribute[b][d.ATR_STRENGTH],this._wwaData.objectAttribute[b][d.ATR_DEFENCE],this._wwaData.objectAttribute[b][d.ATR_GOLD]);var f=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]],
n=this._player.getStatusWithoutEquipments();c.strength>d.STATUS_MINUS_BORDER&&n.strength<c.strength-d.STATUS_MINUS_BORDER||c.defence>d.STATUS_MINUS_BORDER&&n.defence<c.defence-d.STATUS_MINUS_BORDER||c.gold>d.STATUS_MINUS_BORDER&&n.gold<c.gold-d.STATUS_MINUS_BORDER?(this._wwaData.mapObject[a.y][a.x]=0,this._keyStore.allClear(),this._mouseStore.clear()):(c.energy=c.energy>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-c.energy:c.energy,c.strength=c.strength>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-
c.strength:c.strength,c.defence=c.defence>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-c.defence:c.defence,c.gold=c.gold>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-c.gold:c.gold,this._player.addStatusAll(c),this.setStatusChangedEffect(c),this._player.isDead()&&0!==this._wwaData.objectAttribute[b][d.ATR_ENERGY]?this.gameover():(this.setMessageQueue(f,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b),this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])))};
c.prototype._execObjectMonsterEvent=function(a,b,c){var f=this;c=new wwa_data.Coord(this._wwaData.objectAttribute[b][d.ATR_X],this._wwaData.objectAttribute[b][d.ATR_Y]);var n=new wwa_data.Status(this._wwaData.objectAttribute[b][d.ATR_ENERGY],this._wwaData.objectAttribute[b][d.ATR_STRENGTH],this._wwaData.objectAttribute[b][d.ATR_DEFENCE],this._wwaData.objectAttribute[b][d.ATR_GOLD]);this._monster=new wwa_monster.Monster(b,a,c,n,this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]],
this._wwaData.objectAttribute[b][d.ATR_ITEM],function(){f._monsterWindow.hide()});this._player.startBattleWith(this._monster)};c.prototype._execObjectBuyEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];var f=this._player.getPosition().getPartsCoord();a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(c,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=
b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};c.prototype._execObjectSellEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];var f=this._player.getPosition().getPartsCoord();a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(c,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=
a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};c.prototype._execObjectItemEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];try{this._player.addItem(b,this._wwaData.objectAttribute[b][d.ATR_NUMBER]),this._wwaData.mapObject[a.y][a.x]=0,0===this._wwaData.objectAttribute[b][d.ATR_MODE]&&(this.setMessageQueue(c,!1,!1,b,wwa_data.PartsType.OBJECT,
a.clone()),this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b))}catch(z){"BLANK"!==this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]&&this.setMessageQueue(""===this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]?"\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002":this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM],!1,!0)}this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};c.prototype._execObjectDoorEvent=
function(a,b,c){c=this._wwaData.objectAttribute[b][d.ATR_ITEM];var f=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];this._player.hasItem(c)&&(0===this._wwaData.objectAttribute[b][d.ATR_MODE]&&this._player.removeItemByPartsID(c),this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND]),this.setMessageQueue(f,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b),this._paintSkipByDoorOpen=
!0)};c.prototype._execObjectYesNoChoiceEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];var f=this._player.getPosition().getPartsCoord();a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(c,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};
c.prototype._execObjectLocalGateEvent=function(a,b,c){c=this._player.getPosition().getPartsCoord();a.x!==c.x||a.y!==c.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);var f=this._wwaData.objectAttribute[b][d.ATR_JUMP_X],n=this._wwaData.objectAttribute[b][d.ATR_JUMP_Y];f>d.RELATIVE_COORD_LOWER&&(f=c.x+f-d.RELATIVE_COORD_BIAS);n>d.RELATIVE_COORD_LOWER&&(n=c.y+n-d.RELATIVE_COORD_BIAS);this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b);0<=f&&0<=n&&f<this._wwaData.mapWidth&&
n<this._wwaData.mapWidth&&(f!==c.x||n!==c.y)&&(this._player.jumpTo(new A(this,f,n,0,0)),this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND]))};c.prototype._execObjectUrlGateEvent=function(a,b,c){c=this._wwaData.objectAttribute[b][d.ATR_STRING];this._isURLGateEnable&&("BLANK"===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?location.href=wwa_util.$escapedURI(this._wwaData.message[c].split(/\s/g)[0]):(this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?
"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=b,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS,this._yesNoURL=this._wwaData.message[c].split(/\s/g)[0]))};c.prototype._execObjectScoreEvent=function(a,b,c){a=this._wwaData.objectAttribute[b][d.ATR_STRING];this._player.getPosition().getPartsCoord();
c=this._player.getStatus();var f=0+this._wwaData.objectAttribute[b][d.ATR_ENERGY]*c.energy;f+=this._wwaData.objectAttribute[b][d.ATR_STRENGTH]*c.strength;f+=this._wwaData.objectAttribute[b][d.ATR_DEFENCE]*c.defence;f+=this._wwaData.objectAttribute[b][d.ATR_GOLD]*c.gold;this._scoreWindow.update(f);this._scoreWindow.show();this.setMessageQueue(0===a?"\u30b9\u30b3\u30a2\u3092\u8868\u793a\u3057\u307e\u3059\u3002":this._wwaData.message[a],!1,!1);this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};
c.prototype._execChoiceWindowRunningEvent=function(){if(0===--this._yesNoDispCounter)if(this._yesNoJudge===wwa_data.YesNoState.YES){if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS){var a=this._wwaData.mapAttribute[this._yesNoChoicePartsID][d.ATR_TYPE];a===d.MAP_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL))}else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS)if(a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_TYPE],
a===d.OBJECT_BUY)this._player.hasItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ITEM])?(this._player.removeItemByPartsID(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ITEM]),a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_GOLD],this._player.earnGold(a),this.setStatusChangedEffect(new wwa_data.Status(0,0,0,a)),this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,this._yesNoChoicePartsID)):"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]&&
this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]?"\u30a2\u30a4\u30c6\u30e0\u3092\u3082\u3063\u3066\u3044\u306a\u3044\u3002":this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM],!0));else if(a===d.OBJECT_SELL)if(this._player.hasGold(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_GOLD]))if(this._player.canHaveMoreItems()||0===this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ITEM]){0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ITEM]&&
this._player.addItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ITEM]);a=new wwa_data.Status(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ENERGY],this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_STRENGTH],this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_DEFENCE],-this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_GOLD]);this._player.getStatusWithoutEquipments();a.energy=a.energy>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-a.energy:
a.energy;this.setStatusChangedEffect(a);this._player.addStatusAll(a);if(this._player.isDead()&&0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ENERGY]){this.gameover();return}this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,this._yesNoChoicePartsID)}else"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]?"\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002":
this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM],!0));else"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]?"\u6240\u6301\u91d1\u304c\u8db3\u308a\u306a\u3044\u3002":this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY],!0));else a===d.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.CHOICE_YES,this._yesNoChoicePartsID):a===
d.OBJECT_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE?this._player.readyToUseItem(this._yesNoUseItemPos):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.QUICK_LOAD):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE?
(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"),this._quickSave()):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.RESTART_GAME):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA?(location.href=wwa_util.$escapedURI(d.WWA_HOME),
wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress")):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"),this._player.setPasswordWindowWating(),this._passwordWindow.show(wwa_password_window.Mode.LOAD)):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE&&(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"),
this._player.setPasswordWindowWating(),this._passwordWindow.password=this._quickSave(!0),this._passwordWindow.show(wwa_password_window.Mode.SAVE));this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this._setNextMessage();this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;this._messageWindow.setYesNoChoice(!1)}else if(this._yesNoJudge===wwa_data.YesNoState.NO){if(this._yesNoChoiceCallInfo!==wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS)if(this._yesNoChoiceCallInfo===
wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS)a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_TYPE],a!==d.OBJECT_BUY&&a!==d.OBJECT_SELL&&a===d.OBJECT_SELECT&&this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.CHOICE_NO,this._yesNoChoicePartsID);else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE)wwa_util.$id("item"+(this._yesNoUseItemPos-1)).classList.remove("onpress");else{if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD){this._yesNoJudge=
wwa_data.YesNoState.UNSELECTED;this.onpasswordloadcalled();return}if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE){this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this.onpasswordsavecalled();return}this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress"):
this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_LOAD?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_PASSWORD_SAVE&&wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress")}this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this._setNextMessage();this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=
void 0;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;this._messageWindow.setYesNoChoice(!1)}};c.prototype.setMessageQueue=function(a,b,d,c,e,g,k){void 0===c&&(c=0);void 0===e&&(e=wwa_data.PartsType.OBJECT);void 0===g&&(g=new x(0,0));void 0===k&&(k=!1);this._messageQueue=this._messageQueue.concat(this.getMessageQueueByRawMessage(a,c,e,g));this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=
void 0);if(0!==this._messageQueue.length){a=this._messageQueue.shift();for(c=0;c<a.macro.length;c++)this._execMacroListInNextFrame.push(a.macro[c]);this._lastMessage=a;if(""!==a.message)return this._messageWindow.setMessage(a.message),this._messageWindow.setYesNoChoice(b),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),d,this._player.getPosition(),this._camera.getPosition()),this._player.setMessageWaiting(),!0;0===this._messageQueue.length?this._hideMessageWindow(k):
this._setNextMessage()}return!1};c.prototype.getMessageQueueByRawMessage=function(a,b,d,c,e){void 0===e&&(e=!1);var f=a.split(/\n\<c\>/i)[0].split(/\<c\>/i)[0].replace(/\n\<p\>\n/ig,"<P>").replace(/\n\<p\>/ig,"<P>").replace(/\<p\>\n/ig,"<P>").replace(/\<p\>/ig,"<P>");a=[];if(""!==f){f=f.split(/\<p\>/ig);for(var n=0;n<f.length;n++){for(var g=f[n].split("\n"),v=[],k=[],m=0;m<g.length;m++){var z=g[m].match(/(\$(?:[a-zA-Z_][a-zA-Z0-9_]*)\=(?:.*))/);null!==z&&2<=z.length?(z=wwa_message.parseMacro(this,
b,d,c,z[1]),k.push(z)):g[m].match(/^\$/)||v.push(g[m])}a.push(new wwa_message.MessageInfo(v.join("\n"),e,n===f.length-1,k))}}return a};c.prototype.appearParts=function(a,b,c){void 0===c&&(c=0);var f=b===wwa_data.AppearanceTriggerType.CHOICE_NO?d.APPERANCE_PARTS_MIN_INDEX_NO:d.APPERANCE_PARTS_MIN_INDEX,e=b===wwa_data.AppearanceTriggerType.CHOICE_YES?d.APPERANCE_PARTS_MAX_INDEX_YES:d.APPERANCE_PARTS_MAX_INDEX;b===wwa_data.AppearanceTriggerType.MAP?(c=0===c?this._wwaData.map[a.y][a.x]:c,b=wwa_data.PartsType.MAP):
(c=0===c?this._wwaData.mapObject[a.y][a.x]:c,b=wwa_data.PartsType.OBJECT);for(;f<=e;f++){var n=d.ATR_APPERANCE_BASE+f*d.REL_ATR_APPERANCE_UNIT_LENGTH;var g=n+d.REL_ATR_APPERANCE_ID;var k=n+d.REL_ATR_APPERANCE_X;var v=n+d.REL_ATR_APPERANCE_Y;n+=d.REL_ATR_APPERANCE_TYPE;g=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[c][g]:this._wwaData.objectAttribute[c][g];n=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[c][n]:this._wwaData.objectAttribute[c][n];k=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[c][k]:
this._wwaData.objectAttribute[c][k];v=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[c][v]:this._wwaData.objectAttribute[c][v];k===d.PLAYER_COORD?(k=this._player.getPosition().getPartsCoord().x,this._player.resetEventExecutionInfo()):k>d.RELATIVE_COORD_LOWER&&(k=a.x+k-d.RELATIVE_COORD_BIAS);v===d.PLAYER_COORD?(v=this._player.getPosition().getPartsCoord().y,this._player.resetEventExecutionInfo()):v>d.RELATIVE_COORD_LOWER&&(v=a.y+v-d.RELATIVE_COORD_BIAS);if(0!==k||0!==v)try{if(new wwa_data.Position(this,
k,v,0,0),n===wwa_data.PartsType.MAP){if(g>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[v][k]=g}else{if(g>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[v][k]=g;this._replaceRandomObject(new x(k,v));k===this._player.getPosition().getPartsCoord().x&&v===this._player.getPosition().getPartsCoord().y&&
this._player.setPartsAppearedFlag()}}catch(E){}}};c.prototype.appearPartsByDirection=function(a,b,d){var f=this._player.getPosition().getPartsCoord(),c=this._player.getDir(),e=wwa_data.vx[c];c=wwa_data.vy[c];this.appearPartsEval(f,(0<=e?"+":"-")+Math.abs(e)*a,(0<=c?"+":"-")+Math.abs(c)*a,b,d)};c.prototype.appearPartsEval=function(a,b,d,c,e){var f=this._player.getPosition().getPartsCoord();if("P"===b||"p"===b)b=f.x;else if("+"===b[0])b=a.x+parseInt(b.substr(1));else if("-"===b[0])b=a.x-parseInt(b.substr(1));
else if(b=parseInt(b),isNaN(b))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");if("P"===d||"p"===d)a=f.y;else if("+"===d[0])a=a.y+parseInt(d.substr(1));else if("-"===d[0])a=a.y-parseInt(d.substr(1));else if(a=parseInt(d),isNaN(a))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");try{if(new wwa_data.Position(this,
b,a,0,0),e===wwa_data.PartsType.MAP){if(c>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[a][b]=c}else{if(c>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[a][b]=c;this._replaceRandomObject(new x(b,a));b===this._player.getPosition().getPartsCoord().x&&a===this._player.getPosition().getPartsCoord().y&&
this._player.setPartsAppearedFlag()}}catch(I){}};c.prototype._replaceRandomObject=function(a){var b=this._wwaData.mapObject[a.y][a.x];if(this._wwaData.objectAttribute[b][d.ATR_TYPE]===d.OBJECT_RANDOM){for(var c=0;c<d.RANDOM_ITERATION_MAX;c++){var f=Math.floor(10*Math.random());f=this._wwaData.objectAttribute[b][d.ATR_RANDOM_BASE+f];if(f>=this._wwaData.objPartsMax){f=0;break}if(this._wwaData.objectAttribute[f][d.ATR_TYPE]!==d.OBJECT_RANDOM)break;b=f}this._wwaData.mapObject[a.y][a.x]=f}};c.prototype._replaceRandomObjectsInScreen=
function(){var a=this._camera.getPosition().getPartsCoord(),b=Math.min(this._wwaData.mapWidth-1,a.x+d.H_PARTS_NUM_IN_WINDOW),c=Math.max(0,a.y-1),e=Math.min(this._wwaData.mapWidth-1,a.y+d.V_PARTS_NUM_IN_WINDOW);for(a=Math.max(0,a.x-1);a<=b;a++)for(var g=c;g<=e;g++)this._replaceRandomObject(new x(a,g))};c.prototype._replaceAllRandomObjects=function(){for(var a=0;a<this._wwaData.mapWidth;a++)for(var b=0;b<this._wwaData.mapWidth;b++)this._replaceRandomObject(new x(a,b))};c.prototype.gameover=function(){var a=
this._wwaData.gameoverX,b=this._wwaData.gameoverY;this._messageWindow.isVisible()&&(this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,this._messageQueue=[],this._messageWindow.hide(),this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE,this._messageWindow.setYesNoChoice(!1));this._waitTimeInCurrentFrame=d.GAMEOVER_FRAME_INTERVAL;this._temporaryInputDisable=!0;this._player.jumpTo(new A(this,a,b,0,0))};c.prototype.setYesNoInput=
function(a){this._yesNoJudgeInNextFrame=a};c.prototype.getYesNoState=function(){return void 0!==this._yesNoJudgeInNextFrame?this._yesNoJudgeInNextFrame:this._yesNoJudge};c.prototype.setStatusChangedEffect=function(a){0!==a.strength&&(wwa_util.$id("disp-strength").classList.add("onpress"),this._statusPressCounter.strength=d.STATUS_CHANGED_EFFECT_FRAME_NUM);0!==a.defence&&(wwa_util.$id("disp-defence").classList.add("onpress"),this._statusPressCounter.defence=d.STATUS_CHANGED_EFFECT_FRAME_NUM);a instanceof
wwa_data.Status&&(0!==a.energy&&(wwa_util.$id("disp-energy").classList.add("onpress"),this._statusPressCounter.energy=d.STATUS_CHANGED_EFFECT_FRAME_NUM),0!==a.gold&&(wwa_util.$id("disp-gold").classList.add("onpress"),this._statusPressCounter.gold=d.STATUS_CHANGED_EFFECT_FRAME_NUM))};c.prototype.setPartsOnPosition=function(a,b,d){a===wwa_data.PartsType.MAP?(b>=this._wwaData.mapPartsMax&&(this._wwaData.map[d.y][d.x]=0),this._wwaData.map[d.y][d.x]=b):(b>=this._wwaData.objPartsMax&&(this._wwaData.mapObject[d.y][d.x]=
0),this._wwaData.mapObject[d.y][d.x]=b)};c.prototype._countSamePartsLength=function(a,b){var d;for(d=b+1;d<a.length&&a[d]===a[d-1];d++);return d-b};c.prototype._compressMap=function(a){for(var b=[],d=0;d<a.length;d++){b[d]=[];for(var c=0;c<a[d].length;){var f=this._countSamePartsLength(a[d],c);b[d].push([a[d][c],f]);c+=f}}return b};c.prototype._decompressMap=function(a){for(var b=[],d=0;d<a.length;d++){b[d]=[];for(var c=0;c<a[d].length;c++)for(var f=a[d][c][1],e=0;e<f;e++)b[d].push(a[d][c][0])}return b};
c.prototype._generateMapDataHash=function(a){var b="A",d,c;for(c=0;c<a.map.length;c++){for(d=0;d<a.map[c].length;){var f=this._countSamePartsLength(a.map[c],d);b+=a.map[c][d]+"|"+f+"/";d+=f}for(d=0;d<a.mapObject[c].length;)f=this._countSamePartsLength(a.mapObject[c],d),b+=a.mapObject[c][d]+"|"+f+"/",d+=f}for(f=0;f<a.mapAttribute.length;f++)for(d=0;d<a.mapAttribute[f].length;d++)b+=a.mapAttribute[f][d]+"/";for(f=0;f<a.objectAttribute.length;f++)for(d=0;d<a.objectAttribute[f].length;d++)b+=a.objectAttribute[f][d]+
"/";return CryptoJS.MD5(b+"Z").toString()};c.prototype._generateSaveDataHash=function(a){var b=this._generateMapDataHash(a),d=[],c;for(c in a)"map"!==c&&"mapObject"!==c&&"mapCompressed"!==c&&"mapObjectCompressed"!==c&&"mapAttribute"!==c&&"objectAttribute"!==c&&"checkString"!==c&&d.push(c);d.sort();for(c=0;c<d.length;c++)b+=wwa_util.arr2str4save(a[d[c]]);return CryptoJS.MD5(b).toString()};c.prototype._quickSave=function(a){void 0===a&&(a=!1);var b=JSON.parse(JSON.stringify(this._wwaData)),d=this._player.getPosition().getPartsCoord(),
c=this._player.getStatusWithoutEquipments();b.itemBox=this._player.getCopyOfItemBox();b.playerX=d.x;b.playerY=d.y;b.statusEnergyMax=this._player.getEnergyMax();b.statusEnergy=c.energy;b.statusStrength=c.strength;b.statusDefence=c.defence;b.statusGold=c.gold;b.moves=this._player.getMoveCount();a&&(b.checkOriginalMapString=this._generateMapDataHash(this._restartData),b.mapCompressed=this._compressMap(b.map),b.mapObjectCompressed=this._compressMap(b.mapObject),b.checkString=this._generateSaveDataHash(b),
b.map=void 0,b.mapObject=void 0);b.message=void 0;b.mapAttribute=void 0;b.objectAttribute=void 0;if(a)return a=JSON.stringify(b),CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(a),"^ /"+(231*this._wwaData.worldPassNumber+8310+b.checkOriginalMapString)+"P+>A[]").toString();this._quickSaveData=b;m.$id("cell-load").textContent="Quick Load";return""};c.prototype._decodePassword=function(a){var b=this._generateMapDataHash(this._restartData);try{var d=CryptoJS.AES.decrypt(a,"^ /"+(231*this._wwaData.worldPassNumber+
8310+b)+"P+>A[]").toString(CryptoJS.enc.Utf8)}catch(C){throw Error("\u30c7\u30fc\u30bf\u304c\u7834\u640d\u3057\u3066\u3044\u307e\u3059\u3002\n"+C.message);}try{var c=JSON.parse(d)}catch(C){throw Error("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u4ee5\u5916\u306e\u3082\u306e\u304c\u6697\u53f7\u5316\u3055\u308c\u305f\u304b\u3001\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306b\u4f55\u304b\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\nJSON PARSE FAILED");}return c};c.prototype._quickLoad=
function(a,b,d){void 0===a&&(a=!1);void 0===b&&(b=null);void 0===d&&(d=!0);if(!a&&void 0===this._quickSaveData&&null===b)throw Error("\u30bb\u30fc\u30d6\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002");a=null!==b?this._decodePassword(b):JSON.parse(JSON.stringify(a?this._restartData:this._quickSaveData));a.message=JSON.parse(JSON.stringify(this._restartData.message));a.mapAttribute=JSON.parse(JSON.stringify(this._restartData.mapAttribute));a.objectAttribute=JSON.parse(JSON.stringify(this._restartData.objectAttribute));
void 0===a.map&&(a.map=this._decompressMap(a.mapCompressed),a.mapCompressed=void 0);void 0===a.mapObject&&(a.mapObject=this._decompressMap(a.mapObjectCompressed),a.mapObjectCompressed=void 0);if(null!==b){b=this._generateSaveDataHash(a);if(a.checkString!==b)throw Error("\u30c7\u30fc\u30bf\u304c\u58ca\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\nInvalid hash (ALL DATA)= "+a.checkString+" "+this._generateSaveDataHash(a));b=this._generateMapDataHash(this._restartData);if(a.checkOriginalMapString!==
b)throw Error("\u7ba1\u7406\u8005\u306b\u3088\u3063\u3066\u30de\u30c3\u30d7\u304c\u5909\u66f4\u3055\u308c\u305f\u3088\u3046\u3067\u3059\u3002\nInvalid hash (ORIGINAL MAP)= "+a.checkString+" "+this._generateSaveDataHash(a));console.log("Valid Password!")}d&&this._applyQuickLoad(a);return a};c.prototype._applyQuickLoad=function(a){this._player.setEnergyMax(a.statusEnergyMax);this._player.setEnergy(a.statusEnergy);this._player.setStrength(a.statusStrength);this._player.setDefence(a.statusDefence);this._player.setGold(a.statusGold);
this._player.setMoveCount(a.moves);this._player.clearItemBox();for(var b=0;b<a.itemBox.length;b++)this._player.addItem(a.itemBox[b],b+1,!0);this._player.systemJumpTo(new wwa_data.Position(this,a.playerX,a.playerY,0,0));0===a.bgm?this.playSound(wwa_data.SystemSound.NO_SOUND):this.playSound(a.bgm);this.setImgClick(new x(a.imgClickX,a.imgClickY));0!==this.getObjectIdByPosition(this._player.getPosition())&&this._player.setPartsAppearedFlag();this._wwaData=a;this._replaceAllRandomObjects();this.updateCSSRule()};
c.prototype._restartGame=function(){this._quickLoad(!0)};c.prototype._fadeout=function(a){var b=0,c=d.MAP_WINDOW_WIDTH,f=d.FADEOUT_SPEED,e=wwa_util.$id("wwa-fader");e.style.display="block";var g=setInterval(function(){b+=f;c-=2*f;0>=c||2*b>d.MAP_WINDOW_WIDTH?(e.removeAttribute("style"),e.style.display="block",e.style.borderWidth="0",e.style.width=d.MAP_WINDOW_WIDTH+"px",e.style.height=d.MAP_WINDOW_HEIGHT+"px",e.style.backgroundColor="#808080",clearInterval(g),a()):(e.style.width=c+"px",e.style.height=
c+"px",e.style.borderWidth=b+"px")},20)};c.prototype.moveObjects=function(a){var b=this._camera.getPosition();this._player.getPosition();b.getPartsCoord();var c=b.getPartsCoord().x;b=b.getPartsCoord().y;var f,e;if(this.getMapAttributeByPosition(this._player.getPosition(),d.ATR_TYPE)!==d.MAP_LOCALGATE&&this.getObjectAttributeByPosition(this._player.getPosition(),d.ATR_TYPE)!==d.OBJECT_LOCALGATE){var g=Array(d.V_PARTS_NUM_IN_WINDOW+2);this.hoge=Array(d.V_PARTS_NUM_IN_WINDOW+2);for(e=-1;e<=d.V_PARTS_NUM_IN_WINDOW;e++)for(g[e+
1]=Array(d.H_PARTS_NUM_IN_WINDOW+2),this.hoge[e+1]=Array(d.H_PARTS_NUM_IN_WINDOW+2),f=-1;f<=d.H_PARTS_NUM_IN_WINDOW;f++)if(0>b+e||b+e>=this._wwaData.mapWidth||0>c+f||c+f>=this._wwaData.mapWidth)g[e+1][f+1]=0,this.hoge[e+1][f+1]=0;else{try{var k=new A(this,c+f,b+e,0,0);var m=k.getPartsCoord()}catch(r){g[e+1][f+1]=0;this.hoge[e+1][f+1]=0;continue}g[e+1][f+1]=this._wwaData.mapObject[m.y][m.x];this.hoge[e+1][f+1]=-this._wwaData.mapObject[m.y][m.x]}for(f=-1;f<=d.H_PARTS_NUM_IN_WINDOW;f++)if(!(0>c+f||c+
f>=this._wwaData.mapWidth))for(e=-1;e<=d.V_PARTS_NUM_IN_WINDOW;e++)if(!(0>b+e||b+e>=this._wwaData.mapWidth)){try{k=new A(this,c+f,b+e,0,0),m=k.getPartsCoord()}catch(r){continue}var y=this._wwaData.mapObject[m.y][m.x];if(0!==y&&this._wwaData.objectAttribute[y][d.ATR_TYPE]!==d.OBJECT_LOCALGATE&&this._wwaData.objectAttribute[y][d.ATR_TYPE]!==d.OBJECT_RANDOM&&(this._wwaData.objectAttribute[y][d.ATR_MOVE]===wwa_data.MoveType.CHASE_PLAYER||this._wwaData.objectAttribute[y][d.ATR_MOVE]===wwa_data.MoveType.RUN_OUT||
this._wwaData.objectAttribute[y][d.ATR_MOVE]===wwa_data.MoveType.HANG_AROUND)){var w=this._wwaData.objectAttribute[y][d.ATR_MOVE];if(w!==wwa_data.MoveType.HANG_AROUND){var h=this._getCandidateCoord(a,k,w),l=new x(h.x,m.y),B=new x(m.x,h.y);if(this._objectCanMoveTo(a,h,g))this._setObjectsInNextFrame(m,h,c,b,g,y);else{var p=this._getSecondCandidateMoveMode(a,m,h,l,B,this._wwaData.objectAttribute[y][d.ATR_TYPE]===d.OBJECT_MONSTER,g);p===wwa_data.SecondCandidateMoveType.MODE_X?this._setObjectsInNextFrame(m,
l,c,b,g,y):p===wwa_data.SecondCandidateMoveType.MODE_Y?this._setObjectsInNextFrame(m,B,c,b,g,y):(w=this._getThirdCandidate(a,k,h,w,g),null!==w&&31<=this._wwaData.version||(w=this._getRandomMoveCoord(a,k,g)),this._setObjectsInNextFrame(m,w,c,b,g,y))}}else w=this._getRandomMoveCoord(a,k,g),this._setObjectsInNextFrame(m,w,c,b,g,y)}}}};c.prototype._getCandidateCoord=function(a,b,d){b=b.getPartsCoord();this._player.getPosition().getOffsetCoord();this._player.getPosition().getPartsCoord();try{var c=a?this._player.getPosition().getNextJustPosition().getPartsCoord():
this._player.getPosition().getPartsCoord()}catch(I){throw Error("\u4e88\u671f\u305b\u306c\u65b9\u5411\u3078\u306e\u79fb\u52d5\u306e\u3088\u3046\u3067\u3059\u3002");}a=b.clone();var f=0,e=0;d===wwa_data.MoveType.CHASE_PLAYER?(f=b.x>c.x?1:b.x<c.x?-1:0,e=b.y>c.y?1:b.y<c.y?-1:0):d===wwa_data.MoveType.RUN_OUT&&(f=b.x>c.x?-1:b.x<c.x?1:0,e=b.y>c.y?-1:b.y<c.y?1:0);a.x-=f;a.y-=e;a.x=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.x));a.y=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.y));return a};c.prototype._getSecondCandidateMoveMode=
function(a,b,d,c,e,g,k){return!a||(this._player.getDir()!==wwa_data.Direction.UP&&this._player.getDir()!==wwa_data.Direction.DOWN||!g)&&(this._player.getDir()!==wwa_data.Direction.LEFT&&this._player.getDir()!==wwa_data.Direction.RIGHT||g)?this._objectCanMoveTo(a,c,k)?wwa_data.SecondCandidateMoveType.MODE_X:this._objectCanMoveTo(a,e,k)?wwa_data.SecondCandidateMoveType.MODE_Y:wwa_data.SecondCandidateMoveType.UNDECIDED:this._objectCanMoveTo(a,e,k)?wwa_data.SecondCandidateMoveType.MODE_Y:this._objectCanMoveTo(a,
c,k)?wwa_data.SecondCandidateMoveType.MODE_X:wwa_data.SecondCandidateMoveType.UNDECIDED};c.prototype._getThirdCandidate=function(a,b,d,c,e){c=c===wwa_data.MoveType.CHASE_PLAYER?1:c===wwa_data.MoveType.RUN_OUT?-1:0;var f=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord();b=b.getPartsCoord();if(f.x!==b.x){var g=new x(d.x,b.y+1*c);if(this._objectCanMoveTo(a,g,e))return g;g=new x(d.x,b.y-1*c);if(this._objectCanMoveTo(a,g,e))return g;g=new x(b.x,
b.y+1*c);if(this._objectCanMoveTo(a,g,e))return g;g=new x(b.x,b.y-1*c);if(this._objectCanMoveTo(a,g,e))return g}if(f.y!==b.y){g=new x(b.x+1*c,d.y);if(this._objectCanMoveTo(a,g,e))return g;g=new x(b.x-1*c,d.y);if(this._objectCanMoveTo(a,g,e))return g;g=new x(b.x+1*c,b.y);if(this._objectCanMoveTo(a,g,e))return g;g=new x(b.x-1*c,b.y);if(this._objectCanMoveTo(a,g,e))return g}return null};c.prototype._getRandomMoveCoord=function(a,b,c){b=b.getPartsCoord();for(var f=b.clone(),e=31>this._wwaData.version?
d.RANDOM_MOVE_ITERATION_NUM_BEFORE_V31:d.RANDOM_MOVE_ITERATION_NUM,g=0;g<e;g++){var k=Math.floor(8*Math.random());f.x=b.x+wwa_data.vx[k];f.y=b.y+wwa_data.vy[k];if(this._objectCanMoveTo(a,f,c))return f}return b};c.prototype.isPrevFrameEventExecuted=function(){return this._prevFrameEventExected};c.prototype._objectCanMoveTo=function(a,b,c){if(0>b.x||0>b.y||this._wwaData.mapWidth<=b.x||this._wwaData.mapWidth<=b.y)return!1;var f=this._wwaData.map[b.y][b.x],e=this._wwaData.mapObject[b.y][b.x],g=this._wwaData.mapAttribute[f][d.ATR_TYPE],
k=this._camera.getPosition(),m=k.getPartsCoord().x;k=k.getPartsCoord().y;if(0===f&&!this.isOldMap()||g===d.MAP_WALL)return!1;f=b.x-m+1;g=b.y-k+1;if(0<=f&&0<=g&&f<c.length&&g<c.length){if(0!==c[g][f])return!1}else if(0!==e)return!1;if(a){if(this._player.getPosition().getNextJustPosition().getPartsCoord().equals(b))return!1}else if(this._player.getPosition().getPartsCoord().equals(b))return!1;return!0};c.prototype._setObjectsInNextFrame=function(a,b,d,c,e,g){var f=b.x-d+1,k=b.y-c+1;0<=b.x&&b.x<=this._wwaData.mapWidth&&
0<=b.y&&b.y<=this._wwaData.mapWidth&&(0<=f&&f<e.length&&0<=k&&k<e.length&&(e[a.y-c+1][a.x-d+1]=0,e[b.y-c+1][b.x-d+1]=g,this.hoge[b.y-c+1][b.x-d+1]=g),this._objectMovingDataManager.add(g,a.convertIntoPosition(this),b.convertIntoPosition(this),a.getDirectionTo(b)))};c.prototype.launchBattleEstimateWindow=function(){var a=this._camera.getPosition().getPartsCoord(),b=Math.max(0,a.x),c=Math.min(this._wwaData.mapWidth-1,a.x+d.H_PARTS_NUM_IN_WINDOW-1),e=Math.max(0,a.y);a=Math.min(this._wwaData.mapWidth-
1,a.y+d.V_PARTS_NUM_IN_WINDOW-1);var g=[];for(this.playSound(wwa_data.SystemSound.DECISION);b<=c;b++)for(var k=e;k<=a;k++){var m=this._wwaData.mapObject[k][b];this._wwaData.objectAttribute[m][d.ATR_TYPE]===d.OBJECT_MONSTER&&-1===g.indexOf(m)&&g.push(m)}if(0===g.length)return!1;this._battleEstimateWindow.update(this._player.getStatus(),g);this._battleEstimateWindow.show();this._player.setEstimateWindowWating();return!0};c.prototype.hideBattleEstimateWindow=function(){this._battleEstimateWindow.hide();
this._player.clearEstimateWindowWaiting()};c.prototype.hidePasswordWindow=function(a){void 0===a&&(a=!1);this._passwordWindow.hide();if(a||this._passwordWindow.mode===wwa_password_window.Mode.SAVE)this._player.clearPasswordWindowWaiting();else{try{var b=this._quickLoad(!1,this._passwordWindow.password,!1)}catch(v){this._player.clearPasswordWindowWaiting();alert("\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u6b63\u5e38\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u30a8\u30e9\u30fc\u8a73\u7d30:\n"+v.message);
return}this._passwordLoadExecInNextFrame=!0;this._passwordSaveExtractData=b}};c.prototype._displayHelp=function(){this._player.isControllable()&&this.setMessageQueue("\u3000\u3010\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30ad\u30fc\u306e\u4e00\u89a7\u3011\n\uff26\uff11\u3001\uff2d\uff1a\u6226\u95d8\u7d50\u679c\u4e88\u6e2c\u306e\u8868\u793a\n\uff26\uff13\uff1a\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\n\uff26\uff14\uff1a\u5fa9\u5e30\u7528\u30d1\u30b9\u30ef\u30fc\u30c9\u8868\u793a\n\uff26\uff15\uff1a\u4e00\u6642\u4fdd\u5b58\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\n\uff26\uff16\uff1a\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\n\uff26\uff17\uff1a\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\n\uff26\uff18\uff1a\uff37\uff37\uff21\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\n\uff26\uff11\uff12\uff1a\u3053\u306e\u30ea\u30b9\u30c8\u306e\u8868\u793a\n\u30ad\u30fc\u30dc\u30fc\u30c9\u306e\u300c\uff11\uff12\uff13\u3001\uff31\uff37\uff25\u3001\uff21\uff33\uff24\u3001\uff3a\uff38\uff23\u300d\u306f\u53f3\u306e\u30a2\u30a4\u30c6\u30e0\u30dc\u30c3\u30af\u30b9\u306b\u5bfe\u5fdc\u3002\n\u300c\uff25\uff4e\uff54\uff45\uff52\u3001\uff39\u300d\u306f\uff39\uff45\uff53,\n\u300c\uff25\uff53\uff43\u3001\uff2e\u300d\u306f\uff2e\uff4f\u306b\u5bfe\u5fdc\u3002\n\u3000\u3000\u3000\uff29: \u79fb\u52d5\u901f\u5ea6\u3092\u843d\u3068\u3059\uff0f\n\uff26\uff12\u3001\uff30: \u79fb\u52d5\u901f\u5ea6\u3092\u4e0a\u3052\u308b\n\u3000\u3000\u73fe\u5728\u306e\u79fb\u52d5\u56de\u6570\uff1a"+
this._player.getMoveCount()+"\n\u3000WWA Wing \u30d0\u30fc\u30b8\u30e7\u30f3:"+d.VERSION_WWAJS+"\n\u3000\u30de\u30c3\u30d7\u30c7\u30fc\u30bf \u30d0\u30fc\u30b8\u30e7\u30f3: "+Math.floor(this._wwaData.version/10)+"."+this._wwaData.version%10,!1,!0)};c.prototype._setNextMessage=function(a){void 0===a&&(a=!1);this._clearFacesInNextFrame=!0;this._scoreWindow.isVisible()&&this._scoreWindow.hide();this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),
this._reservedMoveMacroTurn=void 0);if(0===this._messageQueue.length)this._hideMessageWindow();else{var b=this._messageQueue.shift(),d=b.message,c=b.macro;this._lastMessage=b;for(b=0;b<c.length;b++)this._execMacroListInNextFrame.push(c[b]);""!==d?(this._messageWindow.hide(),this._messageWindow.setMessage(d),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),a,this._player.getPosition(),this._camera.getPosition()),this._messageWindow.show()):0===this._messageQueue.length?
this._hideMessageWindow():this._setNextMessage()}};c.prototype._hideMessageWindow=function(a){void 0===a&&(a=!0);var b=0;this._player.isReadyToUseItem()&&(b=this._player.useItem());var c=this.getObjectAttributeById(b,d.ATR_STRING);this.clearFaces();0===c?(a&&(this._messageWindow.hide(),this._keyStore.allClear(),this._mouseStore.clear()),this._player.clearMessageWaiting()):this.setMessageQueue(this.getMessageById(c),!1,!1,b,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord(),!0)};
c.prototype.replaceParts=function(a,b,c,e){void 0===c&&(c=wwa_data.PartsType.OBJECT);void 0===e&&(e=!1);var f=this._camera.getPosition().getPartsCoord(),g=e?Math.min(this._wwaData.mapWidth-1,f.x+d.H_PARTS_NUM_IN_WINDOW-1):this._wwaData.mapWidth-1,k=e?Math.max(0,f.y):0,m=e?Math.min(this._wwaData.mapWidth-1,f.y+d.V_PARTS_NUM_IN_WINDOW)-1:this._wwaData.mapWidth-1;for(f=e?Math.max(0,f.x):0;f<=g;f++)for(var n=k;n<=m;n++)c===wwa_data.PartsType.OBJECT?(e=this._wwaData.mapObject[n][f],e===a&&(this._wwaData.mapObject[n][f]=
b)):(e=this._wwaData.map[n][f],e===a&&(this._wwaData.map[n][f]=b))};c.prototype.getYesNoImgCoord=function(){return new x(this._wwaData.yesnoImgPosX,this._wwaData.yesnoImgPosY)};c.prototype.setYesNoImgCoord=function(a){this._wwaData.yesnoImgPosX=a.x;this._wwaData.yesnoImgPosY=a.y;return a};c.prototype.getPlayerImgCoord=function(){return new x(this._wwaData.playerImgPosX,this._wwaData.playerImgPosY)};c.prototype.setPlayerImgCoord=function(a){this._wwaData.playerImgPosX=a.x;this._wwaData.playerImgPosY=
a.y;return a};c.prototype.setPlayerEnergyMax=function(a){return this._player.setEnergyMax(a)};c.prototype.getMapPartsNum=function(){return this._wwaData.mapPartsMax};c.prototype.getObjectPartsNum=function(){return this._wwaData.objPartsMax};c.prototype.setMoveMacroWaitingToPlayer=function(a){this._reservedMoveMacroTurn=a};c.prototype.disableSave=function(a){return this._wwaData.disableSaveFlag=a};c.prototype.isOldMap=function(){return this._wwaData.isOldMap};c.prototype.setOldMap=function(a){return this._wwaData.isOldMap=
a};c.prototype.setObjectNotCollapseOnPartsOnPlayer=function(a){return this._wwaData.objectNoCollapseDefaultFlag=a};c.prototype.setGameOverPosition=function(a){if(0>a.x||a.x>=this.getMapWidth()||0>a.y||a.y>=this.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");this._wwaData.gameoverX=a.x;this._wwaData.gameoverY=a.y;return a};c.prototype.setPlayerStatus=function(a,b){if(a===wwa_data.MacroStatusIndex.ENERGY)this._player.setEnergy(b);
else if(a===wwa_data.MacroStatusIndex.STRENGTH)this._player.setStrength(b);else if(a===wwa_data.MacroStatusIndex.DEFENCE)this._player.setDefence(b);else if(a===wwa_data.MacroStatusIndex.GOLD)this._player.setGold(b);else if(a===wwa_data.MacroStatusIndex.MOVES)this._player.setMoveCount(b);else throw Error("\u672a\u5b9a\u7fa9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30bf\u30a4\u30d7\u3067\u3059");};c.prototype.setDelPlayer=function(a){return this._wwaData.delPlayerFlag=a};c.prototype.setPlayerGetItem=function(a,
b){try{this._player.addItem(b,a,!0)}catch(v){}};c.prototype.setFrameCoord=function(a){return this._frameCoord=a.clone()};c.prototype.setBattleEffectCoord=function(a){return this._battleEffectCoord=a.clone()};c.prototype.canInput=function(){return!this._temporaryInputDisable};c.prototype.setWaitTime=function(a){this._waitTimeInCurrentFrame+=a;this._temporaryInputDisable=!0};c.prototype.setEffect=function(a,b){this._wwaData.effectWaits=a;this._wwaData.effectCoords=b};c.prototype.stopEffect=function(){this._wwaData.effectCoords=
[]};c.prototype.setImgClick=function(a){this._wwaData.imgClickX=a.x;this._wwaData.imgClickY=a.y;if(a.equals(new x(0,0)))Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage="url('"+wwa_data.WWAConsts.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0"});else{var b=this._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(c){c.style.backgroundImage=
"url('"+b+"')";c.style.backgroundPosition="-"+a.x*d.CHIP_SIZE+"px -"+a.y*d.CHIP_SIZE+"px"})}};c.prototype.addFace=function(a){this._faces.push(a)};c.prototype.clearFaces=function(){this._faces=[]};c.prototype.initCSSRule=function(){this._styleElm=wwa_util.$id(d.WWA_STYLE_TAG_ID);this._sheet=this._styleElm.sheet;this.updateCSSRule()};c.prototype.updateCSSRule=function(){var a=this._isClassicModeEnable?1:.9;if(void 0===this._stylePos)this._stylePos=Array(2);else if(void 0!==this._sheet.addRule)for(var b=
0;b<this._stylePos.length;b++)this._sheet.removeRule(this._stylePos[this._styleElm[b]]);else for(b=0;b<this._stylePos.length;b++)this._sheet.deleteRule(this._stylePos[this._styleElm[b]]);void 0!==this._sheet.addRule?(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=this._sheet.addRule("div.wwa-message-window, div#wwa-battle-estimate, div#wwa-password-window","background-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+", "+a+");border-color: rgba("+
this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+", 1);color: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+", 1);"),this._stylePos[wwa_data.SelectorType.SIDEBAR]=this._sheet.addRule("div#wwa-sidebar","color: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);font-weight: bold;")):(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=this._sheet.insertRule("div.wwa-message-window, div#wwa-battle-estimate, div#wwa-password-window {\nbackground-color: rgba("+
this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+", "+a+");\nborder-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+", 1);\ncolor: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+", 1);\n}",0),this._stylePos[wwa_data.SelectorType.SIDEBAR]=this._sheet.insertRule("div#wwa-sidebar {\ncolor: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+
",1);\nfont-weight: bold;\n}",1))};c.prototype.changeStyleRule=function(a,b,d,c){a===wwa_data.ChangeStyleType.COLOR_FRAME?(this._wwaData.frameColorR=b,this._wwaData.frameColorG=d,this._wwaData.frameColorB=c):a===wwa_data.ChangeStyleType.COLOR_FRAMEOUT?(this._wwaData.frameOutColorR=b,this._wwaData.frameOutColorG=d,this._wwaData.frameOutColorB=c):a===wwa_data.ChangeStyleType.COLOR_STR?(this._wwaData.fontColorR=b,this._wwaData.fontColorG=d,this._wwaData.fontColorB=c):a===wwa_data.ChangeStyleType.COLOR_STATUS_STR&&
(this._wwaData.statusColorR=b,this._wwaData.statusColorG=d,this._wwaData.statusColorB=c);this.updateCSSRule()};c.prototype.showMonsterWindow=function(){this._monsterWindow.show()};c.prototype.isClassicMode=function(){return this._isClassicModeEnable};c.prototype.isConsoleOutputMode=function(){return this._useConsole};return c}();c.WWA=B;var k=!1;"complete"===document.readyState?g():window.addEventListener("load",g)})(wwa_main||(wwa_main={}));
var CryptoJS=CryptoJS||function(c,e){var g={},b=g.lib={},t=function(){},h=b.Base={extend:function(a){t.prototype=this;var b=new t;a&&b.mixIn(a);b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)});b.init.prototype=b;b.$super=this;return b},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
a=b.WordArray=h.extend({init:function(a,b){a=this.words=a||[];this.sigBytes=b!=e?b:4*a.length},toString:function(a){return(a||l).stringify(this)},concat:function(a){var b=this.words,d=a.words,c=this.sigBytes;a=a.sigBytes;this.clamp();if(c%4)for(var f=0;f<a;f++)b[c+f>>>2]|=(d[f>>>2]>>>24-f%4*8&255)<<24-(c+f)%4*8;else if(65535<d.length)for(f=0;f<a;f+=4)b[c+f>>>2]=d[f>>>2];else b.push.apply(b,d);this.sigBytes+=a;return this},clamp:function(){var a=this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-
b%4*8;a.length=c.ceil(b/4)},clone:function(){var a=h.clone.call(this);a.words=this.words.slice(0);return a},random:function(b){for(var d=[],e=0;e<b;e+=4)d.push(4294967296*c.random()|0);return new a.init(d,b)}}),u=g.enc={},l=u.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var d=[],c=0;c<a;c++){var f=b[c>>>2]>>>24-c%4*8&255;d.push((f>>>4).toString(16));d.push((f&15).toString(16))}return d.join("")},parse:function(b){for(var d=b.length,c=[],e=0;e<d;e+=2)c[e>>>3]|=parseInt(b.substr(e,2),16)<<
24-e%8*4;return new a.init(c,d/2)}},d=u.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var d=[],c=0;c<a;c++)d.push(String.fromCharCode(b[c>>>2]>>>24-c%4*8&255));return d.join("")},parse:function(b){for(var d=b.length,c=[],e=0;e<d;e++)c[e>>>2]|=(b.charCodeAt(e)&255)<<24-e%4*8;return new a.init(c,d)}},x=u.Utf8={stringify:function(a){try{return decodeURIComponent(escape(d.stringify(a)))}catch(B){throw Error("Malformed UTF-8 data");}},parse:function(a){return d.parse(unescape(encodeURIComponent(a)))}},
A=b.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new a.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=x.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var d=this._data,e=d.words,g=d.sigBytes,f=this.blockSize,n=g/(4*f);n=b?c.ceil(n):c.max((n|0)-this._minBufferSize,0);b=n*f;g=c.min(4*b,g);if(b){for(var w=0;w<b;w+=f)this._doProcessBlock(e,w);w=e.splice(0,b);d.sigBytes-=g}return new a.init(w,g)},clone:function(){var a=h.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});b.Hasher=A.extend({cfg:h.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){A.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,d){return(new a.init(d)).finalize(b)}},_createHmacHelper:function(a){return function(b,d){return(new w.HMAC.init(a,
d)).finalize(b)}}});var w=g.algo={};return g}(Math);
(function(){var c=CryptoJS,e=c.lib.WordArray;c.enc.Base64={stringify:function(c){var b=c.words,e=c.sigBytes,g=this._map;c.clamp();c=[];for(var a=0;a<e;a+=3)for(var u=(b[a>>>2]>>>24-a%4*8&255)<<16|(b[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|b[a+2>>>2]>>>24-(a+2)%4*8&255,l=0;4>l&&a+.75*l<e;l++)c.push(g.charAt(u>>>6*(3-l)&63));if(b=g.charAt(64))for(;c.length%4;)c.push(b);return c.join("")},parse:function(c){var b=c.length,g=this._map,h=g.charAt(64);h&&(h=c.indexOf(h),-1!=h&&(b=h));h=[];for(var a=0,u=0;u<b;u++)if(u%
4){var l=g.indexOf(c.charAt(u-1))<<u%4*2,d=g.indexOf(c.charAt(u))>>>6-u%4*2;h[a>>>2]|=(l|d)<<24-a%4*8;a++}return e.create(h,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();
(function(c){function e(a,b,d,c,e,g,f){a=a+(b&d|~b&c)+e+f;return(a<<g|a>>>32-g)+b}function g(a,b,d,c,e,g,f){a=a+(b&c|d&~c)+e+f;return(a<<g|a>>>32-g)+b}function b(a,b,d,c,e,g,f){a=a+(b^d^c)+e+f;return(a<<g|a>>>32-g)+b}function t(a,b,d,c,e,g,f){a=a+(d^(b|~c))+e+f;return(a<<g|a>>>32-g)+b}var h=CryptoJS,a=h.lib,u=a.WordArray,l=a.Hasher;a=h.algo;for(var d=[],x=0;64>x;x++)d[x]=4294967296*c.abs(c.sin(x+1))|0;a=a.MD5=l.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(a,c){for(var h,l,k=0;16>k;k++)l=c+k,h=a[l],a[l]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;k=this._hash.words;l=a[c+0];h=a[c+1];var y=a[c+2],f=a[c+3],n=a[c+4],v=a[c+5],u=a[c+6],w=a[c+7],x=a[c+8],A=a[c+9],F=a[c+10],G=a[c+11],E=a[c+12],H=a[c+13],D=a[c+14];a=a[c+15];c=k[0];var q=k[1],p=k[2],r=k[3];c=e(c,q,p,r,l,7,d[0]);r=e(r,c,q,p,h,12,d[1]);p=e(p,r,c,q,y,17,d[2]);q=e(q,p,r,c,f,22,d[3]);c=e(c,q,p,r,n,7,d[4]);r=e(r,c,q,p,v,12,d[5]);p=e(p,r,c,q,u,17,d[6]);q=e(q,p,r,c,w,22,
d[7]);c=e(c,q,p,r,x,7,d[8]);r=e(r,c,q,p,A,12,d[9]);p=e(p,r,c,q,F,17,d[10]);q=e(q,p,r,c,G,22,d[11]);c=e(c,q,p,r,E,7,d[12]);r=e(r,c,q,p,H,12,d[13]);p=e(p,r,c,q,D,17,d[14]);q=e(q,p,r,c,a,22,d[15]);c=g(c,q,p,r,h,5,d[16]);r=g(r,c,q,p,u,9,d[17]);p=g(p,r,c,q,G,14,d[18]);q=g(q,p,r,c,l,20,d[19]);c=g(c,q,p,r,v,5,d[20]);r=g(r,c,q,p,F,9,d[21]);p=g(p,r,c,q,a,14,d[22]);q=g(q,p,r,c,n,20,d[23]);c=g(c,q,p,r,A,5,d[24]);r=g(r,c,q,p,D,9,d[25]);p=g(p,r,c,q,f,14,d[26]);q=g(q,p,r,c,x,20,d[27]);c=g(c,q,p,r,H,5,d[28]);r=
g(r,c,q,p,y,9,d[29]);p=g(p,r,c,q,w,14,d[30]);q=g(q,p,r,c,E,20,d[31]);c=b(c,q,p,r,v,4,d[32]);r=b(r,c,q,p,x,11,d[33]);p=b(p,r,c,q,G,16,d[34]);q=b(q,p,r,c,D,23,d[35]);c=b(c,q,p,r,h,4,d[36]);r=b(r,c,q,p,n,11,d[37]);p=b(p,r,c,q,w,16,d[38]);q=b(q,p,r,c,F,23,d[39]);c=b(c,q,p,r,H,4,d[40]);r=b(r,c,q,p,l,11,d[41]);p=b(p,r,c,q,f,16,d[42]);q=b(q,p,r,c,u,23,d[43]);c=b(c,q,p,r,A,4,d[44]);r=b(r,c,q,p,E,11,d[45]);p=b(p,r,c,q,a,16,d[46]);q=b(q,p,r,c,y,23,d[47]);c=t(c,q,p,r,l,6,d[48]);r=t(r,c,q,p,w,10,d[49]);p=t(p,
r,c,q,D,15,d[50]);q=t(q,p,r,c,v,21,d[51]);c=t(c,q,p,r,E,6,d[52]);r=t(r,c,q,p,f,10,d[53]);p=t(p,r,c,q,F,15,d[54]);q=t(q,p,r,c,h,21,d[55]);c=t(c,q,p,r,x,6,d[56]);r=t(r,c,q,p,a,10,d[57]);p=t(p,r,c,q,u,15,d[58]);q=t(q,p,r,c,H,21,d[59]);c=t(c,q,p,r,n,6,d[60]);r=t(r,c,q,p,G,10,d[61]);p=t(p,r,c,q,y,15,d[62]);q=t(q,p,r,c,A,21,d[63]);k[0]=k[0]+c|0;k[1]=k[1]+q|0;k[2]=k[2]+p|0;k[3]=k[3]+r|0},_doFinalize:function(){var a=this._data,b=a.words,d=8*this._nDataBytes,e=8*a.sigBytes;b[e>>>5]|=128<<24-e%32;var g=c.floor(d/
4294967296);b[(e+64>>>9<<4)+15]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360;b[(e+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360;a.sigBytes=4*(b.length+1);this._process();a=this._hash;b=a.words;for(d=0;4>d;d++)e=b[d],b[d]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;return a},clone:function(){var a=l.clone.call(this);a._hash=this._hash.clone();return a}});h.MD5=l._createHelper(a);h.HmacMD5=l._createHmacHelper(a)})(Math);
(function(){var c=CryptoJS,e=c.lib,g=e.Base,b=e.WordArray;e=c.algo;var t=e.EvpKDF=g.extend({cfg:g.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(b){this.cfg=this.cfg.extend(b)},compute:function(c,a){var e=this.cfg,g=e.hasher.create(),d=b.create(),h=d.words,t=e.keySize;for(e=e.iterations;h.length<t;){w&&g.update(w);var w=g.update(c).finalize(a);g.reset();for(var m=1;m<e;m++)w=g.finalize(w),g.reset();d.concat(w)}d.sigBytes=4*t;return d}});c.EvpKDF=function(b,a,c){return t.create(c).compute(b,
a)}})();
CryptoJS.lib.Cipher||function(c){var e=CryptoJS,g=e.lib,b=g.Base,t=g.WordArray,h=g.BufferedBlockAlgorithm,a=e.enc.Base64,u=e.algo.EvpKDF,l=g.Cipher=h.extend({cfg:b.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c);this._xformMode=a;this._key=b;this.reset()},reset:function(){h.reset.call(this);this._doReset()},process:function(a){this._append(a);return this._process()},
finalize:function(a){a&&this._append(a);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(b,c,d){return("string"==typeof c?B:m).encrypt(a,b,c,d)},decrypt:function(b,c,d){return("string"==typeof c?B:m).decrypt(a,b,c,d)}}}});g.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=e.mode={},x=function(a,b,d){var e=this._iv;e?this._iv=c:e=this._prevBlock;for(var f=0;f<d;f++)a[b+f]^=
e[f]},A=(g.BlockCipherMode=b.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a;this._iv=b}})).extend();A.Encryptor=A.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize;x.call(this,a,b,d);c.encryptBlock(a,b);this._prevBlock=a.slice(b,b+d)}});A.Decryptor=A.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize,e=a.slice(b,b+d);c.decryptBlock(a,b);x.call(this,
a,b,d);this._prevBlock=e}});d=d.CBC=A;A=(e.pad={}).Pkcs7={pad:function(a,b){b*=4;b-=a.sigBytes%b;for(var c=b<<24|b<<16|b<<8|b,d=[],e=0;e<b;e+=4)d.push(c);b=t.create(d,b);a.concat(b)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};g.BlockCipher=l.extend({cfg:l.cfg.extend({mode:d,padding:A}),reset:function(){l.reset.call(this);var a=this.cfg,b=a.iv;a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,
this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var w=g.CipherParams=b.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}});d=(e.format={}).OpenSSL={stringify:function(b){var c=b.ciphertext;b=b.salt;return(b?t.create([1398893684,
1701076831]).concat(b).concat(c):c).toString(a)},parse:function(b){b=a.parse(b);var c=b.words;if(1398893684==c[0]&&1701076831==c[1]){var d=t.create(c.slice(2,4));c.splice(0,4);b.sigBytes-=16}return w.create({ciphertext:b,salt:d})}};var m=g.SerializableCipher=b.extend({cfg:b.extend({format:d}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d);b=e.finalize(b);e=e.cfg;return w.create({ciphertext:b,key:c,iv:e.iv,algorithm:a,mode:e.mode,padding:e.padding,blockSize:a.blockSize,
formatter:d.format})},decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);return a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}});e=(e.kdf={}).OpenSSL={execute:function(a,b,c,d){d||(d=t.random(8));a=u.create({keySize:b+c}).compute(a,d);c=t.create(a.words.slice(b),4*c);a.sigBytes=4*b;return w.create({key:a,iv:c,salt:d})}};var B=g.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:e}),encrypt:function(a,b,c,d){d=
this.cfg.extend(d);c=d.kdf.execute(c,a.keySize,a.ivSize);d.iv=c.iv;a=m.encrypt.call(this,a,b,c.key,d);a.mixIn(c);return a},decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);c=d.kdf.execute(c,a.keySize,a.ivSize,b.salt);d.iv=c.iv;return m.decrypt.call(this,a,b,c.key,d)}})}();
(function(){for(var c=CryptoJS,e=c.lib.BlockCipher,g=c.algo,b=[],t=[],h=[],a=[],u=[],l=[],d=[],x=[],A=[],w=[],m=[],B=0;256>B;B++)m[B]=128>B?B<<1:B<<1^283;var k=0,y=0;for(B=0;256>B;B++){var f=y^y<<1^y<<2^y<<3^y<<4;f=f>>>8^f&255^99;b[k]=f;t[f]=k;var n=m[k],v=m[n],z=m[v],C=257*m[f]^16843008*f;h[k]=C<<24|C>>>8;a[k]=C<<16|C>>>16;u[k]=C<<8|C>>>24;l[k]=C;C=16843009*z^65537*v^257*n^16843008*k;d[f]=C<<24|C>>>8;x[f]=C<<16|C>>>16;A[f]=C<<8|C>>>24;w[f]=C;k?(k=n^m[m[m[z^n]]],y^=m[m[y]]):k=y=1}var J=[0,1,2,4,8,
16,32,64,128,27,54];g=g.AES=e.extend({_doReset:function(){var a=this._key,c=a.words,e=a.sigBytes/4;a=4*((this._nRounds=e+6)+1);for(var f=this._keySchedule=[],g=0;g<a;g++)if(g<e)f[g]=c[g];else{var h=f[g-1];g%e?6<e&&4==g%e&&(h=b[h>>>24]<<24|b[h>>>16&255]<<16|b[h>>>8&255]<<8|b[h&255]):(h=h<<8|h>>>24,h=b[h>>>24]<<24|b[h>>>16&255]<<16|b[h>>>8&255]<<8|b[h&255],h^=J[g/e|0]<<24);f[g]=f[g-e]^h}c=this._invKeySchedule=[];for(e=0;e<a;e++)g=a-e,h=e%4?f[g]:f[g-4],c[e]=4>e||4>=g?h:d[b[h>>>24]]^x[b[h>>>16&255]]^
A[b[h>>>8&255]]^w[b[h&255]]},encryptBlock:function(c,d){this._doCryptBlock(c,d,this._keySchedule,h,a,u,l,b)},decryptBlock:function(a,b){var c=a[b+1];a[b+1]=a[b+3];a[b+3]=c;this._doCryptBlock(a,b,this._invKeySchedule,d,x,A,w,t);c=a[b+1];a[b+1]=a[b+3];a[b+3]=c},_doCryptBlock:function(a,b,c,d,e,f,g,h){var n=this._nRounds;var k=a[b]^c[0];var l=a[b+1]^c[1];var m=a[b+2]^c[2];var p=a[b+3]^c[3];for(var q=4,t=1;t<n;t++){var u=d[k>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[p&255]^c[q++];var v=d[l>>>24]^e[m>>>16&255]^
f[p>>>8&255]^g[k&255]^c[q++];var w=d[m>>>24]^e[p>>>16&255]^f[k>>>8&255]^g[l&255]^c[q++];p=d[p>>>24]^e[k>>>16&255]^f[l>>>8&255]^g[m&255]^c[q++];k=u;l=v;m=w}u=(h[k>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[p&255])^c[q++];v=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[p>>>8&255]<<8|h[k&255])^c[q++];w=(h[m>>>24]<<24|h[p>>>16&255]<<16|h[k>>>8&255]<<8|h[l&255])^c[q++];p=(h[p>>>24]<<24|h[k>>>16&255]<<16|h[l>>>8&255]<<8|h[m&255])^c[q++];a[b]=u;a[b+1]=v;a[b+2]=w;a[b+3]=p},keySize:8});c.AES=e._createHelper(g)})();
